!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Sketchbook=t():e.Sketchbook=t()}(self,()=>(()=>{var e={3687:function(e,t,i){"use strict";let n,r,a,s,o,l,c;i.r(t),i.d(t,{AABB:()=>v,ArrayCollisionMatrix:()=>_,BODY_SLEEP_STATES:()=>F,BODY_TYPES:()=>U,Body:()=>k,Box:()=>B,Broadphase:()=>$,COLLISION_TYPES:()=>iK,ConeTwistConstraint:()=>tt,Constraint:()=>ez,ContactEquation:()=>eK,ContactMaterial:()=>tu,ConvexPolyhedron:()=>R,Cylinder:()=>t9,DistanceConstraint:()=>ti,Equation:()=>eV,EventTarget:()=>A,FrictionEquation:()=>tl,GSSolver:()=>iB,GridBroadphase:()=>er,Heightfield:()=>ii,HingeConstraint:()=>ta,JacobianElement:()=>eH,LockConstraint:()=>tn,Mat3:()=>u,Material:()=>td,NaiveBroadphase:()=>es,Narrowphase:()=>iQ,ObjectCollisionMatrix:()=>h,Particle:()=>t7,Plane:()=>ie,PointToPointConstraint:()=>e4,Pool:()=>iX,Quaternion:()=>b,RAY_MODES:()=>el,Ray:()=>ec,RaycastResult:()=>eo,RaycastVehicle:()=>tT,RigidVehicle:()=>tJ,RotationalEquation:()=>e9,RotationalMotorEquation:()=>tr,SAPBroadphase:()=>eF,SHAPE_TYPES:()=>M,SPHSystem:()=>t0,Shape:()=>E,Solver:()=>iD,Sphere:()=>tQ,SplitSolver:()=>iF,Spring:()=>tp,Transform:()=>C,Trimesh:()=>ix,Vec3:()=>p,Vec3Pool:()=>iY,WheelInfo:()=>tM,World:()=>n6});class h{constructor(){this.matrix={}}get(e,t){let{id:i}=e,{id:n}=t;if(n>i){let e=n;n=i,i=e}return`${i}-${n}`in this.matrix}set(e,t,i){let{id:n}=e,{id:r}=t;if(r>n){let e=r;r=n,n=e}i?this.matrix[`${n}-${r}`]=!0:delete this.matrix[`${n}-${r}`]}reset(){this.matrix={}}setNumObjects(e){}}class u{constructor(e){void 0===e&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){let e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){let e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){let t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){void 0===e&&(e=new p);let t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){void 0===t&&(t=new p);let i=this.elements,n=e.x,r=e.y,a=e.z;return t.x=i[0]*n+i[1]*r+i[2]*a,t.y=i[3]*n+i[4]*r+i[5]*a,t.z=i[6]*n+i[7]*r+i[8]*a,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){void 0===t&&(t=new u);let i=this.elements,n=e.elements,r=t.elements,a=i[0],s=i[1],o=i[2],l=i[3],c=i[4],h=i[5],d=i[6],p=i[7],f=i[8],m=n[0],g=n[1],v=n[2],y=n[3],x=n[4],_=n[5],A=n[6],b=n[7],S=n[8];return r[0]=a*m+s*y+o*A,r[1]=a*g+s*x+o*b,r[2]=a*v+s*_+o*S,r[3]=l*m+c*y+h*A,r[4]=l*g+c*x+h*b,r[5]=l*v+c*_+h*S,r[6]=d*m+p*y+f*A,r[7]=d*g+p*x+f*b,r[8]=d*v+p*_+f*S,t}scale(e,t){void 0===t&&(t=new u);let i=this.elements,n=t.elements;for(let t=0;3!==t;t++)n[3*t+0]=e.x*i[3*t+0],n[3*t+1]=e.y*i[3*t+1],n[3*t+2]=e.z*i[3*t+2];return t}solve(e,t){let i,n,r,a;void 0===t&&(t=new p);let s=[];for(i=0;i<12;i++)s.push(0);for(i=0;i<3;i++)for(n=0;n<3;n++)s[i+4*n]=this.elements[i+3*n];s[3]=e.x,s[7]=e.y,s[11]=e.z;let o=3;do{if(0===s[(i=3-o)+4*i]){for(n=i+1;n<3;n++)if(0!==s[i+4*n]){r=4;do a=4-r,s[a+4*i]+=s[a+4*n];while(--r);break}}if(0!==s[i+4*i])for(n=i+1;n<3;n++){let e=s[i+4*n]/s[i+4*i];r=4;do s[(a=4-r)+4*n]=a<=i?0:s[a+4*n]-s[a+4*i]*e;while(--r)}}while(--o);if(t.z=s[11]/s[10],t.y=(s[7]-s[6]*t.z)/s[5],t.x=(s[3]-s[2]*t.z-s[1]*t.y)/s[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,i){if(void 0===i)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){let t,i,n,r;for(void 0===e&&(e=new u),t=0;t<3;t++)for(i=0;i<3;i++)d[t+6*i]=this.elements[t+3*i];d[3]=1,d[9]=0,d[15]=0,d[4]=0,d[10]=1,d[16]=0,d[5]=0,d[11]=0,d[17]=1;let a=3;do{if(0===d[(t=3-a)+6*t]){for(i=t+1;i<3;i++)if(0!==d[t+6*i]){n=6;do r=6-n,d[r+6*t]+=d[r+6*i];while(--n);break}}if(0!==d[t+6*t])for(i=t+1;i<3;i++){let e=d[t+6*i]/d[t+6*t];n=6;do d[(r=6-n)+6*i]=r<=t?0:d[r+6*i]-d[r+6*t]*e;while(--n)}}while(--a);t=2;do{i=t-1;do{let e=d[t+6*i]/d[t+6*t];n=6;do d[(r=6-n)+6*i]=d[r+6*i]-d[r+6*t]*e;while(--n)}while(i--)}while(--t);t=2;do{let e=1/d[t+6*t];n=6;do d[(r=6-n)+6*t]=d[r+6*t]*e;while(--n)}while(t--);t=2;do{i=2;do{if(isNaN(r=d[3+i+6*t])||r===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(t,i,r)}while(i--)}while(t--);return e}setRotationFromQuaternion(e){let t=e.x,i=e.y,n=e.z,r=e.w,a=t+t,s=i+i,o=n+n,l=t*a,c=t*s,h=t*o,u=i*s,d=i*o,p=n*o,f=r*a,m=r*s,g=r*o,v=this.elements;return v[0]=1-(u+p),v[1]=c-g,v[2]=h+m,v[3]=c+g,v[4]=1-(l+p),v[5]=d-f,v[6]=h-m,v[7]=d+f,v[8]=1-(l+u),this}transpose(e){let t;void 0===e&&(e=new u);let i=this.elements,n=e.elements;return n[0]=i[0],n[4]=i[4],n[8]=i[8],t=i[1],n[1]=i[3],n[3]=t,t=i[2],n[2]=i[6],n[6]=t,t=i[5],n[5]=i[7],n[7]=t,e}}let d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class p{constructor(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.x=e,this.y=t,this.z=i}cross(e,t){void 0===t&&(t=new p);let i=e.x,n=e.y,r=e.z,a=this.x,s=this.y,o=this.z;return t.x=s*r-o*n,t.y=o*i-a*r,t.z=a*n-s*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new p(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new p(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new u([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){let e=this.x,t=this.y,i=this.z,n=Math.sqrt(e*e+t*t+i*i);if(n>0){let e=1/n;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return n}unit(e){void 0===e&&(e=new p);let t=this.x,i=this.y,n=this.z,r=Math.sqrt(t*t+i*i+n*n);return r>0?(r=1/r,e.x=t*r,e.y=i*r,e.z=n*r):(e.x=1,e.y=0,e.z=0),e}length(){let e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){let t=this.x,i=this.y,n=this.z,r=e.x,a=e.y,s=e.z;return Math.sqrt((r-t)*(r-t)+(a-i)*(a-i)+(s-n)*(s-n))}distanceSquared(e){let t=this.x,i=this.y,n=this.z,r=e.x,a=e.y,s=e.z;return(r-t)*(r-t)+(a-i)*(a-i)+(s-n)*(s-n)}scale(e,t){void 0===t&&(t=new p);let i=this.x,n=this.y,r=this.z;return t.x=e*i,t.y=e*n,t.z=e*r,t}vmul(e,t){return void 0===t&&(t=new p),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return void 0===i&&(i=new p),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){return void 0===e&&(e=new p),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){let i=this.length();if(i>0){let n=1/i;f.set(this.x*n,this.y*n,this.z*n),.9>Math.abs(f.x)?m.set(1,0,0):m.set(0,1,0),f.cross(m,e),f.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){let n=this.x,r=this.y,a=this.z;i.x=n+(e.x-n)*t,i.y=r+(e.y-r)*t,i.z=a+(e.z-a)*t}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(g),g.almostEquals(e,t)}clone(){return new p(this.x,this.y,this.z)}}p.ZERO=new p(0,0,0),p.UNIT_X=new p(1,0,0),p.UNIT_Y=new p(0,1,0),p.UNIT_Z=new p(0,0,1);let f=new p,m=new p,g=new p;class v{constructor(e){void 0===e&&(e={}),this.lowerBound=new p,this.upperBound=new p,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,n){let r=this.lowerBound,a=this.upperBound;r.copy(e[0]),i&&i.vmult(r,r),a.copy(r);for(let t=1;t<e.length;t++){let n=e[t];i&&(i.vmult(n,y),n=y),n.x>a.x&&(a.x=n.x),n.x<r.x&&(r.x=n.x),n.y>a.y&&(a.y=n.y),n.y<r.y&&(r.y=n.y),n.z>a.z&&(a.z=n.z),n.z<r.z&&(r.z=n.z)}return t&&(t.vadd(r,r),t.vadd(a,a)),n&&(r.x-=n,r.y-=n,r.z-=n,a.x+=n,a.y+=n,a.z+=n),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new v().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){let t=this.lowerBound,i=this.upperBound,n=e.lowerBound,r=e.upperBound,a=n.x<=i.x&&i.x<=r.x||t.x<=r.x&&r.x<=i.x,s=n.y<=i.y&&i.y<=r.y||t.y<=r.y&&r.y<=i.y,o=n.z<=i.z&&i.z<=r.z||t.z<=r.z&&r.z<=i.z;return a&&s&&o}volume(){let e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){let t=this.lowerBound,i=this.upperBound,n=e.lowerBound,r=e.upperBound;return t.x<=n.x&&i.x>=r.x&&t.y<=n.y&&i.y>=r.y&&t.z<=n.z&&i.z>=r.z}getCorners(e,t,i,n,r,a,s,o){let l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),i.set(c.x,c.y,l.z),n.set(l.x,c.y,c.z),r.set(c.x,l.y,c.z),a.set(l.x,c.y,l.z),s.set(l.x,l.y,c.z),o.copy(c)}toLocalFrame(e,t){let i=x[0],n=x[1],r=x[2],a=x[3],s=x[4],o=x[5],l=x[6],c=x[7];this.getCorners(i,n,r,a,s,o,l,c);for(let t=0;8!==t;t++){let i=x[t];e.pointToLocal(i,i)}return t.setFromPoints(x)}toWorldFrame(e,t){let i=x[0],n=x[1],r=x[2],a=x[3],s=x[4],o=x[5],l=x[6],c=x[7];this.getCorners(i,n,r,a,s,o,l,c);for(let t=0;8!==t;t++){let i=x[t];e.pointToWorld(i,i)}return t.setFromPoints(x)}overlapsRay(e){let{direction:t,from:i}=e,n=1/t.x,r=1/t.y,a=1/t.z,s=(this.lowerBound.x-i.x)*n,o=(this.upperBound.x-i.x)*n,l=(this.lowerBound.y-i.y)*r,c=(this.upperBound.y-i.y)*r,h=(this.lowerBound.z-i.z)*a,u=(this.upperBound.z-i.z)*a,d=Math.max(Math.max(Math.min(s,o),Math.min(l,c)),Math.min(h,u)),p=Math.min(Math.min(Math.max(s,o),Math.max(l,c)),Math.max(h,u));return!(p<0)&&!(d>p)}}let y=new p,x=[new p,new p,new p,new p,new p,new p,new p,new p];class _{constructor(){this.matrix=[]}get(e,t){let{index:i}=e,{index:n}=t;if(n>i){let e=n;n=i,i=e}return this.matrix[(i*(i+1)>>1)+n-1]}set(e,t,i){let{index:n}=e,{index:r}=t;if(r>n){let e=r;r=n,n=e}this.matrix[(n*(n+1)>>1)+r-1]=i?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class A{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;return void 0===i[e]&&(i[e]=[]),i[e].includes(t)||i[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return!!(void 0!==i[e]&&i[e].includes(t))}hasAnyEventListener(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;let i=this._listeners;if(void 0===i[e])return this;let n=i[e].indexOf(t);return -1!==n&&i[e].splice(n,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;let t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let i=0,n=t.length;i<n;i++)t[i].call(this,e)}return this}}class b{constructor(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.x=e,this.y=t,this.z=i,this.w=n}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){let i=Math.sin(.5*t);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t),this}toAxisAngle(e){void 0===e&&(e=new p),this.normalize();let t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t))e.tangents(S,w),this.setFromAxisAngle(S,Math.PI);else{let i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){void 0===t&&(t=new b);let i=this.x,n=this.y,r=this.z,a=this.w,s=e.x,o=e.y,l=e.z,c=e.w;return t.x=i*c+a*s+n*l-r*o,t.y=n*c+a*o+r*s-i*l,t.z=r*c+a*l+i*o-n*s,t.w=a*c-i*s-n*o-r*l,t}inverse(e){void 0===e&&(e=new b);let t=this.x,i=this.y,n=this.z,r=this.w;this.conjugate(e);let a=1/(t*t+i*i+n*n+r*r);return e.x*=a,e.y*=a,e.z*=a,e.w*=a,e}conjugate(e){return void 0===e&&(e=new b),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){let e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){void 0===t&&(t=new p);let i=e.x,n=e.y,r=e.z,a=this.x,s=this.y,o=this.z,l=this.w,c=l*i+s*r-o*n,h=l*n+o*i-a*r,u=l*r+a*n-s*i,d=-a*i-s*n-o*r;return t.x=c*l+-(d*a)+-(h*o)- -(u*s),t.y=h*l+-(d*s)+-(u*a)- -(c*o),t.z=u*l+-(d*o)+-(c*s)- -(h*a),t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let i,n,r;void 0===t&&(t="YZX");let a=this.x,s=this.y,o=this.z,l=this.w;if("YZX"===t){let e=a*s+o*l;if(e>.499&&(i=2*Math.atan2(a,l),n=Math.PI/2,r=0),e<-.499&&(i=-2*Math.atan2(a,l),n=-Math.PI/2,r=0),void 0===i){let t=o*o;i=Math.atan2(2*s*l-2*a*o,1-s*s*2-2*t),n=Math.asin(2*e),r=Math.atan2(2*a*l-2*s*o,1-a*a*2-2*t)}}else throw Error(`Euler order ${t} not supported yet.`);e.y=i,e.z=n,e.x=r}setFromEuler(e,t,i,n){void 0===n&&(n="XYZ");let r=Math.cos(e/2),a=Math.cos(t/2),s=Math.cos(i/2),o=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(i/2);return"XYZ"===n?(this.x=o*a*s+r*l*c,this.y=r*l*s-o*a*c,this.z=r*a*c+o*l*s,this.w=r*a*s-o*l*c):"YXZ"===n?(this.x=o*a*s+r*l*c,this.y=r*l*s-o*a*c,this.z=r*a*c-o*l*s,this.w=r*a*s+o*l*c):"ZXY"===n?(this.x=o*a*s-r*l*c,this.y=r*l*s+o*a*c,this.z=r*a*c+o*l*s,this.w=r*a*s-o*l*c):"ZYX"===n?(this.x=o*a*s-r*l*c,this.y=r*l*s+o*a*c,this.z=r*a*c-o*l*s,this.w=r*a*s+o*l*c):"YZX"===n?(this.x=o*a*s+r*l*c,this.y=r*l*s+o*a*c,this.z=r*a*c-o*l*s,this.w=r*a*s-o*l*c):"XZY"===n&&(this.x=o*a*s-r*l*c,this.y=r*l*s-o*a*c,this.z=r*a*c+o*l*s,this.w=r*a*s+o*l*c),this}clone(){return new b(this.x,this.y,this.z,this.w)}slerp(e,t,i){let n,r,a,s,o;void 0===i&&(i=new b);let l=this.x,c=this.y,h=this.z,u=this.w,d=e.x,p=e.y,f=e.z,m=e.w;return(r=l*d+c*p+h*f+u*m)<0&&(r=-r,d=-d,p=-p,f=-f,m=-m),1-r>1e-6?(a=Math.sin(n=Math.acos(r)),s=Math.sin((1-t)*n)/a,o=Math.sin(t*n)/a):(s=1-t,o=t),i.x=s*l+o*d,i.y=s*c+o*p,i.z=s*h+o*f,i.w=s*u+o*m,i}integrate(e,t,i,n){void 0===n&&(n=new b);let r=e.x*i.x,a=e.y*i.y,s=e.z*i.z,o=this.x,l=this.y,c=this.z,h=this.w,u=.5*t;return n.x+=u*(r*h+a*c-s*l),n.y+=u*(a*h+s*o-r*c),n.z+=u*(s*h+r*l-a*o),n.w+=u*(-r*o-a*l-s*c),n}}let S=new p,w=new p,M={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class E{constructor(e){void 0===e&&(e={}),this.id=E.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,i,n){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}E.idCounter=0,E.types=M;class C{constructor(e){void 0===e&&(e={}),this.position=new p,this.quaternion=new b,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return C.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return C.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return void 0===t&&(t=new p),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,n){return void 0===n&&(n=new p),i.vsub(e,n),t.conjugate(T),T.vmult(n,n),n}static pointToWorldFrame(e,t,i,n){return void 0===n&&(n=new p),t.vmult(i,n),n.vadd(e,n),n}static vectorToWorldFrame(e,t,i){return void 0===i&&(i=new p),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,n){return void 0===n&&(n=new p),t.w*=-1,t.vmult(i,n),t.w*=-1,n}}let T=new b;class R extends E{constructor(e){void 0===e&&(e={});let{vertices:t=[],faces:i=[],normals:n=[],axes:r,boundingSphereRadius:a}=e;super({type:E.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=i,this.faceNormals=n,0===this.faceNormals.length&&this.computeNormals(),a?this.boundingSphereRadius=a:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=r?r.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){let e=this.faces,t=this.vertices,i=this.uniqueEdges;i.length=0;let n=new p;for(let r=0;r!==e.length;r++){let a=e[r],s=a.length;for(let e=0;e!==s;e++){let r=(e+1)%s;t[a[e]].vsub(t[a[r]],n),n.normalize();let o=!1;for(let e=0;e!==i.length;e++)if(i[e].almostEquals(n)||i[e].almostEquals(n)){o=!0;break}o||i.push(n.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw Error(`Vertex ${this.faces[e][t]} not found!`);let t=this.faceNormals[e]||new p;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;let i=this.vertices[this.faces[e][0]];if(0>t.dot(i)){console.error(`.faceNormals[${e}] = Vec3(${t.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let t=0;t<this.faces[e].length;t++)console.warn(`.vertices[${this.faces[e][t]}] = Vec3(${this.vertices[this.faces[e][t]].toString()})`)}}}getFaceNormal(e,t){let i=this.faces[e],n=this.vertices[i[0]],r=this.vertices[i[1]],a=this.vertices[i[2]];R.computeNormal(n,r,a,t)}static computeNormal(e,t,i,n){let r=new p,a=new p;t.vsub(e,a),i.vsub(t,r),r.cross(a,n),n.isZero()||n.normalize()}clipAgainstHull(e,t,i,n,r,a,s,o,l){let c=new p,h=-1,u=-Number.MAX_VALUE;for(let e=0;e<i.faces.length;e++){c.copy(i.faceNormals[e]),r.vmult(c,c);let t=c.dot(a);t>u&&(u=t,h=e)}let d=[];for(let e=0;e<i.faces[h].length;e++){let t=i.vertices[i.faces[h][e]],a=new p;a.copy(t),r.vmult(a,a),n.vadd(a,a),d.push(a)}h>=0&&this.clipFaceAgainstHull(a,e,t,d,s,o,l)}findSeparatingAxis(e,t,i,n,r,a,s,o){let l=new p,c=new p,h=new p,u=new p,d=new p,f=new p,m=Number.MAX_VALUE;if(this.uniqueAxes)for(let s=0;s!==this.uniqueAxes.length;s++){i.vmult(this.uniqueAxes[s],l);let o=this.testSepAxis(l,e,t,i,n,r);if(!1===o)return!1;o<m&&(m=o,a.copy(l))}else{let o=s?s.length:this.faces.length;for(let c=0;c<o;c++){let o=s?s[c]:c;l.copy(this.faceNormals[o]),i.vmult(l,l);let h=this.testSepAxis(l,e,t,i,n,r);if(!1===h)return!1;h<m&&(m=h,a.copy(l))}}if(e.uniqueAxes)for(let s=0;s!==e.uniqueAxes.length;s++){r.vmult(e.uniqueAxes[s],c);let o=this.testSepAxis(c,e,t,i,n,r);if(!1===o)return!1;o<m&&(m=o,a.copy(c))}else{let s=o?o.length:e.faces.length;for(let l=0;l<s;l++){let s=o?o[l]:l;c.copy(e.faceNormals[s]),r.vmult(c,c);let h=this.testSepAxis(c,e,t,i,n,r);if(!1===h)return!1;h<m&&(m=h,a.copy(c))}}for(let s=0;s!==this.uniqueEdges.length;s++){i.vmult(this.uniqueEdges[s],u);for(let s=0;s!==e.uniqueEdges.length;s++)if(r.vmult(e.uniqueEdges[s],d),u.cross(d,f),!f.almostZero()){f.normalize();let s=this.testSepAxis(f,e,t,i,n,r);if(!1===s)return!1;s<m&&(m=s,a.copy(f))}}return n.vsub(t,h),h.dot(a)>0&&a.negate(a),!0}testSepAxis(e,t,i,n,r,a){R.project(this,e,i,n,P),R.project(t,e,r,a,I);let s=P[0],o=P[1],l=I[0],c=I[1];if(s<c||l<o)return!1;let h=s-c,u=l-o;return h<u?h:u}calculateLocalInertia(e,t){let i=new p,n=new p;this.computeLocalAABB(n,i);let r=i.x-n.x,a=i.y-n.y,s=i.z-n.z;t.x=1/12*e*(2*a*2*a+2*s*2*s),t.y=1/12*e*(2*r*2*r+2*s*2*s),t.z=1/12*e*(2*a*2*a+2*r*2*r)}getPlaneConstantOfFace(e){let t=this.faces[e],i=this.faceNormals[e],n=this.vertices[t[0]];return-i.dot(n)}clipFaceAgainstHull(e,t,i,n,r,a,s){let o=new p,l=new p,c=new p,h=new p,u=new p,d=new p,f=new p,m=new p,g=[],v=-1,y=Number.MAX_VALUE;for(let t=0;t<this.faces.length;t++){o.copy(this.faceNormals[t]),i.vmult(o,o);let n=o.dot(e);n<y&&(y=n,v=t)}if(v<0)return;let x=this.faces[v];x.connectedFaces=[];for(let e=0;e<this.faces.length;e++)for(let t=0;t<this.faces[e].length;t++)-1!==x.indexOf(this.faces[e][t])&&e!==v&&-1===x.connectedFaces.indexOf(e)&&x.connectedFaces.push(e);let _=x.length;for(let e=0;e<_;e++){let r=this.vertices[x[e]],a=this.vertices[x[(e+1)%_]];r.vsub(a,l),c.copy(l),i.vmult(c,c),t.vadd(c,c),h.copy(this.faceNormals[v]),i.vmult(h,h),t.vadd(h,h),c.cross(h,u),u.negate(u),d.copy(r),i.vmult(d,d),t.vadd(d,d);let s=x.connectedFaces[e];f.copy(this.faceNormals[s]);let o=this.getPlaneConstantOfFace(s);m.copy(f),i.vmult(m,m);let p=o-m.dot(t);for(this.clipFaceAgainstPlane(n,g,m,p);n.length;)n.shift();for(;g.length;)n.push(g.shift())}f.copy(this.faceNormals[v]);let A=this.getPlaneConstantOfFace(v);m.copy(f),i.vmult(m,m);let b=A-m.dot(t);for(let e=0;e<n.length;e++){let t=m.dot(n[e])+b;if(t<=r&&(console.log(`clamped: depth=${t} to minDist=${r}`),t=r),t<=a){let i=n[e];if(t<=1e-6){let e={point:i,normal:m,depth:t};s.push(e)}}}}clipFaceAgainstPlane(e,t,i,n){let r,a;let s=e.length;if(s<2)return t;let o=e[e.length-1],l=e[0];r=i.dot(o)+n;for(let c=0;c<s;c++){if(l=e[c],a=i.dot(l)+n,r<0){if(a<0){let e=new p;e.copy(l),t.push(e)}else{let e=new p;o.lerp(l,r/(r-a),e),t.push(e)}}else if(a<0){let e=new p;o.lerp(l,r/(r-a),e),t.push(e),t.push(l)}o=l,r=a}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new p);let i=this.vertices,n=this.worldVertices;for(let r=0;r!==this.vertices.length;r++)t.vmult(i[r],n[r]),e.vadd(n[r],n[r]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){let i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let n=0;n<this.vertices.length;n++){let r=i[n];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}computeWorldFaceNormals(e){let t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new p);let i=this.faceNormals,n=this.worldFaceNormals;for(let r=0;r!==t;r++)e.vmult(i[r],n[r]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0,t=this.vertices;for(let i=0;i!==t.length;i++){let n=t[i].lengthSquared();n>e&&(e=n)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,i,n){let r,a,s,o,l,c;let h=this.vertices,u=new p;for(let i=0;i<h.length;i++)u.copy(h[i]),t.vmult(u,u),e.vadd(u,u),(void 0===r||u.x<r)&&(r=u.x),(void 0===o||u.x>o)&&(o=u.x),(void 0===a||u.y<a)&&(a=u.y),(void 0===l||u.y>l)&&(l=u.y),(void 0===s||u.z<s)&&(s=u.z),(void 0===c||u.z>c)&&(c=u.z);i.set(r,a,s),n.set(o,l,c)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){void 0===e&&(e=new p);let t=this.vertices;for(let i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){let i=this.vertices.length,n=this.vertices;if(t){for(let e=0;e<i;e++){let i=n[e];t.vmult(i,i)}for(let e=0;e<this.faceNormals.length;e++){let i=this.faceNormals[e];t.vmult(i,i)}}if(e)for(let t=0;t<i;t++){let i=n[t];i.vadd(e,i)}}pointIsInside(e){let t=this.vertices,i=this.faces,n=this.faceNormals,r=new p;this.getAveragePointLocal(r);for(let a=0;a<this.faces.length;a++){let s=n[a],o=t[i[a][0]],l=new p;e.vsub(o,l);let c=s.dot(l),h=new p;r.vsub(o,h);let u=s.dot(h);if(c<0&&u>0||c>0&&u<0)return!1}return -1}static project(e,t,i,n,r){let a=e.vertices.length,s=0,o=0,l=e.vertices;D.setZero(),C.vectorToLocalFrame(i,n,t,L),C.pointToLocalFrame(i,n,D,D);let c=D.dot(L);o=s=l[0].dot(L);for(let e=1;e<a;e++){let t=l[e].dot(L);t>s&&(s=t),t<o&&(o=t)}if((o-=c)>(s-=c)){let e=o;o=s,s=e}r[0]=s,r[1]=o}}let P=[],I=[];new p;let L=new p,D=new p;class B extends E{constructor(e){super({type:E.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){let e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,n=new R({vertices:[new p(-e,-t,-i),new p(e,-t,-i),new p(e,t,-i),new p(-e,t,-i),new p(-e,-t,i),new p(e,-t,i),new p(e,t,i),new p(-e,t,i)],faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:[new p(0,0,1),new p(0,1,0),new p(1,0,0)]});this.convexPolyhedronRepresentation=n,n.material=this.material}calculateLocalInertia(e,t){return void 0===t&&(t=new p),B.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,i){i.x=1/12*t*(2*e.y*2*e.y+2*e.z*2*e.z),i.y=1/12*t*(2*e.x*2*e.x+2*e.z*2*e.z),i.z=1/12*t*(2*e.y*2*e.y+2*e.x*2*e.x)}getSideNormals(e,t){let i=this.halfExtents;if(e[0].set(i.x,0,0),e[1].set(0,i.y,0),e[2].set(0,0,i.z),e[3].set(-i.x,0,0),e[4].set(0,-i.y,0),e[5].set(0,0,-i.z),void 0!==t)for(let i=0;i!==e.length;i++)t.vmult(e[i],e[i]);return e}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,i){let n=this.halfExtents,r=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]];for(let n=0;n<r.length;n++)O.set(r[n][0],r[n][1],r[n][2]),t.vmult(O,O),e.vadd(O,O),i(O.x,O.y,O.z)}calculateWorldAABB(e,t,i,n){let r=this.halfExtents;N[0].set(r.x,r.y,r.z),N[1].set(-r.x,r.y,r.z),N[2].set(-r.x,-r.y,r.z),N[3].set(-r.x,-r.y,-r.z),N[4].set(r.x,-r.y,-r.z),N[5].set(r.x,r.y,-r.z),N[6].set(-r.x,r.y,-r.z),N[7].set(r.x,-r.y,r.z);let a=N[0];t.vmult(a,a),e.vadd(a,a),n.copy(a),i.copy(a);for(let r=1;r<8;r++){let a=N[r];t.vmult(a,a),e.vadd(a,a);let s=a.x,o=a.y,l=a.z;s>n.x&&(n.x=s),o>n.y&&(n.y=o),l>n.z&&(n.z=l),s<i.x&&(i.x=s),o<i.y&&(i.y=o),l<i.z&&(i.z=l)}}}let O=new p,N=[new p,new p,new p,new p,new p,new p,new p,new p],U={DYNAMIC:1,STATIC:2,KINEMATIC:4},F={AWAKE:0,SLEEPY:1,SLEEPING:2};class k extends A{constructor(e){void 0===e&&(e={}),super(),this.id=k.idCounter++,this.index=-1,this.world=null,this.vlambda=new p,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new p,this.previousPosition=new p,this.interpolatedPosition=new p,this.initPosition=new p,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new p,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new p,this.force=new p;let t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?k.STATIC:k.DYNAMIC,typeof e.type==typeof k.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=k.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new p,this.quaternion=new b,this.initQuaternion=new b,this.previousQuaternion=new b,this.interpolatedQuaternion=new b,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new p,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new p,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new p,this.invInertia=new p,this.invInertiaWorld=new u,this.invMassSolve=0,this.invInertiaSolve=new p,this.invInertiaWorldSolve=new u,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new p(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new p(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new v,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new p,this.isTrigger=!!e.isTrigger,e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){let e=this.sleepState;this.sleepState=k.AWAKE,this.wakeUpAfterNarrowphase=!1,e===k.SLEEPING&&this.dispatchEvent(k.wakeupEvent)}sleep(){this.sleepState=k.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){let t=this.sleepState,i=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),n=this.sleepSpeedLimit**2;t===k.AWAKE&&i<n?(this.sleepState=k.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(k.sleepyEvent)):t===k.SLEEPY&&i>n?this.wakeUp():t===k.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(k.sleepEvent))}}updateSolveMassProperties(){this.sleepState===k.SLEEPING||this.type===k.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return void 0===t&&(t=new p),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return void 0===t&&(t=new p),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return void 0===t&&(t=new p),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return void 0===t&&(t=new p),this.quaternion.vmult(e,t),t}addShape(e,t,i){let n=new p,r=new b;return t&&n.copy(t),i&&r.copy(i),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){let t=this.shapes.indexOf(e);return -1===t?console.warn("Shape does not belong to the body"):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null),this}updateBoundingRadius(){let e=this.shapes,t=this.shapeOffsets,i=e.length,n=0;for(let r=0;r!==i;r++){let i=e[r];i.updateBoundingSphereRadius();let a=t[r].length(),s=i.boundingSphereRadius;a+s>n&&(n=a+s)}this.boundingRadius=n}updateAABB(){let e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,n=e.length,r=this.quaternion,a=this.aabb;for(let s=0;s!==n;s++){let n=e[s];r.vmult(t[s],z),z.vadd(this.position,z),r.mult(i[s],H),n.calculateWorldAABB(z,H,V.lowerBound,V.upperBound),0===s?a.copy(V):a.extend(V)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){let t=this.invInertia;(t.x!==t.y||t.y!==t.z||e)&&(G.setRotationFromQuaternion(this.quaternion),G.transpose(W),G.scale(t,G),G.mmult(W,this.invInertiaWorld))}applyForce(e,t){void 0===t&&(t=new p),this.type===k.DYNAMIC&&(this.sleepState===k.SLEEPING&&this.wakeUp(),t.cross(e,j),this.force.vadd(e,this.force),this.torque.vadd(j,this.torque))}applyLocalForce(e,t){void 0===t&&(t=new p),this.type===k.DYNAMIC&&(this.vectorToWorldFrame(e,q),this.vectorToWorldFrame(t,X),this.applyForce(q,X))}applyTorque(e){this.type===k.DYNAMIC&&(this.sleepState===k.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(void 0===t&&(t=new p),this.type!==k.DYNAMIC)return;this.sleepState===k.SLEEPING&&this.wakeUp();let i=t;Y.copy(e),Y.scale(this.invMass,Y),this.velocity.vadd(Y,this.velocity),i.cross(e,K),this.invInertiaWorld.vmult(K,K),this.angularVelocity.vadd(K,this.angularVelocity)}applyLocalImpulse(e,t){void 0===t&&(t=new p),this.type===k.DYNAMIC&&(this.vectorToWorldFrame(e,Q),this.vectorToWorldFrame(t,J),this.applyImpulse(Q,J))}updateMassProperties(){this.invMass=this.mass>0?1/this.mass:0;let e=this.inertia,t=this.fixedRotation;this.updateAABB(),Z.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),B.calculateInertia(Z,this.mass,e),this.invInertia.set(e.x>0&&!t?1/e.x:0,e.y>0&&!t?1/e.y:0,e.z>0&&!t?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){let i=new p;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}integrate(e,t,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===k.DYNAMIC||this.type===k.KINEMATIC)||this.sleepState===k.SLEEPING)return;let n=this.velocity,r=this.angularVelocity,a=this.position,s=this.force,o=this.torque,l=this.quaternion,c=this.invMass,h=this.invInertiaWorld,u=this.linearFactor,d=c*e;n.x+=s.x*d*u.x,n.y+=s.y*d*u.y,n.z+=s.z*d*u.z;let p=h.elements,f=this.angularFactor,m=o.x*f.x,g=o.y*f.y,v=o.z*f.z;r.x+=e*(p[0]*m+p[1]*g+p[2]*v),r.y+=e*(p[3]*m+p[4]*g+p[5]*v),r.z+=e*(p[6]*m+p[7]*g+p[8]*v),a.x+=n.x*e,a.y+=n.y*e,a.z+=n.z*e,l.integrate(this.angularVelocity,e,this.angularFactor,l),t&&(i?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}k.idCounter=0,k.COLLIDE_EVENT_NAME="collide",k.DYNAMIC=U.DYNAMIC,k.STATIC=U.STATIC,k.KINEMATIC=U.KINEMATIC,k.AWAKE=F.AWAKE,k.SLEEPY=F.SLEEPY,k.SLEEPING=F.SLEEPING,k.wakeupEvent={type:"wakeup"},k.sleepyEvent={type:"sleepy"},k.sleepEvent={type:"sleep"};let z=new p,H=new b,V=new v,G=new u,W=new u;new u;let j=new p,q=new p,X=new p,Y=new p,K=new p,Q=new p,J=new p,Z=new p;class ${constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,i){throw Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return(e.collisionFilterGroup&t.collisionFilterMask)!=0&&(t.collisionFilterGroup&e.collisionFilterMask)!=0&&((e.type&k.STATIC)==0&&e.sleepState!==k.SLEEPING||(t.type&k.STATIC)==0&&t.sleepState!==k.SLEEPING)}intersectionTest(e,t,i,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,n):this.doBoundingSphereBroadphase(e,t,i,n)}doBoundingSphereBroadphase(e,t,i,n){t.position.vsub(e.position,ee);let r=(e.boundingRadius+t.boundingRadius)**2;ee.lengthSquared()<r&&(i.push(e),n.push(t))}doBoundingBoxBroadphase(e,t,i,n){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),n.push(t))}makePairsUnique(e,t){let i=e.length;for(let n=0;n!==i;n++)ei[n]=e[n],en[n]=t[n];e.length=0,t.length=0;for(let e=0;e!==i;e++){let t=ei[e].id,i=en[e].id,n=t<i?`${t},${i}`:`${i},${t}`;et[n]=e,et.keys.push(n)}for(let i=0;i!==et.keys.length;i++){let i=et.keys.pop(),n=et[i];e.push(ei[n]),t.push(en[n]),delete et[i]}}setWorld(e){}static boundingSphereCheck(e,t){let i=new p;e.position.vsub(t.position,i);let n=e.shapes[0],r=t.shapes[0];return Math.pow(n.boundingSphereRadius+r.boundingSphereRadius,2)>i.lengthSquared()}aabbQuery(e,t,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}let ee=new p;new p,new b,new p;let et={keys:[]},ei=[],en=[];new p;class er extends ${constructor(e,t,i,n,r){void 0===e&&(e=new p(100,100,100)),void 0===t&&(t=new p(-100,-100,-100)),void 0===i&&(i=10),void 0===n&&(n=10),void 0===r&&(r=10),super(),this.nx=i,this.ny=n,this.nz=r,this.aabbMin=e,this.aabbMax=t;let a=this.nx*this.ny*this.nz;if(a<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=a,this.binLengths.length=a;for(let e=0;e<a;e++)this.bins[e]=[],this.binLengths[e]=0}collisionPairs(e,t,i){let n=e.bodies.length,r=e.bodies,a=this.aabbMax,s=this.aabbMin,o=this.nx,l=this.ny,c=this.nz,h=l*c,u=a.x,d=a.y,p=a.z,f=s.x,m=s.y,g=s.z,v=o/(u-f),y=l/(d-m),x=c/(p-g),_=(u-f)/o,A=(d-m)/l,b=(p-g)/c,S=.5*Math.sqrt(_*_+A*A+b*b),w=E.types,M=w.SPHERE,C=w.PLANE;w.BOX,w.COMPOUND,w.CONVEXPOLYHEDRON;let T=this.bins,R=this.binLengths,P=this.bins.length;for(let e=0;e!==P;e++)R[e]=0;let I=Math.ceil;function L(e,t,i,n,r,a,s){let u=(e-f)*v|0,d=(t-m)*y|0,p=(i-g)*x|0,_=I((n-f)*v),A=I((r-m)*y),b=I((a-g)*x);u<0?u=0:u>=o&&(u=o-1),d<0?d=0:d>=l&&(d=l-1),p<0?p=0:p>=c&&(p=c-1),_<0?_=0:_>=o&&(_=o-1),A<0?A=0:A>=l&&(A=l-1),b<0?b=0:b>=c&&(b=c-1),u*=h,d*=c,p*=1,_*=h,A*=c,b*=1;for(let e=u;e<=_;e+=h)for(let t=d;t<=A;t+=c)for(let i=p;i<=b;i+=1){let n=e+t+i;T[n][R[n]++]=s}}for(let e=0;e!==n;e++){let t=r[e],i=t.shapes[0];switch(i.type){case M:{let e=t.position.x,n=t.position.y,r=t.position.z,a=i.radius;L(e-a,n-a,r-a,e+a,n+a,r+a,t);break}case C:{i.worldNormalNeedsUpdate&&i.computeWorldNormal(t.quaternion);let e=i.worldNormal,n=f+.5*_-t.position.x,r=m+.5*A-t.position.y,a=g+.5*b-t.position.z;ea.set(n,r,a);for(let i=0,n=0;i!==o;i++,n+=h,ea.y=r,ea.x+=_)for(let i=0,r=0;i!==l;i++,r+=c,ea.z=a,ea.y+=A)for(let i=0,a=0;i!==c;i++,a+=1,ea.z+=b)if(ea.dot(e)<S){let e=n+r+a;T[e][R[e]++]=t}break}default:t.aabbNeedsUpdate&&t.updateAABB(),L(t.aabb.lowerBound.x,t.aabb.lowerBound.y,t.aabb.lowerBound.z,t.aabb.upperBound.x,t.aabb.upperBound.y,t.aabb.upperBound.z,t)}}for(let e=0;e!==P;e++){let n=R[e];if(n>1){let r=T[e];for(let e=0;e!==n;e++){let n=r[e];for(let a=0;a!==e;a++){let e=r[a];this.needBroadphaseCollision(n,e)&&this.intersectionTest(n,e,t,i)}}}}this.makePairsUnique(t,i)}}let ea=new p;new p;class es extends ${constructor(){super()}collisionPairs(e,t,i){let n,r;let a=e.bodies,s=a.length;for(let e=0;e!==s;e++)for(let s=0;s!==e;s++)n=a[e],r=a[s],this.needBroadphaseCollision(n,r)&&this.intersectionTest(n,r,t,i)}aabbQuery(e,t,i){void 0===i&&(i=[]);for(let n=0;n<e.bodies.length;n++){let r=e.bodies[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(t)&&i.push(r)}return i}}class eo{constructor(){this.rayFromWorld=new p,this.rayToWorld=new p,this.hitNormalWorld=new p,this.hitPointWorld=new p,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,n,r,a,s){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(n),this.shape=r,this.body=a,this.distance=s}}let el={CLOSEST:1,ANY:2,ALL:4};n=E.types.SPHERE,r=E.types.PLANE,a=E.types.BOX,s=E.types.CYLINDER,o=E.types.CONVEXPOLYHEDRON,l=E.types.HEIGHTFIELD,c=E.types.TRIMESH;class ec{get[n](){return this._intersectSphere}get[r](){return this._intersectPlane}get[a](){return this._intersectBox}get[s](){return this._intersectConvex}get[o](){return this._intersectConvex}get[l](){return this._intersectHeightfield}get[c](){return this._intersectTrimesh}constructor(e,t){void 0===e&&(e=new p),void 0===t&&(t=new p),this.from=e.clone(),this.to=t.clone(),this.direction=new p,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ec.ANY,this.result=new eo,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||ec.ANY,this.result=t.result||new eo,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(eh),eu.length=0,e.broadphase.aabbQuery(e,eh,eu),this.intersectBodies(eu),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());let i=this.checkCollisionResponse;if((!i||e.collisionResponse)&&(this.collisionFilterGroup&e.collisionFilterMask)!=0&&(e.collisionFilterGroup&this.collisionFilterMask)!=0)for(let t=0,n=e.shapes.length;t<n;t++){let n=e.shapes[t];if((!i||n.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[t],em),e.quaternion.vmult(e.shapeOffsets[t],ef),ef.vadd(e.position,ef),this.intersectShape(n,em,ef,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let t=0,i=e.length;!this.result.shouldStop&&t<i;t++)this.intersectBody(e[t])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,n){if(function(e,t,i){i.vsub(e,eN);let n=eN.dot(t);return t.scale(n,eU),eU.vadd(e,eU),i.distanceTo(eU)}(this.from,this.direction,i)>e.boundingSphereRadius)return;let r=this[e.type];r&&r.call(this,e,t,i,n,e)}_intersectBox(e,t,i,n,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,n,r)}_intersectPlane(e,t,i,n,r){let a=this.from,s=this.to,o=this.direction,l=new p(0,0,1);t.vmult(l,l);let c=new p;a.vsub(i,c);let h=c.dot(l);if(s.vsub(i,c),h*c.dot(l)>0||a.distanceTo(s)<h)return;let u=l.dot(o);if(Math.abs(u)<this.precision)return;let d=new p,f=new p,m=new p;a.vsub(i,d);let g=-l.dot(d)/u;o.scale(g,f),a.vadd(f,m),this.reportIntersection(l,m,r,n,-1)}getAABB(e){let{lowerBound:t,upperBound:i}=e,n=this.to,r=this.from;t.x=Math.min(n.x,r.x),t.y=Math.min(n.y,r.y),t.z=Math.min(n.z,r.z),i.x=Math.max(n.x,r.x),i.y=Math.max(n.y,r.y),i.z=Math.max(n.z,r.z)}_intersectHeightfield(e,t,i,n,r){let a,s,o,l;e.data,e.elementSize,eb.from.copy(this.from),eb.to.copy(this.to),C.pointToLocalFrame(i,t,eb.from,eb.from),C.pointToLocalFrame(i,t,eb.to,eb.to),eb.updateDirection(),a=s=0,o=l=e.data.length-1;let c=new v;eb.getAABB(c),e.getIndexOfPosition(c.lowerBound.x,c.lowerBound.y,eS,!0),a=Math.max(a,eS[0]),s=Math.max(s,eS[1]),e.getIndexOfPosition(c.upperBound.x,c.upperBound.y,eS,!0),o=Math.min(o,eS[0]+1),l=Math.min(l,eS[1]+1);for(let h=a;h<o;h++)for(let a=s;a<l;a++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,a,c),c.overlapsRay(eb)){if(e.getConvexTrianglePillar(h,a,!1),C.pointToWorldFrame(i,t,e.pillarOffset,eA),this._intersectConvex(e.pillarConvex,t,eA,n,r,e_),this.result.shouldStop)return;e.getConvexTrianglePillar(h,a,!0),C.pointToWorldFrame(i,t,e.pillarOffset,eA),this._intersectConvex(e.pillarConvex,t,eA,n,r,e_)}}}_intersectSphere(e,t,i,n,r){let a=this.from,s=this.to,o=e.radius,l=(s.x-a.x)**2+(s.y-a.y)**2+(s.z-a.z)**2,c=2*((s.x-a.x)*(a.x-i.x)+(s.y-a.y)*(a.y-i.y)+(s.z-a.z)*(a.z-i.z)),h=c**2-4*l*((a.x-i.x)**2+(a.y-i.y)**2+(a.z-i.z)**2-o**2);if(!(h<0)){if(0===h)a.lerp(s,h,ew),ew.vsub(i,eM),eM.normalize(),this.reportIntersection(eM,ew,r,n,-1);else{let e=(-c-Math.sqrt(h))/(2*l),t=(-c+Math.sqrt(h))/(2*l);if(e>=0&&e<=1&&(a.lerp(s,e,ew),ew.vsub(i,eM),eM.normalize(),this.reportIntersection(eM,ew,r,n,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(a.lerp(s,t,ew),ew.vsub(i,eM),eM.normalize(),this.reportIntersection(eM,ew,r,n,-1))}}}_intersectConvex(e,t,i,n,r,a){let s=a&&a.faceList||null,o=e.faces,l=e.vertices,c=e.faceNormals,h=this.direction,u=this.from,d=this.to,p=u.distanceTo(d),f=s?s.length:o.length,m=this.result;for(let e=0;!m.shouldStop&&e<f;e++){let a=s?s[e]:e,d=o[a],f=c[a];eC.copy(l[d[0]]),t.vmult(eC,eC),eC.vadd(i,eC),eC.vsub(u,eC),t.vmult(f,eE);let g=h.dot(eE);if(Math.abs(g)<this.precision)continue;let v=eE.dot(eC)/g;if(!(v<0)){h.scale(v,eg),eg.vadd(u,eg),ev.copy(l[d[0]]),t.vmult(ev,ev),i.vadd(ev,ev);for(let e=1;!m.shouldStop&&e<d.length-1;e++){ey.copy(l[d[e]]),ex.copy(l[d[e+1]]),t.vmult(ey,ey),t.vmult(ex,ex),i.vadd(ey,ey),i.vadd(ex,ex);let s=eg.distanceTo(u);(ec.pointInTriangle(eg,ev,ey,ex)||ec.pointInTriangle(eg,ey,ev,ex))&&!(s>p)&&this.reportIntersection(eE,eg,r,n,a)}}}}_intersectTrimesh(e,t,i,n,r,a){let s=e.indices;e.vertices;let o=this.from,l=this.to,c=this.direction;eO.position.copy(i),eO.quaternion.copy(t),C.vectorToLocalFrame(i,t,c,eR),C.pointToLocalFrame(i,t,o,eP),C.pointToLocalFrame(i,t,l,eI),eI.x*=e.scale.x,eI.y*=e.scale.y,eI.z*=e.scale.z,eP.x*=e.scale.x,eP.y*=e.scale.y,eP.z*=e.scale.z,eI.vsub(eP,eR),eR.normalize();let h=eP.distanceSquared(eI);e.tree.rayQuery(this,eO,eB);for(let a=0,o=eB.length;!this.result.shouldStop&&a!==o;a++){let o=eB[a];e.getNormal(o,eT),e.getVertex(s[3*o],ev),ev.vsub(eP,eC);let l=eR.dot(eT),c=eT.dot(eC)/l;if(c<0)continue;eR.scale(c,eg),eg.vadd(eP,eg),e.getVertex(s[3*o+1],ey),e.getVertex(s[3*o+2],ex);let u=eg.distanceSquared(eP);(ec.pointInTriangle(eg,ey,ev,ex)||ec.pointInTriangle(eg,ev,ey,ex))&&!(u>h)&&(C.vectorToWorldFrame(t,eT,eL),C.pointToWorldFrame(i,t,eg,eD),this.reportIntersection(eL,eD,r,n,o))}eB.length=0}reportIntersection(e,t,i,n,r){let a=this.from,s=this.to,o=a.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case ec.ALL:this.hasHit=!0,l.set(a,s,e,t,i,n,o),l.hasHit=!0,this.callback(l);break;case ec.CLOSEST:(o<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(a,s,e,t,i,n,o));break;case ec.ANY:this.hasHit=!0,l.hasHit=!0,l.set(a,s,e,t,i,n,o),l.shouldStop=!0}}static pointInTriangle(e,t,i,n){let r,a;n.vsub(t,eN),i.vsub(t,ed),e.vsub(t,ep);let s=eN.dot(eN),o=eN.dot(ed),l=eN.dot(ep),c=ed.dot(ed),h=ed.dot(ep);return(r=c*l-o*h)>=0&&(a=s*h-o*l)>=0&&r+a<s*c-o*o}}ec.CLOSEST=el.CLOSEST,ec.ANY=el.ANY,ec.ALL=el.ALL;let eh=new v,eu=[],ed=new p,ep=new p,ef=new p,em=new b,eg=new p,ev=new p,ey=new p,ex=new p;new p,new eo;let e_={faceList:[0]},eA=new p,eb=new ec,eS=[],ew=new p,eM=new p,eE=new p;new p,new p;let eC=new p,eT=new p,eR=new p,eP=new p,eI=new p,eL=new p,eD=new p;new v;let eB=[],eO=new C,eN=new p,eU=new p;class eF extends ${static checkBounds(e,t,i){let n,r;0===i?(n=e.position.x,r=t.position.x):1===i?(n=e.position.y,r=t.position.y):2===i&&(n=e.position.z,r=t.position.z);let a=e.boundingRadius;return r-t.boundingRadius<n+a}static insertionSortX(e){for(let t=1,i=e.length;t<i;t++){let i;let n=e[t];for(i=t-1;i>=0&&!(e[i].aabb.lowerBound.x<=n.aabb.lowerBound.x);i--)e[i+1]=e[i];e[i+1]=n}return e}static insertionSortY(e){for(let t=1,i=e.length;t<i;t++){let i;let n=e[t];for(i=t-1;i>=0&&!(e[i].aabb.lowerBound.y<=n.aabb.lowerBound.y);i--)e[i+1]=e[i];e[i+1]=n}return e}static insertionSortZ(e){for(let t=1,i=e.length;t<i;t++){let i;let n=e[t];for(i=t-1;i>=0&&!(e[i].aabb.lowerBound.z<=n.aabb.lowerBound.z);i--)e[i+1]=e[i];e[i+1]=n}return e}constructor(e){super(),this.axisList=[],this.world=null,this.axisIndex=0;let t=this.axisList;this._addBodyHandler=e=>{t.push(e.body)},this._removeBodyHandler=e=>{let i=t.indexOf(e.body);-1!==i&&t.splice(i,1)},e&&this.setWorld(e)}setWorld(e){this.axisList.length=0;for(let t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0}collisionPairs(e,t,i){let n,r;let a=this.axisList,s=a.length,o=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),n=0;n!==s;n++){let e=a[n];for(r=n+1;r<s;r++){let n=a[r];if(this.needBroadphaseCollision(e,n)){if(!eF.checkBounds(e,n,o))break;this.intersectionTest(e,n,t,i)}}}}sortList(){let e=this.axisList,t=this.axisIndex,i=e.length;for(let t=0;t!==i;t++){let i=e[t];i.aabbNeedsUpdate&&i.updateAABB()}0===t?eF.insertionSortX(e):1===t?eF.insertionSortY(e):2===t&&eF.insertionSortZ(e)}autoDetectAxis(){let e=0,t=0,i=0,n=0,r=0,a=0,s=this.axisList,o=s.length,l=1/o;for(let l=0;l!==o;l++){let o=s[l],c=o.position.x;e+=c,t+=c*c;let h=o.position.y;i+=h,n+=h*h;let u=o.position.z;r+=u,a+=u*u}let c=t-e*e*l,h=n-i*i*l,u=a-r*r*l;c>h?c>u?this.axisIndex=0:this.axisIndex=2:h>u?this.axisIndex=1:this.axisIndex=2}aabbQuery(e,t,i){void 0===i&&(i=[]),this.dirty&&(this.sortList(),this.dirty=!1);let n=this.axisIndex,r="x";1===n&&(r="y"),2===n&&(r="z");let a=this.axisList;t.lowerBound[r],t.upperBound[r];for(let e=0;e<a.length;e++){let n=a[e];n.aabbNeedsUpdate&&n.updateAABB(),n.aabb.overlaps(t)&&i.push(n)}return i}}class ek{static defaults(e,t){for(let i in void 0===e&&(e={}),t)i in e||(e[i]=t[i]);return e}}class ez{constructor(e,t,i){void 0===i&&(i={}),i=ek.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=ez.idCounter++,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw Error("method update() not implmemented in this Constraint subclass!")}enable(){let e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){let e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}ez.idCounter=0;class eH{constructor(){this.spatial=new p,this.rotational=new p}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class eV{constructor(e,t,i,n){void 0===i&&(i=-1e6),void 0===n&&(n=1e6),this.id=eV.idCounter++,this.minForce=i,this.maxForce=n,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new eH,this.jacobianElementB=new eH,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,i){this.a=4/(i*(1+4*t)),this.b=4*t/(1+4*t),this.eps=4/(i*i*e*(1+4*t))}computeB(e,t,i){let n=this.computeGW();return-this.computeGq()*e-n*t-this.computeGiMf()*i}computeGq(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.position,a=n.position;return e.spatial.dot(r)+t.spatial.dot(a)}computeGW(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.velocity,a=n.velocity,s=i.angularVelocity,o=n.angularVelocity;return e.multiplyVectors(r,s)+t.multiplyVectors(a,o)}computeGWlambda(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.vlambda,a=n.vlambda,s=i.wlambda,o=n.wlambda;return e.multiplyVectors(r,s)+t.multiplyVectors(a,o)}computeGiMf(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.force,a=i.torque,s=n.force,o=n.torque,l=i.invMassSolve,c=n.invMassSolve;return r.scale(l,eG),s.scale(c,eW),i.invInertiaWorldSolve.vmult(a,ej),n.invInertiaWorldSolve.vmult(o,eq),e.multiplyVectors(eG,ej)+t.multiplyVectors(eW,eq)}computeGiMGt(){let e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,r=i.invMassSolve,a=n.invMassSolve,s=i.invInertiaWorldSolve,o=n.invInertiaWorldSolve,l=r+a;return s.vmult(e.rotational,eX),l+=eX.dot(e.rotational),o.vmult(t.rotational,eX),l+=eX.dot(t.rotational)}addToWlambda(e){let t=this.jacobianElementA,i=this.jacobianElementB,n=this.bi,r=this.bj;n.vlambda.addScaledVector(n.invMassSolve*e,t.spatial,n.vlambda),r.vlambda.addScaledVector(r.invMassSolve*e,i.spatial,r.vlambda),n.invInertiaWorldSolve.vmult(t.rotational,eY),n.wlambda.addScaledVector(e,eY,n.wlambda),r.invInertiaWorldSolve.vmult(i.rotational,eY),r.wlambda.addScaledVector(e,eY,r.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}eV.idCounter=0;let eG=new p,eW=new p,ej=new p,eq=new p,eX=new p,eY=new p;class eK extends eV{constructor(e,t,i){void 0===i&&(i=1e6),super(e,t,0,i),this.restitution=0,this.ri=new p,this.rj=new p,this.ni=new p}computeB(e){let t=this.a,i=this.b,n=this.bi,r=this.bj,a=this.ri,s=this.rj,o=n.velocity,l=n.angularVelocity;n.force,n.torque;let c=r.velocity,h=r.angularVelocity;r.force,r.torque;let u=this.jacobianElementA,d=this.jacobianElementB,p=this.ni;a.cross(p,eQ),s.cross(p,eJ),p.negate(u.spatial),eQ.negate(u.rotational),d.spatial.copy(p),d.rotational.copy(eJ),eZ.copy(r.position),eZ.vadd(s,eZ),eZ.vsub(n.position,eZ),eZ.vsub(a,eZ);let f=p.dot(eZ),m=this.restitution+1,g=m*c.dot(p)-m*o.dot(p)+h.dot(eJ)-l.dot(eQ);return-f*t-g*i-e*this.computeGiMf()}getImpactVelocityAlongNormal(){return this.bi.position.vadd(this.ri,e1),this.bj.position.vadd(this.rj,e2),this.bi.getVelocityAtWorldPoint(e1,e$),this.bj.getVelocityAtWorldPoint(e2,e0),e$.vsub(e0,e3),this.ni.dot(e3)}}let eQ=new p,eJ=new p,eZ=new p,e$=new p,e0=new p,e1=new p,e2=new p,e3=new p;class e4 extends ez{constructor(e,t,i,n,r){void 0===t&&(t=new p),void 0===n&&(n=new p),void 0===r&&(r=1e6),super(e,i),this.pivotA=t.clone(),this.pivotB=n.clone();let a=this.equationX=new eK(e,i),s=this.equationY=new eK(e,i),o=this.equationZ=new eK(e,i);this.equations.push(a,s,o),a.minForce=s.minForce=o.minForce=-r,a.maxForce=s.maxForce=o.maxForce=r,a.ni.set(1,0,0),s.ni.set(0,1,0),o.ni.set(0,0,1)}update(){let e=this.bodyA,t=this.bodyB,i=this.equationX,n=this.equationY,r=this.equationZ;e.quaternion.vmult(this.pivotA,i.ri),t.quaternion.vmult(this.pivotB,i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj),r.ri.copy(i.ri),r.rj.copy(i.rj)}}class e5 extends eV{constructor(e,t,i){void 0===i&&(i={});let n=void 0!==i.maxForce?i.maxForce:1e6;super(e,t,-n,n),this.axisA=i.axisA?i.axisA.clone():new p(1,0,0),this.axisB=i.axisB?i.axisB.clone():new p(0,1,0),this.angle=void 0!==i.angle?i.angle:0}computeB(e){let t=this.a,i=this.b,n=this.axisA,r=this.axisB,a=this.jacobianElementA,s=this.jacobianElementB;n.cross(r,e6),r.cross(n,e8),a.rotational.copy(e8),s.rotational.copy(e6);let o=Math.cos(this.angle)-n.dot(r),l=this.computeGW();return-o*t-l*i-e*this.computeGiMf()}}let e6=new p,e8=new p;class e9 extends eV{constructor(e,t,i){void 0===i&&(i={});let n=void 0!==i.maxForce?i.maxForce:1e6;super(e,t,-n,n),this.axisA=i.axisA?i.axisA.clone():new p(1,0,0),this.axisB=i.axisB?i.axisB.clone():new p(0,1,0),this.maxAngle=Math.PI/2}computeB(e){let t=this.a,i=this.b,n=this.axisA,r=this.axisB,a=this.jacobianElementA,s=this.jacobianElementB;n.cross(r,e7),r.cross(n,te),a.rotational.copy(te),s.rotational.copy(e7);let o=Math.cos(this.maxAngle)-n.dot(r),l=this.computeGW();return-o*t-l*i-e*this.computeGiMf()}}let e7=new p,te=new p;class tt extends e4{constructor(e,t,i){void 0===i&&(i={});let n=void 0!==i.maxForce?i.maxForce:1e6;super(e,i.pivotA?i.pivotA.clone():new p,t,i.pivotB?i.pivotB.clone():new p,n),this.axisA=i.axisA?i.axisA.clone():new p,this.axisB=i.axisB?i.axisB.clone():new p,this.collideConnected=!!i.collideConnected,this.angle=void 0!==i.angle?i.angle:0;let r=this.coneEquation=new e5(e,t,i),a=this.twistEquation=new e9(e,t,i);this.twistAngle=void 0!==i.twistAngle?i.twistAngle:0,r.maxForce=0,r.minForce=-n,a.maxForce=0,a.minForce=-n,this.equations.push(r,a)}update(){let e=this.bodyA,t=this.bodyB,i=this.coneEquation,n=this.twistEquation;super.update(),e.vectorToWorldFrame(this.axisA,i.axisA),t.vectorToWorldFrame(this.axisB,i.axisB),this.axisA.tangents(n.axisA,n.axisA),e.vectorToWorldFrame(n.axisA,n.axisA),this.axisB.tangents(n.axisB,n.axisB),t.vectorToWorldFrame(n.axisB,n.axisB),i.angle=this.angle,n.maxAngle=this.twistAngle}}new p,new p;class ti extends ez{constructor(e,t,i,n){void 0===n&&(n=1e6),super(e,t),void 0===i&&(i=e.position.distanceTo(t.position)),this.distance=i;let r=this.distanceEquation=new eK(e,t);this.equations.push(r),r.minForce=-n,r.maxForce=n}update(){let e=this.bodyA,t=this.bodyB,i=this.distanceEquation,n=.5*this.distance,r=i.ni;t.position.vsub(e.position,r),r.normalize(),r.scale(n,i.ri),r.scale(-n,i.rj)}}class tn extends e4{constructor(e,t,i){void 0===i&&(i={});let n=void 0!==i.maxForce?i.maxForce:1e6,r=new p,a=new p,s=new p;e.position.vadd(t.position,s),s.scale(.5,s),t.pointToLocalFrame(s,a),e.pointToLocalFrame(s,r),super(e,r,t,a,n),this.xA=e.vectorToLocalFrame(p.UNIT_X),this.xB=t.vectorToLocalFrame(p.UNIT_X),this.yA=e.vectorToLocalFrame(p.UNIT_Y),this.yB=t.vectorToLocalFrame(p.UNIT_Y),this.zA=e.vectorToLocalFrame(p.UNIT_Z),this.zB=t.vectorToLocalFrame(p.UNIT_Z);let o=this.rotationalEquation1=new e9(e,t,i),l=this.rotationalEquation2=new e9(e,t,i),c=this.rotationalEquation3=new e9(e,t,i);this.equations.push(o,l,c)}update(){let e=this.bodyA,t=this.bodyB;this.motorEquation;let i=this.rotationalEquation1,n=this.rotationalEquation2,r=this.rotationalEquation3;super.update(),e.vectorToWorldFrame(this.xA,i.axisA),t.vectorToWorldFrame(this.yB,i.axisB),e.vectorToWorldFrame(this.yA,n.axisA),t.vectorToWorldFrame(this.zB,n.axisB),e.vectorToWorldFrame(this.zA,r.axisA),t.vectorToWorldFrame(this.xB,r.axisB)}}new p,new p;class tr extends eV{constructor(e,t,i){void 0===i&&(i=1e6),super(e,t,-i,i),this.axisA=new p,this.axisB=new p,this.targetVelocity=0}computeB(e){this.a;let t=this.b;this.bi,this.bj;let i=this.axisA,n=this.axisB,r=this.jacobianElementA,a=this.jacobianElementB;r.rotational.copy(i),n.negate(a.rotational);let s=this.computeGW()-this.targetVelocity;return-s*t-e*this.computeGiMf()}}class ta extends e4{constructor(e,t,i){void 0===i&&(i={});let n=void 0!==i.maxForce?i.maxForce:1e6;super(e,i.pivotA?i.pivotA.clone():new p,t,i.pivotB?i.pivotB.clone():new p,n),(this.axisA=i.axisA?i.axisA.clone():new p(1,0,0)).normalize(),(this.axisB=i.axisB?i.axisB.clone():new p(1,0,0)).normalize(),this.collideConnected=!!i.collideConnected;let r=this.rotationalEquation1=new e9(e,t,i),a=this.rotationalEquation2=new e9(e,t,i),s=this.motorEquation=new tr(e,t,n);s.enabled=!1,this.equations.push(r,a,s)}enableMotor(){this.motorEquation.enabled=!0}disableMotor(){this.motorEquation.enabled=!1}setMotorSpeed(e){this.motorEquation.targetVelocity=e}setMotorMaxForce(e){this.motorEquation.maxForce=e,this.motorEquation.minForce=-e}update(){let e=this.bodyA,t=this.bodyB,i=this.motorEquation,n=this.rotationalEquation1,r=this.rotationalEquation2,a=this.axisA,s=this.axisB;super.update(),e.quaternion.vmult(a,ts),t.quaternion.vmult(s,to),ts.tangents(n.axisA,r.axisA),n.axisB.copy(to),r.axisB.copy(to),this.motorEquation.enabled&&(e.quaternion.vmult(this.axisA,i.axisA),t.quaternion.vmult(this.axisB,i.axisB))}}let ts=new p,to=new p;class tl extends eV{constructor(e,t,i){super(e,t,-i,i),this.ri=new p,this.rj=new p,this.t=new p}computeB(e){this.a;let t=this.b;this.bi,this.bj;let i=this.ri,n=this.rj,r=this.t;i.cross(r,tc),n.cross(r,th);let a=this.jacobianElementA,s=this.jacobianElementB;r.negate(a.spatial),tc.negate(a.rotational),s.spatial.copy(r),s.rotational.copy(th);let o=this.computeGW();return-o*t-e*this.computeGiMf()}}let tc=new p,th=new p;class tu{constructor(e,t,i){i=ek.defaults(i,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=tu.idCounter++,this.materials=[e,t],this.friction=i.friction,this.restitution=i.restitution,this.contactEquationStiffness=i.contactEquationStiffness,this.contactEquationRelaxation=i.contactEquationRelaxation,this.frictionEquationStiffness=i.frictionEquationStiffness,this.frictionEquationRelaxation=i.frictionEquationRelaxation}}tu.idCounter=0;class td{constructor(e){void 0===e&&(e={});let t="";"string"==typeof e&&(t=e,e={}),this.name=t,this.id=td.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}td.idCounter=0;class tp{constructor(e,t,i){void 0===i&&(i={}),this.restLength="number"==typeof i.restLength?i.restLength:1,this.stiffness=i.stiffness||100,this.damping=i.damping||1,this.bodyA=e,this.bodyB=t,this.localAnchorA=new p,this.localAnchorB=new p,i.localAnchorA&&this.localAnchorA.copy(i.localAnchorA),i.localAnchorB&&this.localAnchorB.copy(i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB)}setWorldAnchorA(e){this.bodyA.pointToLocalFrame(e,this.localAnchorA)}setWorldAnchorB(e){this.bodyB.pointToLocalFrame(e,this.localAnchorB)}getWorldAnchorA(e){this.bodyA.pointToWorldFrame(this.localAnchorA,e)}getWorldAnchorB(e){this.bodyB.pointToWorldFrame(this.localAnchorB,e)}applyForce(){let e=this.stiffness,t=this.damping,i=this.restLength,n=this.bodyA,r=this.bodyB;this.getWorldAnchorA(ty),this.getWorldAnchorB(tx),ty.vsub(n.position,t_),tx.vsub(r.position,tA),tx.vsub(ty,tf);let a=tf.length();tm.copy(tf),tm.normalize(),r.velocity.vsub(n.velocity,tg),r.angularVelocity.cross(tA,tw),tg.vadd(tw,tg),n.angularVelocity.cross(t_,tw),tg.vsub(tw,tg),tm.scale(-e*(a-i)-t*tg.dot(tm),tv),n.force.vsub(tv,n.force),r.force.vadd(tv,r.force),t_.cross(tv,tb),tA.cross(tv,tS),n.torque.vsub(tb,n.torque),r.torque.vadd(tS,r.torque)}}let tf=new p,tm=new p,tg=new p,tv=new p,ty=new p,tx=new p,t_=new p,tA=new p,tb=new p,tS=new p,tw=new p;class tM{constructor(e){void 0===e&&(e={}),e=ek.defaults(e,{chassisConnectionPointLocal:new p,chassisConnectionPointWorld:new p,directionLocal:new p,directionWorld:new p,axleLocal:new p,axleWorld:new p,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:10.5,forwardAcceleration:1,sideAcceleration:1,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,slipInfo:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=e.maxSuspensionTravel,this.customSlidingRotationalSpeed=e.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=e.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=e.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=e.chassisConnectionPointWorld.clone(),this.directionLocal=e.directionLocal.clone(),this.directionWorld=e.directionWorld.clone(),this.axleLocal=e.axleLocal.clone(),this.axleWorld=e.axleWorld.clone(),this.suspensionRestLength=e.suspensionRestLength,this.suspensionMaxLength=e.suspensionMaxLength,this.radius=e.radius,this.suspensionStiffness=e.suspensionStiffness,this.dampingCompression=e.dampingCompression,this.dampingRelaxation=e.dampingRelaxation,this.frictionSlip=e.frictionSlip,this.forwardAcceleration=e.forwardAcceleration,this.sideAcceleration=e.sideAcceleration,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=e.rollInfluence,this.maxSuspensionForce=e.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=e.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.slipInfo=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new eo,this.worldTransform=new C,this.isInContact=!1}updateWheel(e){let t=this.raycastResult;if(this.isInContact){let i=t.hitNormalWorld.dot(t.directionWorld);t.hitPointWorld.vsub(e.position,tC),e.getVelocityAtWorldPoint(tC,tE);let n=t.hitNormalWorld.dot(tE);if(i>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{let e=-1/i;this.suspensionRelativeVelocity=n*e,this.clippedInvContactDotSuspension=e}}else t.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.hitNormalWorld),this.clippedInvContactDotSuspension=1}}let tE=new p,tC=new p;class tT{constructor(e){this.chassisBody=e.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==e.indexRightAxis?e.indexRightAxis:2,this.indexForwardAxis=void 0!==e.indexForwardAxis?e.indexForwardAxis:0,this.indexUpAxis=void 0!==e.indexUpAxis?e.indexUpAxis:1,this.constraints=[],this.preStepCallback=()=>{},this.currentVehicleSpeedKmHour=0,this.numWheelsOnGround=0}addWheel(e){void 0===e&&(e={});let t=new tM(e),i=this.wheelInfos.length;return this.wheelInfos.push(t),i}setSteeringValue(e,t){this.wheelInfos[t].steering=e}applyEngineForce(e,t){this.wheelInfos[t].engineForce=e}setBrake(e,t){this.wheelInfos[t].brake=e}addToWorld(e){e.addBody(this.chassisBody);let t=this;this.preStepCallback=()=>{t.updateVehicle(e.dt)},e.addEventListener("preStep",this.preStepCallback),this.world=e}getVehicleAxisWorld(e,t){t.set(0===e?1:0,1===e?1:0,2===e?1:0),this.chassisBody.vectorToWorldFrame(t,t)}updateVehicle(e){let t=this.wheelInfos,i=t.length,n=this.chassisBody;for(let e=0;e<i;e++)this.updateWheelTransform(e);this.currentVehicleSpeedKmHour=3.6*n.velocity.length();let r=new p;this.getVehicleAxisWorld(this.indexForwardAxis,r),0>r.dot(n.velocity)&&(this.currentVehicleSpeedKmHour*=-1);for(let e=0;e<i;e++)this.castRay(t[e]);this.updateSuspension(e);let a=new p,s=new p;for(let r=0;r<i;r++){let i=t[r],o=i.suspensionForce;o>i.maxSuspensionForce&&(o=i.maxSuspensionForce),i.raycastResult.hitNormalWorld.scale(o*e,a),i.raycastResult.hitPointWorld.vsub(n.position,s),n.applyImpulse(a,s)}this.updateFriction(e);let o=new p,l=new p,c=new p;for(let r=0;r<i;r++){let i=t[r];n.getVelocityAtWorldPoint(i.chassisConnectionPointWorld,c);let a=1;if(1===this.indexUpAxis&&(a=-1),i.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,l);let t=l.dot(i.raycastResult.hitNormalWorld);i.raycastResult.hitNormalWorld.scale(t,o),l.vsub(o,l);let n=l.dot(c);i.deltaRotation=a*n*e/i.radius}(i.sliding||!i.isInContact)&&0!==i.engineForce&&i.useCustomSlidingRotationalSpeed&&(i.deltaRotation=(i.engineForce>0?1:-1)*i.customSlidingRotationalSpeed*e),Math.abs(i.brake)>Math.abs(i.engineForce)&&(i.deltaRotation=0),i.rotation+=i.deltaRotation,i.deltaRotation*=.99}}updateSuspension(e){let t=this.chassisBody.mass,i=this.wheelInfos,n=i.length;for(let e=0;e<n;e++){let n=i[e];if(n.isInContact){let e,i;let r=n.suspensionRestLength-n.suspensionLength;e=n.suspensionStiffness*r*n.clippedInvContactDotSuspension;let a=n.suspensionRelativeVelocity;e-=(a<0?n.dampingCompression:n.dampingRelaxation)*a,n.suspensionForce=e*t,n.suspensionForce<0&&(n.suspensionForce=0)}else n.suspensionForce=0}}removeFromWorld(e){this.constraints,e.removeBody(this.chassisBody),e.removeEventListener("preStep",this.preStepCallback),this.world=null}castRay(e){this.updateWheelTransformWorld(e);let t=this.chassisBody,i=-1,n=e.suspensionRestLength+e.radius;e.directionWorld.scale(n,tL);let r=e.chassisConnectionPointWorld;r.vadd(tL,tD);let a=e.raycastResult;a.reset();let s=t.collisionResponse;t.collisionResponse=!1,this.world.rayTest(r,tD,a),t.collisionResponse=s;let o=a.body;if(e.raycastResult.groundObject=0,o){i=a.distance,e.raycastResult.hitNormalWorld=a.hitNormalWorld,e.isInContact=!0;let n=a.distance;e.suspensionLength=n-e.radius;let r=e.suspensionRestLength-e.maxSuspensionTravel,s=e.suspensionRestLength+e.maxSuspensionTravel;e.suspensionLength<r&&(e.suspensionLength=r),e.suspensionLength>s&&(e.suspensionLength=s,e.raycastResult.reset());let o=e.raycastResult.hitNormalWorld.dot(e.directionWorld),l=new p;t.getVelocityAtWorldPoint(e.raycastResult.hitPointWorld,l);let c=e.raycastResult.hitNormalWorld.dot(l);if(o>=-.1)e.suspensionRelativeVelocity=0,e.clippedInvContactDotSuspension=10;else{let t=-1/o;e.suspensionRelativeVelocity=c*t,e.clippedInvContactDotSuspension=t}}else e.suspensionLength=e.suspensionRestLength+0*e.maxSuspensionTravel,e.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.raycastResult.hitNormalWorld),e.clippedInvContactDotSuspension=1;return i}updateWheelTransformWorld(e){e.isInContact=!1;let t=this.chassisBody;t.pointToWorldFrame(e.chassisConnectionPointLocal,e.chassisConnectionPointWorld),t.vectorToWorldFrame(e.directionLocal,e.directionWorld),t.vectorToWorldFrame(e.axleLocal,e.axleWorld)}updateWheelTransform(e){let t=this.wheelInfos[e];this.updateWheelTransformWorld(t),t.directionLocal.scale(-1,tR),tP.copy(t.axleLocal),tR.cross(tP,tI),tI.normalize(),tP.normalize();let i=t.steering,n=new b;n.setFromAxisAngle(tR,i);let r=new b;r.setFromAxisAngle(tP,t.rotation);let a=t.worldTransform.quaternion;this.chassisBody.quaternion.mult(n,a),a.mult(r,a),a.normalize();let s=t.worldTransform.position;s.copy(t.directionWorld),s.scale(t.suspensionLength,s),s.vadd(t.chassisConnectionPointWorld,s)}getWheelTransformWorld(e){return this.wheelInfos[e].worldTransform}updateFriction(e){let t=this.wheelInfos,i=t.length,n=this.chassisBody;this.numWheelsOnGround=0;for(let e=0;e<i;e++){let i=t[e];i.raycastResult.body&&this.numWheelsOnGround++,i.sideImpulse=0,i.forwardImpulse=0,tU[e]||(tU[e]=new p),tN[e]||(tN[e]=new p)}for(let e=0;e<i;e++){let i=t[e],r=i.raycastResult.body;if(r){let t=tN[e];this.getWheelTransformWorld(e).vectorToWorldFrame(tB[this.indexRightAxis],t);let a=i.raycastResult.hitNormalWorld,s=t.dot(a);a.scale(s,tO),t.vsub(tO,t),t.normalize(),a.cross(t,tU[e]),tU[e].normalize(),i.sideImpulse=function(e,t,i,n,r){if(r.lengthSquared()>1.1)return 0;e.getVelocityAtWorldPoint(t,tX),i.getVelocityAtWorldPoint(n,tY),tX.vsub(tY,tK);let a=r.dot(tK);return -.2*a*(1/(e.invMass+i.invMass))}(n,i.raycastResult.hitPointWorld,r,i.raycastResult.hitPointWorld,t),i.sideImpulse*=tF}}this.sliding=!1;for(let r=0;r<i;r++){let i=t[r],a=i.raycastResult.body,s=0;if(i.slipInfo=1,a){let t=i.brake?i.brake:0;s=function(e,t,i,n,r){let a=0;e.getVelocityAtWorldPoint(i,tk),t.getVelocityAtWorldPoint(i,tz),tk.vsub(tz,tH);let s=n.dot(tH),o=tq(e,i,n);return r<(a=-(1/(o+tq(t,i,n))*s))&&(a=r),a<-r&&(a=-r),a}(n,a,i.raycastResult.hitPointWorld,tU[r],t)+i.engineForce*e;let o=t/s;i.slipInfo*=o}if(i.forwardImpulse=0,i.skidInfo=1,a){i.skidInfo=1;let t=i.suspensionForce*e*i.frictionSlip,n=t*t;i.forwardImpulse=s;let r=.5*i.forwardImpulse/i.forwardAcceleration,a=1*i.sideImpulse/i.sideAcceleration,o=r*r+a*a;if(i.sliding=!1,o>n){this.sliding=!0,i.sliding=!0;let e=t/Math.sqrt(o);i.skidInfo*=e}}}if(this.sliding)for(let e=0;e<i;e++){let i=t[e];0!==i.sideImpulse&&i.skidInfo<1&&(i.forwardImpulse*=i.skidInfo,i.sideImpulse*=i.skidInfo)}for(let e=0;e<i;e++){let i=t[e],r=new p;if(i.raycastResult.hitPointWorld.vsub(n.position,r),0!==i.forwardImpulse){let t=new p;tU[e].scale(i.forwardImpulse,t),n.applyImpulse(t,r)}if(0!==i.sideImpulse){let t=i.raycastResult.body,a=new p;i.raycastResult.hitPointWorld.vsub(t.position,a);let s=new p;tN[e].scale(i.sideImpulse,s),n.vectorToLocalFrame(r,r),r["xyz"[this.indexUpAxis]]*=i.rollInfluence,n.vectorToWorldFrame(r,r),n.applyImpulse(s,r),s.scale(-1,s),t.applyImpulse(s,a)}}}}new p,new p,new p;let tR=new p,tP=new p,tI=new p;new ec,new p;let tL=new p,tD=new p,tB=[new p(1,0,0),new p(0,1,0),new p(0,0,1)],tO=new p,tN=[],tU=[],tF=1,tk=new p,tz=new p,tH=new p,tV=new p,tG=new p,tW=new p,tj=new p;function tq(e,t,i){return t.vsub(e.position,tV),tV.cross(i,tG),e.invInertiaWorld.vmult(tG,tj),tj.cross(tV,tW),e.invMass+i.dot(tW)}let tX=new p,tY=new p,tK=new p;class tQ extends E{constructor(e){if(super({type:E.types.SPHERE}),this.radius=void 0!==e?e:1,this.radius<0)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,t){void 0===t&&(t=new p);let i=2*e*this.radius*this.radius/5;return t.x=i,t.y=i,t.z=i,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,t,i,n){let r=this.radius,a=["x","y","z"];for(let t=0;t<a.length;t++){let s=a[t];i[s]=e[s]-r,n[s]=e[s]+r}}}class tJ{constructor(e){void 0===e&&(e={}),this.wheelBodies=[],this.coordinateSystem=void 0!==e.coordinateSystem?e.coordinateSystem.clone():new p(1,2,3),e.chassisBody?this.chassisBody=e.chassisBody:this.chassisBody=new k({mass:1,shape:new B(new p(5,.5,2))}),this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}addWheel(e){let t;void 0===e&&(e={}),t=e.body?e.body:new k({mass:1,shape:new tQ(1.2)}),this.wheelBodies.push(t),this.wheelForces.push(0);let i=void 0!==e.position?e.position.clone():new p,n=new p;this.chassisBody.pointToWorldFrame(i,n),t.position.set(n.x,n.y,n.z);let r=void 0!==e.axis?e.axis.clone():new p(0,0,1);this.wheelAxes.push(r);let a=new ta(this.chassisBody,t,{pivotA:i,axisA:r,pivotB:p.ZERO,axisB:r,collideConnected:!1});return this.constraints.push(a),this.wheelBodies.length-1}setSteeringValue(e,t){let i=this.wheelAxes[t],n=Math.cos(e),r=Math.sin(e),a=i.x,s=i.z;this.constraints[t].axisA.set(-n*a+r*s,0,r*a+n*s)}setMotorSpeed(e,t){let i=this.constraints[t];i.enableMotor(),i.motorTargetVelocity=e}disableMotor(e){this.constraints[e].disableMotor()}setWheelForce(e,t){this.wheelForces[t]=e}applyWheelForce(e,t){let i=this.wheelAxes[t],n=this.wheelBodies[t],r=n.torque;i.scale(e,tZ),n.vectorToWorldFrame(tZ,tZ),r.vadd(tZ,r)}addToWorld(e){let t=this.constraints,i=this.wheelBodies.concat([this.chassisBody]);for(let t=0;t<i.length;t++)e.addBody(i[t]);for(let i=0;i<t.length;i++)e.addConstraint(t[i]);e.addEventListener("preStep",this._update.bind(this))}_update(){let e=this.wheelForces;for(let t=0;t<e.length;t++)this.applyWheelForce(e[t],t)}removeFromWorld(e){let t=this.constraints,i=this.wheelBodies.concat([this.chassisBody]);for(let t=0;t<i.length;t++)e.removeBody(i[t]);for(let i=0;i<t.length;i++)e.removeConstraint(t[i])}getWheelSpeed(e){let t=this.wheelAxes[e],i=this.wheelBodies[e].angularVelocity;return this.chassisBody.vectorToWorldFrame(t,t$),i.dot(t$)}}let tZ=new p,t$=new p;class t0{constructor(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}add(e){this.particles.push(e),this.neighbors.length<this.particles.length&&this.neighbors.push([])}remove(e){let t=this.particles.indexOf(e);-1!==t&&(this.particles.splice(t,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())}getNeighbors(e,t){let i=this.particles.length,n=e.id,r=this.smoothingRadius*this.smoothingRadius;for(let a=0;a!==i;a++){let i=this.particles[a];i.position.vsub(e.position,t1),n!==i.id&&t1.lengthSquared()<r&&t.push(i)}}update(){let e=this.particles.length,t=this.speedOfSound,i=this.eps;for(let i=0;i!==e;i++){let e=this.particles[i],n=this.neighbors[i];n.length=0,this.getNeighbors(e,n),n.push(this.particles[i]);let r=n.length,a=0;for(let t=0;t!==r;t++){e.position.vsub(n[t].position,t2);let i=t2.length(),r=this.w(i);a+=n[t].mass*r}this.densities[i]=a,this.pressures[i]=t*t*(this.densities[i]-this.density)}for(let t=0;t!==e;t++){let e,n;let r=this.particles[t];t3.set(0,0,0),t4.set(0,0,0);let a=this.neighbors[t],s=a.length;for(let o=0;o!==s;o++){let s=a[o];r.position.vsub(s.position,t6);let l=t6.length();e=-s.mass*(this.pressures[t]/(this.densities[t]*this.densities[t]+i)+this.pressures[o]/(this.densities[o]*this.densities[o]+i)),this.gradw(t6,t5),t5.scale(e,t5),t3.vadd(t5,t3),s.velocity.vsub(r.velocity,t8),t8.scale(1/(1e-4+this.densities[t]*this.densities[o])*this.viscosity*s.mass,t8),n=this.nablaw(l),t8.scale(n,t8),t4.vadd(t8,t4)}t4.scale(r.mass,t4),t3.scale(r.mass,t3),r.force.vadd(t4,r.force),r.force.vadd(t3,r.force)}}w(e){let t=this.smoothingRadius;return 315/(64*Math.PI*t**9)*(t*t-e*e)**3}gradw(e,t){let i=e.length(),n=this.smoothingRadius;e.scale(945/(32*Math.PI*n**9)*(n*n-i*i)**2,t)}nablaw(e){let t=this.smoothingRadius;return 945/(32*Math.PI*t**9)*(t*t-e*e)*(7*e*e-3*t*t)}}let t1=new p,t2=new p,t3=new p,t4=new p,t5=new p,t6=new p,t8=new p;class t9 extends R{constructor(e,t,i,n){if(void 0===e&&(e=1),void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=8),e<0)throw Error("The cylinder radiusTop cannot be negative.");if(t<0)throw Error("The cylinder radiusBottom cannot be negative.");let r=n,a=[],s=[],o=[],l=[],c=[],h=Math.cos,u=Math.sin;a.push(new p(-t*u(0),-(.5*i),t*h(0))),l.push(0),a.push(new p(-e*u(0),.5*i,e*h(0))),c.push(1);for(let n=0;n<r;n++){let d=2*Math.PI/r*(n+1),f=2*Math.PI/r*(n+.5);n<r-1?(a.push(new p(-t*u(d),-(.5*i),t*h(d))),l.push(2*n+2),a.push(new p(-e*u(d),.5*i,e*h(d))),c.push(2*n+3),o.push([2*n,2*n+1,2*n+3,2*n+2])):o.push([2*n,2*n+1,1,0]),(r%2==1||n<r/2)&&s.push(new p(-u(f),0,h(f)))}o.push(l),s.push(new p(0,1,0));let d=[];for(let e=0;e<c.length;e++)d.push(c[c.length-e-1]);o.push(d),super({vertices:a,faces:o,axes:s}),this.type=E.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=i,this.numSegments=n}}class t7 extends E{constructor(){super({type:E.types.PARTICLE})}calculateLocalInertia(e,t){return void 0===t&&(t=new p),t.set(0,0,0),t}volume(){return 0}updateBoundingSphereRadius(){this.boundingSphereRadius=0}calculateWorldAABB(e,t,i,n){i.copy(e),n.copy(e)}}class ie extends E{constructor(){super({type:E.types.PLANE}),this.worldNormal=new p,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){let t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,t){return void 0===t&&(t=new p),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,i,n){it.set(0,0,1),t.vmult(it,it);let r=Number.MAX_VALUE;i.set(-r,-r,-r),n.set(r,r,r),1===it.x?n.x=e.x:-1===it.x&&(i.x=e.x),1===it.y?n.y=e.y:-1===it.y&&(i.y=e.y),1===it.z?n.z=e.z:-1===it.z&&(i.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}let it=new p;class ii extends E{constructor(e,t){void 0===t&&(t={}),t=ek.defaults(t,{maxValue:null,minValue:null,elementSize:1}),super({type:E.types.HEIGHTFIELD}),this.data=e,this.maxValue=t.maxValue,this.minValue=t.minValue,this.elementSize=t.elementSize,null===t.minValue&&this.updateMinValue(),null===t.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,this.pillarConvex=new R,this.pillarOffset=new p,this.updateBoundingSphereRadius(),this._cachedPillars={}}update(){this._cachedPillars={}}updateMinValue(){let e=this.data,t=e[0][0];for(let i=0;i!==e.length;i++)for(let n=0;n!==e[i].length;n++){let r=e[i][n];r<t&&(t=r)}this.minValue=t}updateMaxValue(){let e=this.data,t=e[0][0];for(let i=0;i!==e.length;i++)for(let n=0;n!==e[i].length;n++){let r=e[i][n];r>t&&(t=r)}this.maxValue=t}setHeightValueAtIndex(e,t,i){this.data[e][t]=i,this.clearCachedConvexTrianglePillar(e,t,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,t,!0),this.clearCachedConvexTrianglePillar(e-1,t,!1)),t>0&&(this.clearCachedConvexTrianglePillar(e,t-1,!0),this.clearCachedConvexTrianglePillar(e,t-1,!1)),t>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,t-1,!0)}getRectMinMax(e,t,i,n,r){void 0===r&&(r=[]);let a=this.data,s=this.minValue;for(let r=e;r<=i;r++)for(let e=t;e<=n;e++){let t=a[r][e];t>s&&(s=t)}r[0]=this.minValue,r[1]=s}getIndexOfPosition(e,t,i,n){let r=this.elementSize,a=this.data,s=Math.floor(e/r),o=Math.floor(t/r);return i[0]=s,i[1]=o,n&&(s<0&&(s=0),o<0&&(o=0),s>=a.length-1&&(s=a.length-1),o>=a[0].length-1&&(o=a[0].length-1)),!(s<0)&&!(o<0)&&!(s>=a.length-1)&&!(o>=a[0].length-1)}getTriangleAt(e,t,i,n,r,a){this.getIndexOfPosition(e,t,ir,i);let s=ir[0],o=ir[1],l=this.data;i&&(s=Math.min(l.length-2,Math.max(0,s)),o=Math.min(l[0].length-2,Math.max(0,o)));let c=this.elementSize,h=(e/c-s)**2+(t/c-o)**2>(e/c-(s+1))**2+(t/c-(o+1))**2;return this.getTriangle(s,o,h,n,r,a),h}getNormalAt(e,t,i,n){this.getTriangleAt(e,t,i,ic,ih,iu),ih.vsub(ic,id),iu.vsub(ic,ip),id.cross(ip,n),n.normalize()}getAabbAtIndex(e,t,i){let{lowerBound:n,upperBound:r}=i,a=this.data,s=this.elementSize;n.set(e*s,t*s,a[e][t]),r.set((e+1)*s,(t+1)*s,a[e+1][t+1])}getHeightAt(e,t,i){var n,r,a,s,o,l,c,h,u;let d=this.data;this.getIndexOfPosition(e,t,ir,i);let p=ir[0],f=ir[1];i&&(p=Math.min(d.length-2,Math.max(0,p)),f=Math.min(d[0].length-2,Math.max(0,f)));let m=this.getTriangleAt(e,t,i,is,io,il);return(n=e,r=t,a=is.x,s=is.y,o=io.x,l=io.y,c=il.x,h=il.y,(u=ia).x=((l-h)*(n-c)+(c-o)*(r-h))/((l-h)*(a-c)+(c-o)*(s-h)),u.y=((h-s)*(n-c)+(a-c)*(r-h))/((l-h)*(a-c)+(c-o)*(s-h)),u.z=1-u.x-u.y,m)?d[p+1][f+1]*ia.x+d[p][f+1]*ia.y+d[p+1][f]*ia.z:d[p][f]*ia.x+d[p+1][f]*ia.y+d[p][f+1]*ia.z}getCacheConvexTrianglePillarKey(e,t,i){return`${e}_${t}_${i?1:0}`}getCachedConvexTrianglePillar(e,t,i){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,i)]}setCachedConvexTrianglePillar(e,t,i,n,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,i)]={convex:n,offset:r}}clearCachedConvexTrianglePillar(e,t,i){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,t,i)]}getTriangle(e,t,i,n,r,a){let s=this.data,o=this.elementSize;i?(n.set((e+1)*o,(t+1)*o,s[e+1][t+1]),r.set(e*o,(t+1)*o,s[e][t+1]),a.set((e+1)*o,t*o,s[e+1][t])):(n.set(e*o,t*o,s[e][t]),r.set((e+1)*o,t*o,s[e+1][t]),a.set(e*o,(t+1)*o,s[e][t+1]))}getConvexTrianglePillar(e,t,i){let n=this.pillarConvex,r=this.pillarOffset;if(this.cacheEnabled){let a=this.getCachedConvexTrianglePillar(e,t,i);if(a){this.pillarConvex=a.convex,this.pillarOffset=a.offset;return}n=new R,r=new p,this.pillarConvex=n,this.pillarOffset=r}let a=this.data,s=this.elementSize,o=n.faces;n.vertices.length=6;for(let e=0;e<6;e++)n.vertices[e]||(n.vertices[e]=new p);o.length=5;for(let e=0;e<5;e++)o[e]||(o[e]=[]);let l=n.vertices,c=(Math.min(a[e][t],a[e+1][t],a[e][t+1],a[e+1][t+1])-this.minValue)/2+this.minValue;i?(r.set((e+.75)*s,(t+.75)*s,c),l[0].set(.25*s,.25*s,a[e+1][t+1]-c),l[1].set(-.75*s,.25*s,a[e][t+1]-c),l[2].set(.25*s,-.75*s,a[e+1][t]-c),l[3].set(.25*s,.25*s,-Math.abs(c)-1),l[4].set(-.75*s,.25*s,-Math.abs(c)-1),l[5].set(.25*s,-.75*s,-Math.abs(c)-1),o[0][0]=0,o[0][1]=1,o[0][2]=2,o[1][0]=5,o[1][1]=4,o[1][2]=3,o[2][0]=2,o[2][1]=5,o[2][2]=3,o[2][3]=0,o[3][0]=3,o[3][1]=4,o[3][2]=1,o[3][3]=0,o[4][0]=1,o[4][1]=4,o[4][2]=5,o[4][3]=2):(r.set((e+.25)*s,(t+.25)*s,c),l[0].set(-.25*s,-.25*s,a[e][t]-c),l[1].set(.75*s,-.25*s,a[e+1][t]-c),l[2].set(-.25*s,.75*s,a[e][t+1]-c),l[3].set(-.25*s,-.25*s,-Math.abs(c)-1),l[4].set(.75*s,-.25*s,-Math.abs(c)-1),l[5].set(-.25*s,.75*s,-Math.abs(c)-1),o[0][0]=0,o[0][1]=1,o[0][2]=2,o[1][0]=5,o[1][1]=4,o[1][2]=3,o[2][0]=0,o[2][1]=2,o[2][2]=5,o[2][3]=3,o[3][0]=1,o[3][1]=0,o[3][2]=3,o[3][3]=4,o[4][0]=4,o[4][1]=5,o[4][2]=2,o[4][3]=1),n.computeNormals(),n.computeEdges(),n.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,t,i,n,r)}calculateLocalInertia(e,t){return void 0===t&&(t=new p),t.set(0,0,0),t}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,t,i,n){i.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){let e=this.data,t=this.elementSize;this.boundingSphereRadius=new p(e.length*t,e[0].length*t,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()}setHeightsFromImage(e,t){let{x:i,z:n,y:r}=t,a=document.createElement("canvas");a.width=e.width,a.height=e.height;let s=a.getContext("2d");s.drawImage(e,0,0);let o=s.getImageData(0,0,e.width,e.height),l=this.data;l.length=0,this.elementSize=Math.abs(i)/o.width;for(let e=0;e<o.height;e++){let t=[];for(let r=0;r<o.width;r++){let a=o.data[(e*o.height+r)*4],s=(a+o.data[(e*o.height+r)*4+1]+o.data[(e*o.height+r)*4+2])/4/255*n;i<0?t.push(s):t.unshift(s)}r<0?l.unshift(t):l.push(t)}this.updateMaxValue(),this.updateMinValue(),this.update()}}let ir=[],ia=new p,is=new p,io=new p,il=new p,ic=new p,ih=new p,iu=new p,id=new p,ip=new p;class im{constructor(e){void 0===e&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new v,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,t,i){void 0===i&&(i=0);let n=this.data;if(!this.aabb.contains(e))return!1;let r=this.children,a=this.maxDepth||this.root.maxDepth;if(i<a){let n=!1;r.length||(this.subdivide(),n=!0);for(let n=0;8!==n;n++)if(r[n].insert(e,t,i+1))return!0;n&&(r.length=0)}return n.push(t),!0}subdivide(){let e=this.aabb,t=e.lowerBound,i=e.upperBound,n=this.children;n.push(new im({aabb:new v({lowerBound:new p(0,0,0)})}),new im({aabb:new v({lowerBound:new p(1,0,0)})}),new im({aabb:new v({lowerBound:new p(1,1,0)})}),new im({aabb:new v({lowerBound:new p(1,1,1)})}),new im({aabb:new v({lowerBound:new p(0,1,1)})}),new im({aabb:new v({lowerBound:new p(0,0,1)})}),new im({aabb:new v({lowerBound:new p(1,0,1)})}),new im({aabb:new v({lowerBound:new p(0,1,0)})})),i.vsub(t,iv),iv.scale(.5,iv);let r=this.root||this;for(let e=0;8!==e;e++){let i=n[e];i.root=r;let a=i.aabb.lowerBound;a.x*=iv.x,a.y*=iv.y,a.z*=iv.z,a.vadd(t,a),a.vadd(iv,i.aabb.upperBound)}}aabbQuery(e,t){this.data,this.children;let i=[this];for(;i.length;){let n=i.pop();n.aabb.overlaps(e)&&Array.prototype.push.apply(t,n.data),Array.prototype.push.apply(i,n.children)}return t}rayQuery(e,t,i){return e.getAABB(iy),iy.toLocalFrame(t,iy),this.aabbQuery(iy,i),i}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),this.children[e].children.length||this.children[e].data.length||this.children.splice(e,1)}}class ig extends im{constructor(e,t){void 0===t&&(t={}),super({root:null,aabb:e}),this.maxDepth=void 0!==t.maxDepth?t.maxDepth:8}}let iv=new p,iy=new v;class ix extends E{constructor(e,t){super({type:E.types.TRIMESH}),this.vertices=new Float32Array(e),this.indices=new Int16Array(t),this.normals=new Float32Array(t.length),this.aabb=new v,this.edges=null,this.scale=new p(1,1,1),this.tree=new ig,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){let e=this.tree;e.reset(),e.aabb.copy(this.aabb);let t=this.scale;e.aabb.lowerBound.x*=1/t.x,e.aabb.lowerBound.y*=1/t.y,e.aabb.lowerBound.z*=1/t.z,e.aabb.upperBound.x*=1/t.x,e.aabb.upperBound.y*=1/t.y,e.aabb.upperBound.z*=1/t.z;let i=new v,n=new p,r=new p,a=new p,s=[n,r,a];for(let t=0;t<this.indices.length/3;t++){let o=3*t;this._getUnscaledVertex(this.indices[o],n),this._getUnscaledVertex(this.indices[o+1],r),this._getUnscaledVertex(this.indices[o+2],a),i.setFromPoints(s),e.insert(i,t)}e.removeEmptyNodes()}getTrianglesInAABB(e,t){iA.copy(e);let i=this.scale,n=i.x,r=i.y,a=i.z,s=iA.lowerBound,o=iA.upperBound;return s.x/=n,s.y/=r,s.z/=a,o.x/=n,o.y/=r,o.z/=a,this.tree.aabbQuery(iA,t)}setScale(e){let t=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,i=e.x===e.y&&e.y===e.z;t&&i||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){let e=this.normals;for(let t=0;t<this.indices.length/3;t++){let i=3*t,n=this.indices[i],r=this.indices[i+1],a=this.indices[i+2];this.getVertex(n,iE),this.getVertex(r,iC),this.getVertex(a,iT),ix.computeNormal(iC,iE,iT,i_),e[i]=i_.x,e[i+1]=i_.y,e[i+2]=i_.z}}updateEdges(){let e={},t=(t,i)=>{e[t<i?`${t}_${i}`:`${i}_${t}`]=!0};for(let e=0;e<this.indices.length/3;e++){let i=3*e,n=this.indices[i],r=this.indices[i+1],a=this.indices[i+2];t(n,r),t(r,a),t(a,n)}let i=Object.keys(e);this.edges=new Int16Array(2*i.length);for(let e=0;e<i.length;e++){let t=i[e].split("_");this.edges[2*e]=parseInt(t[0],10),this.edges[2*e+1]=parseInt(t[1],10)}}getEdgeVertex(e,t,i){let n=this.edges[2*e+(t?1:0)];this.getVertex(n,i)}getEdgeVector(e,t){this.getEdgeVertex(e,0,ib),this.getEdgeVertex(e,1,iS),iS.vsub(ib,t)}static computeNormal(e,t,i,n){t.vsub(e,iM),i.vsub(t,iw),iw.cross(iM,n),n.isZero()||n.normalize()}getVertex(e,t){let i=this.scale;return this._getUnscaledVertex(e,t),t.x*=i.x,t.y*=i.y,t.z*=i.z,t}_getUnscaledVertex(e,t){let i=3*e,n=this.vertices;return t.set(n[i],n[i+1],n[i+2])}getWorldVertex(e,t,i,n){return this.getVertex(e,n),C.pointToWorldFrame(t,i,n,n),n}getTriangleVertices(e,t,i,n){let r=3*e;this.getVertex(this.indices[r],t),this.getVertex(this.indices[r+1],i),this.getVertex(this.indices[r+2],n)}getNormal(e,t){let i=3*e;return t.set(this.normals[i],this.normals[i+1],this.normals[i+2])}calculateLocalInertia(e,t){this.computeLocalAABB(iR);let i=iR.upperBound.x-iR.lowerBound.x,n=iR.upperBound.y-iR.lowerBound.y,r=iR.upperBound.z-iR.lowerBound.z;return t.set(1/12*e*(2*n*2*n+2*r*2*r),1/12*e*(2*i*2*i+2*r*2*r),1/12*e*(2*n*2*n+2*i*2*i))}computeLocalAABB(e){let t=e.lowerBound,i=e.upperBound,n=this.vertices.length;this.vertices,this.getVertex(0,iP),t.copy(iP),i.copy(iP);for(let e=0;e!==n;e++)this.getVertex(e,iP),iP.x<t.x?t.x=iP.x:iP.x>i.x&&(i.x=iP.x),iP.y<t.y?t.y=iP.y:iP.y>i.y&&(i.y=iP.y),iP.z<t.z?t.z=iP.z:iP.z>i.z&&(i.z=iP.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0,t=this.vertices,i=new p;for(let n=0,r=t.length/3;n!==r;n++){this.getVertex(n,i);let t=i.lengthSquared();t>e&&(e=t)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,i,n){iI.position=e,iI.quaternion=t,this.aabb.toWorldFrame(iI,iL),i.copy(iL.lowerBound),n.copy(iL.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,t,i,n,r){void 0===e&&(e=1),void 0===t&&(t=.5),void 0===i&&(i=8),void 0===n&&(n=6),void 0===r&&(r=2*Math.PI);let a=[],s=[];for(let s=0;s<=i;s++)for(let o=0;o<=n;o++){let l=o/n*r,c=s/i*Math.PI*2,h=(e+t*Math.cos(c))*Math.cos(l),u=(e+t*Math.cos(c))*Math.sin(l),d=t*Math.sin(c);a.push(h,u,d)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){let i=(n+1)*e+t-1,r=(n+1)*(e-1)+t-1,a=(n+1)*(e-1)+t,o=(n+1)*e+t;s.push(i,r,o),s.push(r,a,o)}return new ix(a,s)}}let i_=new p,iA=new v,ib=new p,iS=new p,iw=new p,iM=new p,iE=new p,iC=new p,iT=new p,iR=new v,iP=new p,iI=new C,iL=new v;class iD{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){let t=this.equations,i=t.indexOf(e);-1!==i&&t.splice(i,1)}removeAllEquations(){this.equations.length=0}}class iB extends iD{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let i,n,r,a,s,o=0,l=this.iterations,c=this.tolerance*this.tolerance,h=this.equations,u=h.length,d=t.bodies,p=d.length;if(0!==u)for(let e=0;e!==p;e++)d[e].updateSolveMassProperties();iN.length=u,iU.length=u,iO.length=u;for(let t=0;t!==u;t++){let i=h[t];iO[t]=0,iU[t]=i.computeB(e),iN[t]=1/i.computeC()}if(0!==u){for(let e=0;e!==p;e++){let t=d[e],i=t.vlambda,n=t.wlambda;i.set(0,0,0),n.set(0,0,0)}for(o=0;o!==l;o++){a=0;for(let e=0;e!==u;e++){let t=h[e];i=iU[e],n=iN[e],s=iO[e],r=n*(i-t.computeGWlambda()-t.eps*s),s+r<t.minForce?r=t.minForce-s:s+r>t.maxForce&&(r=t.maxForce-s),iO[e]+=r,a+=r>0?r:-r,t.addToWlambda(r)}if(a*a<c)break}for(let e=0;e!==p;e++){let t=d[e],i=t.velocity,n=t.angularVelocity;t.vlambda.vmul(t.linearFactor,t.vlambda),i.vadd(t.vlambda,i),t.wlambda.vmul(t.angularFactor,t.wlambda),n.vadd(t.wlambda,n)}let t=h.length,f=1/e;for(;t--;)h[t].multiplier=iO[t]*f}return o}}let iO=[],iN=[],iU=[];class iF extends iD{constructor(e){for(super(),this.iterations=10,this.tolerance=1e-7,this.subsolver=e,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}createNode(){return{body:null,children:[],eqs:[],visited:!1}}solve(e,t){let i;let n=this.nodePool,r=t.bodies,a=this.equations,s=a.length,o=r.length,l=this.subsolver;for(;n.length<o;)n.push(this.createNode());ik.length=o;for(let e=0;e<o;e++)ik[e]=n[e];for(let e=0;e!==o;e++){let t=ik[e];t.body=r[e],t.children.length=0,t.eqs.length=0,t.visited=!1}for(let e=0;e!==s;e++){let t=a[e],i=r.indexOf(t.bi),n=r.indexOf(t.bj),s=ik[i],o=ik[n];s.children.push(o),s.eqs.push(t),o.children.push(s),o.eqs.push(t)}let c=0,h=iz;for(l.tolerance=this.tolerance,l.iterations=this.iterations;i=iG(ik);){h.length=0,iH.bodies.length=0,function(e,t,i,n){for(iW.push(e),e.visited=!0,t(e,i,n);iW.length;){let e;let r=iW.pop();for(;e=iG(r.children);)e.visited=!0,t(e,i,n),iW.push(e)}}(i,ij,iH.bodies,h);let t=h.length;h=h.sort(iq);for(let e=0;e!==t;e++)l.addEquation(h[e]);l.solve(e,iH),l.removeAllEquations(),c++}return c}}let ik=[],iz=[],iH={bodies:[]},iV=k.STATIC;function iG(e){let t=e.length;for(let i=0;i!==t;i++){let t=e[i];if(!t.visited&&!(t.body.type&iV))return t}return!1}let iW=[];function ij(e,t,i){t.push(e.body);let n=e.eqs.length;for(let t=0;t!==n;t++){let n=e.eqs[t];i.includes(n)||i.push(n)}}function iq(e,t){return t.id-e.id}class iX{constructor(){this.objects=[],this.type=Object}release(){let e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){let t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class iY extends iX{constructor(){super(...arguments),this.type=p}constructObject(){return new p}}let iK={sphereSphere:E.types.SPHERE,spherePlane:E.types.SPHERE|E.types.PLANE,boxBox:E.types.BOX|E.types.BOX,sphereBox:E.types.SPHERE|E.types.BOX,planeBox:E.types.PLANE|E.types.BOX,convexConvex:E.types.CONVEXPOLYHEDRON,sphereConvex:E.types.SPHERE|E.types.CONVEXPOLYHEDRON,planeConvex:E.types.PLANE|E.types.CONVEXPOLYHEDRON,boxConvex:E.types.BOX|E.types.CONVEXPOLYHEDRON,sphereHeightfield:E.types.SPHERE|E.types.HEIGHTFIELD,boxHeightfield:E.types.BOX|E.types.HEIGHTFIELD,convexHeightfield:E.types.CONVEXPOLYHEDRON|E.types.HEIGHTFIELD,sphereParticle:E.types.PARTICLE|E.types.SPHERE,planeParticle:E.types.PLANE|E.types.PARTICLE,boxParticle:E.types.BOX|E.types.PARTICLE,convexParticle:E.types.PARTICLE|E.types.CONVEXPOLYHEDRON,cylinderCylinder:E.types.CYLINDER,sphereCylinder:E.types.SPHERE|E.types.CYLINDER,planeCylinder:E.types.PLANE|E.types.CYLINDER,boxCylinder:E.types.BOX|E.types.CYLINDER,convexCylinder:E.types.CONVEXPOLYHEDRON|E.types.CYLINDER,heightfieldCylinder:E.types.HEIGHTFIELD|E.types.CYLINDER,particleCylinder:E.types.PARTICLE|E.types.CYLINDER,sphereTrimesh:E.types.SPHERE|E.types.TRIMESH,planeTrimesh:E.types.PLANE|E.types.TRIMESH};class iQ{get[iK.sphereSphere](){return this.sphereSphere}get[iK.spherePlane](){return this.spherePlane}get[iK.boxBox](){return this.boxBox}get[iK.sphereBox](){return this.sphereBox}get[iK.planeBox](){return this.planeBox}get[iK.convexConvex](){return this.convexConvex}get[iK.sphereConvex](){return this.sphereConvex}get[iK.planeConvex](){return this.planeConvex}get[iK.boxConvex](){return this.boxConvex}get[iK.sphereHeightfield](){return this.sphereHeightfield}get[iK.boxHeightfield](){return this.boxHeightfield}get[iK.convexHeightfield](){return this.convexHeightfield}get[iK.sphereParticle](){return this.sphereParticle}get[iK.planeParticle](){return this.planeParticle}get[iK.boxParticle](){return this.boxParticle}get[iK.convexParticle](){return this.convexParticle}get[iK.cylinderCylinder](){return this.convexConvex}get[iK.sphereCylinder](){return this.sphereConvex}get[iK.planeCylinder](){return this.planeConvex}get[iK.boxCylinder](){return this.boxConvex}get[iK.convexCylinder](){return this.convexConvex}get[iK.heightfieldCylinder](){return this.heightfieldCylinder}get[iK.particleCylinder](){return this.particleCylinder}get[iK.sphereTrimesh](){return this.sphereTrimesh}get[iK.planeTrimesh](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new iY,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,i,n,r,a){let s;this.contactPointPool.length?((s=this.contactPointPool.pop()).bi=e,s.bj=t):s=new eK(e,t),s.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&n.collisionResponse;let o=this.currentContactMaterial;s.restitution=o.restitution,s.setSpookParams(o.contactEquationStiffness,o.contactEquationRelaxation,this.world.dt);let l=i.material||e.material,c=n.material||t.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(s.restitution=l.restitution*c.restitution),s.si=r||i,s.sj=a||n,s}createFrictionEquationsFromContact(e,t){let i=e.bi,n=e.bj,r=e.si,a=e.sj,s=this.world,o=this.currentContactMaterial,l=o.friction,c=r.material||i.material,h=a.material||n.material;if(c&&h&&c.friction>=0&&h.friction>=0&&(l=c.friction*h.friction),l>0){let r=l*(s.frictionGravity||s.gravity).length(),a=i.invMass+n.invMass;a>0&&(a=1/a);let c=this.frictionEquationPool,h=c.length?c.pop():new tl(i,n,r*a),u=c.length?c.pop():new tl(i,n,r*a);return h.bi=u.bi=i,h.bj=u.bj=n,h.minForce=u.minForce=-r*a,h.maxForce=u.maxForce=r*a,h.ri.copy(e.ri),h.rj.copy(e.rj),u.ri.copy(e.ri),u.rj.copy(e.rj),e.ni.tangents(h.t,u.t),h.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,s.dt),u.setSpookParams(o.frictionEquationStiffness,o.frictionEquationRelaxation,s.dt),h.enabled=u.enabled=e.enabled,t.push(h,u),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||1===e)return;let i=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];iJ.setZero(),iZ.setZero(),i$.setZero();let r=t.bi;t.bj;for(let i=0;i!==e;i++)(t=this.result[this.result.length-1-i]).bi!==r?(iJ.vadd(t.ni,iJ),iZ.vadd(t.ri,iZ),i$.vadd(t.rj,i$)):(iJ.vsub(t.ni,iJ),iZ.vadd(t.rj,iZ),i$.vadd(t.ri,i$));let a=1/e;iZ.scale(a,i.ri),i$.scale(a,i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj),iJ.normalize(),iJ.tangents(i.t,n.t)}getContacts(e,t,i,n,r,a,s){this.contactPointPool=r,this.frictionEquationPool=s,this.result=n,this.frictionResult=a;for(let n=0,r=e.length;n!==r;n++){let r=e[n],a=t[n],s=null;r.material&&a.material&&(s=i.getContactMaterial(r.material,a.material)||null);let o=r.type&k.KINEMATIC&&a.type&k.STATIC||r.type&k.STATIC&&a.type&k.KINEMATIC||r.type&k.KINEMATIC&&a.type&k.KINEMATIC;for(let e=0;e<r.shapes.length;e++){r.quaternion.mult(r.shapeOrientations[e],i2),r.quaternion.vmult(r.shapeOffsets[e],i0),i0.vadd(r.position,i0);let t=r.shapes[e];for(let e=0;e<a.shapes.length;e++){a.quaternion.mult(a.shapeOrientations[e],i3),a.quaternion.vmult(a.shapeOffsets[e],i1),i1.vadd(a.position,i1);let n=a.shapes[e];if(!(t.collisionFilterMask&n.collisionFilterGroup&&n.collisionFilterMask&t.collisionFilterGroup)||i0.distanceTo(i1)>t.boundingSphereRadius+n.boundingSphereRadius)continue;let l=null;t.material&&n.material&&(l=i.getContactMaterial(t.material,n.material)||null),this.currentContactMaterial=l||s||i.defaultContactMaterial;let c=this[t.type|n.type];if(c){let e=!1;(t.type<n.type?c.call(this,t,n,i0,i1,i2,i3,r,a,t,n,o):c.call(this,n,t,i1,i0,i3,i2,a,r,t,n,o))&&o&&(i.shapeOverlapKeeper.set(t.id,n.id),i.bodyOverlapKeeper.set(r.id,a.id))}}}}}sphereSphere(e,t,i,n,r,a,s,o,l,c,h){if(h)return i.distanceSquared(n)<(e.radius+t.radius)**2;let u=this.createContactEquation(s,o,e,t,l,c);n.vsub(i,u.ni),u.ni.normalize(),u.ri.copy(u.ni),u.rj.copy(u.ni),u.ri.scale(e.radius,u.ri),u.rj.scale(-t.radius,u.rj),u.ri.vadd(i,u.ri),u.ri.vsub(s.position,u.ri),u.rj.vadd(n,u.rj),u.rj.vsub(o.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}spherePlane(e,t,i,n,r,a,s,o,l,c,h){let u=this.createContactEquation(s,o,e,t,l,c);if(u.ni.set(0,0,1),a.vmult(u.ni,u.ni),u.ni.negate(u.ni),u.ni.normalize(),u.ni.scale(e.radius,u.ri),i.vsub(n,nd),u.ni.scale(u.ni.dot(nd),np),nd.vsub(np,u.rj),-nd.dot(u.ni)<=e.radius){if(h)return!0;let e=u.ri,t=u.rj;e.vadd(i,e),e.vsub(s.position,e),t.vadd(n,t),t.vsub(o.position,t),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}}boxBox(e,t,i,n,r,a,s,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,n,r,a,s,o,e,t,h)}sphereBox(e,t,i,n,r,a,s,o,l,c,h){let u=this.v3pool;i.vsub(n,nv),t.getSideNormals(nA,a);let d=e.radius,p=!1,f=null,m=0,g=0,v=0,y=null;for(let e=0,t=nA.length;e!==t&&!1===p;e++){ny.copy(nA[e]);let t=ny.length();ny.normalize();let i=nv.dot(ny);if(i<t+d&&i>0){nx.copy(nA[(e+1)%3]),n_.copy(nA[(e+2)%3]);let n=nx.length(),r=n_.length();nx.normalize(),n_.normalize();let a=nv.dot(nx),s=nv.dot(n_);if(a<n&&a>-n&&s<r&&s>-r){let e=Math.abs(i-t-d);if((null===y||e<y)&&(y=e,g=a,v=s,f=t,nS.copy(ny),nw.copy(nx),nM.copy(n_),m++,h))return!0}}}if(m){p=!0;let r=this.createContactEquation(s,o,e,t,l,c);nS.scale(-d,r.ri),r.ni.copy(nS),r.ni.negate(r.ni),nS.scale(f,nS),nw.scale(g,nw),nS.vadd(nw,nS),nM.scale(v,nM),nS.vadd(nM,r.rj),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),r.rj.vadd(n,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}let x=u.get();for(let r=0;2!==r&&!p;r++)for(let a=0;2!==a&&!p;a++)for(let u=0;2!==u&&!p;u++)if(x.set(0,0,0),r?x.vadd(nA[0],x):x.vsub(nA[0],x),a?x.vadd(nA[1],x):x.vsub(nA[1],x),u?x.vadd(nA[2],x):x.vsub(nA[2],x),n.vadd(x,nb),nb.vsub(i,nb),nb.lengthSquared()<d*d){if(h)return!0;p=!0;let r=this.createContactEquation(s,o,e,t,l,c);r.ri.copy(nb),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(d,r.ri),r.rj.copy(x),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),r.rj.vadd(n,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}u.release(x),x=null;let _=u.get(),A=u.get(),b=u.get(),S=u.get(),w=u.get(),M=nA.length;for(let r=0;r!==M&&!p;r++)for(let a=0;a!==M&&!p;a++)if(r%3!=a%3){nA[a].cross(nA[r],_),_.normalize(),nA[r].vadd(nA[a],A),b.copy(i),b.vsub(A,b),b.vsub(n,b);let u=b.dot(_);_.scale(u,S);let f=0;for(;f===r%3||f===a%3;)f++;w.copy(i),w.vsub(S,w),w.vsub(A,w),w.vsub(n,w);let m=Math.abs(u),g=w.length();if(m<nA[f].length()&&g<d){if(h)return!0;p=!0;let r=this.createContactEquation(s,o,e,t,l,c);A.vadd(S,r.rj),r.rj.copy(r.rj),w.negate(r.ni),r.ni.normalize(),r.ri.copy(r.rj),r.ri.vadd(n,r.ri),r.ri.vsub(i,r.ri),r.ri.normalize(),r.ri.scale(d,r.ri),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),r.rj.vadd(n,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}u.release(_,A,b,S,w)}planeBox(e,t,i,n,r,a,s,o,l,c,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,i,n,r,a,s,o,e,t,h)}convexConvex(e,t,i,n,r,a,s,o,l,c,h,u,d){if(!(i.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,r,n,a,nz,u,d)){let u=[];e.clipAgainstHull(i,r,t,n,a,nz,-100,100,u);let d=0;for(let r=0;r!==u.length;r++){if(h)return!0;let a=this.createContactEquation(s,o,e,t,l,c),p=a.ri,f=a.rj;nz.negate(a.ni),u[r].normal.negate(nH),nH.scale(u[r].depth,nH),u[r].point.vadd(nH,p),f.copy(u[r].point),p.vsub(i,p),f.vsub(n,f),p.vadd(i,p),p.vsub(s.position,p),f.vadd(n,f),f.vsub(o.position,f),this.result.push(a),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(a,this.frictionResult)}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)}}sphereConvex(e,t,i,n,r,a,s,o,l,c,h){let u=this.v3pool;i.vsub(n,nE);let d=t.faceNormals,p=t.faces,f=t.vertices,m=e.radius,g=!1;for(let r=0;r!==f.length;r++){let u=f[r];if(a.vmult(u,nP),n.vadd(nP,nP),nP.vsub(i,nR),nR.lengthSquared()<m*m){if(h)return!0;g=!0;let r=this.createContactEquation(s,o,e,t,l,c);r.ri.copy(nR),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(m,r.ri),nP.vsub(n,r.rj),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),r.rj.vadd(n,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult);return}}for(let r=0,v=p.length;r!==v&&!1===g;r++){let v=d[r],y=p[r];a.vmult(v,nI),a.vmult(f[y[0]],nL),nL.vadd(n,nL),nI.scale(-m,nD),i.vadd(nD,nD),nD.vsub(nL,nB);let x=nB.dot(nI);if(i.vsub(nL,nO),x<0&&nO.dot(nI)>0){let r=[];for(let e=0,t=y.length;e!==t;e++){let t=u.get();a.vmult(f[y[e]],t),n.vadd(t,t),r.push(t)}if(function(e,t,i){let n=null,r=e.length;for(let a=0;a!==r;a++){let s=e[a];e[(a+1)%r].vsub(s,nf),nf.cross(t,nm),i.vsub(s,ng);let o=nm.dot(ng);if(null!==n&&(!(o>0)||!0!==n)&&(!(o<=0)||!1!==n))return!1;null===n&&(n=o>0)}return!0}(r,nI,i)){if(h)return!0;g=!0;let a=this.createContactEquation(s,o,e,t,l,c);nI.scale(-m,a.ri),nI.negate(a.ni);let d=u.get();nI.scale(-x,d);let p=u.get();nI.scale(-m,p),i.vsub(n,a.rj),a.rj.vadd(p,a.rj),a.rj.vadd(d,a.rj),a.rj.vadd(n,a.rj),a.rj.vsub(o.position,a.rj),a.ri.vadd(i,a.ri),a.ri.vsub(s.position,a.ri),u.release(d),u.release(p),this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult);for(let e=0,t=r.length;e!==t;e++)u.release(r[e]);return}for(let d=0;d!==y.length;d++){let p=u.get(),g=u.get();a.vmult(f[y[(d+1)%y.length]],p),a.vmult(f[y[(d+2)%y.length]],g),n.vadd(p,p),n.vadd(g,g),g.vsub(p,nC),nC.unit(nT);let v=u.get(),x=u.get();i.vsub(p,x);let _=x.dot(nT);nT.scale(_,v),v.vadd(p,v);let A=u.get();if(v.vsub(i,A),_>0&&_*_<nC.lengthSquared()&&A.lengthSquared()<m*m){if(h)return!0;let a=this.createContactEquation(s,o,e,t,l,c);v.vsub(n,a.rj),v.vsub(i,a.ni),a.ni.normalize(),a.ni.scale(m,a.ri),a.rj.vadd(n,a.rj),a.rj.vsub(o.position,a.rj),a.ri.vadd(i,a.ri),a.ri.vsub(s.position,a.ri),this.result.push(a),this.createFrictionEquationsFromContact(a,this.frictionResult);for(let e=0,t=r.length;e!==t;e++)u.release(r[e]);u.release(p),u.release(g),u.release(v),u.release(A),u.release(x);return}u.release(p),u.release(g),u.release(v),u.release(A),u.release(x)}for(let e=0,t=r.length;e!==t;e++)u.release(r[e])}}}planeConvex(e,t,i,n,r,a,s,o,l,c,h){nU.set(0,0,1),r.vmult(nU,nU);let u=0;for(let r=0;r!==t.vertices.length;r++)if(nN.copy(t.vertices[r]),a.vmult(nN,nN),n.vadd(nN,nN),nN.vsub(i,nF),0>=nU.dot(nF)){if(h)return!0;let r=this.createContactEquation(s,o,e,t,l,c);nU.scale(nU.dot(nF),nk),nN.vsub(nk,nk),nk.vsub(i,r.ri),r.ni.copy(nU),nN.vsub(n,r.rj),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),r.rj.vadd(n,r.rj),r.rj.vsub(o.position,r.rj),this.result.push(r),u++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}this.enableFrictionReduction&&u&&this.createFrictionFromAverage(u)}boxConvex(e,t,i,n,r,a,s,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,n,r,a,s,o,e,t,h)}sphereHeightfield(e,t,i,n,r,a,s,o,l,c,h){let u=t.data,d=e.radius,p=t.elementSize;C.pointToLocalFrame(n,a,i,n0);let f=Math.floor((n0.x-d)/p)-1,m=Math.ceil((n0.x+d)/p)+1,g=Math.floor((n0.y-d)/p)-1,v=Math.ceil((n0.y+d)/p)+1;if(m<0||v<0||f>u.length||g>u[0].length)return;f<0&&(f=0),m<0&&(m=0),g<0&&(g=0),v<0&&(v=0),f>=u.length&&(f=u.length-1),m>=u.length&&(m=u.length-1),v>=u[0].length&&(v=u[0].length-1),g>=u[0].length&&(g=u[0].length-1);let y=[];t.getRectMinMax(f,g,m,v,y);let x=y[0],_=y[1];if(n0.z-d>_||n0.z+d<x)return;let A=this.result;for(let l=f;l<m;l++)for(let c=g;c<v;c++){let u=A.length,d=!1;if(t.getConvexTrianglePillar(l,c,!1),C.pointToWorldFrame(n,a,t.pillarOffset,n1),i.distanceTo(n1)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,i,n1,r,a,s,o,e,t,h)),h&&d||(t.getConvexTrianglePillar(l,c,!0),C.pointToWorldFrame(n,a,t.pillarOffset,n1),i.distanceTo(n1)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,i,n1,r,a,s,o,e,t,h)),h&&d))return!0;if(A.length-u>2)return}}boxHeightfield(e,t,i,n,r,a,s,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,n,r,a,s,o,e,t,h)}convexHeightfield(e,t,i,n,r,a,s,o,l,c,h){let u=t.data,d=t.elementSize,p=e.boundingSphereRadius;C.pointToLocalFrame(n,a,i,nJ);let f=Math.floor((nJ.x-p)/d)-1,m=Math.ceil((nJ.x+p)/d)+1,g=Math.floor((nJ.y-p)/d)-1,v=Math.ceil((nJ.y+p)/d)+1;if(m<0||v<0||f>u.length||g>u[0].length)return;f<0&&(f=0),m<0&&(m=0),g<0&&(g=0),v<0&&(v=0),f>=u.length&&(f=u.length-1),m>=u.length&&(m=u.length-1),v>=u[0].length&&(v=u[0].length-1),g>=u[0].length&&(g=u[0].length-1);let y=[];t.getRectMinMax(f,g,m,v,y);let x=y[0],_=y[1];if(!(nJ.z-p>_)&&!(nJ.z+p<x))for(let l=f;l<m;l++)for(let c=g;c<v;c++){let u=!1;if(t.getConvexTrianglePillar(l,c,!1),C.pointToWorldFrame(n,a,t.pillarOffset,nZ),i.distanceTo(nZ)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(u=this.convexConvex(e,t.pillarConvex,i,nZ,r,a,s,o,null,null,h,n$,null)),h&&u||(t.getConvexTrianglePillar(l,c,!0),C.pointToWorldFrame(n,a,t.pillarOffset,nZ),i.distanceTo(nZ)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(u=this.convexConvex(e,t.pillarConvex,i,nZ,r,a,s,o,null,null,h,n$,null)),h&&u))return!0}}sphereParticle(e,t,i,n,r,a,s,o,l,c,h){if(nj.set(0,0,1),n.vsub(i,nj),nj.lengthSquared()<=e.radius*e.radius){if(h)return!0;let i=this.createContactEquation(o,s,t,e,l,c);nj.normalize(),i.rj.copy(nj),i.rj.scale(e.radius,i.rj),i.ni.copy(nj),i.ni.negate(i.ni),i.ri.set(0,0,0),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}planeParticle(e,t,i,n,r,a,s,o,l,c,h){if(nV.set(0,0,1),s.quaternion.vmult(nV,nV),n.vsub(s.position,nG),0>=nV.dot(nG)){if(h)return!0;let i=this.createContactEquation(o,s,t,e,l,c);i.ni.copy(nV),i.ni.negate(i.ni),i.ri.set(0,0,0),nV.scale(nV.dot(n),nW),n.vsub(nW,nW),i.rj.copy(nW),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}boxParticle(e,t,i,n,r,a,s,o,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,n,r,a,s,o,e,t,h)}convexParticle(e,t,i,n,r,a,s,o,l,c,h){let u=-1,d=null;if(nX.copy(n),nX.vsub(i,nX),r.conjugate(nq),nq.vmult(nX,nX),e.pointIsInside(nX)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,r),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(r);for(let t=0,i=e.faces.length;t!==i;t++){let i=[e.worldVertices[e.faces[t][0]]],r=e.worldFaceNormals[t];n.vsub(i[0],nK);let a=-r.dot(nK);if(null===d||Math.abs(a)<Math.abs(d)){if(h)return!0;d=a,u=t,nY.copy(r)}}if(-1!==u){let r=this.createContactEquation(o,s,t,e,l,c);nY.scale(d,nQ),nQ.vadd(n,nQ),nQ.vsub(i,nQ),r.rj.copy(nQ),nY.negate(r.ni),r.ri.set(0,0,0);let a=r.ri,h=r.rj;a.vadd(n,a),a.vsub(o.position,a),h.vadd(i,h),h.vsub(s.position,h),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,t,i,n,r,a,s,o,l,c,h){return this.convexHeightfield(t,e,n,i,a,r,o,s,l,c,h)}particleCylinder(e,t,i,n,r,a,s,o,l,c,h){return this.convexParticle(t,e,n,i,a,r,o,s,l,c,h)}sphereTrimesh(e,t,i,n,r,a,s,o,l,c,h){C.pointToLocalFrame(n,a,i,na);let u=e.radius;nh.lowerBound.set(na.x-u,na.y-u,na.z-u),nh.upperBound.set(na.x+u,na.y+u,na.z+u),t.getTrianglesInAABB(nh,nu);let d=e.radius*e.radius;for(let r=0;r<nu.length;r++)for(let u=0;u<3;u++)if(t.getVertex(t.indices[3*nu[r]+u],i7),i7.vsub(na,i9),i9.lengthSquared()<=d){if(ne.copy(i7),C.pointToWorldFrame(n,a,ne,i7),i7.vsub(i,i9),h)return!0;let r=this.createContactEquation(s,o,e,t,l,c);r.ni.copy(i9),r.ni.normalize(),r.ri.copy(r.ni),r.ri.scale(e.radius,r.ri),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),r.rj.copy(i7),r.rj.vsub(o.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}for(let r=0;r<nu.length;r++)for(let u=0;u<3;u++){t.getVertex(t.indices[3*nu[r]+u],nt),t.getVertex(t.indices[3*nu[r]+(u+1)%3],ni),ni.vsub(nt,nn),na.vsub(ni,ns);let d=ns.dot(nn);na.vsub(nt,ns);let p=ns.dot(nn);if(p>0&&d<0&&(na.vsub(nt,ns),nr.copy(nn),nr.normalize(),p=ns.dot(nr),nr.scale(p,ns),ns.vadd(nt,ns),ns.distanceTo(na)<e.radius)){if(h)return!0;let r=this.createContactEquation(s,o,e,t,l,c);ns.vsub(na,r.ni),r.ni.normalize(),r.ni.scale(e.radius,r.ri),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),C.pointToWorldFrame(n,a,ns,ns),ns.vsub(o.position,r.rj),C.vectorToWorldFrame(a,r.ni,r.ni),C.vectorToWorldFrame(a,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}for(let r=0,u=nu.length;r!==u;r++){t.getTriangleVertices(nu[r],no,nl,nc),t.getNormal(nu[r],i8),na.vsub(no,ns);let u=ns.dot(i8);if(i8.scale(u,ns),na.vsub(ns,ns),u=ns.distanceTo(na),ec.pointInTriangle(ns,no,nl,nc)&&u<e.radius){if(h)return!0;let r=this.createContactEquation(s,o,e,t,l,c);ns.vsub(na,r.ni),r.ni.normalize(),r.ni.scale(e.radius,r.ri),r.ri.vadd(i,r.ri),r.ri.vsub(s.position,r.ri),C.pointToWorldFrame(n,a,ns,ns),ns.vsub(o.position,r.rj),C.vectorToWorldFrame(a,r.ni,r.ni),C.vectorToWorldFrame(a,r.ri,r.ri),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}nu.length=0}planeTrimesh(e,t,i,n,r,a,s,o,l,c,h){let u=new p;i4.set(0,0,1),r.vmult(i4,i4);for(let r=0;r<t.vertices.length/3;r++){t.getVertex(r,u);let d=new p;if(d.copy(u),C.pointToWorldFrame(n,a,d,u),u.vsub(i,i5),0>=i4.dot(i5)){if(h)return!0;let i=this.createContactEquation(s,o,e,t,l,c);i.ni.copy(i4),i4.scale(i5.dot(i4),i6),u.vsub(i6,i6),i.ri.copy(i6),i.ri.vsub(s.position,i.ri),i.rj.copy(u),i.rj.vsub(o.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}}}let iJ=new p,iZ=new p,i$=new p,i0=new p,i1=new p,i2=new b,i3=new b,i4=new p,i5=new p,i6=new p,i8=new p,i9=new p;new p;let i7=new p,ne=new p,nt=new p,ni=new p,nn=new p,nr=new p,na=new p,ns=new p,no=new p,nl=new p,nc=new p,nh=new v,nu=[],nd=new p,np=new p,nf=new p,nm=new p,ng=new p,nv=new p,ny=new p,nx=new p,n_=new p,nA=[new p,new p,new p,new p,new p,new p],nb=new p,nS=new p,nw=new p,nM=new p,nE=new p,nC=new p,nT=new p,nR=new p,nP=new p,nI=new p,nL=new p,nD=new p,nB=new p,nO=new p;new p,new p;let nN=new p,nU=new p,nF=new p,nk=new p,nz=new p,nH=new p,nV=new p,nG=new p,nW=new p,nj=new p,nq=new b,nX=new p;new p;let nY=new p,nK=new p,nQ=new p,nJ=new p,nZ=new p,n$=[0],n0=new p,n1=new p;class n2{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){let i=t;t=e,e=i}return e<<16|t}set(e,t){let i=this.getKey(e,t),n=this.current,r=0;for(;i>n[r];)r++;if(i!==n[r]){for(let e=n.length-1;e>=r;e--)n[e+1]=n[e];n[r]=i}}tick(){let e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){let i=this.current,n=this.previous,r=i.length,a=n.length,s=0;for(let t=0;t<r;t++){let r=!1,a=i[t];for(;a>n[s];)s++;a===n[s]||n3(e,a)}s=0;for(let e=0;e<a;e++){let r=!1,a=n[e];for(;a>i[s];)s++;i[s]===a||n3(t,a)}}}function n3(e,t){e.push((0xffff0000&t)>>16,65535&t)}let n4=(e,t)=>e<t?`${e}-${t}`:`${t}-${e}`;class n5{constructor(){this.data={keys:[]}}get(e,t){let i=n4(e,t);return this.data[i]}set(e,t,i){let n=n4(e,t);this.get(e,t)||this.data.keys.push(n),this.data[n]=i}delete(e,t){let i=n4(e,t),n=this.data.keys.indexOf(i);-1!==n&&this.data.keys.splice(n,1),delete this.data[i]}reset(){let e=this.data,t=e.keys;for(;t.length>0;){let i=t.pop();delete e[i]}}}class n6 extends A{constructor(e){void 0===e&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new p,e.gravity&&this.gravity.copy(e.gravity),e.frictionGravity&&(this.frictionGravity=new p,this.frictionGravity.copy(e.frictionGravity)),this.broadphase=void 0!==e.broadphase?e.broadphase:new es,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==e.solver?e.solver:new iB,this.constraints=[],this.narrowphase=new iQ(this),this.collisionMatrix=new _,this.collisionMatrixPrevious=new _,this.bodyOverlapKeeper=new n2,this.shapeOverlapKeeper=new n2,this.contactmaterials=[],this.contactMaterialTable=new n5,this.defaultMaterial=new td("default"),this.defaultContactMaterial=new tu(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){let e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){let t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}rayTest(e,t,i){i instanceof eo?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)}raycastAll(e,t,i,n){return void 0===i&&(i={}),i.mode=ec.ALL,i.from=e,i.to=t,i.callback=n,n8.intersectWorld(this,i)}raycastAny(e,t,i,n){return void 0===i&&(i={}),i.mode=ec.ANY,i.from=e,i.to=t,i.result=n,n8.intersectWorld(this,i)}raycastClosest(e,t,i,n){return void 0===i&&(i={}),i.mode=ec.CLOSEST,i.from=e,i.to=t,i.result=n,n8.intersectWorld(this,i)}addBody(e){!this.bodies.includes(e)&&(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof k&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;let t=this.bodies.length-1,i=this.bodies,n=i.indexOf(e);if(-1!==n){i.splice(n,1);for(let e=0;e!==i.length;e++)i[e].index=e;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){let t=this.bodies;for(let i=0;i<t.length;i++){let n=t[i].shapes;for(let t=0;t<n.length;t++){let i=n[t];if(i.id===e)return i}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){let t=this.contactmaterials.indexOf(e);-1!==t&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){void 0===e&&(e=1/60),void 0===t&&(t=10);let i=n9.now()/1e3;if(this.lastCallTime){let n=i-this.lastCallTime;this.step(e,n,t)}else this.step(e,void 0,t);this.lastCallTime=i}step(e,t,i){if(void 0===i&&(i=10),void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;let n=n9.now(),r=0;for(;this.accumulator>=e&&r<i&&(this.internalStep(e),this.accumulator-=e,r++,!(n9.now()-n>1e3*e)););this.accumulator=this.accumulator%e;let a=this.accumulator/e;for(let e=0;e!==this.bodies.length;e++){let t=this.bodies[e];t.previousPosition.lerp(t.position,a,t.interpolatedPosition),t.previousQuaternion.slerp(t.quaternion,a,t.interpolatedQuaternion),t.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;let t=this.contacts,i=this.bodies.length,n=this.bodies,r=this.solver,a=this.gravity,s=this.doProfiling,o=this.profile,l=k.DYNAMIC,c=-1/0,h=this.constraints;a.length();let u=a.x,d=a.y,p=a.z,f=0;for(s&&(c=n9.now()),f=0;f!==i;f++){let e=n[f];if(e.type===l){let t=e.force,i=e.mass;t.x+=i*u,t.y+=i*d,t.z+=i*p}}for(let e=0,t=this.subsystems.length;e!==t;e++)this.subsystems[e].update();s&&(c=n9.now()),rr.length=0,ra.length=0,this.broadphase.collisionPairs(this,rr,ra),s&&(o.broadphase=n9.now()-c);let m=h.length;for(f=0;f!==m;f++){let e=h[f];if(!e.collideConnected)for(let t=rr.length-1;t>=0;t-=1)(e.bodyA===rr[t]&&e.bodyB===ra[t]||e.bodyB===rr[t]&&e.bodyA===ra[t])&&(rr.splice(t,1),ra.splice(t,1))}this.collisionMatrixTick(),s&&(c=n9.now());let g=t.length;for(f=0;f!==g;f++)ri.push(t[f]);t.length=0;let v=this.frictionEquations.length;for(f=0;f!==v;f++)rn.push(this.frictionEquations[f]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(rr,ra,this,t,ri,this.frictionEquations,rn),s&&(o.narrowphase=n9.now()-c),s&&(c=n9.now()),f=0;f<this.frictionEquations.length;f++)r.addEquation(this.frictionEquations[f]);let y=t.length;for(let e=0;e!==y;e++){let i;let n=t[e],a=n.bi,s=n.bj,o=n.si,l=n.sj;(a.material&&s.material&&this.getContactMaterial(a.material,s.material)||this.defaultContactMaterial).friction,a.material&&s.material&&(a.material.friction>=0&&s.material.friction>=0&&(a.material.friction,s.material.friction),a.material.restitution>=0&&s.material.restitution>=0&&(n.restitution=a.material.restitution*s.material.restitution)),r.addEquation(n),a.allowSleep&&a.type===k.DYNAMIC&&a.sleepState===k.SLEEPING&&s.sleepState===k.AWAKE&&s.type!==k.STATIC&&s.velocity.lengthSquared()+s.angularVelocity.lengthSquared()>=2*s.sleepSpeedLimit**2&&(a.wakeUpAfterNarrowphase=!0),s.allowSleep&&s.type===k.DYNAMIC&&s.sleepState===k.SLEEPING&&a.sleepState===k.AWAKE&&a.type!==k.STATIC&&a.velocity.lengthSquared()+a.angularVelocity.lengthSquared()>=2*a.sleepSpeedLimit**2&&(s.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(a,s,!0),this.collisionMatrixPrevious.get(a,s)||(rt.body=s,rt.contact=n,a.dispatchEvent(rt),rt.body=a,s.dispatchEvent(rt)),this.bodyOverlapKeeper.set(a.id,s.id),this.shapeOverlapKeeper.set(o.id,l.id)}for(this.emitContactEvents(),s&&(o.makeContactConstraints=n9.now()-c,c=n9.now()),f=0;f!==i;f++){let e=n[f];e.wakeUpAfterNarrowphase&&(e.wakeUp(),e.wakeUpAfterNarrowphase=!1)}for(f=0,m=h.length;f!==m;f++){let e=h[f];e.update();for(let t=0,i=e.equations.length;t!==i;t++){let i=e.equations[t];r.addEquation(i)}}r.solve(e,this),s&&(o.solve=n9.now()-c),r.removeAllEquations();let x=Math.pow;for(f=0;f!==i;f++){let t=n[f];if(t.type&l){let i=x(1-t.linearDamping,e),n=t.velocity;n.scale(i,n);let r=t.angularVelocity;if(r){let i=x(1-t.angularDamping,e);r.scale(i,r)}}}this.dispatchEvent(re),s&&(c=n9.now());let _=this.stepnumber%(this.quatNormalizeSkip+1)==0,A=this.quatNormalizeFast;for(f=0;f!==i;f++)n[f].integrate(e,_,A);this.clearForces(),this.broadphase.dirty=!0,s&&(o.integrate=n9.now()-c),this.stepnumber+=1,this.dispatchEvent(n7);let b=!0;if(this.allowSleep)for(f=0,b=!1;f!==i;f++){let e=n[f];e.sleepTick(this.time),e.sleepState!==k.SLEEPING&&(b=!0)}this.hasActiveBodies=b}emitContactEvents(){let e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(rs,ro),e){for(let e=0,t=rs.length;e<t;e+=2)rl.bodyA=this.getBodyById(rs[e]),rl.bodyB=this.getBodyById(rs[e+1]),this.dispatchEvent(rl);rl.bodyA=rl.bodyB=null}if(t){for(let e=0,t=ro.length;e<t;e+=2)rc.bodyA=this.getBodyById(ro[e]),rc.bodyB=this.getBodyById(ro[e+1]),this.dispatchEvent(rc);rc.bodyA=rc.bodyB=null}rs.length=ro.length=0;let i=this.hasAnyEventListener("beginShapeContact"),n=this.hasAnyEventListener("endShapeContact");if((i||n)&&this.shapeOverlapKeeper.getDiff(rs,ro),i){for(let e=0,t=rs.length;e<t;e+=2){let t=this.getShapeById(rs[e]),i=this.getShapeById(rs[e+1]);rh.shapeA=t,rh.shapeB=i,t&&(rh.bodyA=t.body),i&&(rh.bodyB=i.body),this.dispatchEvent(rh)}rh.bodyA=rh.bodyB=rh.shapeA=rh.shapeB=null}if(n){for(let e=0,t=ro.length;e<t;e+=2){let t=this.getShapeById(ro[e]),i=this.getShapeById(ro[e+1]);ru.shapeA=t,ru.shapeB=i,t&&(ru.bodyA=t.body),i&&(ru.bodyB=i.body),this.dispatchEvent(ru)}ru.bodyA=ru.bodyB=ru.shapeA=ru.shapeB=null}}clearForces(){let e=this.bodies,t=e.length;for(let i=0;i!==t;i++){let t=e[i];t.force,t.torque,t.force.set(0,0,0),t.torque.set(0,0,0)}}}new v;let n8=new ec,n9=globalThis.performance||{};if(!n9.now){let e=Date.now();n9.timing&&n9.timing.navigationStart&&(e=n9.timing.navigationStart),n9.now=()=>Date.now()-e}new p;let n7={type:"postStep"},re={type:"preStep"},rt={type:k.COLLIDE_EVENT_NAME,body:null,contact:null},ri=[],rn=[],rr=[],ra=[],rs=[],ro=[],rl={type:"beginContact",bodyA:null,bodyB:null},rc={type:"endContact",bodyA:null,bodyB:null},rh={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},ru={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null}},182:function(e,t,i){"use strict";i.d(t,{Z:()=>m});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a),o=i(8503),l=i(842),c=i(2750),h=i(3246),u=i(5833),d=i(7370),p=i(6177),f=s()(r());f.i(o.Z),f.i(l.Z),f.i(c.Z),f.i(h.Z),f.i(u.Z),f.i(d.Z),f.i(p.Z),f.push([e.id,"\r\n","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);let m=f},8503:function(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a)()(r());s.push([e.id,"/* Base */\r\n\r\nbody {\r\n	background-color: #ffffff;\r\n	overflow: hidden;\r\n	margin: 0;\r\n	font-family: 'Solway', serif;\r\n	color: white;\r\n	user-select: none;\r\n	text-shadow: 1px 1px 1px #000, 0px 1px 3px #000;\r\n}\r\n\r\nhtml,\r\nbody {\r\n	width: 100%;\r\n	height: 100%;\r\n}\r\n\r\nh1 {\r\n	font-weight: 400;\r\n	font-size: 50px;\r\n	font-family: 'Alfa Slab One', cursive;\r\n}\r\n\r\n#canvas {\r\n	width: 100%;\r\n	height: 100%;\r\n}\r\n\r\n#ui-container {\r\n	position: absolute;\r\n	top: 0;\r\n	height: 100vh;\r\n}\r\n","",{version:3,sources:["webpack://./src/css/modules/base.css"],names:[],mappings:"AAAA,SAAS;;AAET;CACC,yBAAyB;CACzB,gBAAgB;CAChB,SAAS;CACT,4BAA4B;CAC5B,YAAY;CACZ,iBAAiB;CACjB,+CAA+C;AAChD;;AAEA;;CAEC,WAAW;CACX,YAAY;AACb;;AAEA;CACC,gBAAgB;CAChB,eAAe;CACf,qCAAqC;AACtC;;AAEA;CACC,WAAW;CACX,YAAY;AACb;;AAEA;CACC,kBAAkB;CAClB,MAAM;CACN,aAAa;AACd",sourcesContent:["/* Base */\r\n\r\nbody {\r\n	background-color: #ffffff;\r\n	overflow: hidden;\r\n	margin: 0;\r\n	font-family: 'Solway', serif;\r\n	color: white;\r\n	user-select: none;\r\n	text-shadow: 1px 1px 1px #000, 0px 1px 3px #000;\r\n}\r\n\r\nhtml,\r\nbody {\r\n	width: 100%;\r\n	height: 100%;\r\n}\r\n\r\nh1 {\r\n	font-weight: 400;\r\n	font-size: 50px;\r\n	font-family: 'Alfa Slab One', cursive;\r\n}\r\n\r\n#canvas {\r\n	width: 100%;\r\n	height: 100%;\r\n}\r\n\r\n#ui-container {\r\n	position: absolute;\r\n	top: 0;\r\n	height: 100vh;\r\n}\r\n"],sourceRoot:""}]);let o=s},7370:function(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a)()(r());s.push([e.id,".cubeWrap {\r\n	-webkit-perspective: 800px;\r\n			perspective: 800px;\r\n	width: 300px;\r\n	overflow: hidden;\r\n	/* position: absolute; */\r\n	-webkit-animation: bouncy 2s ease forwards;\r\n			animation: bouncy 2s ease forwards;\r\n  }\r\n  \r\n  .cube {\r\n	margin: 3em auto;\r\n	width: 6em;\r\n	height: 6em;\r\n	-webkit-transform-style: preserve-3d;\r\n			transform-style: preserve-3d;\r\n	-webkit-transform-origin: 50% 50% -3em;\r\n			transform-origin: 50% 50% -3em;\r\n	position: relative;\r\n	-webkit-animation: spin 4s linear infinite;\r\n			animation: spin 4s linear infinite;\r\n	-webkit-transform: rotateX(-50deg) rotateY(405deg);\r\n			transform: rotateX(-50deg) rotateY(405deg);\r\n  }\r\n  .cube div {\r\n	position: absolute;\r\n	width: 6em;\r\n	height: 6em;\r\n	-webkit-transform-style: preserve-3d;\r\n			transform-style: preserve-3d;\r\n  }\r\n  \r\n  .faces1::before,\r\n  .faces1::after,\r\n  .faces2::before,\r\n  .faces2::after {\r\n	position: absolute;\r\n	content: '';\r\n	display: block;\r\n	width: 100%;\r\n	height: 100%;\r\n	-webkit-transform-style: preserve-3d;\r\n			transform-style: preserve-3d;\r\n  }\r\n  \r\n  .faces1::before,\r\n  .faces2::before {\r\n	-webkit-transform: rotateY(90deg);\r\n			transform: rotateY(90deg);\r\n	-webkit-transform-origin: 0 50%;\r\n			transform-origin: 0 50%;\r\n	background-color: purple;\r\n  }\r\n  \r\n  .faces2 {\r\n	-webkit-transform: rotateX(180deg) translateZ(6em);\r\n			transform: rotateX(180deg) translateZ(6em);\r\n  }\r\n  \r\n  .faces2::before {\r\n	background-color: orange;\r\n	-webkit-transform: rotateY(-90deg);\r\n			transform: rotateY(-90deg);\r\n	-webkit-transform-origin: 100% 50%;\r\n			transform-origin: 100% 50%;\r\n  }\r\n  \r\n  .faces1::after,\r\n  .faces2::after {\r\n	-webkit-transform: rotateX(-90deg);\r\n			transform: rotateX(-90deg);\r\n	-webkit-transform-origin: 50% 0;\r\n			transform-origin: 50% 0;\r\n	background-color: red;\r\n  }\r\n  \r\n  .faces1 {\r\n	background-color: #eee;\r\n  }\r\n  \r\n  .faces2 {\r\n	background-color: #f3f3f3;\r\n  }\r\n  \r\n  .faces1::before {\r\n	background-color: #f8f8f8;\r\n  }\r\n  \r\n  .faces2::before {\r\n	background-color: white;\r\n  }\r\n  \r\n  .faces1::after {\r\n	background-color: #e9e9e9;\r\n  }\r\n  \r\n  .faces2::after {\r\n	background-color: #e4e4e4;\r\n  }\r\n  \r\n  @-webkit-keyframes spin {\r\n	0% {\r\n	  -webkit-transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n			  transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n	}\r\n	100% {\r\n	  -webkit-transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n			  transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n	}\r\n  }\r\n  \r\n  @keyframes spin {\r\n	0% {\r\n	  -webkit-transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n			  transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n	}\r\n	100% {\r\n	  -webkit-transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n			  transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n	}\r\n  }\r\n  @-webkit-keyframes bouncy {\r\n	/* up */\r\n	0% {\r\n	  -webkit-transform: translateY(-600px) scale(0.8, 1.2);\r\n			  transform: translateY(-600px) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	30% {\r\n	  -webkit-transform: translateY(0) scale(0.8, 1.2);\r\n			  transform: translateY(0) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	32% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.8);\r\n			  transform: translateY(0) scale(1, 0.8);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	45% {\r\n	  -webkit-transform: translateY(-100px) scale(0.9, 1.1);\r\n			  transform: translateY(-100px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	60% {\r\n	  -webkit-transform: translateY(0) scale(0.9, 1.1);\r\n			  transform: translateY(0) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	62% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.9);\r\n			  transform: translateY(0) scale(1, 0.9);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	70% {\r\n	  -webkit-transform: translateY(-30px) scale(0.9, 1.1);\r\n			  transform: translateY(-30px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	80% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	82% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.95);\r\n			  transform: translateY(0) scale(1, 0.95);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	85% {\r\n	  -webkit-transform: translateY(-10px) scale(0.98, 1.02);\r\n			  transform: translateY(-10px) scale(0.98, 1.02);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	90% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n  }\r\n  @keyframes bouncy {\r\n	/* up */\r\n	0% {\r\n	  -webkit-transform: translateY(-600px) scale(0.8, 1.2);\r\n			  transform: translateY(-600px) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	30% {\r\n	  -webkit-transform: translateY(0) scale(0.8, 1.2);\r\n			  transform: translateY(0) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	32% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.8);\r\n			  transform: translateY(0) scale(1, 0.8);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	45% {\r\n	  -webkit-transform: translateY(-100px) scale(0.9, 1.1);\r\n			  transform: translateY(-100px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	60% {\r\n	  -webkit-transform: translateY(0) scale(0.9, 1.1);\r\n			  transform: translateY(0) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	62% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.9);\r\n			  transform: translateY(0) scale(1, 0.9);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	70% {\r\n	  -webkit-transform: translateY(-30px) scale(0.9, 1.1);\r\n			  transform: translateY(-30px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	80% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	82% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.95);\r\n			  transform: translateY(0) scale(1, 0.95);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	85% {\r\n	  -webkit-transform: translateY(-10px) scale(0.98, 1.02);\r\n			  transform: translateY(-10px) scale(0.98, 1.02);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	90% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n  }\r\n  ","",{version:3,sources:["webpack://./src/css/modules/cubeLoader.css"],names:[],mappings:"AAAA;CACC,0BAA0B;GACxB,kBAAkB;CACpB,YAAY;CACZ,gBAAgB;CAChB,wBAAwB;CACxB,0CAA0C;GACxC,kCAAkC;EACnC;;EAEA;CACD,gBAAgB;CAChB,UAAU;CACV,WAAW;CACX,oCAAoC;GAClC,4BAA4B;CAC9B,sCAAsC;GACpC,8BAA8B;CAChC,kBAAkB;CAClB,0CAA0C;GACxC,kCAAkC;CACpC,kDAAkD;GAChD,0CAA0C;EAC3C;EACA;CACD,kBAAkB;CAClB,UAAU;CACV,WAAW;CACX,oCAAoC;GAClC,4BAA4B;EAC7B;;EAEA;;;;CAID,kBAAkB;CAClB,WAAW;CACX,cAAc;CACd,WAAW;CACX,YAAY;CACZ,oCAAoC;GAClC,4BAA4B;EAC7B;;EAEA;;CAED,iCAAiC;GAC/B,yBAAyB;CAC3B,+BAA+B;GAC7B,uBAAuB;CACzB,wBAAwB;EACvB;;EAEA;CACD,kDAAkD;GAChD,0CAA0C;EAC3C;;EAEA;CACD,wBAAwB;CACxB,kCAAkC;GAChC,0BAA0B;CAC5B,kCAAkC;GAChC,0BAA0B;EAC3B;;EAEA;;CAED,kCAAkC;GAChC,0BAA0B;CAC5B,+BAA+B;GAC7B,uBAAuB;CACzB,qBAAqB;EACpB;;EAEA;CACD,sBAAsB;EACrB;;EAEA;CACD,yBAAyB;EACxB;;EAEA;CACD,yBAAyB;EACxB;;EAEA;CACD,uBAAuB;EACtB;;EAEA;CACD,yBAAyB;EACxB;;EAEA;CACD,yBAAyB;EACxB;;EAEA;CACD;GACE,4DAA4D;KAC1D,oDAAoD;CACxD;CACA;GACE,gEAAgE;KAC9D,wDAAwD;CAC5D;EACC;;EAEA;CACD;GACE,4DAA4D;KAC1D,oDAAoD;CACxD;CACA;GACE,gEAAgE;KAC9D,wDAAwD;CAC5D;EACC;EACA;CACD,OAAO;CACP;GACE,qDAAqD;KACnD,6CAA6C;GAC/C,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,gDAAgD;KAC9C,wCAAwC;GAC1C,2CAA2C;KACzC,mCAAmC;CACvC;CACA,UAAU;CACV;GACE,8CAA8C;KAC5C,sCAAsC;GACxC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,OAAO;CACP;GACE,qDAAqD;KACnD,6CAA6C;GAC/C,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,gDAAgD;KAC9C,wCAAwC;GAC1C,2CAA2C;KACzC,mCAAmC;CACvC;CACA,UAAU;CACV;GACE,8CAA8C;KAC5C,sCAAsC;GACxC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,OAAO;CACP;GACE,oDAAoD;KAClD,4CAA4C;GAC9C,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,4CAA4C;KAC1C,oCAAoC;GACtC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,UAAU;CACV;GACE,+CAA+C;KAC7C,uCAAuC;GACzC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,OAAO;CACP;GACE,sDAAsD;KACpD,8CAA8C;GAChD,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,4CAA4C;KAC1C,oCAAoC;GACtC,2CAA2C;KACzC,mCAAmC;CACvC;EACC;EACA;CACD,OAAO;CACP;GACE,qDAAqD;KACnD,6CAA6C;GAC/C,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,gDAAgD;KAC9C,wCAAwC;GAC1C,2CAA2C;KACzC,mCAAmC;CACvC;CACA,UAAU;CACV;GACE,8CAA8C;KAC5C,sCAAsC;GACxC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,OAAO;CACP;GACE,qDAAqD;KACnD,6CAA6C;GAC/C,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,gDAAgD;KAC9C,wCAAwC;GAC1C,2CAA2C;KACzC,mCAAmC;CACvC;CACA,UAAU;CACV;GACE,8CAA8C;KAC5C,sCAAsC;GACxC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,OAAO;CACP;GACE,oDAAoD;KAClD,4CAA4C;GAC9C,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,4CAA4C;KAC1C,oCAAoC;GACtC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,UAAU;CACV;GACE,+CAA+C;KAC7C,uCAAuC;GACzC,2CAA2C;KACzC,mCAAmC;CACvC;CACA,OAAO;CACP;GACE,sDAAsD;KACpD,8CAA8C;GAChD,0CAA0C;KACxC,kCAAkC;CACtC;CACA,UAAU;CACV;GACE,4CAA4C;KAC1C,oCAAoC;GACtC,2CAA2C;KACzC,mCAAmC;CACvC;EACC",sourcesContent:[".cubeWrap {\r\n	-webkit-perspective: 800px;\r\n			perspective: 800px;\r\n	width: 300px;\r\n	overflow: hidden;\r\n	/* position: absolute; */\r\n	-webkit-animation: bouncy 2s ease forwards;\r\n			animation: bouncy 2s ease forwards;\r\n  }\r\n  \r\n  .cube {\r\n	margin: 3em auto;\r\n	width: 6em;\r\n	height: 6em;\r\n	-webkit-transform-style: preserve-3d;\r\n			transform-style: preserve-3d;\r\n	-webkit-transform-origin: 50% 50% -3em;\r\n			transform-origin: 50% 50% -3em;\r\n	position: relative;\r\n	-webkit-animation: spin 4s linear infinite;\r\n			animation: spin 4s linear infinite;\r\n	-webkit-transform: rotateX(-50deg) rotateY(405deg);\r\n			transform: rotateX(-50deg) rotateY(405deg);\r\n  }\r\n  .cube div {\r\n	position: absolute;\r\n	width: 6em;\r\n	height: 6em;\r\n	-webkit-transform-style: preserve-3d;\r\n			transform-style: preserve-3d;\r\n  }\r\n  \r\n  .faces1::before,\r\n  .faces1::after,\r\n  .faces2::before,\r\n  .faces2::after {\r\n	position: absolute;\r\n	content: '';\r\n	display: block;\r\n	width: 100%;\r\n	height: 100%;\r\n	-webkit-transform-style: preserve-3d;\r\n			transform-style: preserve-3d;\r\n  }\r\n  \r\n  .faces1::before,\r\n  .faces2::before {\r\n	-webkit-transform: rotateY(90deg);\r\n			transform: rotateY(90deg);\r\n	-webkit-transform-origin: 0 50%;\r\n			transform-origin: 0 50%;\r\n	background-color: purple;\r\n  }\r\n  \r\n  .faces2 {\r\n	-webkit-transform: rotateX(180deg) translateZ(6em);\r\n			transform: rotateX(180deg) translateZ(6em);\r\n  }\r\n  \r\n  .faces2::before {\r\n	background-color: orange;\r\n	-webkit-transform: rotateY(-90deg);\r\n			transform: rotateY(-90deg);\r\n	-webkit-transform-origin: 100% 50%;\r\n			transform-origin: 100% 50%;\r\n  }\r\n  \r\n  .faces1::after,\r\n  .faces2::after {\r\n	-webkit-transform: rotateX(-90deg);\r\n			transform: rotateX(-90deg);\r\n	-webkit-transform-origin: 50% 0;\r\n			transform-origin: 50% 0;\r\n	background-color: red;\r\n  }\r\n  \r\n  .faces1 {\r\n	background-color: #eee;\r\n  }\r\n  \r\n  .faces2 {\r\n	background-color: #f3f3f3;\r\n  }\r\n  \r\n  .faces1::before {\r\n	background-color: #f8f8f8;\r\n  }\r\n  \r\n  .faces2::before {\r\n	background-color: white;\r\n  }\r\n  \r\n  .faces1::after {\r\n	background-color: #e9e9e9;\r\n  }\r\n  \r\n  .faces2::after {\r\n	background-color: #e4e4e4;\r\n  }\r\n  \r\n  @-webkit-keyframes spin {\r\n	0% {\r\n	  -webkit-transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n			  transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n	}\r\n	100% {\r\n	  -webkit-transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n			  transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n	}\r\n  }\r\n  \r\n  @keyframes spin {\r\n	0% {\r\n	  -webkit-transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n			  transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg);\r\n	}\r\n	100% {\r\n	  -webkit-transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n			  transform: rotateX(720deg) rotateY(360deg) rotateZ(0deg);\r\n	}\r\n  }\r\n  @-webkit-keyframes bouncy {\r\n	/* up */\r\n	0% {\r\n	  -webkit-transform: translateY(-600px) scale(0.8, 1.2);\r\n			  transform: translateY(-600px) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	30% {\r\n	  -webkit-transform: translateY(0) scale(0.8, 1.2);\r\n			  transform: translateY(0) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	32% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.8);\r\n			  transform: translateY(0) scale(1, 0.8);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	45% {\r\n	  -webkit-transform: translateY(-100px) scale(0.9, 1.1);\r\n			  transform: translateY(-100px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	60% {\r\n	  -webkit-transform: translateY(0) scale(0.9, 1.1);\r\n			  transform: translateY(0) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	62% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.9);\r\n			  transform: translateY(0) scale(1, 0.9);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	70% {\r\n	  -webkit-transform: translateY(-30px) scale(0.9, 1.1);\r\n			  transform: translateY(-30px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	80% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	82% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.95);\r\n			  transform: translateY(0) scale(1, 0.95);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	85% {\r\n	  -webkit-transform: translateY(-10px) scale(0.98, 1.02);\r\n			  transform: translateY(-10px) scale(0.98, 1.02);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	90% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n  }\r\n  @keyframes bouncy {\r\n	/* up */\r\n	0% {\r\n	  -webkit-transform: translateY(-600px) scale(0.8, 1.2);\r\n			  transform: translateY(-600px) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	30% {\r\n	  -webkit-transform: translateY(0) scale(0.8, 1.2);\r\n			  transform: translateY(0) scale(0.8, 1.2);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	32% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.8);\r\n			  transform: translateY(0) scale(1, 0.8);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	45% {\r\n	  -webkit-transform: translateY(-100px) scale(0.9, 1.1);\r\n			  transform: translateY(-100px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	60% {\r\n	  -webkit-transform: translateY(0) scale(0.9, 1.1);\r\n			  transform: translateY(0) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	62% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.9);\r\n			  transform: translateY(0) scale(1, 0.9);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	70% {\r\n	  -webkit-transform: translateY(-30px) scale(0.9, 1.1);\r\n			  transform: translateY(-30px) scale(0.9, 1.1);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	80% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* floor */\r\n	82% {\r\n	  -webkit-transform: translateY(0) scale(1, 0.95);\r\n			  transform: translateY(0) scale(1, 0.95);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n	/* up */\r\n	85% {\r\n	  -webkit-transform: translateY(-10px) scale(0.98, 1.02);\r\n			  transform: translateY(-10px) scale(0.98, 1.02);\r\n	  -webkit-animation-timing-function: ease-in;\r\n			  animation-timing-function: ease-in;\r\n	}\r\n	/* floor */\r\n	90% {\r\n	  -webkit-transform: translateY(0) scale(1, 1);\r\n			  transform: translateY(0) scale(1, 1);\r\n	  -webkit-animation-timing-function: ease-out;\r\n			  animation-timing-function: ease-out;\r\n	}\r\n  }\r\n  "],sourceRoot:""}]);let o=s},3246:function(e,t,i){"use strict";i.d(t,{Z:()=>g});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a),o=i(1667),l=i.n(o),c=new URL(i(2294),i.b),h=new URL(i(1561),i.b),u=new URL(i(8895),i.b),d=s()(r()),p=l()(c),f=l()(h),m=l()(u);d.push([e.id,"/* Dat GUI */\r\n\r\n.dg ul {\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 0;\r\n    width: 100%;\r\n    clear: both\r\n}\r\n\r\n.dg.ac {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    height: 0;\r\n    z-index: 0\r\n}\r\n\r\n.dg:not(.ac) .main {\r\n    overflow: hidden\r\n}\r\n\r\n.dg.main {\r\n    -webkit-transition: opacity .1s linear;\r\n    -o-transition: opacity .1s linear;\r\n    -moz-transition: opacity .1s linear;\r\n    transition: opacity .1s linear\r\n}\r\n\r\n.dg.main.taller-than-window {\r\n    overflow-y: auto\r\n}\r\n\r\n.dg.main.taller-than-window .close-button {\r\n    opacity: 1;\r\n    margin-top: -1px;\r\n    border-top: 1px solid #2c2c2c\r\n}\r\n\r\n.dg.main ul.closed .close-button {\r\n    opacity: 1 !important\r\n}\r\n\r\n.dg.main:hover .close-button,\r\n.dg.main .close-button.drag {\r\n    opacity: 1\r\n}\r\n\r\n.dg.main .close-button {\r\n    -webkit-transition: opacity .1s linear;\r\n    -o-transition: opacity .1s linear;\r\n    -moz-transition: opacity .1s linear;\r\n    transition: opacity .1s linear;\r\n    border: 0;\r\n    line-height: 19px;\r\n    height: 20px;\r\n    cursor: pointer;\r\n    text-align: center;\r\n    background-color: #000\r\n}\r\n\r\n.dg.main .close-button.close-top {\r\n    position: relative\r\n}\r\n\r\n.dg.main .close-button.close-bottom {\r\n    position: absolute\r\n}\r\n\r\n.dg.main .close-button:hover {\r\n    background-color: #111\r\n}\r\n\r\n.dg.a {\r\n    float: right;\r\n    margin-top: 15px;\r\n    margin-right: 15px;\r\n    border-radius: 5px;\r\n    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 30%);\r\n    overflow-x: hidden;\r\n    overflow-y: visible\r\n}\r\n\r\n.dg.a.has-save>ul.close-top {\r\n    margin-top: 0\r\n}\r\n\r\n.dg.a.has-save>ul.close-bottom {\r\n    margin-top: 27px\r\n}\r\n\r\n.dg.a.has-save>ul.closed {\r\n    margin-top: 0\r\n}\r\n\r\n.dg.a .save-row {\r\n    top: 0;\r\n    z-index: 1002\r\n}\r\n\r\n.dg.a .save-row.close-top {\r\n    position: relative\r\n}\r\n\r\n.dg.a .save-row.close-bottom {\r\n    position: fixed\r\n}\r\n\r\n.dg li {\r\n    -webkit-transition: height .1s ease-out;\r\n    -o-transition: height .1s ease-out;\r\n    -moz-transition: height .1s ease-out;\r\n    transition: height .1s ease-out;\r\n    -webkit-transition: overflow .1s linear;\r\n    -o-transition: overflow .1s linear;\r\n    -moz-transition: overflow .1s linear;\r\n    transition: overflow .1s linear\r\n}\r\n\r\n.dg li:not(.folder) {\r\n    cursor: auto;\r\n    height: 33px;\r\n    line-height: 33px;\r\n    padding: 0 10px 0 10px\r\n}\r\n\r\n.dg li.folder {\r\n    padding: 0;\r\n    border-left: 4px solid transparent\r\n}\r\n\r\n.dg li.title {\r\n    /* font-family: 'Allerta Stencil', sans-serif; */\r\n    /* font-family: 'Patua One', cursive; */\r\n    /* font-family: 'Fredoka One', cursive; */\r\n    font-weight: 500;\r\n    cursor: pointer;\r\n    margin-left: -4px\r\n}\r\n\r\n.dg .closed li:not(.title),\r\n.dg .closed ul li,\r\n.dg .closed ul li>* {\r\n    height: 0;\r\n    overflow: hidden;\r\n    border: 0\r\n}\r\n\r\n.dg .cr {\r\n    clear: both;\r\n    padding-left: 3px;\r\n    height: 27px;\r\n    overflow: hidden\r\n}\r\n\r\n.dg .property-name {\r\n    font-size: 82%;\r\n    cursor: default;\r\n    float: left;\r\n    clear: left;\r\n    width: 40%;\r\n    overflow: hidden;\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis\r\n}\r\n\r\n.dg .cr.function .property-name {\r\n    width: 100%;\r\n}\r\n\r\n.dg .c {\r\n    float: left;\r\n    width: 60%;\r\n    position: relative\r\n}\r\n\r\n.dg .c input[type=text] {\r\n    border: 0;\r\n    margin-top: 4px;\r\n    padding: 3px;\r\n    width: 100%;\r\n    float: right\r\n}\r\n\r\n.dg .has-slider input[type=text] {\r\n    width: 30%;\r\n    margin-left: 0\r\n}\r\n\r\n.dg .slider {\r\n    float: left;\r\n    width: 66%;\r\n    margin-left: -5px;\r\n    margin-right: 0;\r\n    height: 19px;\r\n    margin-top: 4px\r\n}\r\n\r\n.dg .slider-fg {\r\n    height: 100%\r\n}\r\n\r\n.dg .c input[type=checkbox] {\r\n    margin-top: 7px\r\n}\r\n\r\n.dg .c select {\r\n    margin-top: 5px\r\n}\r\n\r\n.dg .cr.function,\r\n.dg .cr.function .property-name,\r\n.dg .cr.function *,\r\n.dg .cr.boolean,\r\n.dg .cr.boolean * {\r\n    cursor: pointer\r\n}\r\n\r\n.dg .cr.color {\r\n    overflow: visible\r\n}\r\n\r\n.dg .selector {\r\n    display: none;\r\n    position: absolute;\r\n    margin-left: -9px;\r\n    margin-top: 23px;\r\n    z-index: 10\r\n}\r\n\r\n.dg .c:hover .selector,\r\n.dg .selector.drag {\r\n    display: block\r\n}\r\n\r\n.dg li.save-row {\r\n    padding: 0\r\n}\r\n\r\n.dg li.save-row .button {\r\n    display: inline-block;\r\n    padding: 0px 6px\r\n}\r\n\r\n.dg.dialogue {\r\n    background-color: #222;\r\n    width: 460px;\r\n    padding: 15px;\r\n    font-size: 13px;\r\n    line-height: 15px\r\n}\r\n\r\n#dg-new-constructor {\r\n    padding: 10px;\r\n    color: #222;\r\n    font-family: Monaco, monospace;\r\n    font-size: 10px;\r\n    border: 0;\r\n    resize: none;\r\n    box-shadow: inset 1px 1px 1px #888;\r\n    word-wrap: break-word;\r\n    margin: 12px 0;\r\n    display: block;\r\n    width: 440px;\r\n    overflow-y: scroll;\r\n    height: 100px;\r\n    position: relative\r\n}\r\n\r\n#dg-local-explain {\r\n    display: none;\r\n    font-size: 11px;\r\n    line-height: 17px;\r\n    border-radius: 3px;\r\n    background-color: #333;\r\n    padding: 8px;\r\n    margin-top: 10px\r\n}\r\n\r\n#dg-local-explain code {\r\n    font-size: 10px\r\n}\r\n\r\n#dat-gui-save-locally {\r\n    display: none\r\n}\r\n\r\n.dg {\r\n    color: #eee;\r\n    /* font-family: 'Cutive Mono', sans-serif; */\r\n    /* text-shadow: 0 -1px 0 #111 */\r\n    text-shadow: none;\r\n}\r\n\r\n.dg.main::-webkit-scrollbar {\r\n    width: 5px;\r\n    background: #1a1a1a\r\n}\r\n\r\n.dg.main::-webkit-scrollbar-corner {\r\n    height: 0;\r\n    display: none\r\n}\r\n\r\n.dg.main::-webkit-scrollbar-thumb {\r\n    border-radius: 5px;\r\n    background: #676767\r\n}\r\n\r\n.dg li:not(.folder) {\r\n    background: rgb(26 26 26 / 92%);\r\n    border-bottom: 1px solid #2c2c2c;\r\n    -webkit-backdrop-filter: blur(10px);\r\n    backdrop-filter: blur(10px);\r\n    margin-left: -4px;\r\n}\r\n\r\n.dg li.save-row {\r\n    line-height: 25px;\r\n    background: #dad5cb;\r\n    border: 0\r\n}\r\n\r\n.dg li.save-row select {\r\n    margin-left: 5px;\r\n    width: 108px\r\n}\r\n\r\n.dg li.save-row .button {\r\n    margin-left: 5px;\r\n    margin-top: 1px;\r\n    border-radius: 2px;\r\n    font-size: 9px;\r\n    line-height: 7px;\r\n    padding: 4px 4px 5px 4px;\r\n    background: #c5bdad;\r\n    color: #fff;\r\n    text-shadow: 0 1px 0 #b0a58f;\r\n    box-shadow: 0 -1px 0 #b0a58f;\r\n    cursor: pointer\r\n}\r\n\r\n.dg li.save-row .button.gears {\r\n    background: #c5bdad url("+p+") 2px 1px no-repeat;\r\n    height: 7px;\r\n    width: 8px\r\n}\r\n\r\n.dg li.save-row .button:hover {\r\n    background-color: #bab19e;\r\n    box-shadow: 0 -1px 0 #b0a58f\r\n}\r\n\r\n.dg li.folder {\r\n    border-bottom: 0\r\n}\r\n\r\n.dg li.title {\r\n    font-size: 90%;\r\n    height: 33px;\r\n    line-height: 33px;\r\n    padding-left: 20px;\r\n    background: #000 url("+f+") 8px 14px no-repeat;\r\n    cursor: pointer;\r\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2);\r\n    background-color: rgb(0 0 0 / 92%);\r\n}\r\n\r\n.dg .closed li.title {\r\n    background-image: url("+m+")\r\n}\r\n\r\n.dg .cr.boolean {\r\n    border-left: 3px solid #806787\r\n}\r\n\r\n.dg .cr.color {\r\n    border-left: 3px solid\r\n}\r\n\r\n.dg .cr.function {\r\n    border-left: 3px solid #e61d5f\r\n}\r\n\r\n.dg .cr.number {\r\n    border-left: 3px solid #2FA1D6\r\n}\r\n\r\n.dg .cr.number input[type=text] {\r\n    color: #2FA1D6\r\n}\r\n\r\n.dg .cr.string {\r\n    border-left: 3px solid #1ed36f\r\n}\r\n\r\n.dg .cr.string input[type=text] {\r\n    color: #1ed36f\r\n}\r\n\r\n.dg .cr.function:hover,\r\n.dg .cr.boolean:hover {\r\n    background: #111\r\n}\r\n\r\n.dg .c input[type=text] {\r\n    background: #303030;\r\n    outline: none\r\n}\r\n\r\n.dg .c input[type=text]:hover {\r\n    background: #3c3c3c\r\n}\r\n\r\n.dg .c input[type=text]:focus {\r\n    background: #494949;\r\n    color: #fff\r\n}\r\n\r\n.dg .c .slider {\r\n    background: #303030;\r\n    cursor: ew-resize\r\n}\r\n\r\n.dg .c .slider-fg {\r\n    background: #2FA1D6;\r\n    max-width: 100%\r\n}\r\n\r\n.dg .c .slider:hover {\r\n    background: #3c3c3c\r\n}\r\n\r\n.dg .c .slider:hover .slider-fg {\r\n    background: #44abda\r\n}\r\n\r\n\r\n/* Stats box */\r\n\r\n#statsBox {\r\n    position: fixed;\r\n    top: 15px;\r\n    height: 48px;\r\n    right: 15px;\r\n    opacity: 0.9;\r\n    z-index: 10000;\r\n}\r\n\r\n#statsBox,\r\n.dg.ac .dg.main.a .dg .title {\r\n    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.dg.ac {\r\n    /* top: 48px; */\r\n    user-select: none;\r\n}\r\n\r\n.dg.ac .close-button.close-bottom {\r\n    display: none;\r\n}\r\n","",{version:3,sources:["webpack://./src/css/modules/dat.gui.css"],names:[],mappings:"AAAA,YAAY;;AAEZ;IACI,gBAAgB;IAChB,SAAS;IACT,UAAU;IACV,WAAW;IACX;AACJ;;AAEA;IACI,eAAe;IACf,MAAM;IACN,OAAO;IACP,QAAQ;IACR,SAAS;IACT;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,sCAAsC;IACtC,iCAAiC;IACjC,mCAAmC;IACnC;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,UAAU;IACV,gBAAgB;IAChB;AACJ;;AAEA;IACI;AACJ;;AAEA;;IAEI;AACJ;;AAEA;IACI,sCAAsC;IACtC,iCAAiC;IACjC,mCAAmC;IACnC,8BAA8B;IAC9B,SAAS;IACT,iBAAiB;IACjB,YAAY;IACZ,eAAe;IACf,kBAAkB;IAClB;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,YAAY;IACZ,gBAAgB;IAChB,kBAAkB;IAClB,kBAAkB;IAClB,wCAAwC;IACxC,kBAAkB;IAClB;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,MAAM;IACN;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,uCAAuC;IACvC,kCAAkC;IAClC,oCAAoC;IACpC,+BAA+B;IAC/B,uCAAuC;IACvC,kCAAkC;IAClC,oCAAoC;IACpC;AACJ;;AAEA;IACI,YAAY;IACZ,YAAY;IACZ,iBAAiB;IACjB;AACJ;;AAEA;IACI,UAAU;IACV;AACJ;;AAEA;IACI,gDAAgD;IAChD,uCAAuC;IACvC,yCAAyC;IACzC,gBAAgB;IAChB,eAAe;IACf;AACJ;;AAEA;;;IAGI,SAAS;IACT,gBAAgB;IAChB;AACJ;;AAEA;IACI,WAAW;IACX,iBAAiB;IACjB,YAAY;IACZ;AACJ;;AAEA;IACI,cAAc;IACd,eAAe;IACf,WAAW;IACX,WAAW;IACX,UAAU;IACV,gBAAgB;IAChB,mBAAmB;IACnB;AACJ;;AAEA;IACI,WAAW;AACf;;AAEA;IACI,WAAW;IACX,UAAU;IACV;AACJ;;AAEA;IACI,SAAS;IACT,eAAe;IACf,YAAY;IACZ,WAAW;IACX;AACJ;;AAEA;IACI,UAAU;IACV;AACJ;;AAEA;IACI,WAAW;IACX,UAAU;IACV,iBAAiB;IACjB,eAAe;IACf,YAAY;IACZ;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;;;;;IAKI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,aAAa;IACb,kBAAkB;IAClB,iBAAiB;IACjB,gBAAgB;IAChB;AACJ;;AAEA;;IAEI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,qBAAqB;IACrB;AACJ;;AAEA;IACI,sBAAsB;IACtB,YAAY;IACZ,aAAa;IACb,eAAe;IACf;AACJ;;AAEA;IACI,aAAa;IACb,WAAW;IACX,8BAA8B;IAC9B,eAAe;IACf,SAAS;IACT,YAAY;IACZ,kCAAkC;IAClC,qBAAqB;IACrB,cAAc;IACd,cAAc;IACd,YAAY;IACZ,kBAAkB;IAClB,aAAa;IACb;AACJ;;AAEA;IACI,aAAa;IACb,eAAe;IACf,iBAAiB;IACjB,kBAAkB;IAClB,sBAAsB;IACtB,YAAY;IACZ;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,WAAW;IACX,4CAA4C;IAC5C,+BAA+B;IAC/B,iBAAiB;AACrB;;AAEA;IACI,UAAU;IACV;AACJ;;AAEA;IACI,SAAS;IACT;AACJ;;AAEA;IACI,kBAAkB;IAClB;AACJ;;AAEA;IACI,+BAA+B;IAC/B,gCAAgC;IAChC,mCAAmC;IACnC,2BAA2B;IAC3B,iBAAiB;AACrB;;AAEA;IACI,iBAAiB;IACjB,mBAAmB;IACnB;AACJ;;AAEA;IACI,gBAAgB;IAChB;AACJ;;AAEA;IACI,gBAAgB;IAChB,eAAe;IACf,kBAAkB;IAClB,cAAc;IACd,gBAAgB;IAChB,wBAAwB;IACxB,mBAAmB;IACnB,WAAW;IACX,4BAA4B;IAC5B,4BAA4B;IAC5B;AACJ;;AAEA;IACI,6EAAyhB;IACzhB,WAAW;IACX;AACJ;;AAEA;IACI,yBAAyB;IACzB;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,cAAc;IACd,YAAY;IACZ,iBAAiB;IACjB,kBAAkB;IAClB,2EAA2I;IAC3I,eAAe;IACf,iDAAiD;IACjD,kCAAkC;AACtC;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;AAEA;;IAEI;AACJ;;AAEA;IACI,mBAAmB;IACnB;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI,mBAAmB;IACnB;AACJ;;AAEA;IACI,mBAAmB;IACnB;AACJ;;AAEA;IACI,mBAAmB;IACnB;AACJ;;AAEA;IACI;AACJ;;AAEA;IACI;AACJ;;;AAGA,cAAc;;AAEd;IACI,eAAe;IACf,SAAS;IACT,YAAY;IACZ,WAAW;IACX,YAAY;IACZ,cAAc;AAClB;;AAEA;;IAEI,0CAA0C;AAC9C;;AAEA;IACI,eAAe;IACf,iBAAiB;AACrB;;AAEA;IACI,aAAa;AACjB",sourcesContent:["/* Dat GUI */\r\n\r\n.dg ul {\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 0;\r\n    width: 100%;\r\n    clear: both\r\n}\r\n\r\n.dg.ac {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    height: 0;\r\n    z-index: 0\r\n}\r\n\r\n.dg:not(.ac) .main {\r\n    overflow: hidden\r\n}\r\n\r\n.dg.main {\r\n    -webkit-transition: opacity .1s linear;\r\n    -o-transition: opacity .1s linear;\r\n    -moz-transition: opacity .1s linear;\r\n    transition: opacity .1s linear\r\n}\r\n\r\n.dg.main.taller-than-window {\r\n    overflow-y: auto\r\n}\r\n\r\n.dg.main.taller-than-window .close-button {\r\n    opacity: 1;\r\n    margin-top: -1px;\r\n    border-top: 1px solid #2c2c2c\r\n}\r\n\r\n.dg.main ul.closed .close-button {\r\n    opacity: 1 !important\r\n}\r\n\r\n.dg.main:hover .close-button,\r\n.dg.main .close-button.drag {\r\n    opacity: 1\r\n}\r\n\r\n.dg.main .close-button {\r\n    -webkit-transition: opacity .1s linear;\r\n    -o-transition: opacity .1s linear;\r\n    -moz-transition: opacity .1s linear;\r\n    transition: opacity .1s linear;\r\n    border: 0;\r\n    line-height: 19px;\r\n    height: 20px;\r\n    cursor: pointer;\r\n    text-align: center;\r\n    background-color: #000\r\n}\r\n\r\n.dg.main .close-button.close-top {\r\n    position: relative\r\n}\r\n\r\n.dg.main .close-button.close-bottom {\r\n    position: absolute\r\n}\r\n\r\n.dg.main .close-button:hover {\r\n    background-color: #111\r\n}\r\n\r\n.dg.a {\r\n    float: right;\r\n    margin-top: 15px;\r\n    margin-right: 15px;\r\n    border-radius: 5px;\r\n    box-shadow: 0 1px 3px 0 rgb(0 0 0 / 30%);\r\n    overflow-x: hidden;\r\n    overflow-y: visible\r\n}\r\n\r\n.dg.a.has-save>ul.close-top {\r\n    margin-top: 0\r\n}\r\n\r\n.dg.a.has-save>ul.close-bottom {\r\n    margin-top: 27px\r\n}\r\n\r\n.dg.a.has-save>ul.closed {\r\n    margin-top: 0\r\n}\r\n\r\n.dg.a .save-row {\r\n    top: 0;\r\n    z-index: 1002\r\n}\r\n\r\n.dg.a .save-row.close-top {\r\n    position: relative\r\n}\r\n\r\n.dg.a .save-row.close-bottom {\r\n    position: fixed\r\n}\r\n\r\n.dg li {\r\n    -webkit-transition: height .1s ease-out;\r\n    -o-transition: height .1s ease-out;\r\n    -moz-transition: height .1s ease-out;\r\n    transition: height .1s ease-out;\r\n    -webkit-transition: overflow .1s linear;\r\n    -o-transition: overflow .1s linear;\r\n    -moz-transition: overflow .1s linear;\r\n    transition: overflow .1s linear\r\n}\r\n\r\n.dg li:not(.folder) {\r\n    cursor: auto;\r\n    height: 33px;\r\n    line-height: 33px;\r\n    padding: 0 10px 0 10px\r\n}\r\n\r\n.dg li.folder {\r\n    padding: 0;\r\n    border-left: 4px solid transparent\r\n}\r\n\r\n.dg li.title {\r\n    /* font-family: 'Allerta Stencil', sans-serif; */\r\n    /* font-family: 'Patua One', cursive; */\r\n    /* font-family: 'Fredoka One', cursive; */\r\n    font-weight: 500;\r\n    cursor: pointer;\r\n    margin-left: -4px\r\n}\r\n\r\n.dg .closed li:not(.title),\r\n.dg .closed ul li,\r\n.dg .closed ul li>* {\r\n    height: 0;\r\n    overflow: hidden;\r\n    border: 0\r\n}\r\n\r\n.dg .cr {\r\n    clear: both;\r\n    padding-left: 3px;\r\n    height: 27px;\r\n    overflow: hidden\r\n}\r\n\r\n.dg .property-name {\r\n    font-size: 82%;\r\n    cursor: default;\r\n    float: left;\r\n    clear: left;\r\n    width: 40%;\r\n    overflow: hidden;\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis\r\n}\r\n\r\n.dg .cr.function .property-name {\r\n    width: 100%;\r\n}\r\n\r\n.dg .c {\r\n    float: left;\r\n    width: 60%;\r\n    position: relative\r\n}\r\n\r\n.dg .c input[type=text] {\r\n    border: 0;\r\n    margin-top: 4px;\r\n    padding: 3px;\r\n    width: 100%;\r\n    float: right\r\n}\r\n\r\n.dg .has-slider input[type=text] {\r\n    width: 30%;\r\n    margin-left: 0\r\n}\r\n\r\n.dg .slider {\r\n    float: left;\r\n    width: 66%;\r\n    margin-left: -5px;\r\n    margin-right: 0;\r\n    height: 19px;\r\n    margin-top: 4px\r\n}\r\n\r\n.dg .slider-fg {\r\n    height: 100%\r\n}\r\n\r\n.dg .c input[type=checkbox] {\r\n    margin-top: 7px\r\n}\r\n\r\n.dg .c select {\r\n    margin-top: 5px\r\n}\r\n\r\n.dg .cr.function,\r\n.dg .cr.function .property-name,\r\n.dg .cr.function *,\r\n.dg .cr.boolean,\r\n.dg .cr.boolean * {\r\n    cursor: pointer\r\n}\r\n\r\n.dg .cr.color {\r\n    overflow: visible\r\n}\r\n\r\n.dg .selector {\r\n    display: none;\r\n    position: absolute;\r\n    margin-left: -9px;\r\n    margin-top: 23px;\r\n    z-index: 10\r\n}\r\n\r\n.dg .c:hover .selector,\r\n.dg .selector.drag {\r\n    display: block\r\n}\r\n\r\n.dg li.save-row {\r\n    padding: 0\r\n}\r\n\r\n.dg li.save-row .button {\r\n    display: inline-block;\r\n    padding: 0px 6px\r\n}\r\n\r\n.dg.dialogue {\r\n    background-color: #222;\r\n    width: 460px;\r\n    padding: 15px;\r\n    font-size: 13px;\r\n    line-height: 15px\r\n}\r\n\r\n#dg-new-constructor {\r\n    padding: 10px;\r\n    color: #222;\r\n    font-family: Monaco, monospace;\r\n    font-size: 10px;\r\n    border: 0;\r\n    resize: none;\r\n    box-shadow: inset 1px 1px 1px #888;\r\n    word-wrap: break-word;\r\n    margin: 12px 0;\r\n    display: block;\r\n    width: 440px;\r\n    overflow-y: scroll;\r\n    height: 100px;\r\n    position: relative\r\n}\r\n\r\n#dg-local-explain {\r\n    display: none;\r\n    font-size: 11px;\r\n    line-height: 17px;\r\n    border-radius: 3px;\r\n    background-color: #333;\r\n    padding: 8px;\r\n    margin-top: 10px\r\n}\r\n\r\n#dg-local-explain code {\r\n    font-size: 10px\r\n}\r\n\r\n#dat-gui-save-locally {\r\n    display: none\r\n}\r\n\r\n.dg {\r\n    color: #eee;\r\n    /* font-family: 'Cutive Mono', sans-serif; */\r\n    /* text-shadow: 0 -1px 0 #111 */\r\n    text-shadow: none;\r\n}\r\n\r\n.dg.main::-webkit-scrollbar {\r\n    width: 5px;\r\n    background: #1a1a1a\r\n}\r\n\r\n.dg.main::-webkit-scrollbar-corner {\r\n    height: 0;\r\n    display: none\r\n}\r\n\r\n.dg.main::-webkit-scrollbar-thumb {\r\n    border-radius: 5px;\r\n    background: #676767\r\n}\r\n\r\n.dg li:not(.folder) {\r\n    background: rgb(26 26 26 / 92%);\r\n    border-bottom: 1px solid #2c2c2c;\r\n    -webkit-backdrop-filter: blur(10px);\r\n    backdrop-filter: blur(10px);\r\n    margin-left: -4px;\r\n}\r\n\r\n.dg li.save-row {\r\n    line-height: 25px;\r\n    background: #dad5cb;\r\n    border: 0\r\n}\r\n\r\n.dg li.save-row select {\r\n    margin-left: 5px;\r\n    width: 108px\r\n}\r\n\r\n.dg li.save-row .button {\r\n    margin-left: 5px;\r\n    margin-top: 1px;\r\n    border-radius: 2px;\r\n    font-size: 9px;\r\n    line-height: 7px;\r\n    padding: 4px 4px 5px 4px;\r\n    background: #c5bdad;\r\n    color: #fff;\r\n    text-shadow: 0 1px 0 #b0a58f;\r\n    box-shadow: 0 -1px 0 #b0a58f;\r\n    cursor: pointer\r\n}\r\n\r\n.dg li.save-row .button.gears {\r\n    background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\r\n    height: 7px;\r\n    width: 8px\r\n}\r\n\r\n.dg li.save-row .button:hover {\r\n    background-color: #bab19e;\r\n    box-shadow: 0 -1px 0 #b0a58f\r\n}\r\n\r\n.dg li.folder {\r\n    border-bottom: 0\r\n}\r\n\r\n.dg li.title {\r\n    font-size: 90%;\r\n    height: 33px;\r\n    line-height: 33px;\r\n    padding-left: 20px;\r\n    background: #000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 8px 14px no-repeat;\r\n    cursor: pointer;\r\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2);\r\n    background-color: rgb(0 0 0 / 92%);\r\n}\r\n\r\n.dg .closed li.title {\r\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)\r\n}\r\n\r\n.dg .cr.boolean {\r\n    border-left: 3px solid #806787\r\n}\r\n\r\n.dg .cr.color {\r\n    border-left: 3px solid\r\n}\r\n\r\n.dg .cr.function {\r\n    border-left: 3px solid #e61d5f\r\n}\r\n\r\n.dg .cr.number {\r\n    border-left: 3px solid #2FA1D6\r\n}\r\n\r\n.dg .cr.number input[type=text] {\r\n    color: #2FA1D6\r\n}\r\n\r\n.dg .cr.string {\r\n    border-left: 3px solid #1ed36f\r\n}\r\n\r\n.dg .cr.string input[type=text] {\r\n    color: #1ed36f\r\n}\r\n\r\n.dg .cr.function:hover,\r\n.dg .cr.boolean:hover {\r\n    background: #111\r\n}\r\n\r\n.dg .c input[type=text] {\r\n    background: #303030;\r\n    outline: none\r\n}\r\n\r\n.dg .c input[type=text]:hover {\r\n    background: #3c3c3c\r\n}\r\n\r\n.dg .c input[type=text]:focus {\r\n    background: #494949;\r\n    color: #fff\r\n}\r\n\r\n.dg .c .slider {\r\n    background: #303030;\r\n    cursor: ew-resize\r\n}\r\n\r\n.dg .c .slider-fg {\r\n    background: #2FA1D6;\r\n    max-width: 100%\r\n}\r\n\r\n.dg .c .slider:hover {\r\n    background: #3c3c3c\r\n}\r\n\r\n.dg .c .slider:hover .slider-fg {\r\n    background: #44abda\r\n}\r\n\r\n\r\n/* Stats box */\r\n\r\n#statsBox {\r\n    position: fixed;\r\n    top: 15px;\r\n    height: 48px;\r\n    right: 15px;\r\n    opacity: 0.9;\r\n    z-index: 10000;\r\n}\r\n\r\n#statsBox,\r\n.dg.ac .dg.main.a .dg .title {\r\n    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);\r\n}\r\n\r\n.dg.ac {\r\n    /* top: 48px; */\r\n    user-select: none;\r\n}\r\n\r\n.dg.ac .close-button.close-bottom {\r\n    display: none;\r\n}\r\n"],sourceRoot:""}]);let g=d},842:function(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a)()(r());s.push([e.id,"/* GitHub corner */\r\n\r\n.github-corner {\r\n	position: absolute;\r\n	left: 0;\r\n	top: 0;\r\n	width: 120px;\r\n	height: 120px;\r\n	overflow: hidden;\r\n}\r\n\r\n.github-corner a {\r\n	position: absolute;\r\n	right: 0;\r\n	top: 0;\r\n	left: 0;\r\n	bottom: 0;\r\n	transform: translate(-50%, -50%) rotate(-45deg);\r\n	color: #000000;\r\n}","",{version:3,sources:["webpack://./src/css/modules/githubCorner.css"],names:[],mappings:"AAAA,kBAAkB;;AAElB;CACC,kBAAkB;CAClB,OAAO;CACP,MAAM;CACN,YAAY;CACZ,aAAa;CACb,gBAAgB;AACjB;;AAEA;CACC,kBAAkB;CAClB,QAAQ;CACR,MAAM;CACN,OAAO;CACP,SAAS;CACT,+CAA+C;CAC/C,cAAc;AACf",sourcesContent:["/* GitHub corner */\r\n\r\n.github-corner {\r\n	position: absolute;\r\n	left: 0;\r\n	top: 0;\r\n	width: 120px;\r\n	height: 120px;\r\n	overflow: hidden;\r\n}\r\n\r\n.github-corner a {\r\n	position: absolute;\r\n	right: 0;\r\n	top: 0;\r\n	left: 0;\r\n	bottom: 0;\r\n	transform: translate(-50%, -50%) rotate(-45deg);\r\n	color: #000000;\r\n}"],sourceRoot:""}]);let o=s},2750:function(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a)()(r());s.push([e.id,"/* Left panel */\r\n\r\n.left-panel {\r\n	position: fixed;\r\n	height: calc(100% - 70px);\r\n	padding-top: 70px;\r\n	flex-direction: column;\r\n	display: flex;\r\n	justify-content: space-between;\r\n	pointer-events: none;\r\n}\r\n\r\n.left-panel .panel-segment {\r\n	flex-grow: 1;\r\n	flex-basis: 100px;\r\n	padding: 20px;\r\n	overflow: hidden;\r\n}\r\n\r\n.flex-bottom {\r\n	display: flex;\r\n	flex-direction: column;\r\n	justify-content: flex-end;\r\n}\r\n\r\n.controls-title {\r\n	margin-bottom: 12px;\r\n}\r\n\r\n.ctrl-row {\r\n	margin-bottom: 6px;\r\n	display: flex;\r\n	align-items: center;\r\n}\r\n\r\n.ctrl-key {\r\n	text-shadow: none;\r\n	font-weight: bold;\r\n	display: inline-block;\r\n	font-family: 'Cutive Mono', monospace;\r\n	padding: 2px 5px;\r\n	margin-right: 2px;\r\n	min-width: 10px;\r\n	text-align: center;\r\n	margin-left: 2px;\r\n	background: #eff0f2;\r\n	box-shadow: inset 0 0 25px #e8e8e8, 0 1px 0 #c3c3c3, 0 2px 0 #c9c9c9, 0 2px 3px #000;\r\n	color: #111;\r\n	border-radius: 2px;\r\n	font-size: 14px;\r\n}\r\n\r\n.ctrl-desc {\r\n	margin-left: 5px;\r\n	/* font-size: 18px; */\r\n}","",{version:3,sources:["webpack://./src/css/modules/leftPanel.css"],names:[],mappings:"AAAA,eAAe;;AAEf;CACC,eAAe;CACf,yBAAyB;CACzB,iBAAiB;CACjB,sBAAsB;CACtB,aAAa;CACb,8BAA8B;CAC9B,oBAAoB;AACrB;;AAEA;CACC,YAAY;CACZ,iBAAiB;CACjB,aAAa;CACb,gBAAgB;AACjB;;AAEA;CACC,aAAa;CACb,sBAAsB;CACtB,yBAAyB;AAC1B;;AAEA;CACC,mBAAmB;AACpB;;AAEA;CACC,kBAAkB;CAClB,aAAa;CACb,mBAAmB;AACpB;;AAEA;CACC,iBAAiB;CACjB,iBAAiB;CACjB,qBAAqB;CACrB,qCAAqC;CACrC,gBAAgB;CAChB,iBAAiB;CACjB,eAAe;CACf,kBAAkB;CAClB,gBAAgB;CAChB,mBAAmB;CACnB,oFAAoF;CACpF,WAAW;CACX,kBAAkB;CAClB,eAAe;AAChB;;AAEA;CACC,gBAAgB;CAChB,qBAAqB;AACtB",sourcesContent:["/* Left panel */\r\n\r\n.left-panel {\r\n	position: fixed;\r\n	height: calc(100% - 70px);\r\n	padding-top: 70px;\r\n	flex-direction: column;\r\n	display: flex;\r\n	justify-content: space-between;\r\n	pointer-events: none;\r\n}\r\n\r\n.left-panel .panel-segment {\r\n	flex-grow: 1;\r\n	flex-basis: 100px;\r\n	padding: 20px;\r\n	overflow: hidden;\r\n}\r\n\r\n.flex-bottom {\r\n	display: flex;\r\n	flex-direction: column;\r\n	justify-content: flex-end;\r\n}\r\n\r\n.controls-title {\r\n	margin-bottom: 12px;\r\n}\r\n\r\n.ctrl-row {\r\n	margin-bottom: 6px;\r\n	display: flex;\r\n	align-items: center;\r\n}\r\n\r\n.ctrl-key {\r\n	text-shadow: none;\r\n	font-weight: bold;\r\n	display: inline-block;\r\n	font-family: 'Cutive Mono', monospace;\r\n	padding: 2px 5px;\r\n	margin-right: 2px;\r\n	min-width: 10px;\r\n	text-align: center;\r\n	margin-left: 2px;\r\n	background: #eff0f2;\r\n	box-shadow: inset 0 0 25px #e8e8e8, 0 1px 0 #c3c3c3, 0 2px 0 #c9c9c9, 0 2px 3px #000;\r\n	color: #111;\r\n	border-radius: 2px;\r\n	font-size: 14px;\r\n}\r\n\r\n.ctrl-desc {\r\n	margin-left: 5px;\r\n	/* font-size: 18px; */\r\n}"],sourceRoot:""}]);let o=s},5833:function(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a)()(r());s.push([e.id,"/* Welcome screen */\r\n\r\n#loading-screen {\r\n	position: absolute;\r\n	top: 0;\r\n	z-index: 0;\r\n	display: flex;\r\n	justify-content: center;\r\n	align-items: center;\r\n	flex-direction: column;\r\n	text-align: center;\r\n	height: 100%;\r\n	width: 100%;\r\n}\r\n\r\n#loader {\r\n	display: flex;\r\n	-webkit-box-align: center;\r\n	align-items: center;\r\n	-webkit-box-pack: center;\r\n	justify-content: center;\r\n}\r\n\r\n#main-title {\r\n	margin-bottom: 0;\r\n}\r\n\r\n#loading-text {\r\n	font-size: larger;\r\n	margin-top: 10px;\r\n}\r\n\r\n#loading-screen-background {\r\n	z-index: -1;\r\n	position: absolute;\r\n	height: 100%;\r\n	width: 100%;\r\n	background: -webkit-linear-gradient(top, #568db5 0%, #ccdde8 100%);\r\n	background: -linear-gradient(top, #568db5 0%, #ccdde8 100%);\r\n	background: -moz-linear-gradient(top, #568db5 0%, #ccdde8 100%);\r\n}","",{version:3,sources:["webpack://./src/css/modules/loadingScreen.css"],names:[],mappings:"AAAA,mBAAmB;;AAEnB;CACC,kBAAkB;CAClB,MAAM;CACN,UAAU;CACV,aAAa;CACb,uBAAuB;CACvB,mBAAmB;CACnB,sBAAsB;CACtB,kBAAkB;CAClB,YAAY;CACZ,WAAW;AACZ;;AAEA;CACC,aAAa;CACb,yBAAyB;CACzB,mBAAmB;CACnB,wBAAwB;CACxB,uBAAuB;AACxB;;AAEA;CACC,gBAAgB;AACjB;;AAEA;CACC,iBAAiB;CACjB,gBAAgB;AACjB;;AAEA;CACC,WAAW;CACX,kBAAkB;CAClB,YAAY;CACZ,WAAW;CACX,kEAAkE;CAClE,2DAA2D;CAC3D,+DAA+D;AAChE",sourcesContent:["/* Welcome screen */\r\n\r\n#loading-screen {\r\n	position: absolute;\r\n	top: 0;\r\n	z-index: 0;\r\n	display: flex;\r\n	justify-content: center;\r\n	align-items: center;\r\n	flex-direction: column;\r\n	text-align: center;\r\n	height: 100%;\r\n	width: 100%;\r\n}\r\n\r\n#loader {\r\n	display: flex;\r\n	-webkit-box-align: center;\r\n	align-items: center;\r\n	-webkit-box-pack: center;\r\n	justify-content: center;\r\n}\r\n\r\n#main-title {\r\n	margin-bottom: 0;\r\n}\r\n\r\n#loading-text {\r\n	font-size: larger;\r\n	margin-top: 10px;\r\n}\r\n\r\n#loading-screen-background {\r\n	z-index: -1;\r\n	position: absolute;\r\n	height: 100%;\r\n	width: 100%;\r\n	background: -webkit-linear-gradient(top, #568db5 0%, #ccdde8 100%);\r\n	background: -linear-gradient(top, #568db5 0%, #ccdde8 100%);\r\n	background: -moz-linear-gradient(top, #568db5 0%, #ccdde8 100%);\r\n}"],sourceRoot:""}]);let o=s},6177:function(e,t,i){"use strict";i.d(t,{Z:()=>o});var n=i(7537),r=i.n(n),a=i(3645),s=i.n(a)()(r());s.push([e.id,".swal2-container {\r\n	text-shadow: none;\r\n}\r\n\r\n.swal2-confirm {\r\n	display: inline-block;\r\n	background: #FFB900;\r\n	border: none;\r\n	padding: 12px 28px;\r\n	color: #222;\r\n	outline: none;\r\n	border-radius: 4px;\r\n	font-family: 'Solway', serif;\r\n	font-weight: 700;\r\n	font-size: 18px;\r\n	cursor: pointer;\r\n	margin: 0 0 4px 0;\r\n	box-shadow: 0 4px 0 0 rgb(228 158 0);\r\n}\r\n\r\n.swal2-confirm:active {\r\n	margin: 4px 0 0 0;\r\n	box-shadow: 0 0px 0 0 rgb(228 158 0);\r\n}\r\n\r\ndiv.swal2-footer {\r\n	justify-content: space-evenly;\r\n}\r\n\r\n.button {\r\n	opacity: 0;\r\n	background: black;\r\n	padding: 12px 15px 12px 15px;\r\n	font-family: \"Cutive Mono\", monospace;\r\n	font-size: 1.2rem;\r\n	border: none;\r\n	color: white;\r\n	cursor: pointer;\r\n}","",{version:3,sources:["webpack://./src/css/modules/welcomeScreen.css"],names:[],mappings:"AAAA;CACC,iBAAiB;AAClB;;AAEA;CACC,qBAAqB;CACrB,mBAAmB;CACnB,YAAY;CACZ,kBAAkB;CAClB,WAAW;CACX,aAAa;CACb,kBAAkB;CAClB,4BAA4B;CAC5B,gBAAgB;CAChB,eAAe;CACf,eAAe;CACf,iBAAiB;CACjB,oCAAoC;AACrC;;AAEA;CACC,iBAAiB;CACjB,oCAAoC;AACrC;;AAEA;CACC,6BAA6B;AAC9B;;AAEA;CACC,UAAU;CACV,iBAAiB;CACjB,4BAA4B;CAC5B,qCAAqC;CACrC,iBAAiB;CACjB,YAAY;CACZ,YAAY;CACZ,eAAe;AAChB",sourcesContent:[".swal2-container {\r\n	text-shadow: none;\r\n}\r\n\r\n.swal2-confirm {\r\n	display: inline-block;\r\n	background: #FFB900;\r\n	border: none;\r\n	padding: 12px 28px;\r\n	color: #222;\r\n	outline: none;\r\n	border-radius: 4px;\r\n	font-family: 'Solway', serif;\r\n	font-weight: 700;\r\n	font-size: 18px;\r\n	cursor: pointer;\r\n	margin: 0 0 4px 0;\r\n	box-shadow: 0 4px 0 0 rgb(228 158 0);\r\n}\r\n\r\n.swal2-confirm:active {\r\n	margin: 4px 0 0 0;\r\n	box-shadow: 0 0px 0 0 rgb(228 158 0);\r\n}\r\n\r\ndiv.swal2-footer {\r\n	justify-content: space-evenly;\r\n}\r\n\r\n.button {\r\n	opacity: 0;\r\n	background: black;\r\n	padding: 12px 15px 12px 15px;\r\n	font-family: \"Cutive Mono\", monospace;\r\n	font-size: 1.2rem;\r\n	border: none;\r\n	color: white;\r\n	cursor: pointer;\r\n}"],sourceRoot:""}]);let o=s},3645:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i="",n=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i}).join("")},t.i=function(e,i,n,r,a){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(n)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);(!n||!s[h[0]])&&(void 0!==a&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=a),i&&(h[2]&&(h[1]="@media ".concat(h[2]," {").concat(h[1],"}")),h[2]=i),r&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=r):h[4]="".concat(r)),t.push(h))}},t}},1667:function(e){"use strict";e.exports=function(e,t){return(t||(t={}),e&&(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes))?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e}},7537:function(e){"use strict";e.exports=function(e){var t=e[1],i=e[3];if(!i)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(i))));return[t].concat(i.sources.map(function(e){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(e," */")})).concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n)," */")]).join("\n")}return[t].join("\n")}},9755:function(e){var t,i;t="undefined"!=typeof window?window:this,i=function(e,t){"use strict";var i,n=[],r=Object.getPrototypeOf,a=n.slice,s=n.flat?function(e){return n.flat.call(e)}:function(e){return n.concat.apply([],e)},o=n.push,l=n.indexOf,c={},h=c.toString,u=c.hasOwnProperty,d=u.toString,p=d.call(Object),f={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},g=function(e){return null!=e&&e===e.window},v=e.document,y={type:!0,src:!0,nonce:!0,noModule:!0};function x(e,t,i){var n,r,a=(i=i||v).createElement("script");if(a.text=e,t)for(n in y)(r=t[n]||t.getAttribute&&t.getAttribute(n))&&a.setAttribute(n,r);i.head.appendChild(a).parentNode.removeChild(a)}function _(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[h.call(e)]||"object":typeof e}var A="3.6.0",b=function(e,t){return new b.fn.init(e,t)};function S(e){var t=!!e&&"length"in e&&e.length,i=_(e);return!(m(e)||g(e))&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}b.fn=b.prototype={jquery:A,constructor:b,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return b.each(this,e)},map:function(e){return this.pushStack(b.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(b.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(b.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:o,sort:n.sort,splice:n.splice},b.extend=b.fn.extend=function(){var e,t,i,n,r,a,s=arguments[0]||{},o=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[o]||{},o++),"object"==typeof s||m(s)||(s={}),o===l&&(s=this,o--);o<l;o++)if(null!=(e=arguments[o]))for(t in e)n=e[t],"__proto__"!==t&&s!==n&&(c&&n&&(b.isPlainObject(n)||(r=Array.isArray(n)))?(i=s[t],a=r&&!Array.isArray(i)?[]:r||b.isPlainObject(i)?i:{},r=!1,s[t]=b.extend(c,a,n)):void 0!==n&&(s[t]=n));return s},b.extend({expando:"jQuery"+(A+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw Error(e)},noop:function(){},isPlainObject:function(e){var t,i;return!!e&&"[object Object]"===h.call(e)&&(!(t=r(e))||"function"==typeof(i=u.call(t,"constructor")&&t.constructor)&&d.call(i)===p)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,i){x(e,{nonce:t&&t.nonce},i)},each:function(e,t){var i,n=0;if(S(e))for(i=e.length;n<i&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(!1===t.call(e[n],n,e[n]))break;return e},makeArray:function(e,t){var i=t||[];return null!=e&&(S(Object(e))?b.merge(i,"string"==typeof e?[e]:e):o.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:l.call(t,e,i)},merge:function(e,t){for(var i=+t.length,n=0,r=e.length;n<i;n++)e[r++]=t[n];return e.length=r,e},grep:function(e,t,i){for(var n=[],r=0,a=e.length,s=!i;r<a;r++)!t(e[r],r)!==s&&n.push(e[r]);return n},map:function(e,t,i){var n,r,a=0,o=[];if(S(e))for(n=e.length;a<n;a++)null!=(r=t(e[a],a,i))&&o.push(r);else for(a in e)null!=(r=t(e[a],a,i))&&o.push(r);return s(o)},guid:1,support:f}),"function"==typeof Symbol&&(b.fn[Symbol.iterator]=n[Symbol.iterator]),b.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});var w=function(e){var t,i,n,r,a,s,o,l,c,h,u,d,p,f,m,g,v,y,x,_="sizzle"+1*new Date,A=e.document,b=0,S=0,w=el(),M=el(),E=el(),C=el(),T=function(e,t){return e===t&&(u=!0),0},R={}.hasOwnProperty,P=[],I=P.pop,L=P.push,D=P.push,B=P.slice,O=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return -1},N="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="[\\x20\\t\\r\\n\\f]",F="(?:\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",k="\\["+U+"*("+F+")(?:"+U+"*([*^$|!~]?=)"+U+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+U+"*\\]",z=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+k+")*)|.*)\\)|)",H=RegExp(U+"+","g"),V=RegExp("^"+U+"+|((?:^|[^\\\\])(?:\\\\.)*)"+U+"+$","g"),G=RegExp("^"+U+"*,"+U+"*"),W=RegExp("^"+U+"*([>+~]|"+U+")"+U+"*"),j=RegExp(U+"|>"),q=new RegExp(z),X=RegExp("^"+F+"$"),Y={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),TAG:RegExp("^("+F+"|[*])"),ATTR:RegExp("^"+k),PSEUDO:RegExp("^"+z),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+U+"*(even|odd|(([+-]|)(\\d*)n|)"+U+"*(?:([+-]|)"+U+"*(\\d+)|))"+U+"*\\)|)","i"),bool:RegExp("^(?:"+N+")$","i"),needsContext:RegExp("^"+U+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+U+"*((?:-\\d)?\\d*)"+U+"*\\)|)(?=[^-]|$)","i")},K=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,et=RegExp("\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\([^\\r\\n\\f])","g"),ei=function(e,t){var i="0x"+e.slice(1)-65536;return t||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},en=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,er=function(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ea=function(){d()},es=ey(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{D.apply(P=B.call(A.childNodes),A.childNodes),P[A.childNodes.length].nodeType}catch(e){D={apply:P.length?function(e,t){L.apply(e,B.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}function eo(e,t,n,r){var a,o,c,h,u,f,v,y=t&&t.ownerDocument,A=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==A&&9!==A&&11!==A)return n;if(!r&&(d(t),t=t||p,m)){if(11!==A&&(u=$.exec(e))){if(a=u[1]){if(9===A){if(!(c=t.getElementById(a)))return n;if(c.id===a)return n.push(c),n}else if(y&&(c=y.getElementById(a))&&x(t,c)&&c.id===a)return n.push(c),n}else if(u[2])return D.apply(n,t.getElementsByTagName(e)),n;else if((a=u[3])&&i.getElementsByClassName&&t.getElementsByClassName)return D.apply(n,t.getElementsByClassName(a)),n}if(i.qsa&&!C[e+" "]&&(!g||!g.test(e))&&(1!==A||"object"!==t.nodeName.toLowerCase())){if(v=e,y=t,1===A&&(j.test(e)||W.test(e))){for((y=ee.test(e)&&em(t.parentNode)||t)===t&&i.scope||((h=t.getAttribute("id"))?h=h.replace(en,er):t.setAttribute("id",h=_)),o=(f=s(e)).length;o--;)f[o]=(h?"#"+h:":scope")+" "+ev(f[o]);v=f.join(",")}try{return D.apply(n,y.querySelectorAll(v)),n}catch(t){C(e,!0)}finally{h===_&&t.removeAttribute("id")}}}return l(e.replace(V,"$1"),t,n,r)}function el(){var e=[];return function t(i,r){return e.push(i+" ")>n.cacheLength&&delete t[e.shift()],t[i+" "]=r}}function ec(e){return e[_]=!0,e}function eh(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function eu(e,t){for(var i=e.split("|"),r=i.length;r--;)n.attrHandle[i[r]]=t}function ed(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(i){for(;i=i.nextSibling;)if(i===t)return -1}return e?1:-1}function ep(e){return function(t){if("form"in t){if(t.parentNode&&!1===t.disabled)return"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||!e!==t.isDisabled&&es(t)===e;return t.disabled===e}return"label"in t&&t.disabled===e}}function ef(e){return ec(function(t){return t=+t,ec(function(i,n){for(var r,a=e([],i.length,t),s=a.length;s--;)i[r=a[s]]&&(i[r]=!(n[r]=i[r]))})})}function em(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in i=eo.support={},a=eo.isXML=function(e){var t=e&&e.namespaceURI,i=e&&(e.ownerDocument||e).documentElement;return!K.test(t||i&&i.nodeName||"HTML")},d=eo.setDocument=function(e){var t,r,s=e?e.ownerDocument||e:A;return s!=p&&9===s.nodeType&&s.documentElement&&(f=(p=s).documentElement,m=!a(p),A!=p&&(r=p.defaultView)&&r.top!==r&&(r.addEventListener?r.addEventListener("unload",ea,!1):r.attachEvent&&r.attachEvent("onunload",ea)),i.scope=eh(function(e){return f.appendChild(e).appendChild(p.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),i.attributes=eh(function(e){return e.className="i",!e.getAttribute("className")}),i.getElementsByTagName=eh(function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length}),i.getElementsByClassName=Z.test(p.getElementsByClassName),i.getById=eh(function(e){return f.appendChild(e).id=_,!p.getElementsByName||!p.getElementsByName(_).length}),i.getById?(n.filter.ID=function(e){var t=e.replace(et,ei);return function(e){return e.getAttribute("id")===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var i=t.getElementById(e);return i?[i]:[]}}):(n.filter.ID=function(e){var t=e.replace(et,ei);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&m){var i,n,r,a=t.getElementById(e);if(a){if((i=a.getAttributeNode("id"))&&i.value===e)return[a];for(r=t.getElementsByName(e),n=0;a=r[n++];)if((i=a.getAttributeNode("id"))&&i.value===e)return[a]}return[]}}),n.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,n=[],r=0,a=t.getElementsByTagName(e);if("*"===e){for(;i=a[r++];)1===i.nodeType&&n.push(i);return n}return a},n.find.CLASS=i.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&m)return t.getElementsByClassName(e)},v=[],g=[],(i.qsa=Z.test(p.querySelectorAll))&&(eh(function(e){var t;f.appendChild(e).innerHTML="<a id='"+_+"'></a><select id='"+_+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&g.push("[*^$]="+U+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||g.push("\\["+U+"*(?:value|"+N+")"),e.querySelectorAll("[id~="+_+"-]").length||g.push("~="),(t=p.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||g.push("\\["+U+"*name"+U+"*="+U+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||g.push(":checked"),e.querySelectorAll("a#"+_+"+*").length||g.push(".#.+[+~]"),e.querySelectorAll("\\\f"),g.push("[\\r\\n\\f]")}),eh(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&g.push("name"+U+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&g.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(i.matchesSelector=Z.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&eh(function(e){i.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",z)}),g=g.length&&new RegExp(g.join("|")),v=v.length&&new RegExp(v.join("|")),x=(t=Z.test(f.compareDocumentPosition))||Z.test(f.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!!(n&&1===n.nodeType&&(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t){for(;t=t.parentNode;)if(t===e)return!0}return!1},T=t?function(e,t){if(e===t)return u=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===n?e==p||e.ownerDocument==A&&x(A,e)?-1:t==p||t.ownerDocument==A&&x(A,t)?1:h?O(h,e)-O(h,t):0:4&n?-1:1}:function(e,t){if(e===t)return u=!0,0;var i,n=0,r=e.parentNode,a=t.parentNode,s=[e],o=[t];if(!r||!a)return e==p?-1:t==p?1:r?-1:a?1:h?O(h,e)-O(h,t):0;if(r===a)return ed(e,t);for(i=e;i=i.parentNode;)s.unshift(i);for(i=t;i=i.parentNode;)o.unshift(i);for(;s[n]===o[n];)n++;return n?ed(s[n],o[n]):s[n]==A?-1:o[n]==A?1:0}),p},eo.matches=function(e,t){return eo(e,null,null,t)},eo.matchesSelector=function(e,t){if(d(e),i.matchesSelector&&m&&!C[t+" "]&&(!v||!v.test(t))&&(!g||!g.test(t)))try{var n=y.call(e,t);if(n||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){C(t,!0)}return eo(t,p,null,[e]).length>0},eo.contains=function(e,t){return(e.ownerDocument||e)!=p&&d(e),x(e,t)},eo.attr=function(e,t){(e.ownerDocument||e)!=p&&d(e);var r=n.attrHandle[t.toLowerCase()],a=r&&R.call(n.attrHandle,t.toLowerCase())?r(e,t,!m):void 0;return void 0!==a?a:i.attributes||!m?e.getAttribute(t):(a=e.getAttributeNode(t))&&a.specified?a.value:null},eo.escape=function(e){return(e+"").replace(en,er)},eo.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},eo.uniqueSort=function(e){var t,n=[],r=0,a=0;if(u=!i.detectDuplicates,h=!i.sortStable&&e.slice(0),e.sort(T),u){for(;t=e[a++];)t===e[a]&&(r=n.push(a));for(;r--;)e.splice(n[r],1)}return h=null,e},r=eo.getText=function(e){var t,i="",n=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=r(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[n++];)i+=r(t);return i},(n=eo.selectors={cacheLength:50,createPseudo:ec,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,ei),e[3]=(e[3]||e[4]||e[5]||"").replace(et,ei),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||eo.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&eo.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return Y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&q.test(i)&&(t=s(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(et,ei).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=w[e+" "];return t||(t=RegExp("(^|"+U+")"+e+"("+U+"|$)"),w(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,i){return function(n){var r=eo.attr(n,e);return null==r?"!="===t:!t||(r+="","="===t?r===i:"!="===t?r!==i:"^="===t?i&&0===r.indexOf(i):"*="===t?i&&r.indexOf(i)>-1:"$="===t?i&&r.slice(-i.length)===i:"~="===t?(" "+r.replace(H," ")+" ").indexOf(i)>-1:"|="===t&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,n,r){var a="nth"!==e.slice(0,3),s="last"!==e.slice(-4),o="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var c,h,u,d,p,f,m=a!==s?"nextSibling":"previousSibling",g=t.parentNode,v=o&&t.nodeName.toLowerCase(),y=!l&&!o,x=!1;if(g){if(a){for(;m;){for(d=t;d=d[m];)if(o?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?g.firstChild:g.lastChild],s&&y){for(x=(p=(c=(h=(u=(d=g)[_]||(d[_]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]||[])[0]===b&&c[1])&&c[2],d=p&&g.childNodes[p];d=++p&&d&&d[m]||(x=p=0)||f.pop();)if(1===d.nodeType&&++x&&d===t){h[e]=[b,p,x];break}}else if(y&&(x=p=(c=(h=(u=(d=t)[_]||(d[_]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]||[])[0]===b&&c[1]),!1===x)for(;(d=++p&&d&&d[m]||(x=p=0)||f.pop())&&(!((o?d.nodeName.toLowerCase()===v:1===d.nodeType)&&++x)||(y&&((h=(u=d[_]||(d[_]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]=[b,x]),d!==t)););return(x-=r)===n||x%n==0&&x/n>=0}}},PSEUDO:function(e,t){var i,r=n.pseudos[e]||n.setFilters[e.toLowerCase()]||eo.error("unsupported pseudo: "+e);return r[_]?r(t):r.length>1?(i=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?ec(function(e,i){for(var n,a=r(e,t),s=a.length;s--;)n=O(e,a[s]),e[n]=!(i[n]=a[s])}):function(e){return r(e,0,i)}):r}},pseudos:{not:ec(function(e){var t=[],i=[],n=o(e.replace(V,"$1"));return n[_]?ec(function(e,t,i,r){for(var a,s=n(e,null,r,[]),o=e.length;o--;)(a=s[o])&&(e[o]=!(t[o]=a))}):function(e,r,a){return t[0]=e,n(t,null,a,i),t[0]=null,!i.pop()}}),has:ec(function(e){return function(t){return eo(e,t).length>0}}),contains:ec(function(e){return e=e.replace(et,ei),function(t){return(t.textContent||r(t)).indexOf(e)>-1}}),lang:ec(function(e){return X.test(e||"")||eo.error("unsupported lang: "+e),e=e.replace(et,ei).toLowerCase(),function(t){var i;do if(i=m?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ep(!1),disabled:ep(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ef(function(){return[0]}),last:ef(function(e,t){return[t-1]}),eq:ef(function(e,t,i){return[i<0?i+t:i]}),even:ef(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:ef(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:ef(function(e,t,i){for(var n=i<0?i+t:i>t?t:i;--n>=0;)e.push(n);return e}),gt:ef(function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e})}}).pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=function(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}(t);function eg(){}function ev(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function ey(e,t,i){var n=t.dir,r=t.next,a=r||n,s=i&&"parentNode"===a,o=S++;return t.first?function(t,i,r){for(;t=t[n];)if(1===t.nodeType||s)return e(t,i,r);return!1}:function(t,i,l){var c,h,u,d=[b,o];if(l){for(;t=t[n];)if((1===t.nodeType||s)&&e(t,i,l))return!0}else for(;t=t[n];)if(1===t.nodeType||s){if(h=(u=t[_]||(t[_]={}))[t.uniqueID]||(u[t.uniqueID]={}),r&&r===t.nodeName.toLowerCase())t=t[n]||t;else if((c=h[a])&&c[0]===b&&c[1]===o)return d[2]=c[2];else if(h[a]=d,d[2]=e(t,i,l))return!0}return!1}}function ex(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function e_(e,t,i,n,r){for(var a,s=[],o=0,l=e.length,c=null!=t;o<l;o++)(a=e[o])&&(!i||i(a,n,r))&&(s.push(a),c&&t.push(o));return s}return eg.prototype=n.filters=n.pseudos,n.setFilters=new eg,s=eo.tokenize=function(e,t){var i,r,a,s,o,l,c,h=M[e+" "];if(h)return t?0:h.slice(0);for(o=e,l=[],c=n.preFilter;o;){for(s in(!i||(r=G.exec(o)))&&(r&&(o=o.slice(r[0].length)||o),l.push(a=[])),i=!1,(r=W.exec(o))&&(i=r.shift(),a.push({value:i,type:r[0].replace(V," ")}),o=o.slice(i.length)),n.filter)(r=Y[s].exec(o))&&(!c[s]||(r=c[s](r)))&&(i=r.shift(),a.push({value:i,type:s,matches:r}),o=o.slice(i.length));if(!i)break}return t?o.length:o?eo.error(e):M(e,l).slice(0)},o=eo.compile=function(e,t){var i,r,a,o,l=[],h=[],u=E[e+" "];if(!u){for(t||(t=s(e)),o=t.length;o--;)(u=function e(t){for(var i,r,a,s=t.length,o=n.relative[t[0].type],l=o||n.relative[" "],h=o?1:0,u=ey(function(e){return e===i},l,!0),d=ey(function(e){return O(i,e)>-1},l,!0),p=[function(e,t,n){var r=!o&&(n||t!==c)||((i=t).nodeType?u(e,t,n):d(e,t,n));return i=null,r}];h<s;h++)if(r=n.relative[t[h].type])p=[ey(ex(p),r)];else{if((r=n.filter[t[h].type].apply(null,t[h].matches))[_]){for(a=++h;a<s&&!n.relative[t[a].type];a++);return function e(t,i,n,r,a,s){return r&&!r[_]&&(r=e(r)),a&&!a[_]&&(a=e(a,s)),ec(function(e,s,o,l){var c,h,u,d=[],p=[],f=s.length,m=e||function(e,t,i){for(var n=0,r=t.length;n<r;n++)eo(e,t[n],i);return i}(i||"*",o.nodeType?[o]:o,[]),g=t&&(e||!i)?e_(m,d,t,o,l):m,v=n?a||(e?t:f||r)?[]:s:g;if(n&&n(g,v,o,l),r)for(c=e_(v,p),r(c,[],o,l),h=c.length;h--;)(u=c[h])&&(v[p[h]]=!(g[p[h]]=u));if(e){if(a||t){if(a){for(c=[],h=v.length;h--;)(u=v[h])&&c.push(g[h]=u);a(null,v=[],c,l)}for(h=v.length;h--;)(u=v[h])&&(c=a?O(e,u):d[h])>-1&&(e[c]=!(s[c]=u))}}else v=e_(v===s?v.splice(f,v.length):v),a?a(null,s,v,l):D.apply(s,v)})}(h>1&&ex(p),h>1&&ev(t.slice(0,h-1).concat({value:" "===t[h-2].type?"*":""})).replace(V,"$1"),r,h<a&&e(t.slice(h,a)),a<s&&e(t=t.slice(a)),a<s&&ev(t))}p.push(r)}return ex(p)}(t[o]))[_]?l.push(u):h.push(u);(u=E(e,(i=l.length>0,r=h.length>0,a=function(e,t,a,s,o){var u,f,g,v=0,y="0",x=e&&[],_=[],A=c,S=e||r&&n.find.TAG("*",o),w=b+=null==A?1:Math.random()||.1,M=S.length;for(o&&(c=t==p||t||o);y!==M&&null!=(u=S[y]);y++){if(r&&u){for(f=0,t||u.ownerDocument==p||(d(u),a=!m);g=h[f++];)if(g(u,t||p,a)){s.push(u);break}o&&(b=w)}i&&((u=!g&&u)&&v--,e&&x.push(u))}if(v+=y,i&&y!==v){for(f=0;g=l[f++];)g(x,_,t,a);if(e){if(v>0)for(;y--;)x[y]||_[y]||(_[y]=I.call(s));_=e_(_)}D.apply(s,_),o&&!e&&_.length>0&&v+l.length>1&&eo.uniqueSort(s)}return o&&(b=w,c=A),x},i?ec(a):a))).selector=e}return u},l=eo.select=function(e,t,i,r){var a,l,c,h,u,d="function"==typeof e&&e,p=!r&&s(e=d.selector||e);if(i=i||[],1===p.length){if((l=p[0]=p[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&m&&n.relative[l[1].type]){if(!(t=(n.find.ID(c.matches[0].replace(et,ei),t)||[])[0]))return i;d&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(a=Y.needsContext.test(e)?0:l.length;a--&&(c=l[a],!n.relative[h=c.type]);)if((u=n.find[h])&&(r=u(c.matches[0].replace(et,ei),ee.test(l[0].type)&&em(t.parentNode)||t))){if(l.splice(a,1),!(e=r.length&&ev(l)))return D.apply(i,r),i;break}}return(d||o(e,p))(r,t,!m,i,!t||ee.test(e)&&em(t.parentNode)||t),i},i.sortStable=_.split("").sort(T).join("")===_,i.detectDuplicates=!!u,d(),i.sortDetached=eh(function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))}),eh(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||eu("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),i.attributes&&eh(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||eu("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),eh(function(e){return null==e.getAttribute("disabled")})||eu(N,function(e,t,i){var n;if(!i)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),eo}(e);b.find=w,b.expr=w.selectors,b.expr[":"]=b.expr.pseudos,b.uniqueSort=b.unique=w.uniqueSort,b.text=w.getText,b.isXMLDoc=w.isXML,b.contains=w.contains,b.escapeSelector=w.escape;var M=function(e,t,i){for(var n=[],r=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&b(e).is(i))break;n.push(e)}return n},E=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},C=b.expr.match.needsContext;function T(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var R=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function P(e,t,i){return m(t)?b.grep(e,function(e,n){return!!t.call(e,n,e)!==i}):t.nodeType?b.grep(e,function(e){return e===t!==i}):"string"!=typeof t?b.grep(e,function(e){return l.call(t,e)>-1!==i}):b.filter(t,e,i)}b.filter=function(e,t,i){var n=t[0];return(i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType)?b.find.matchesSelector(n,e)?[n]:[]:b.find.matches(e,b.grep(t,function(e){return 1===e.nodeType}))},b.fn.extend({find:function(e){var t,i,n=this.length,r=this;if("string"!=typeof e)return this.pushStack(b(e).filter(function(){for(t=0;t<n;t++)if(b.contains(r[t],this))return!0}));for(t=0,i=this.pushStack([]);t<n;t++)b.find(e,r[t],i);return n>1?b.uniqueSort(i):i},filter:function(e){return this.pushStack(P(this,e||[],!1))},not:function(e){return this.pushStack(P(this,e||[],!0))},is:function(e){return!!P(this,"string"==typeof e&&C.test(e)?b(e):e||[],!1).length}});var I,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(b.fn.init=function(e,t,i){var n,r;if(!e)return this;if(i=i||I,"string"==typeof e){if((n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:L.exec(e))&&(n[1]||!t)){if(!n[1])return(r=v.getElementById(n[2]))&&(this[0]=r,this.length=1),this;if(t=t instanceof b?t[0]:t,b.merge(this,b.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:v,!0)),R.test(n[1])&&b.isPlainObject(t))for(n in t)m(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e)}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==i.ready?i.ready(e):e(b):b.makeArray(e,this)}).prototype=b.fn,I=b(v);var D=/^(?:parents|prev(?:Until|All))/,B={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}b.fn.extend({has:function(e){var t=b(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(b.contains(this,t[e]))return!0})},closest:function(e,t){var i,n=0,r=this.length,a=[],s="string"!=typeof e&&b(e);if(!C.test(e)){for(;n<r;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&b.find.matchesSelector(i,e))){a.push(i);break}}return this.pushStack(a.length>1?b.uniqueSort(a):a)},index:function(e){return e?"string"==typeof e?l.call(b(e),this[0]):l.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(b.uniqueSort(b.merge(this.get(),b(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return M(e,"parentNode")},parentsUntil:function(e,t,i){return M(e,"parentNode",i)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return M(e,"nextSibling")},prevAll:function(e){return M(e,"previousSibling")},nextUntil:function(e,t,i){return M(e,"nextSibling",i)},prevUntil:function(e,t,i){return M(e,"previousSibling",i)},siblings:function(e){return E((e.parentNode||{}).firstChild,e)},children:function(e){return E(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(T(e,"template")&&(e=e.content||e),b.merge([],e.childNodes))}},function(e,t){b.fn[e]=function(i,n){var r=b.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=b.filter(n,r)),this.length>1&&(B[e]||b.uniqueSort(r),D.test(e)&&r.reverse()),this.pushStack(r)}});var N=/[^\x20\t\r\n\f]+/g;function U(e){return e}function F(e){throw e}function k(e,t,i,n){var r;try{e&&m(r=e.promise)?r.call(e).done(t).fail(i):e&&m(r=e.then)?r.call(e,t,i):t.apply(void 0,[e].slice(n))}catch(e){i.apply(void 0,[e])}}b.Callbacks=function(e){e="string"==typeof e?(t=e,i={},b.each(t.match(N)||[],function(e,t){i[t]=!0}),i):b.extend({},e);var t,i,n,r,a,s,o=[],l=[],c=-1,h=function(){for(s=s||e.once,a=n=!0;l.length;c=-1)for(r=l.shift();++c<o.length;)!1===o[c].apply(r[0],r[1])&&e.stopOnFalse&&(c=o.length,r=!1);e.memory||(r=!1),n=!1,s&&(o=r?[]:"")},u={add:function(){return o&&(r&&!n&&(c=o.length-1,l.push(r)),function t(i){b.each(i,function(i,n){m(n)?e.unique&&u.has(n)||o.push(n):n&&n.length&&"string"!==_(n)&&t(n)})}(arguments),r&&!n&&h()),this},remove:function(){return b.each(arguments,function(e,t){for(var i;(i=b.inArray(t,o,i))>-1;)o.splice(i,1),i<=c&&c--}),this},has:function(e){return e?b.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return s=l=[],o=r="",this},disabled:function(){return!o},lock:function(){return s=l=[],r||n||(o=r=""),this},locked:function(){return!!s},fireWith:function(e,t){return s||(t=[e,(t=t||[]).slice?t.slice():t],l.push(t),n||h()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!a}};return u},b.extend({Deferred:function(t){var i=[["notify","progress",b.Callbacks("memory"),b.Callbacks("memory"),2],["resolve","done",b.Callbacks("once memory"),b.Callbacks("once memory"),0,"resolved"],["reject","fail",b.Callbacks("once memory"),b.Callbacks("once memory"),1,"rejected"]],n="pending",r={state:function(){return n},always:function(){return a.done(arguments).fail(arguments),this},catch:function(e){return r.then(null,e)},pipe:function(){var e=arguments;return b.Deferred(function(t){b.each(i,function(i,n){var r=m(e[n[4]])&&e[n[4]];a[n[1]](function(){var e=r&&r.apply(this,arguments);e&&m(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[n[0]+"With"](this,r?[e]:arguments)})}),e=null}).promise()},then:function(t,n,r){var a=0;function s(t,i,n,r){return function(){var o=this,l=arguments,c=function(){var e,c;if(!(t<a)){if((e=n.apply(o,l))===i.promise())throw TypeError("Thenable self-resolution");m(c=e&&("object"==typeof e||"function"==typeof e)&&e.then)?r?c.call(e,s(a,i,U,r),s(a,i,F,r)):(a++,c.call(e,s(a,i,U,r),s(a,i,F,r),s(a,i,U,i.notifyWith))):(n!==U&&(o=void 0,l=[e]),(r||i.resolveWith)(o,l))}},h=r?c:function(){try{c()}catch(e){b.Deferred.exceptionHook&&b.Deferred.exceptionHook(e,h.stackTrace),t+1>=a&&(n!==F&&(o=void 0,l=[e]),i.rejectWith(o,l))}};t?h():(b.Deferred.getStackHook&&(h.stackTrace=b.Deferred.getStackHook()),e.setTimeout(h))}}return b.Deferred(function(e){i[0][3].add(s(0,e,m(r)?r:U,e.notifyWith)),i[1][3].add(s(0,e,m(t)?t:U)),i[2][3].add(s(0,e,m(n)?n:F))}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},a={};return b.each(i,function(e,t){var s=t[2],o=t[5];r[t[1]]=s.add,o&&s.add(function(){n=o},i[3-e][2].disable,i[3-e][3].disable,i[0][2].lock,i[0][3].lock),s.add(t[3].fire),a[t[0]]=function(){return a[t[0]+"With"](this===a?void 0:this,arguments),this},a[t[0]+"With"]=s.fireWith}),r.promise(a),t&&t.call(a,a),a},when:function(e){var t=arguments.length,i=t,n=Array(i),r=a.call(arguments),s=b.Deferred(),o=function(e){return function(i){n[e]=this,r[e]=arguments.length>1?a.call(arguments):i,--t||s.resolveWith(n,r)}};if(t<=1&&(k(e,s.done(o(i)).resolve,s.reject,!t),"pending"===s.state()||m(r[i]&&r[i].then)))return s.then();for(;i--;)k(r[i],o(i),s.reject);return s.promise()}});var z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;b.Deferred.exceptionHook=function(t,i){e.console&&e.console.warn&&t&&z.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,i)},b.readyException=function(t){e.setTimeout(function(){throw t})};var H=b.Deferred();function V(){v.removeEventListener("DOMContentLoaded",V),e.removeEventListener("load",V),b.ready()}b.fn.ready=function(e){return H.then(e).catch(function(e){b.readyException(e)}),this},b.extend({isReady:!1,readyWait:1,ready:function(e){if(!(!0===e?--b.readyWait:b.isReady))b.isReady=!0,!(!0!==e&&--b.readyWait>0)&&H.resolveWith(v,[b])}}),b.ready.then=H.then,"complete"!==v.readyState&&("loading"===v.readyState||v.documentElement.doScroll)?(v.addEventListener("DOMContentLoaded",V),e.addEventListener("load",V)):e.setTimeout(b.ready);var G=function(e,t,i,n,r,a,s){var o=0,l=e.length,c=null==i;if("object"===_(i))for(o in r=!0,i)G(e,t,o,i[o],!0,a,s);else if(void 0!==n&&(r=!0,m(n)||(s=!0),c&&(s?(t.call(e,n),t=null):(c=t,t=function(e,t,i){return c.call(b(e),i)})),t))for(;o<l;o++)t(e[o],i,s?n:n.call(e[o],o,t(e[o],i)));return r?e:c?t.call(e):l?t(e[0],i):a},W=/^-ms-/,j=/-([a-z])/g;function q(e,t){return t.toUpperCase()}function X(e){return e.replace(W,"ms-").replace(j,q)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function K(){this.expando=b.expando+K.uid++}K.uid=1,K.prototype={cache:function(e){var t=e[this.expando];return!t&&(t={},Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var n,r=this.cache(e);if("string"==typeof t)r[X(t)]=i;else for(n in t)r[X(n)]=t[n];return r},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n=e[this.expando];if(void 0!==n){if(void 0!==t)for(i=(t=Array.isArray(t)?t.map(X):((t=X(t))in n)?[t]:t.match(N)||[]).length;i--;)delete n[t[i]];(void 0===t||b.isEmptyObject(n))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!b.isEmptyObject(t)}};var Q=new K,J=new K,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,$=/[A-Z]/g;function ee(e,t,i){var n,r;if(void 0===i&&1===e.nodeType){if(n="data-"+t.replace($,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(n))){try{r=i,i="true"===r||"false"!==r&&("null"===r?null:r===+r+""?+r:Z.test(r)?JSON.parse(r):r)}catch(e){}J.set(e,t,i)}else i=void 0}return i}b.extend({hasData:function(e){return J.hasData(e)||Q.hasData(e)},data:function(e,t,i){return J.access(e,t,i)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,i){return Q.access(e,t,i)},_removeData:function(e,t){Q.remove(e,t)}}),b.fn.extend({data:function(e,t){var i,n,r,a=this[0],s=a&&a.attributes;if(void 0===e){if(this.length&&(r=J.get(a),1===a.nodeType&&!Q.get(a,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&0===(n=s[i].name).indexOf("data-")&&ee(a,n=X(n.slice(5)),r[n]);Q.set(a,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each(function(){J.set(this,e)}):G(this,function(t){var i;if(a&&void 0===t)return void 0!==(i=J.get(a,e))||void 0!==(i=ee(a,e))?i:void 0;this.each(function(){J.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),b.extend({queue:function(e,t,i){var n;if(e)return t=(t||"fx")+"queue",n=Q.get(e,t),i&&(!n||Array.isArray(i)?n=Q.access(e,t,b.makeArray(i)):n.push(i)),n||[]},dequeue:function(e,t){t=t||"fx";var i=b.queue(e,t),n=i.length,r=i.shift(),a=b._queueHooks(e,t);"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete a.stop,r.call(e,function(){b.dequeue(e,t)},a)),!n&&a&&a.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return Q.get(e,i)||Q.access(e,i,{empty:b.Callbacks("once memory").add(function(){Q.remove(e,[t+"queue",i])})})}}),b.fn.extend({queue:function(e,t){var i=2;return("string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i)?b.queue(this[0],e):void 0===t?this:this.each(function(){var i=b.queue(this,e,t);b._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=b.Deferred(),a=this,s=this.length,o=function(){--n||r.resolveWith(a,[a])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(i=Q.get(a[s],e+"queueHooks"))&&i.empty&&(n++,i.empty.add(o));return o(),r.promise(t)}});var et=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ei=RegExp("^(?:([+-])=|)("+et+")([a-z%]*)$","i"),en=["Top","Right","Bottom","Left"],er=v.documentElement,ea=function(e){return b.contains(e.ownerDocument,e)},es={composed:!0};er.getRootNode&&(ea=function(e){return b.contains(e.ownerDocument,e)||e.getRootNode(es)===e.ownerDocument});var eo=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ea(e)&&"none"===b.css(e,"display")};function el(e,t,i,n){var r,a,s=20,o=n?function(){return n.cur()}:function(){return b.css(e,t,"")},l=o(),c=i&&i[3]||(b.cssNumber[t]?"":"px"),h=e.nodeType&&(b.cssNumber[t]||"px"!==c&&+l)&&ei.exec(b.css(e,t));if(h&&h[3]!==c){for(l/=2,c=c||h[3],h=+l||1;s--;)b.style(e,t,h+c),(1-a)*(1-(a=o()/l||.5))<=0&&(s=0),h/=a;h*=2,b.style(e,t,h+c),i=i||[]}return i&&(h=+h||+l||0,r=i[1]?h+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=h,n.end=r)),r}var ec={};function eh(e,t){for(var i,n,r=[],a=0,s=e.length;a<s;a++)(n=e[a]).style&&(i=n.style.display,t?("none"!==i||(r[a]=Q.get(n,"display")||null,r[a]||(n.style.display="")),""===n.style.display&&eo(n)&&(r[a]=function(e){var t,i=e.ownerDocument,n=e.nodeName,r=ec[n];return r||(t=i.body.appendChild(i.createElement(n)),r=b.css(t,"display"),t.parentNode.removeChild(t),"none"===r&&(r="block"),ec[n]=r),r}(n))):"none"!==i&&(r[a]="none",Q.set(n,"display",i)));for(a=0;a<s;a++)null!=r[a]&&(e[a].style.display=r[a]);return e}b.fn.extend({show:function(){return eh(this,!0)},hide:function(){return eh(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){eo(this)?b(this).show():b(this).hide()})}});var eu=/^(?:checkbox|radio)$/i,ed=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ep=/^$|^module$|\/(?:java|ecma)script/i;eZ=v.createDocumentFragment().appendChild(v.createElement("div")),(e$=v.createElement("input")).setAttribute("type","radio"),e$.setAttribute("checked","checked"),e$.setAttribute("name","t"),eZ.appendChild(e$),f.checkClone=eZ.cloneNode(!0).cloneNode(!0).lastChild.checked,eZ.innerHTML="<textarea>x</textarea>",f.noCloneChecked=!!eZ.cloneNode(!0).lastChild.defaultValue,eZ.innerHTML="<option></option>",f.option=!!eZ.lastChild;var ef={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function em(e,t){var i;return(i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&T(e,t))?b.merge([e],i):i}function eg(e,t){for(var i=0,n=e.length;i<n;i++)Q.set(e[i],"globalEval",!t||Q.get(t[i],"globalEval"))}ef.tbody=ef.tfoot=ef.colgroup=ef.caption=ef.thead,ef.th=ef.td,f.option||(ef.optgroup=ef.option=[1,"<select multiple='multiple'>","</select>"]);var ev=/<|&#?\w+;/;function ey(e,t,i,n,r){for(var a,s,o,l,c,h=t.createDocumentFragment(),u=[],d=0,p=e.length;d<p;d++)if((a=e[d])||0===a){if("object"===_(a))b.merge(u,a.nodeType?[a]:a);else if(ev.test(a)){for(s=s||h.appendChild(t.createElement("div")),o=ef[(ed.exec(a)||["",""])[1].toLowerCase()]||ef._default,s.innerHTML=o[1]+b.htmlPrefilter(a)+o[2],c=o[0];c--;)s=s.lastChild;b.merge(u,s.childNodes),(s=h.firstChild).textContent=""}else u.push(t.createTextNode(a))}for(h.textContent="",d=0;a=u[d++];){if(n&&b.inArray(a,n)>-1){r&&r.push(a);continue}if(l=ea(a),s=em(h.appendChild(a),"script"),l&&eg(s),i)for(c=0;a=s[c++];)ep.test(a.type||"")&&i.push(a)}return h}var ex=/^([^.]*)(?:\.(.+)|)/;function e_(){return!0}function eA(){return!1}function eb(e,t){return e===function(){try{return v.activeElement}catch(e){}}()==("focus"===t)}function eS(e,t,i,n,r,a){var s,o;if("object"==typeof t){for(o in"string"!=typeof i&&(n=n||i,i=void 0),t)eS(e,o,i,n,t[o],a);return e}if(null==n&&null==r?(r=i,n=i=void 0):null==r&&("string"==typeof i?(r=n,n=void 0):(r=n,n=i,i=void 0)),!1===r)r=eA;else if(!r)return e;return 1===a&&(s=r,(r=function(e){return b().off(e),s.apply(this,arguments)}).guid=s.guid||(s.guid=b.guid++)),e.each(function(){b.event.add(this,t,r,n,i)})}function ew(e,t,i){if(!i){void 0===Q.get(e,t)&&b.event.add(e,t,e_);return}Q.set(e,t,!1),b.event.add(e,t,{namespace:!1,handler:function(e){var n,r,s=Q.get(this,t);if(1&e.isTrigger&&this[t]){if(s.length)(b.event.special[t]||{}).delegateType&&e.stopPropagation();else if(s=a.call(arguments),Q.set(this,t,s),n=i(this,t),this[t](),s!==(r=Q.get(this,t))||n?Q.set(this,t,!1):r={},s!==r)return e.stopImmediatePropagation(),e.preventDefault(),r&&r.value}else s.length&&(Q.set(this,t,{value:b.event.trigger(b.extend(s[0],b.Event.prototype),s.slice(1),this)}),e.stopImmediatePropagation())}})}b.event={global:{},add:function(e,t,i,n,r){var a,s,o,l,c,h,u,d,p,f,m,g=Q.get(e);if(Y(e))for(i.handler&&(i=(a=i).handler,r=a.selector),r&&b.find.matchesSelector(er,r),i.guid||(i.guid=b.guid++),(l=g.events)||(l=g.events=Object.create(null)),(s=g.handle)||(s=g.handle=function(t){return b.event.triggered!==t.type?b.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(N)||[""]).length;c--;)p=m=(o=ex.exec(t[c])||[])[1],f=(o[2]||"").split(".").sort(),p&&(u=b.event.special[p]||{},p=(r?u.delegateType:u.bindType)||p,u=b.event.special[p]||{},h=b.extend({type:p,origType:m,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&b.expr.match.needsContext.test(r),namespace:f.join(".")},a),(d=l[p])||((d=l[p]=[]).delegateCount=0,(!u.setup||!1===u.setup.call(e,n,f,s))&&e.addEventListener&&e.addEventListener(p,s)),u.add&&(u.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,h):d.push(h),b.event.global[p]=!0)},remove:function(e,t,i,n,r){var a,s,o,l,c,h,u,d,p,f,m,g=Q.hasData(e)&&Q.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(N)||[""]).length;c--;){if(p=m=(o=ex.exec(t[c])||[])[1],f=(o[2]||"").split(".").sort(),!p){for(p in l)b.event.remove(e,p+t[c],i,n,!0);continue}for(u=b.event.special[p]||{},d=l[p=(n?u.delegateType:u.bindType)||p]||[],o=o[2]&&RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=a=d.length;a--;)h=d[a],(r||m===h.origType)&&(!i||i.guid===h.guid)&&(!o||o.test(h.namespace))&&(!n||n===h.selector||"**"===n&&h.selector)&&(d.splice(a,1),h.selector&&d.delegateCount--,u.remove&&u.remove.call(e,h));s&&!d.length&&(u.teardown&&!1!==u.teardown.call(e,f,g.handle)||b.removeEvent(e,p,g.handle),delete l[p])}b.isEmptyObject(l)&&Q.remove(e,"handle events")}},dispatch:function(e){var t,i,n,r,a,s,o=Array(arguments.length),l=b.event.fix(e),c=(Q.get(this,"events")||Object.create(null))[l.type]||[],h=b.event.special[l.type]||{};for(t=1,o[0]=l;t<arguments.length;t++)o[t]=arguments[t];if(l.delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,l)){for(s=b.event.handlers.call(this,l,c),t=0;(r=s[t++])&&!l.isPropagationStopped();)for(l.currentTarget=r.elem,i=0;(a=r.handlers[i++])&&!l.isImmediatePropagationStopped();)(!l.rnamespace||!1===a.namespace||l.rnamespace.test(a.namespace))&&(l.handleObj=a,l.data=a.data,void 0!==(n=((b.event.special[a.origType]||{}).handle||a.handler).apply(r.elem,o))&&!1===(l.result=n)&&(l.preventDefault(),l.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,l),l.result}},handlers:function(e,t){var i,n,r,a,s,o=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1)){for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&!("click"===e.type&&!0===c.disabled)){for(i=0,a=[],s={};i<l;i++)void 0===s[r=(n=t[i]).selector+" "]&&(s[r]=n.needsContext?b(r,this).index(c)>-1:b.find(r,this,null,[c]).length),s[r]&&a.push(n);a.length&&o.push({elem:c,handlers:a})}}return c=this,l<t.length&&o.push({elem:c,handlers:t.slice(l)}),o},addProp:function(e,t){Object.defineProperty(b.Event.prototype,e,{enumerable:!0,configurable:!0,get:m(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[b.expando]?e:new b.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return eu.test(t.type)&&t.click&&T(t,"input")&&ew(t,"click",e_),!1},trigger:function(e){var t=this||e;return eu.test(t.type)&&t.click&&T(t,"input")&&ew(t,"click"),!0},_default:function(e){var t=e.target;return eu.test(t.type)&&t.click&&T(t,"input")&&Q.get(t,"click")||T(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},b.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},b.Event=function(e,t){if(!(this instanceof b.Event))return new b.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?e_:eA,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&b.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[b.expando]=!0},b.Event.prototype={constructor:b.Event,isDefaultPrevented:eA,isPropagationStopped:eA,isImmediatePropagationStopped:eA,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=e_,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=e_,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=e_,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},b.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},b.event.addProp),b.each({focus:"focusin",blur:"focusout"},function(e,t){b.event.special[e]={setup:function(){return ew(this,e,eb),!1},trigger:function(){return ew(this,e),!0},_default:function(){return!0},delegateType:t}}),b.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||b.contains(this,n))||(e.type=r.origType,i=r.handler.apply(this,arguments),e.type=t),i}}}),b.fn.extend({on:function(e,t,i,n){return eS(this,e,t,i,n)},one:function(e,t,i,n){return eS(this,e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,b(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return(!1===t||"function"==typeof t)&&(i=t,t=void 0),!1===i&&(i=eA),this.each(function(){b.event.remove(this,e,i,t)})}});var eM=/<script|<style|<link/i,eE=/checked\s*(?:[^=]|=\s*.checked.)/i,eC=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function eT(e,t){return T(e,"table")&&T(11!==t.nodeType?t:t.firstChild,"tr")&&b(e).children("tbody")[0]||e}function eR(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function eP(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function eI(e,t){var i,n,r,a,s,o;if(1===t.nodeType){if(Q.hasData(e)&&(o=Q.get(e).events))for(r in Q.remove(t,"handle events"),o)for(i=0,n=o[r].length;i<n;i++)b.event.add(t,r,o[r][i]);J.hasData(e)&&(a=J.access(e),s=b.extend({},a),J.set(t,s))}}function eL(e,t,i,n){t=s(t);var r,a,o,l,c,h,u=0,d=e.length,p=d-1,g=t[0],v=m(g);if(v||d>1&&"string"==typeof g&&!f.checkClone&&eE.test(g))return e.each(function(r){var a=e.eq(r);v&&(t[0]=g.call(this,r,a.html())),eL(a,t,i,n)});if(d&&(a=(r=ey(t,e[0].ownerDocument,!1,e,n)).firstChild,1===r.childNodes.length&&(r=a),a||n)){for(l=(o=b.map(em(r,"script"),eR)).length;u<d;u++)c=r,u!==p&&(c=b.clone(c,!0,!0),l&&b.merge(o,em(c,"script"))),i.call(e[u],c,u);if(l)for(h=o[o.length-1].ownerDocument,b.map(o,eP),u=0;u<l;u++)c=o[u],ep.test(c.type||"")&&!Q.access(c,"globalEval")&&b.contains(h,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?b._evalUrl&&!c.noModule&&b._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},h):x(c.textContent.replace(eC,""),c,h))}return e}function eD(e,t,i){for(var n,r=t?b.filter(t,e):e,a=0;null!=(n=r[a]);a++)i||1!==n.nodeType||b.cleanData(em(n)),n.parentNode&&(i&&ea(n)&&eg(em(n,"script")),n.parentNode.removeChild(n));return e}b.extend({htmlPrefilter:function(e){return e},clone:function(e,t,i){var n,r,a,s,o=e.cloneNode(!0),l=ea(e);if(!f.noCloneChecked&&(1===e.nodeType||11===e.nodeType)&&!b.isXMLDoc(e))for(n=0,s=em(o),r=(a=em(e)).length;n<r;n++)!function(e,t){var i=t.nodeName.toLowerCase();"input"===i&&eu.test(e.type)?t.checked=e.checked:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}(a[n],s[n]);if(t){if(i)for(n=0,a=a||em(e),s=s||em(o),r=a.length;n<r;n++)eI(a[n],s[n]);else eI(e,o)}return(s=em(o,"script")).length>0&&eg(s,!l&&em(e,"script")),o},cleanData:function(e){for(var t,i,n,r=b.event.special,a=0;void 0!==(i=e[a]);a++)if(Y(i)){if(t=i[Q.expando]){if(t.events)for(n in t.events)r[n]?b.event.remove(i,n):b.removeEvent(i,n,t.handle);i[Q.expando]=void 0}i[J.expando]&&(i[J.expando]=void 0)}}}),b.fn.extend({detach:function(e){return eD(this,e,!0)},remove:function(e){return eD(this,e)},text:function(e){return G(this,function(e){return void 0===e?b.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return eL(this,arguments,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&eT(this,e).appendChild(e)})},prepend:function(){return eL(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=eT(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return eL(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return eL(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(b.cleanData(em(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return G(this,function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!eM.test(e)&&!ef[(ed.exec(e)||["",""])[1].toLowerCase()]){e=b.htmlPrefilter(e);try{for(;i<n;i++)t=this[i]||{},1===t.nodeType&&(b.cleanData(em(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return eL(this,arguments,function(t){var i=this.parentNode;0>b.inArray(this,e)&&(b.cleanData(em(this)),i&&i.replaceChild(t,this))},e)}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){for(var i,n=[],r=b(e),a=r.length-1,s=0;s<=a;s++)i=s===a?this:this.clone(!0),b(r[s])[t](i),o.apply(n,i.get());return this.pushStack(n)}});var eB=RegExp("^("+et+")(?!px)[a-z%]+$","i"),eO=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)},eN=function(e,t,i){var n,r,a={};for(r in t)a[r]=e.style[r],e.style[r]=t[r];for(r in n=i.call(e),t)e.style[r]=a[r];return n},eU=RegExp(en.join("|"),"i");function eF(e,t,i){var n,r,a,s,o=e.style;return(i=i||eO(e))&&(""!==(s=i.getPropertyValue(t)||i[t])||ea(e)||(s=b.style(e,t)),!f.pixelBoxStyles()&&eB.test(s)&&eU.test(t)&&(n=o.width,r=o.minWidth,a=o.maxWidth,o.minWidth=o.maxWidth=o.width=s,s=i.width,o.width=n,o.minWidth=r,o.maxWidth=a)),void 0!==s?s+"":s}function ek(e,t){return{get:function(){if(e()){delete this.get;return}return(this.get=t).apply(this,arguments)}}}!function(){function t(){if(h){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",h.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",er.appendChild(c).appendChild(h);var t=e.getComputedStyle(h);n="1%"!==t.top,l=12===i(t.marginLeft),h.style.right="60%",s=36===i(t.right),r=36===i(t.width),h.style.position="absolute",a=12===i(h.offsetWidth/3),er.removeChild(c),h=null}}function i(e){return Math.round(parseFloat(e))}var n,r,a,s,o,l,c=v.createElement("div"),h=v.createElement("div");h.style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",f.clearCloneStyle="content-box"===h.style.backgroundClip,b.extend(f,{boxSizingReliable:function(){return t(),r},pixelBoxStyles:function(){return t(),s},pixelPosition:function(){return t(),n},reliableMarginLeft:function(){return t(),l},scrollboxSize:function(){return t(),a},reliableTrDimensions:function(){var t,i,n,r;return null==o&&(t=v.createElement("table"),i=v.createElement("tr"),n=v.createElement("div"),t.style.cssText="position:absolute;left:-11111px;border-collapse:separate",i.style.cssText="border:1px solid",i.style.height="1px",n.style.height="9px",n.style.display="block",er.appendChild(t).appendChild(i).appendChild(n),o=parseInt((r=e.getComputedStyle(i)).height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===i.offsetHeight,er.removeChild(t)),o}}))}();var ez=["Webkit","Moz","ms"],eH=v.createElement("div").style,eV={};function eG(e){var t=b.cssProps[e]||eV[e];return t||(e in eH?e:eV[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),i=ez.length;i--;)if((e=ez[i]+t)in eH)return e}(e)||e)}var eW=/^(none|table(?!-c[ea]).+)/,ej=/^--/,eq={position:"absolute",visibility:"hidden",display:"block"},eX={letterSpacing:"0",fontWeight:"400"};function eY(e,t,i){var n=ei.exec(t);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):t}function eK(e,t,i,n,r,a){var s="width"===t?1:0,o=0,l=0;if(i===(n?"border":"content"))return 0;for(;s<4;s+=2)"margin"===i&&(l+=b.css(e,i+en[s],!0,r)),n?("content"===i&&(l-=b.css(e,"padding"+en[s],!0,r)),"margin"!==i&&(l-=b.css(e,"border"+en[s]+"Width",!0,r))):(l+=b.css(e,"padding"+en[s],!0,r),"padding"!==i?l+=b.css(e,"border"+en[s]+"Width",!0,r):o+=b.css(e,"border"+en[s]+"Width",!0,r));return!n&&a>=0&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-a-l-o-.5))||0),l}function eQ(e,t,i){var n=eO(e),r=(!f.boxSizingReliable()||i)&&"border-box"===b.css(e,"boxSizing",!1,n),a=r,s=eF(e,t,n),o="offset"+t[0].toUpperCase()+t.slice(1);if(eB.test(s)){if(!i)return s;s="auto"}return(!f.boxSizingReliable()&&r||!f.reliableTrDimensions()&&T(e,"tr")||"auto"===s||!parseFloat(s)&&"inline"===b.css(e,"display",!1,n))&&e.getClientRects().length&&(r="border-box"===b.css(e,"boxSizing",!1,n),(a=o in e)&&(s=e[o])),(s=parseFloat(s)||0)+eK(e,t,i||(r?"border":"content"),a,n,s)+"px"}function eJ(e,t,i,n,r){return new eJ.prototype.init(e,t,i,n,r)}b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=eF(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,a,s,o=X(t),l=ej.test(t),c=e.style;if(l||(t=eG(o)),s=b.cssHooks[t]||b.cssHooks[o],void 0===i)return s&&"get"in s&&void 0!==(r=s.get(e,!1,n))?r:c[t];if("string"==(a=typeof i)&&(r=ei.exec(i))&&r[1]&&(i=el(e,t,r),a="number"),null!=i&&i==i)"number"!==a||l||(i+=r&&r[3]||(b.cssNumber[o]?"":"px")),f.clearCloneStyle||""!==i||0!==t.indexOf("background")||(c[t]="inherit"),s&&"set"in s&&void 0===(i=s.set(e,i,n))||(l?c.setProperty(t,i):c[t]=i)}},css:function(e,t,i,n){var r,a,s,o=X(t);return(ej.test(t)||(t=eG(o)),(s=b.cssHooks[t]||b.cssHooks[o])&&"get"in s&&(r=s.get(e,!0,i)),void 0===r&&(r=eF(e,t,n)),"normal"===r&&t in eX&&(r=eX[t]),""===i||i)?(a=parseFloat(r),!0===i||isFinite(a)?a||0:r):r}}),b.each(["height","width"],function(e,t){b.cssHooks[t]={get:function(e,i,n){if(i)return!eW.test(b.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?eQ(e,t,n):eN(e,eq,function(){return eQ(e,t,n)})},set:function(e,i,n){var r,a=eO(e),s=!f.scrollboxSize()&&"absolute"===a.position,o=(s||n)&&"border-box"===b.css(e,"boxSizing",!1,a),l=n?eK(e,t,n,o,a):0;return o&&s&&(l-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(a[t])-eK(e,t,"border",!1,a)-.5)),l&&(r=ei.exec(i))&&"px"!==(r[3]||"px")&&(e.style[t]=i,i=b.css(e,t)),eY(e,i,l)}}}),b.cssHooks.marginLeft=ek(f.reliableMarginLeft,function(e,t){if(t)return(parseFloat(eF(e,"marginLeft"))||e.getBoundingClientRect().left-eN(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(i){for(var n=0,r={},a="string"==typeof i?i.split(" "):[i];n<4;n++)r[e+en[n]+t]=a[n]||a[n-2]||a[0];return r}},"margin"!==e&&(b.cssHooks[e+t].set=eY)}),b.fn.extend({css:function(e,t){return G(this,function(e,t,i){var n,r,a={},s=0;if(Array.isArray(t)){for(n=eO(e),r=t.length;s<r;s++)a[t[s]]=b.css(e,t[s],!1,n);return a}return void 0!==i?b.style(e,t,i):b.css(e,t)},e,t,arguments.length>1)}}),b.Tween=eJ,eJ.prototype={constructor:eJ,init:function(e,t,i,n,r,a){this.elem=e,this.prop=i,this.easing=r||b.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=a||(b.cssNumber[i]?"":"px")},cur:function(){var e=eJ.propHooks[this.prop];return e&&e.get?e.get(this):eJ.propHooks._default.get(this)},run:function(e){var t,i=eJ.propHooks[this.prop];return this.options.duration?this.pos=t=b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):eJ.propHooks._default.set(this),this}},eJ.prototype.init.prototype=eJ.prototype,eJ.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=b.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):1===e.elem.nodeType&&(b.cssHooks[e.prop]||null!=e.elem.style[eG(e.prop)])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},eJ.propHooks.scrollTop=eJ.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.easing={linear:function(e){return e},swing:function(e){return .5-Math.cos(e*Math.PI)/2},_default:"swing"},b.fx=eJ.prototype.init,b.fx.step={};var eZ,e$,e0,e1,e2=/^(?:toggle|show|hide)$/,e3=/queueHooks$/;function e4(){return e.setTimeout(function(){e0=void 0}),e0=Date.now()}function e5(e,t){var i,n=0,r={height:e};for(t=t?1:0;n<4;n+=2-t)r["margin"+(i=en[n])]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}function e6(e,t,i){for(var n,r=(e8.tweeners[t]||[]).concat(e8.tweeners["*"]),a=0,s=r.length;a<s;a++)if(n=r[a].call(i,t,e))return n}function e8(e,t,i){var n,r,a=0,s=e8.prefilters.length,o=b.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=e0||e4(),i=Math.max(0,c.startTime+c.duration-t),n=1-(i/c.duration||0),a=0,s=c.tweens.length;a<s;a++)c.tweens[a].run(n);return(o.notifyWith(e,[c,n,i]),n<1&&s)?i:(s||o.notifyWith(e,[c,1,0]),o.resolveWith(e,[c]),!1)},c=o.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{},easing:b.easing._default},i),originalProperties:t,originalOptions:i,startTime:e0||e4(),duration:i.duration,tweens:[],createTween:function(t,i){var n=b.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(n),n},stop:function(t){var i=0,n=t?c.tweens.length:0;if(r)return this;for(r=!0;i<n;i++)c.tweens[i].run(1);return t?(o.notifyWith(e,[c,1,0]),o.resolveWith(e,[c,t])):o.rejectWith(e,[c,t]),this}}),h=c.props;for(function(e,t){var i,n,r,a,s;for(i in e)if(r=t[n=X(i)],Array.isArray(a=e[i])&&(r=a[1],a=e[i]=a[0]),i!==n&&(e[n]=a,delete e[i]),(s=b.cssHooks[n])&&"expand"in s)for(i in a=s.expand(a),delete e[n],a)i in e||(e[i]=a[i],t[i]=r);else t[n]=r}(h,c.opts.specialEasing);a<s;a++)if(n=e8.prefilters[a].call(c,e,h,c.opts))return m(n.stop)&&(b._queueHooks(c.elem,c.opts.queue).stop=n.stop.bind(n)),n;return b.map(h,e6,c),m(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),b.fx.timer(b.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}b.Animation=b.extend(e8,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return el(i.elem,e,ei.exec(t),i),i}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(N);for(var i,n=0,r=e.length;n<r;n++)i=e[n],e8.tweeners[i]=e8.tweeners[i]||[],e8.tweeners[i].unshift(t)},prefilters:[function(e,t,i){var n,r,a,s,o,l,c,h,u="width"in t||"height"in t,d=this,p={},f=e.style,m=e.nodeType&&eo(e),g=Q.get(e,"fxshow");for(n in i.queue||(null==(s=b._queueHooks(e,"fx")).unqueued&&(s.unqueued=0,o=s.empty.fire,s.empty.fire=function(){s.unqueued||o()}),s.unqueued++,d.always(function(){d.always(function(){s.unqueued--,b.queue(e,"fx").length||s.empty.fire()})})),t)if(r=t[n],e2.test(r)){if(delete t[n],a=a||"toggle"===r,r===(m?"hide":"show")){if("show"!==r||!g||void 0===g[n])continue;m=!0}p[n]=g&&g[n]||b.style(e,n)}if(!(!(l=!b.isEmptyObject(t))&&b.isEmptyObject(p)))for(n in u&&1===e.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=g&&g.display)&&(c=Q.get(e,"display")),"none"===(h=b.css(e,"display"))&&(c?h=c:(eh([e],!0),c=e.style.display||c,h=b.css(e,"display"),eh([e]))),("inline"===h||"inline-block"===h&&null!=c)&&"none"===b.css(e,"float")&&(l||(d.done(function(){f.display=c}),null!=c||(c="none"===(h=f.display)?"":h)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",d.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]})),l=!1,p)l||(g?"hidden"in g&&(m=g.hidden):g=Q.access(e,"fxshow",{display:c}),a&&(g.hidden=!m),m&&eh([e],!0),d.done(function(){for(n in m||eh([e]),Q.remove(e,"fxshow"),p)b.style(e,n,p[n])})),l=e6(m?g[n]:0,n,d),n in g||(g[n]=l.start,m&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?e8.prefilters.unshift(e):e8.prefilters.push(e)}}),b.speed=function(e,t,i){var n=e&&"object"==typeof e?b.extend({},e):{complete:i||!i&&t||m(e)&&e,duration:e,easing:i&&t||t&&!m(t)&&t};return b.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in b.fx.speeds?n.duration=b.fx.speeds[n.duration]:n.duration=b.fx.speeds._default),(null==n.queue||!0===n.queue)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){m(n.old)&&n.old.call(this),n.queue&&b.dequeue(this,n.queue)},n},b.fn.extend({fadeTo:function(e,t,i,n){return this.filter(eo).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=b.isEmptyObject(e),a=b.speed(t,i,n),s=function(){var t=e8(this,b.extend({},e),a);(r||Q.get(this,"finish"))&&t.stop(!0)};return s.finish=s,r||!1===a.queue?this.each(s):this.queue(a.queue,s)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",a=b.timers,s=Q.get(this);if(r)s[r]&&s[r].stop&&n(s[r]);else for(r in s)s[r]&&s[r].stop&&e3.test(r)&&n(s[r]);for(r=a.length;r--;)a[r].elem===this&&(null==e||a[r].queue===e)&&(a[r].anim.stop(i),t=!1,a.splice(r,1));(t||!i)&&b.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,i=Q.get(this),n=i[e+"queue"],r=i[e+"queueHooks"],a=b.timers,s=n?n.length:0;for(i.finish=!0,b.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;t<s;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),b.each(["toggle","show","hide"],function(e,t){var i=b.fn[t];b.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(e5(t,!0),e,n,r)}}),b.each({slideDown:e5("show"),slideUp:e5("hide"),slideToggle:e5("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),b.timers=[],b.fx.tick=function(){var e,t=0,i=b.timers;for(e0=Date.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||b.fx.stop(),e0=void 0},b.fx.timer=function(e){b.timers.push(e),b.fx.start()},b.fx.interval=13,b.fx.start=function(){!e1&&(e1=!0,function t(){e1&&(!1===v.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(t):e.setTimeout(t,b.fx.interval),b.fx.tick())}())},b.fx.stop=function(){e1=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fn.delay=function(t,i){return t=b.fx&&b.fx.speeds[t]||t,i=i||"fx",this.queue(i,function(i,n){var r=e.setTimeout(i,t);n.stop=function(){e.clearTimeout(r)}})},e9=v.createElement("input"),e7=v.createElement("select").appendChild(v.createElement("option")),e9.type="checkbox",f.checkOn=""!==e9.value,f.optSelected=e7.selected,(e9=v.createElement("input")).value="t",e9.type="radio",f.radioValue="t"===e9.value;var e9,e7,te,tt=b.expr.attrHandle;b.fn.extend({attr:function(e,t){return G(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})}}),b.extend({attr:function(e,t,i){var n,r,a=e.nodeType;if(3!==a&&8!==a&&2!==a){if(void 0===e.getAttribute)return b.prop(e,t,i);if(1===a&&b.isXMLDoc(e)||(r=b.attrHooks[t.toLowerCase()]||(b.expr.match.bool.test(t)?te:void 0)),void 0!==i){if(null===i){b.removeAttr(e,t);return}return r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:(e.setAttribute(t,i+""),i)}return r&&"get"in r&&null!==(n=r.get(e,t))?n:null==(n=b.find.attr(e,t))?void 0:n}},attrHooks:{type:{set:function(e,t){if(!f.radioValue&&"radio"===t&&T(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,n=0,r=t&&t.match(N);if(r&&1===e.nodeType)for(;i=r[n++];)e.removeAttribute(i)}}),te={set:function(e,t,i){return!1===t?b.removeAttr(e,i):e.setAttribute(i,i),i}},b.each(b.expr.match.bool.source.match(/\w+/g),function(e,t){var i=tt[t]||b.find.attr;tt[t]=function(e,t,n){var r,a,s=t.toLowerCase();return n||(a=tt[s],tt[s]=r,r=null!=i(e,t,n)?s:null,tt[s]=a),r}});var ti=/^(?:input|select|textarea|button)$/i,tn=/^(?:a|area)$/i;function tr(e){return(e.match(N)||[]).join(" ")}function ta(e){return e.getAttribute&&e.getAttribute("class")||""}function ts(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(N)||[]}b.fn.extend({prop:function(e,t){return G(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[b.propFix[e]||e]})}}),b.extend({prop:function(e,t,i){var n,r,a=e.nodeType;if(3!==a&&8!==a&&2!==a)return(1===a&&b.isXMLDoc(e)||(t=b.propFix[t]||t,r=b.propHooks[t]),void 0!==i)?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:e[t]=i:r&&"get"in r&&null!==(n=r.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=b.find.attr(e,"tabindex");return t?parseInt(t,10):ti.test(e.nodeName)||tn.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),f.optSelected||(b.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),b.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){b.propFix[this.toLowerCase()]=this}),b.fn.extend({addClass:function(e){var t,i,n,r,a,s,o,l=0;if(m(e))return this.each(function(t){b(this).addClass(e.call(this,t,ta(this)))});if((t=ts(e)).length){for(;i=this[l++];)if(r=ta(i),n=1===i.nodeType&&" "+tr(r)+" "){for(s=0;a=t[s++];)0>n.indexOf(" "+a+" ")&&(n+=a+" ");r!==(o=tr(n))&&i.setAttribute("class",o)}}return this},removeClass:function(e){var t,i,n,r,a,s,o,l=0;if(m(e))return this.each(function(t){b(this).removeClass(e.call(this,t,ta(this)))});if(!arguments.length)return this.attr("class","");if((t=ts(e)).length){for(;i=this[l++];)if(r=ta(i),n=1===i.nodeType&&" "+tr(r)+" "){for(s=0;a=t[s++];)for(;n.indexOf(" "+a+" ")>-1;)n=n.replace(" "+a+" "," ");r!==(o=tr(n))&&i.setAttribute("class",o)}}return this},toggleClass:function(e,t){var i=typeof e,n="string"===i||Array.isArray(e);return"boolean"==typeof t&&n?t?this.addClass(e):this.removeClass(e):m(e)?this.each(function(i){b(this).toggleClass(e.call(this,i,ta(this),t),t)}):this.each(function(){var t,r,a,s;if(n)for(r=0,a=b(this),s=ts(e);t=s[r++];)a.hasClass(t)?a.removeClass(t):a.addClass(t);else(void 0===e||"boolean"===i)&&((t=ta(this))&&Q.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Q.get(this,"__className__")||""))})},hasClass:function(e){var t,i,n=0;for(t=" "+e+" ";i=this[n++];)if(1===i.nodeType&&(" "+tr(ta(i))+" ").indexOf(t)>-1)return!0;return!1}});var to=/\r/g;b.fn.extend({val:function(e){var t,i,n,r=this[0];if(!arguments.length)return r?(t=b.valHooks[r.type]||b.valHooks[r.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(r,"value"))?i:"string"==typeof(i=r.value)?i.replace(to,""):null==i?"":i:void 0;return n=m(e),this.each(function(i){var r;1===this.nodeType&&(null==(r=n?e.call(this,i,b(this).val()):e)?r="":"number"==typeof r?r+="":Array.isArray(r)&&(r=b.map(r,function(e){return null==e?"":e+""})),(t=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))})}}),b.extend({valHooks:{option:{get:function(e){var t=b.find.attr(e,"value");return null!=t?t:tr(b.text(e))}},select:{get:function(e){var t,i,n,r=e.options,a=e.selectedIndex,s="select-one"===e.type,o=s?null:[],l=s?a+1:r.length;for(n=a<0?l:s?a:0;n<l;n++)if(((i=r[n]).selected||n===a)&&!i.disabled&&(!i.parentNode.disabled||!T(i.parentNode,"optgroup"))){if(t=b(i).val(),s)return t;o.push(t)}return o},set:function(e,t){for(var i,n,r=e.options,a=b.makeArray(t),s=r.length;s--;)((n=r[s]).selected=b.inArray(b.valHooks.option.get(n),a)>-1)&&(i=!0);return i||(e.selectedIndex=-1),a}}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=b.inArray(b(e).val(),t)>-1}},f.checkOn||(b.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),f.focusin="onfocusin"in e;var tl=/^(?:focusinfocus|focusoutblur)$/,tc=function(e){e.stopPropagation()};b.extend(b.event,{trigger:function(t,i,n,r){var a,s,o,l,c,h,d,p,f=[n||v],y=u.call(t,"type")?t.type:t,x=u.call(t,"namespace")?t.namespace.split("."):[];if(s=p=o=n=n||v,!(3===n.nodeType||8===n.nodeType||tl.test(y+b.event.triggered))){if(y.indexOf(".")>-1&&(y=(x=y.split(".")).shift(),x.sort()),c=0>y.indexOf(":")&&"on"+y,(t=t[b.expando]?t:new b.Event(y,"object"==typeof t&&t)).isTrigger=r?2:3,t.namespace=x.join("."),t.rnamespace=t.namespace?RegExp("(^|\\.)"+x.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:b.makeArray(i,[t]),d=b.event.special[y]||{},r||!d.trigger||!1!==d.trigger.apply(n,i)){if(!r&&!d.noBubble&&!g(n)){for(l=d.delegateType||y,tl.test(l+y)||(s=s.parentNode);s;s=s.parentNode)f.push(s),o=s;o===(n.ownerDocument||v)&&f.push(o.defaultView||o.parentWindow||e)}for(a=0;(s=f[a++])&&!t.isPropagationStopped();)p=s,t.type=a>1?l:d.bindType||y,(h=(Q.get(s,"events")||Object.create(null))[t.type]&&Q.get(s,"handle"))&&h.apply(s,i),(h=c&&s[c])&&h.apply&&Y(s)&&(t.result=h.apply(s,i),!1===t.result&&t.preventDefault());return t.type=y,!r&&!t.isDefaultPrevented()&&(!d._default||!1===d._default.apply(f.pop(),i))&&Y(n)&&c&&m(n[y])&&!g(n)&&((o=n[c])&&(n[c]=null),b.event.triggered=y,t.isPropagationStopped()&&p.addEventListener(y,tc),n[y](),t.isPropagationStopped()&&p.removeEventListener(y,tc),b.event.triggered=void 0,o&&(n[c]=o)),t.result}}},simulate:function(e,t,i){var n=b.extend(new b.Event,i,{type:e,isSimulated:!0});b.event.trigger(n,null,t)}}),b.fn.extend({trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return b.event.trigger(e,t,i,!0)}}),f.focusin||b.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){b.event.simulate(t,e.target,b.event.fix(e))};b.event.special[t]={setup:function(){var n=this.ownerDocument||this.document||this,r=Q.access(n,t);r||n.addEventListener(e,i,!0),Q.access(n,t,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,r=Q.access(n,t)-1;r?Q.access(n,t,r):(n.removeEventListener(e,i,!0),Q.remove(n,t))}}});var th=e.location,tu={guid:Date.now()},td=/\?/;b.parseXML=function(t){var i,n;if(!t||"string"!=typeof t)return null;try{i=new e.DOMParser().parseFromString(t,"text/xml")}catch(e){}return n=i&&i.getElementsByTagName("parsererror")[0],(!i||n)&&b.error("Invalid XML: "+(n?b.map(n.childNodes,function(e){return e.textContent}).join("\n"):t)),i};var tp=/\[\]$/,tf=/\r?\n/g,tm=/^(?:submit|button|image|reset|file)$/i,tg=/^(?:input|select|textarea|keygen)/i;b.param=function(e,t){var i,n=[],r=function(e,t){var i=m(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){r(this.name,this.value)});else for(i in e)!function e(t,i,n,r){var a;if(Array.isArray(i))b.each(i,function(i,a){n||tp.test(t)?r(t,a):e(t+"["+("object"==typeof a&&null!=a?i:"")+"]",a,n,r)});else if(n||"object"!==_(i))r(t,i);else for(a in i)e(t+"["+a+"]",i[a],n,r)}(i,e[i],t,r);return n.join("&")},b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&tg.test(this.nodeName)&&!tm.test(e)&&(this.checked||!eu.test(e))}).map(function(e,t){var i=b(this).val();return null==i?null:Array.isArray(i)?b.map(i,function(e){return{name:t.name,value:e.replace(tf,"\r\n")}}):{name:t.name,value:i.replace(tf,"\r\n")}}).get()}});var tv=/%20/g,ty=/#.*$/,tx=/([?&])_=[^&]*/,t_=/^(.*?):[ \t]*([^\r\n]*)$/mg,tA=/^(?:GET|HEAD)$/,tb=/^\/\//,tS={},tw={},tM="*/".concat("*"),tE=v.createElement("a");function tC(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,a=t.toLowerCase().match(N)||[];if(m(i))for(;n=a[r++];)"+"===n[0]?(e[n=n.slice(1)||"*"]=e[n]||[]).unshift(i):(e[n]=e[n]||[]).push(i)}}function tT(e,t,i,n){var r={},a=e===tw;function s(o){var l;return r[o]=!0,b.each(e[o]||[],function(e,o){var c=o(t,i,n);return"string"!=typeof c||a||r[c]?a?!(l=c):void 0:(t.dataTypes.unshift(c),s(c),!1)}),l}return s(t.dataTypes[0])||!r["*"]&&s("*")}function tR(e,t){var i,n,r=b.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((r[i]?e:n||(n={}))[i]=t[i]);return n&&b.extend(!0,e,n),e}tE.href=th.href,b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:th.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(th.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":tM,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?tR(tR(e,b.ajaxSettings),t):tR(b.ajaxSettings,e)},ajaxPrefilter:tC(tS),ajaxTransport:tC(tw),ajax:function(t,i){"object"==typeof t&&(i=t,t=void 0),i=i||{};var n,r,a,s,o,l,c,h,u,d,p=b.ajaxSetup({},i),f=p.context||p,m=p.context&&(f.nodeType||f.jquery)?b(f):b.event,g=b.Deferred(),y=b.Callbacks("once memory"),x=p.statusCode||{},_={},A={},S="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s)for(s={};t=t_.exec(a);)s[t[1].toLowerCase()+" "]=(s[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=s[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(e,t){return null==c&&(_[e=A[e.toLowerCase()]=A[e.toLowerCase()]||e]=t),this},overrideMimeType:function(e){return null==c&&(p.mimeType=e),this},statusCode:function(e){var t;if(e){if(c)w.always(e[w.status]);else for(t in e)x[t]=[x[t],e[t]]}return this},abort:function(e){var t=e||S;return n&&n.abort(t),M(0,t),this}};if(g.promise(w),p.url=((t||p.url||th.href)+"").replace(tb,th.protocol+"//"),p.type=i.method||i.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(N)||[""],null==p.crossDomain){l=v.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=tE.protocol+"//"+tE.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),tT(tS,p,i,w),c)return w;for(u in(h=b.event&&p.global)&&0==b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!tA.test(p.type),r=p.url.replace(ty,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(tv,"+")):(d=p.url.slice(r.length),p.data&&(p.processData||"string"==typeof p.data)&&(r+=(td.test(r)?"&":"?")+p.data,delete p.data),!1===p.cache&&(r=r.replace(tx,"$1"),d=(td.test(r)?"&":"?")+"_="+tu.guid+++d),p.url=r+d),p.ifModified&&(b.lastModified[r]&&w.setRequestHeader("If-Modified-Since",b.lastModified[r]),b.etag[r]&&w.setRequestHeader("If-None-Match",b.etag[r])),(p.data&&p.hasContent&&!1!==p.contentType||i.contentType)&&w.setRequestHeader("Content-Type",p.contentType),w.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+tM+"; q=0.01":""):p.accepts["*"]),p.headers)w.setRequestHeader(u,p.headers[u]);if(p.beforeSend&&(!1===p.beforeSend.call(f,w,p)||c))return w.abort();if(S="abort",y.add(p.complete),w.done(p.success),w.fail(p.error),n=tT(tw,p,i,w)){if(w.readyState=1,h&&m.trigger("ajaxSend",[w,p]),c)return w;p.async&&p.timeout>0&&(o=e.setTimeout(function(){w.abort("timeout")},p.timeout));try{c=!1,n.send(_,M)}catch(e){if(c)throw e;M(-1,e)}}else M(-1,"No Transport");function M(t,i,s,l){var u,d,v,_,A,S=i;!c&&(c=!0,o&&e.clearTimeout(o),n=void 0,a=l||"",w.readyState=t>0?4:0,u=t>=200&&t<300||304===t,s&&(_=function(e,t,i){for(var n,r,a,s,o=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n){for(r in o)if(o[r]&&o[r].test(n)){l.unshift(r);break}}if(l[0]in i)a=l[0];else{for(r in i){if(!l[0]||e.converters[r+" "+l[0]]){a=r;break}s||(s=r)}a=a||s}if(a)return a!==l[0]&&l.unshift(a),i[a]}(p,w,s)),!u&&b.inArray("script",p.dataTypes)>-1&&0>b.inArray("json",p.dataTypes)&&(p.converters["text script"]=function(){}),_=function(e,t,i,n){var r,a,s,o,l,c={},h=e.dataTypes.slice();if(h[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(a=h.shift();a;)if(e.responseFields[a]&&(i[e.responseFields[a]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=a,a=h.shift()){if("*"===a)a=l;else if("*"!==l&&l!==a){if(!(s=c[l+" "+a]||c["* "+a])){for(r in c)if((o=r.split(" "))[1]===a&&(s=c[l+" "+o[0]]||c["* "+o[0]])){!0===s?s=c[r]:!0!==c[r]&&(a=o[0],h.unshift(o[1]));break}}if(!0!==s){if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+l+" to "+a}}}}}return{state:"success",data:t}}(p,_,w,u),u?(p.ifModified&&((A=w.getResponseHeader("Last-Modified"))&&(b.lastModified[r]=A),(A=w.getResponseHeader("etag"))&&(b.etag[r]=A)),204===t||"HEAD"===p.type?S="nocontent":304===t?S="notmodified":(S=_.state,d=_.data,u=!(v=_.error))):(v=S,(t||!S)&&(S="error",t<0&&(t=0))),w.status=t,w.statusText=(i||S)+"",u?g.resolveWith(f,[d,S,w]):g.rejectWith(f,[w,S,v]),w.statusCode(x),x=void 0,h&&m.trigger(u?"ajaxSuccess":"ajaxError",[w,p,u?d:v]),y.fireWith(f,[w,S]),!h||(m.trigger("ajaxComplete",[w,p]),--b.active||b.event.trigger("ajaxStop")))}return w},getJSON:function(e,t,i){return b.get(e,t,i,"json")},getScript:function(e,t){return b.get(e,void 0,t,"script")}}),b.each(["get","post"],function(e,t){b[t]=function(e,i,n,r){return m(i)&&(r=r||n,n=i,i=void 0),b.ajax(b.extend({url:e,type:t,dataType:r,data:i,success:n},b.isPlainObject(e)&&e))}}),b.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),b._evalUrl=function(e,t,i){return b.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){b.globalEval(e,t,i)}})},b.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=b(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return m(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=m(e);return this.each(function(i){b(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){b(this).replaceWith(this.childNodes)}),this}}),b.expr.pseudos.hidden=function(e){return!b.expr.pseudos.visible(e)},b.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},b.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var tP={0:200,1223:204},tI=b.ajaxSettings.xhr();f.cors=!!tI&&"withCredentials"in tI,f.ajax=tI=!!tI,b.ajaxTransport(function(t){var i,n;if(f.cors||tI&&!t.crossDomain)return{send:function(r,a){var s,o=t.xhr();if(o.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)o[s]=t.xhrFields[s];for(s in t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)o.setRequestHeader(s,r[s]);i=function(e){return function(){i&&(i=n=o.onload=o.onerror=o.onabort=o.ontimeout=o.onreadystatechange=null,"abort"===e?o.abort():"error"===e?"number"!=typeof o.status?a(0,"error"):a(o.status,o.statusText):a(tP[o.status]||o.status,o.statusText,"text"!==(o.responseType||"text")||"string"!=typeof o.responseText?{binary:o.response}:{text:o.responseText},o.getAllResponseHeaders()))}},o.onload=i(),n=o.onerror=o.ontimeout=i("error"),void 0!==o.onabort?o.onabort=n:o.onreadystatechange=function(){4===o.readyState&&e.setTimeout(function(){i&&n()})},i=i("abort");try{o.send(t.hasContent&&t.data||null)}catch(e){if(i)throw e}},abort:function(){i&&i()}}}),b.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),b.ajaxTransport("script",function(e){if(e.crossDomain||e.scriptAttrs){var t,i;return{send:function(n,r){t=b("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&r("error"===e.type?404:200,e.type)}),v.head.appendChild(t[0])},abort:function(){i&&i()}}}});var tL=[],tD=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tL.pop()||b.expando+"_"+tu.guid++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(t,i,n){var r,a,s,o=!1!==t.jsonp&&(tD.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tD.test(t.data)&&"data");if(o||"jsonp"===t.dataTypes[0])return r=t.jsonpCallback=m(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(tD,"$1"+r):!1!==t.jsonp&&(t.url+=(td.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return s||b.error(r+" was not called"),s[0]},t.dataTypes[0]="json",a=e[r],e[r]=function(){s=arguments},n.always(function(){void 0===a?b(e).removeProp(r):e[r]=a,t[r]&&(t.jsonpCallback=i.jsonpCallback,tL.push(r)),s&&m(a)&&a(s[0]),s=a=void 0}),"script"}),f.createHTMLDocument=((i=v.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===i.childNodes.length),b.parseHTML=function(e,t,i){var n,r,a;return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(f.createHTMLDocument?((n=(t=v.implementation.createHTMLDocument("")).createElement("base")).href=v.location.href,t.head.appendChild(n)):t=v),r=R.exec(e),a=!i&&[],r)?[t.createElement(r[1])]:(r=ey([e],t,a),a&&a.length&&b(a).remove(),b.merge([],r.childNodes))},b.fn.load=function(e,t,i){var n,r,a,s=this,o=e.indexOf(" ");return o>-1&&(n=tr(e.slice(o)),e=e.slice(0,o)),m(t)?(i=t,t=void 0):t&&"object"==typeof t&&(r="POST"),s.length>0&&b.ajax({url:e,type:r||"GET",dataType:"html",data:t}).done(function(e){a=arguments,s.html(n?b("<div>").append(b.parseHTML(e)).find(n):e)}).always(i&&function(e,t){s.each(function(){i.apply(this,a||[e.responseText,t,e])})}),this},b.expr.pseudos.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length},b.offset={setOffset:function(e,t,i){var n,r,a,s,o,l,c=b.css(e,"position"),h=b(e),u={};"static"===c&&(e.style.position="relative"),o=h.offset(),a=b.css(e,"top"),l=b.css(e,"left"),("absolute"===c||"fixed"===c)&&(a+l).indexOf("auto")>-1?(s=(n=h.position()).top,r=n.left):(s=parseFloat(a)||0,r=parseFloat(l)||0),m(t)&&(t=t.call(e,i,b.extend({},o))),null!=t.top&&(u.top=t.top-o.top+s),null!=t.left&&(u.left=t.left-o.left+r),"using"in t?t.using.call(e,u):h.css(u)}},b.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){b.offset.setOffset(this,e,t)});var t,i,n=this[0];return n?n.getClientRects().length?(t=n.getBoundingClientRect(),i=n.ownerDocument.defaultView,{top:t.top+i.pageYOffset,left:t.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i,n=this[0],r={top:0,left:0};if("fixed"===b.css(n,"position"))t=n.getBoundingClientRect();else{for(t=this.offset(),i=n.ownerDocument,e=n.offsetParent||i.documentElement;e&&(e===i.body||e===i.documentElement)&&"static"===b.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&(r=b(e).offset(),r.top+=b.css(e,"borderTopWidth",!0),r.left+=b.css(e,"borderLeftWidth",!0))}return{top:t.top-r.top-b.css(n,"marginTop",!0),left:t.left-r.left-b.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===b.css(e,"position");)e=e.offsetParent;return e||er})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;b.fn[e]=function(n){return G(this,function(e,n,r){var a;if(g(e)?a=e:9===e.nodeType&&(a=e.defaultView),void 0===r)return a?a[t]:e[n];a?a.scrollTo(i?a.pageXOffset:r,i?r:a.pageYOffset):e[n]=r},e,n,arguments.length)}}),b.each(["top","left"],function(e,t){b.cssHooks[t]=ek(f.pixelPosition,function(e,i){if(i)return i=eF(e,t),eB.test(i)?b(e).position()[t]+"px":i})}),b.each({Height:"height",Width:"width"},function(e,t){b.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,n){b.fn[n]=function(r,a){var s=arguments.length&&(i||"boolean"!=typeof r),o=i||(!0===r||!0===a?"margin":"border");return G(this,function(t,i,r){var a;return g(t)?0===n.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(a=t.documentElement,Math.max(t.body["scroll"+e],a["scroll"+e],t.body["offset"+e],a["offset"+e],a["client"+e])):void 0===r?b.css(t,i,o):b.style(t,i,r,o)},t,s?r:void 0,s)}})}),b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1==arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),b.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){b.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}});var tB=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;b.proxy=function(e,t){var i,n,r;if("string"==typeof t&&(i=e[t],t=e,e=i),m(e))return n=a.call(arguments,2),(r=function(){return e.apply(t||this,n.concat(a.call(arguments)))}).guid=e.guid=e.guid||b.guid++,r},b.holdReady=function(e){e?b.readyWait++:b.ready(!0)},b.isArray=Array.isArray,b.parseJSON=JSON.parse,b.nodeName=T,b.isFunction=m,b.isWindow=g,b.camelCase=X,b.type=_,b.now=Date.now,b.isNumeric=function(e){var t=b.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},b.trim=function(e){return null==e?"":(e+"").replace(tB,"")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return b});var tO=e.jQuery,tN=e.$;return b.noConflict=function(t){return e.$===b&&(e.$=tN),t&&e.jQuery===b&&(e.jQuery=tO),b},void 0===t&&(e.jQuery=e.$=b),b},"object"==typeof e.exports?e.exports=t.document?i(t,!0):function(e){if(!e.document)throw Error("jQuery requires a window with a document");return i(e)}:i(t)},6486:function(e,t,i){e=i.nmd(e),(function(){var n,r="Expected a function",a="__lodash_hash_undefined__",s="__lodash_placeholder__",o=1/0,l=0/0,c=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],h="[object Arguments]",u="[object Array]",d="[object Boolean]",p="[object Date]",f="[object Error]",m="[object Function]",g="[object GeneratorFunction]",v="[object Map]",y="[object Number]",x="[object Object]",_="[object Promise]",A="[object RegExp]",b="[object Set]",S="[object String]",w="[object Symbol]",M="[object WeakMap]",E="[object ArrayBuffer]",C="[object DataView]",T="[object Float32Array]",R="[object Float64Array]",P="[object Int8Array]",I="[object Int16Array]",L="[object Int32Array]",D="[object Uint8Array]",B="[object Uint8ClampedArray]",O="[object Uint16Array]",N="[object Uint32Array]",U=/\b__p \+= '';/g,F=/\b(__p \+=) '' \+/g,k=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z=/&(?:amp|lt|gt|quot|#39);/g,H=/[&<>"']/g,V=RegExp(z.source),G=RegExp(H.source),W=/<%-([\s\S]+?)%>/g,j=/<%([\s\S]+?)%>/g,q=/<%=([\s\S]+?)%>/g,X=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Y=/^\w*$/,K=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Q=/[\\^$.*+?()[\]{}|]/g,J=RegExp(Q.source),Z=/^\s+/,$=/\s/,ee=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,et=/\{\n\/\* \[wrapped with (.+)\] \*/,ei=/,? & /,en=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,er=/[()=,{}\[\]\/\s]/,ea=/\\(\\)?/g,es=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,eo=/\w*$/,el=/^[-+]0x[0-9a-f]+$/i,ec=/^0b[01]+$/i,eh=/^\[object .+?Constructor\]$/,eu=/^0o[0-7]+$/i,ed=/^(?:0|[1-9]\d*)$/,ep=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ef=/($^)/,em=/['\n\r\u2028\u2029\\]/g,eg="\ud800-\udfff",ev="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ey="\\u2700-\\u27bf",ex="a-z\\xdf-\\xf6\\xf8-\\xff",e_="A-Z\\xc0-\\xd6\\xd8-\\xde",eA="\\ufe0e\\ufe0f",eb="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",eS="[']",ew="["+eb+"]",eM="["+ev+"]",eE="["+ex+"]",eC="[^"+eg+eb+"\\d+"+ey+ex+e_+"]",eT="\ud83c[\udffb-\udfff]",eR="[^"+eg+"]",eP="(?:\ud83c[\udde6-\uddff]){2}",eI="[\ud800-\udbff][\udc00-\udfff]",eL="["+e_+"]",eD="\\u200d",eB="(?:"+eE+"|"+eC+")",eO="(?:"+eL+"|"+eC+")",eN="(?:"+eS+"(?:d|ll|m|re|s|t|ve))?",eU="(?:"+eS+"(?:D|LL|M|RE|S|T|VE))?",eF="(?:"+eM+"|"+eT+")?",ek="["+eA+"]?",ez="(?:"+eD+"(?:"+[eR,eP,eI].join("|")+")"+ek+eF+")*",eH=ek+eF+ez,eV="(?:"+["["+ey+"]",eP,eI].join("|")+")"+eH,eG="(?:"+[eR+eM+"?",eM,eP,eI,"["+eg+"]"].join("|")+")",eW=RegExp(eS,"g"),ej=RegExp(eM,"g"),eq=RegExp(eT+"(?="+eT+")|"+eG+eH,"g"),eX=RegExp([eL+"?"+eE+"+"+eN+"(?="+[ew,eL,"$"].join("|")+")",eO+"+"+eU+"(?="+[ew,eL+eB,"$"].join("|")+")",eL+"?"+eB+"+"+eN,eL+"+"+eU,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",eV].join("|"),"g"),eY=RegExp("["+eD+eg+ev+eA+"]"),eK=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,eQ=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],eJ=-1,eZ={};eZ[T]=eZ[R]=eZ[P]=eZ[I]=eZ[L]=eZ[D]=eZ[B]=eZ[O]=eZ[N]=!0,eZ[h]=eZ[u]=eZ[E]=eZ[d]=eZ[C]=eZ[p]=eZ[f]=eZ[m]=eZ[v]=eZ[y]=eZ[x]=eZ[A]=eZ[b]=eZ[S]=eZ[M]=!1;var e$={};e$[h]=e$[u]=e$[E]=e$[C]=e$[d]=e$[p]=e$[T]=e$[R]=e$[P]=e$[I]=e$[L]=e$[v]=e$[y]=e$[x]=e$[A]=e$[b]=e$[S]=e$[w]=e$[D]=e$[B]=e$[O]=e$[N]=!0,e$[f]=e$[m]=e$[M]=!1;var e0={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},e1=parseFloat,e2=parseInt,e3="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,e4="object"==typeof self&&self&&self.Object===Object&&self,e5=e3||e4||Function("return this")(),e6=t&&!t.nodeType&&t,e8=e6&&e&&!e.nodeType&&e,e9=e8&&e8.exports===e6,e7=e9&&e3.process,te=function(){try{var e=e8&&e8.require&&e8.require("util").types;if(e)return e;return e7&&e7.binding&&e7.binding("util")}catch(e){}}(),tt=te&&te.isArrayBuffer,ti=te&&te.isDate,tn=te&&te.isMap,tr=te&&te.isRegExp,ta=te&&te.isSet,ts=te&&te.isTypedArray;function to(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function tl(e,t,i,n){for(var r=-1,a=null==e?0:e.length;++r<a;){var s=e[r];t(n,s,i(s),e)}return n}function tc(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););return e}function th(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(!t(e[i],i,e))return!1;return!0}function tu(e,t){for(var i=-1,n=null==e?0:e.length,r=0,a=[];++i<n;){var s=e[i];t(s,i,e)&&(a[r++]=s)}return a}function td(e,t){return!!(null==e?0:e.length)&&tb(e,t,0)>-1}function tp(e,t,i){for(var n=-1,r=null==e?0:e.length;++n<r;)if(i(t,e[n]))return!0;return!1}function tf(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r}function tm(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}function tg(e,t,i,n){var r=-1,a=null==e?0:e.length;for(n&&a&&(i=e[++r]);++r<a;)i=t(i,e[r],r,e);return i}function tv(e,t,i,n){var r=null==e?0:e.length;for(n&&r&&(i=e[--r]);r--;)i=t(i,e[r],r,e);return i}function ty(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}var tx=tE("length");function t_(e,t,i){var n;return i(e,function(e,i,r){if(t(e,i,r))return n=i,!1}),n}function tA(e,t,i,n){for(var r=e.length,a=i+(n?1:-1);n?a--:++a<r;)if(t(e[a],a,e))return a;return -1}function tb(e,t,i){return t==t?function(e,t,i){for(var n=i-1,r=e.length;++n<r;)if(e[n]===t)return n;return -1}(e,t,i):tA(e,tw,i)}function tS(e,t,i,n){for(var r=i-1,a=e.length;++r<a;)if(n(e[r],t))return r;return -1}function tw(e){return e!=e}function tM(e,t){var i=null==e?0:e.length;return i?tR(e,t)/i:l}function tE(e){return function(t){return null==t?n:t[e]}}function tC(e){return function(t){return null==e?n:e[t]}}function tT(e,t,i,n,r){return r(e,function(e,r,a){i=n?(n=!1,e):t(i,e,r,a)}),i}function tR(e,t){for(var i,r=-1,a=e.length;++r<a;){var s=t(e[r]);n!==s&&(i=n===i?s:i+s)}return i}function tP(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}function tI(e){return e?e.slice(0,tX(e)+1).replace(Z,""):e}function tL(e){return function(t){return e(t)}}function tD(e,t){return tf(t,function(t){return e[t]})}function tB(e,t){return e.has(t)}function tO(e,t){for(var i=-1,n=e.length;++i<n&&tb(t,e[i],0)>-1;);return i}function tN(e,t){for(var i=e.length;i--&&tb(t,e[i],0)>-1;);return i}var tU=tC({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),tF=tC({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function tk(e){return"\\"+e0[e]}function tz(e){return eY.test(e)}function tH(e){var t=-1,i=Array(e.size);return e.forEach(function(e,n){i[++t]=[n,e]}),i}function tV(e,t){return function(i){return e(t(i))}}function tG(e,t){for(var i=-1,n=e.length,r=0,a=[];++i<n;){var o=e[i];(o===t||o===s)&&(e[i]=s,a[r++]=i)}return a}function tW(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}function tj(e){return tz(e)?function(e){for(var t=eq.lastIndex=0;eq.test(e);)++t;return t}(e):tx(e)}function tq(e){return tz(e)?e.match(eq)||[]:e.split("")}function tX(e){for(var t=e.length;t--&&$.test(e.charAt(t)););return t}var tY=tC({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),tK=function e(t){var i,$,eg,ev,ey=(t=null==t?e5:tK.defaults(e5.Object(),t,tK.pick(e5,eQ))).Array,ex=t.Date,e_=t.Error,eA=t.Function,eb=t.Math,eS=t.Object,ew=t.RegExp,eM=t.String,eE=t.TypeError,eC=ey.prototype,eT=eA.prototype,eR=eS.prototype,eP=t["__core-js_shared__"],eI=eT.toString,eL=eR.hasOwnProperty,eD=0,eB=(i=/[^.]+$/.exec(eP&&eP.keys&&eP.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",eO=eR.toString,eN=eI.call(eS),eU=e5._,eF=ew("^"+eI.call(eL).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ek=e9?t.Buffer:n,ez=t.Symbol,eH=t.Uint8Array,eV=ek?ek.allocUnsafe:n,eG=tV(eS.getPrototypeOf,eS),eq=eS.create,eY=eR.propertyIsEnumerable,e0=eC.splice,e3=ez?ez.isConcatSpreadable:n,e4=ez?ez.iterator:n,e6=ez?ez.toStringTag:n,e8=function(){try{var e=rf(eS,"defineProperty");return e({},"",{}),e}catch(e){}}(),e7=t.clearTimeout!==e5.clearTimeout&&t.clearTimeout,te=ex&&ex.now!==e5.Date.now&&ex.now,tx=t.setTimeout!==e5.setTimeout&&t.setTimeout,tC=eb.ceil,tQ=eb.floor,tJ=eS.getOwnPropertySymbols,tZ=ek?ek.isBuffer:n,t$=t.isFinite,t0=eC.join,t1=tV(eS.keys,eS),t2=eb.max,t3=eb.min,t4=ex.now,t5=t.parseInt,t6=eb.random,t8=eC.reverse,t9=rf(t,"DataView"),t7=rf(t,"Map"),ie=rf(t,"Promise"),it=rf(t,"Set"),ii=rf(t,"WeakMap"),ir=rf(eS,"create"),ia=ii&&new ii,is={},io=rk(t9),il=rk(t7),ic=rk(ie),ih=rk(it),iu=rk(ii),id=ez?ez.prototype:n,ip=id?id.valueOf:n,im=id?id.toString:n;function ig(e){if(aq(e)&&!aO(e)&&!(e instanceof i_)){if(e instanceof ix)return e;if(eL.call(e,"__wrapped__"))return rz(e)}return new ix(e)}var iv=function(){function e(){}return function(t){if(!aj(t))return{};if(eq)return eq(t);e.prototype=t;var i=new e;return e.prototype=n,i}}();function iy(){}function ix(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=n}function i_(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=0xffffffff,this.__views__=[]}function iA(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function ib(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function iS(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function iw(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new iS;++t<i;)this.add(e[t])}function iM(e){var t=this.__data__=new ib(e);this.size=t.size}function iE(e,t){var i=aO(e),n=!i&&aB(e),r=!i&&!n&&ak(e),a=!i&&!n&&!r&&a0(e),s=i||n||r||a,o=s?tP(e.length,eM):[],l=o.length;for(var c in e)(t||eL.call(e,c))&&!(s&&("length"==c||r&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||rA(c,l)))&&o.push(c);return o}function iC(e){var t=e.length;return t?e[nu(0,t-1)]:n}ig.templateSettings={escape:W,evaluate:j,interpolate:q,variable:"",imports:{_:ig}},ig.prototype=iy.prototype,ig.prototype.constructor=ig,ix.prototype=iv(iy.prototype),ix.prototype.constructor=ix,i_.prototype=iv(iy.prototype),i_.prototype.constructor=i_,iA.prototype.clear=function(){this.__data__=ir?ir(null):{},this.size=0},iA.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},iA.prototype.get=function(e){var t=this.__data__;if(ir){var i=t[e];return i===a?n:i}return eL.call(t,e)?t[e]:n},iA.prototype.has=function(e){var t=this.__data__;return ir?t[e]!==n:eL.call(t,e)},iA.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=ir&&n===t?a:t,this},ib.prototype.clear=function(){this.__data__=[],this.size=0},ib.prototype.delete=function(e){var t=this.__data__,i=iP(t,e);return!(i<0)&&(i==t.length-1?t.pop():e0.call(t,i,1),--this.size,!0)},ib.prototype.get=function(e){var t=this.__data__,i=iP(t,e);return i<0?n:t[i][1]},ib.prototype.has=function(e){return iP(this.__data__,e)>-1},ib.prototype.set=function(e,t){var i=this.__data__,n=iP(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this},iS.prototype.clear=function(){this.size=0,this.__data__={hash:new iA,map:new(t7||ib),string:new iA}},iS.prototype.delete=function(e){var t=rd(this,e).delete(e);return this.size-=t?1:0,t},iS.prototype.get=function(e){return rd(this,e).get(e)},iS.prototype.has=function(e){return rd(this,e).has(e)},iS.prototype.set=function(e,t){var i=rd(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this},iw.prototype.add=iw.prototype.push=function(e){return this.__data__.set(e,a),this},iw.prototype.has=function(e){return this.__data__.has(e)};function iT(e,t,i){(n===i||aI(e[t],i))&&(n!==i||t in e)||iD(e,t,i)}function iR(e,t,i){var r=e[t];eL.call(e,t)&&aI(r,i)&&(n!==i||t in e)||iD(e,t,i)}function iP(e,t){for(var i=e.length;i--;)if(aI(e[i][0],t))return i;return -1}function iI(e,t,i,n){return iz(e,function(e,r,a){t(n,e,i(e),a)}),n}function iL(e,t){return e&&nG(t,sd(t),e)}function iD(e,t,i){"__proto__"==t&&e8?e8(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function iB(e,t){for(var i=-1,r=t.length,a=ey(r),s=null==e;++i<r;)a[i]=s?n:so(e,t[i]);return a}function iO(e,t,i){return e==e&&(n!==i&&(e=e<=i?e:i),n!==t&&(e=e>=t?e:t)),e}function iN(e,t,i,r,a,s){var o,l=1&t,c=2&t,u=4&t;if(i&&(o=a?i(e,r,a,s):i(e)),n!==o)return o;if(!aj(e))return e;var f=aO(e);if(f){if(M=(_=e).length,U=new _.constructor(M),M&&"string"==typeof _[0]&&eL.call(_,"index")&&(U.index=_.index,U.input=_.input),o=U,!l)return nV(e,o)}else{var _,M,U,F,k,z,H,V,G=rv(e),W=G==m||G==g;if(ak(e))return nN(e,l);if(G==x||G==h||W&&!a){if(o=c||W?{}:rx(e),!l){return c?(F=e,k=(V=o)&&nG(e,sp(e),V),nG(F,rg(F),k)):(z=e,H=iL(o,e),nG(z,rm(z),H))}}else{if(!e$[G])return a?e:{};o=function(e,t,i){var n,r,a=e.constructor;switch(t){case E:return nU(e);case d:case p:return new a(+e);case C:return n=i?nU(e.buffer):e.buffer,new e.constructor(n,e.byteOffset,e.byteLength);case T:case R:case P:case I:case L:case D:case B:case O:case N:return nF(e,i);case v:return new a;case y:case S:return new a(e);case A:return(r=new e.constructor(e.source,eo.exec(e))).lastIndex=e.lastIndex,r;case b:return new a;case w:return ip?eS(ip.call(e)):{}}}(e,G,l)}}s||(s=new iM);var j=s.get(e);if(j)return j;s.set(e,o),aJ(e)?e.forEach(function(n){o.add(iN(n,t,i,n,e,s))}):aX(e)&&e.forEach(function(n,r){o.set(r,iN(n,t,i,r,e,s))});var q=u?c?ro:rs:c?sp:sd,X=f?n:q(e);return tc(X||e,function(n,r){X&&(n=e[r=n]),iR(o,r,iN(n,t,i,r,e,s))}),o}function iU(e,t,i){var r=i.length;if(null==e)return!r;for(e=eS(e);r--;){var a=i[r],s=t[a],o=e[a];if(n===o&&!(a in e)||!s(o))return!1}return!0}function iF(e,t,i){if("function"!=typeof e)throw new eE(r);return rL(function(){e.apply(n,i)},t)}function ik(e,t,i,n){var r=-1,a=td,s=!0,o=e.length,l=[],c=t.length;if(!o)return l;i&&(t=tf(t,tL(i))),n?(a=tp,s=!1):t.length>=200&&(a=tB,s=!1,t=new iw(t));e:for(;++r<o;){var h=e[r],u=null==i?h:i(h);if(h=n||0!==h?h:0,s&&u==u){for(var d=c;d--;)if(t[d]===u)continue e;l.push(h)}else a(t,u,n)||l.push(h)}return l}iM.prototype.clear=function(){this.__data__=new ib,this.size=0},iM.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},iM.prototype.get=function(e){return this.__data__.get(e)},iM.prototype.has=function(e){return this.__data__.has(e)},iM.prototype.set=function(e,t){var i=this.__data__;if(i instanceof ib){var n=i.__data__;if(!t7||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new iS(n)}return i.set(e,t),this.size=i.size,this};var iz=nq(iY),iH=nq(iK,!0);function iV(e,t){var i=!0;return iz(e,function(e,n,r){return i=!!t(e,n,r)}),i}function iG(e,t,i){for(var r=-1,a=e.length;++r<a;){var s=e[r],o=t(s);if(null!=o&&(n===l?o==o&&!a$(o):i(o,l)))var l=o,c=s}return c}function iW(e,t){var i=[];return iz(e,function(e,n,r){t(e,n,r)&&i.push(e)}),i}function ij(e,t,i,n,r){var a=-1,s=e.length;for(i||(i=r_),r||(r=[]);++a<s;){var o=e[a];t>0&&i(o)?t>1?ij(o,t-1,i,n,r):tm(r,o):n||(r[r.length]=o)}return r}var iq=nX(),iX=nX(!0);function iY(e,t){return e&&iq(e,t,sd)}function iK(e,t){return e&&iX(e,t,sd)}function iQ(e,t){return tu(t,function(t){return aV(e[t])})}function iJ(e,t){t=nD(t,e);for(var i=0,r=t.length;null!=e&&i<r;)e=e[rF(t[i++])];return i&&i==r?e:n}function iZ(e,t,i){var n=t(e);return aO(e)?n:tm(n,i(e))}function i$(e){var t;return null==e?n===e?"[object Undefined]":"[object Null]":e6&&e6 in eS(e)?function(e){var t=eL.call(e,e6),i=e[e6];try{e[e6]=n;var r=!0}catch(e){}var a=eO.call(e);return r&&(t?e[e6]=i:delete e[e6]),a}(e):(t=e,eO.call(t))}function i0(e,t){return e>t}function i1(e,t){return null!=e&&eL.call(e,t)}function i2(e,t){return null!=e&&t in eS(e)}function i3(e,t,i){for(var r=i?tp:td,a=e[0].length,s=e.length,o=s,l=ey(s),c=1/0,h=[];o--;){var u=e[o];o&&t&&(u=tf(u,tL(t))),c=t3(u.length,c),l[o]=!i&&(t||a>=120&&u.length>=120)?new iw(o&&u):n}u=e[0];var d=-1,p=l[0];e:for(;++d<a&&h.length<c;){var f=u[d],m=t?t(f):f;if(f=i||0!==f?f:0,!(p?tB(p,m):r(h,m,i))){for(o=s;--o;){var g=l[o];if(!(g?tB(g,m):r(e[o],m,i)))continue e}p&&p.push(m),h.push(f)}}return h}function i4(e,t,i){t=nD(t,e);var r=null==(e=rR(e,t))?e:e[rF(rJ(t))];return null==r?n:to(r,e,i)}function i5(e){return aq(e)&&i$(e)==h}function i6(e,t,i,r,a){return e===t||(null!=e&&null!=t&&(aq(e)||aq(t))?function(e,t,i,r,a,s){var o=aO(e),l=aO(t),c=o?u:rv(e),m=l?u:rv(t);c=c==h?x:c,m=m==h?x:m;var g=c==x,_=m==x,M=c==m;if(M&&ak(e)){if(!ak(t))return!1;o=!0,g=!1}if(M&&!g)return s||(s=new iM),o||a0(e)?rr(e,t,i,r,a,s):function(e,t,i,n,r,a,s){switch(i){case C:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case E:if(e.byteLength!=t.byteLength||!a(new eH(e),new eH(t)))break;return!0;case d:case p:case y:return aI(+e,+t);case f:return e.name==t.name&&e.message==t.message;case A:case S:return e==t+"";case v:var o=tH;case b:var l=1&n;if(o||(o=tW),e.size!=t.size&&!l)break;var c=s.get(e);if(c)return c==t;n|=2,s.set(e,t);var h=rr(o(e),o(t),n,r,a,s);return s.delete(e),h;case w:if(ip)return ip.call(e)==ip.call(t)}return!1}(e,t,c,i,r,a,s);if(!(1&i)){var T=g&&eL.call(e,"__wrapped__"),R=_&&eL.call(t,"__wrapped__");if(T||R){var P=T?e.value():e,I=R?t.value():t;return s||(s=new iM),a(P,I,i,r,s)}}return!!M&&(s||(s=new iM),function(e,t,i,r,a,s){var o=1&i,l=rs(e),c=l.length;if(c!=rs(t).length&&!o)return!1;for(var h=c;h--;){var u=l[h];if(!(o?u in t:eL.call(t,u)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var f=!0;s.set(e,t),s.set(t,e);for(var m=o;++h<c;){var g=e[u=l[h]],v=t[u];if(r)var y=o?r(v,g,u,t,e,s):r(g,v,u,e,t,s);if(!(n===y?g===v||a(g,v,i,r,s):y)){f=!1;break}m||(m="constructor"==u)}if(f&&!m){var x=e.constructor,_=t.constructor;x!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof x&&x instanceof x&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return s.delete(e),s.delete(t),f}(e,t,i,r,a,s))}(e,t,i,r,i6,a):e!=e&&t!=t)}function i8(e,t,i,r){var a=i.length,s=a,o=!r;if(null==e)return!s;for(e=eS(e);a--;){var l=i[a];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++a<s;){var c=(l=i[a])[0],h=e[c],u=l[1];if(o&&l[2]){if(n===h&&!(c in e))return!1}else{var d=new iM;if(r)var p=r(h,u,c,e,t,d);if(!(n===p?i6(u,h,3,r,d):p))return!1}}return!0}function i9(e){var t;return!(!aj(e)||(t=e,eB&&eB in t))&&(aV(e)?eF:eh).test(rk(e))}function i7(e){return"function"==typeof e?e:null==e?sF:"object"==typeof e?aO(e)?nr(e[0],e[1]):nn(e):sX(e)}function ne(e){if(!rE(e))return t1(e);var t=[];for(var i in eS(e))eL.call(e,i)&&"constructor"!=i&&t.push(i);return t}function nt(e,t){return e<t}function ni(e,t){var i=-1,n=aU(e)?ey(e.length):[];return iz(e,function(e,r,a){n[++i]=t(e,r,a)}),n}function nn(e){var t=rp(e);return 1==t.length&&t[0][2]?rC(t[0][0],t[0][1]):function(i){return i===e||i8(i,e,t)}}function nr(e,t){var i;return rS(e)&&(i=t)==i&&!aj(i)?rC(rF(e),t):function(i){var r=so(i,e);return n===r&&r===t?sl(i,e):i6(t,r,3)}}function na(e,t,i,r,a){e!==t&&iq(t,function(s,o){if(a||(a=new iM),aj(s))(function(e,t,i,r,a,s,o){var l=rP(e,i),c=rP(t,i),h=o.get(c);if(h){iT(e,i,h);return}var u=s?s(l,c,i+"",e,t,o):n,d=n===u;if(d){var p=aO(c),f=!p&&ak(c),m=!p&&!f&&a0(c);u=c,p||f||m?aO(l)?u=l:aF(l)?u=nV(l):f?(d=!1,u=nN(c,!0)):m?(d=!1,u=nF(c,!0)):u=[]:aK(c)||aB(c)?(u=l,aB(l)?u=a9(l):(!aj(l)||aV(l))&&(u=rx(c))):d=!1}d&&(o.set(c,u),a(u,c,r,s,o),o.delete(c)),iT(e,i,u)})(e,t,o,i,na,r,a);else{var l=r?r(rP(e,o),s,o+"",e,t,a):n;n===l&&(l=s),iT(e,o,l)}},sp)}function ns(e,t){var i=e.length;if(i)return rA(t+=t<0?i:0,i)?e[t]:n}function no(e,t,i){t=t.length?tf(t,function(e){return aO(e)?function(t){return iJ(t,1===e.length?e[0]:e)}:e}):[sF];var n=-1;return t=tf(t,tL(ru())),function(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}(ni(e,function(e,i,r){return{criteria:tf(t,function(t){return t(e)}),index:++n,value:e}}),function(e,t){return function(e,t,i){for(var n=-1,r=e.criteria,a=t.criteria,s=r.length,o=i.length;++n<s;){var l=nk(r[n],a[n]);if(l){if(n>=o)return l;return l*("desc"==i[n]?-1:1)}}return e.index-t.index}(e,t,i)})}function nl(e,t,i){for(var n=-1,r=t.length,a={};++n<r;){var s=t[n],o=iJ(e,s);i(o,s)&&nf(a,nD(s,e),o)}return a}function nc(e,t,i,n){var r=n?tS:tb,a=-1,s=t.length,o=e;for(e===t&&(t=nV(t)),i&&(o=tf(e,tL(i)));++a<s;)for(var l=0,c=t[a],h=i?i(c):c;(l=r(o,h,l,n))>-1;)o!==e&&e0.call(o,l,1),e0.call(e,l,1);return e}function nh(e,t){for(var i=e?t.length:0,n=i-1;i--;){var r=t[i];if(i==n||r!==a){var a=r;rA(r)?e0.call(e,r,1):nM(e,r)}}return e}function nu(e,t){return e+tQ(t6()*(t-e+1))}function nd(e,t){var i="";if(!e||t<1||t>0x1fffffffffffff)return i;do t%2&&(i+=e),(t=tQ(t/2))&&(e+=e);while(t);return i}function np(e,t){return rD(rT(e,t,sF),e+"")}function nf(e,t,i,r){if(!aj(e))return e;t=nD(t,e);for(var a=-1,s=t.length,o=s-1,l=e;null!=l&&++a<s;){var c=rF(t[a]),h=i;if("__proto__"===c||"constructor"===c||"prototype"===c)break;if(a!=o){var u=l[c];h=r?r(u,c,l):n,n===h&&(h=aj(u)?u:rA(t[a+1])?[]:{})}iR(l,c,h),l=l[c]}return e}var nm=ia?function(e,t){return ia.set(e,t),e}:sF,ng=e8?function(e,t){return e8(e,"toString",{configurable:!0,enumerable:!1,value:sO(t),writable:!0})}:sF;function nv(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var a=ey(r);++n<r;)a[n]=e[n+t];return a}function ny(e,t){var i;return iz(e,function(e,n,r){return!(i=t(e,n,r))}),!!i}function nx(e,t,i){var n=0,r=null==e?n:e.length;if("number"==typeof t&&t==t&&r<=0x7fffffff){for(;n<r;){var a=n+r>>>1,s=e[a];null!==s&&!a$(s)&&(i?s<=t:s<t)?n=a+1:r=a}return r}return n_(e,t,sF,i)}function n_(e,t,i,r){var a=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=i(t))!=t,l=null===t,c=a$(t),h=n===t;a<s;){var u=tQ((a+s)/2),d=i(e[u]),p=n!==d,f=null===d,m=d==d,g=a$(d);if(o)var v=r||m;else v=h?m&&(r||p):l?m&&p&&(r||!f):c?m&&p&&!f&&(r||!g):!f&&!g&&(r?d<=t:d<t);v?a=u+1:s=u}return t3(s,0xfffffffe)}function nA(e,t){for(var i=-1,n=e.length,r=0,a=[];++i<n;){var s=e[i],o=t?t(s):s;if(!i||!aI(o,l)){var l=o;a[r++]=0===s?0:s}}return a}function nb(e){return"number"==typeof e?e:a$(e)?l:+e}function nS(e){if("string"==typeof e)return e;if(aO(e))return tf(e,nS)+"";if(a$(e))return im?im.call(e):"";var t=e+"";return"0"==t&&1/e==-o?"-0":t}function nw(e,t,i){var n=-1,r=td,a=e.length,s=!0,o=[],l=o;if(i)s=!1,r=tp;else if(a>=200){var c=t?null:n9(e);if(c)return tW(c);s=!1,r=tB,l=new iw}else l=t?[]:o;e:for(;++n<a;){var h=e[n],u=t?t(h):h;if(h=i||0!==h?h:0,s&&u==u){for(var d=l.length;d--;)if(l[d]===u)continue e;t&&l.push(u),o.push(h)}else r(l,u,i)||(l!==o&&l.push(u),o.push(h))}return o}function nM(e,t){return t=nD(t,e),null==(e=rR(e,t))||delete e[rF(rJ(t))]}function nE(e,t,i,n){return nf(e,t,i(iJ(e,t)),n)}function nC(e,t,i,n){for(var r=e.length,a=n?r:-1;(n?a--:++a<r)&&t(e[a],a,e););return i?nv(e,n?0:a,n?a+1:r):nv(e,n?a+1:0,n?r:a)}function nT(e,t){var i=e;return i instanceof i_&&(i=i.value()),tg(t,function(e,t){return t.func.apply(t.thisArg,tm([e],t.args))},i)}function nR(e,t,i){var n=e.length;if(n<2)return n?nw(e[0]):[];for(var r=-1,a=ey(n);++r<n;)for(var s=e[r],o=-1;++o<n;)o!=r&&(a[r]=ik(a[r]||s,e[o],t,i));return nw(ij(a,1),t,i)}function nP(e,t,i){for(var r=-1,a=e.length,s=t.length,o={};++r<a;){var l=r<s?t[r]:n;i(o,e[r],l)}return o}function nI(e){return aF(e)?e:[]}function nL(e){return"function"==typeof e?e:sF}function nD(e,t){return aO(e)?e:rS(e,t)?[e]:rU(a7(e))}function nB(e,t,i){var r=e.length;return i=n===i?r:i,!t&&i>=r?e:nv(e,t,i)}var nO=e7||function(e){return e5.clearTimeout(e)};function nN(e,t){if(t)return e.slice();var i=e.length,n=eV?eV(i):new e.constructor(i);return e.copy(n),n}function nU(e){var t=new e.constructor(e.byteLength);return new eH(t).set(new eH(e)),t}function nF(e,t){var i=t?nU(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function nk(e,t){if(e!==t){var i=n!==e,r=null===e,a=e==e,s=a$(e),o=n!==t,l=null===t,c=t==t,h=a$(t);if(!l&&!h&&!s&&e>t||s&&o&&c&&!l&&!h||r&&o&&c||!i&&c||!a)return 1;if(!r&&!s&&!h&&e<t||h&&i&&a&&!r&&!s||l&&i&&a||!o&&a||!c)return -1}return 0}function nz(e,t,i,n){for(var r=-1,a=e.length,s=i.length,o=-1,l=t.length,c=t2(a-s,0),h=ey(l+c),u=!n;++o<l;)h[o]=t[o];for(;++r<s;)(u||r<a)&&(h[i[r]]=e[r]);for(;c--;)h[o++]=e[r++];return h}function nH(e,t,i,n){for(var r=-1,a=e.length,s=-1,o=i.length,l=-1,c=t.length,h=t2(a-o,0),u=ey(h+c),d=!n;++r<h;)u[r]=e[r];for(var p=r;++l<c;)u[p+l]=t[l];for(;++s<o;)(d||r<a)&&(u[p+i[s]]=e[r++]);return u}function nV(e,t){var i=-1,n=e.length;for(t||(t=ey(n));++i<n;)t[i]=e[i];return t}function nG(e,t,i,r){var a=!i;i||(i={});for(var s=-1,o=t.length;++s<o;){var l=t[s],c=r?r(i[l],e[l],l,i,e):n;n===c&&(c=e[l]),a?iD(i,l,c):iR(i,l,c)}return i}function nW(e,t){return function(i,n){var r=aO(i)?tl:iI,a=t?t():{};return r(i,e,ru(n,2),a)}}function nj(e){return np(function(t,i){var r=-1,a=i.length,s=a>1?i[a-1]:n,o=a>2?i[2]:n;for(s=e.length>3&&"function"==typeof s?(a--,s):n,o&&rb(i[0],i[1],o)&&(s=a<3?n:s,a=1),t=eS(t);++r<a;){var l=i[r];l&&e(t,l,r,s)}return t})}function nq(e,t){return function(i,n){if(null==i)return i;if(!aU(i))return e(i,n);for(var r=i.length,a=t?r:-1,s=eS(i);(t?a--:++a<r)&&!1!==n(s[a],a,s););return i}}function nX(e){return function(t,i,n){for(var r=-1,a=eS(t),s=n(t),o=s.length;o--;){var l=s[e?o:++r];if(!1===i(a[l],l,a))break}return t}}function nY(e){return function(t){var i=tz(t=a7(t))?tq(t):n,r=i?i[0]:t.charAt(0),a=i?nB(i,1).join(""):t.slice(1);return r[e]()+a}}function nK(e){return function(t){return tg(sL(sw(t).replace(eW,"")),e,"")}}function nQ(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=iv(e.prototype),n=e.apply(i,t);return aj(n)?n:i}}function nJ(e){return function(t,i,r){var a=eS(t);if(!aU(t)){var s=ru(i,3);t=sd(t),i=function(e){return s(a[e],e,a)}}var o=e(t,i,r);return o>-1?a[s?t[o]:o]:n}}function nZ(e){return ra(function(t){var i=t.length,a=i,s=ix.prototype.thru;for(e&&t.reverse();a--;){var o=t[a];if("function"!=typeof o)throw new eE(r);if(s&&!l&&"wrapper"==rc(o))var l=new ix([],!0)}for(a=l?a:i;++a<i;){var c=rc(o=t[a]),h="wrapper"==c?rl(o):n;l=h&&rw(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?l[rc(h[0])].apply(l,h[3]):1==o.length&&rw(o)?l[c]():l.thru(o)}return function(){var e=arguments,n=e[0];if(l&&1==e.length&&aO(n))return l.plant(n).value();for(var r=0,a=i?t[r].apply(this,e):n;++r<i;)a=t[r].call(this,a);return a}})}function n$(e,t,i,r,a,s,o,l,c,h){var u=128&t,d=1&t,p=2&t,f=24&t,m=512&t,g=p?n:nQ(e);return function v(){for(var y=arguments.length,x=ey(y),_=y;_--;)x[_]=arguments[_];if(f)var A=rh(v),b=function(e,t){for(var i=e.length,n=0;i--;)e[i]===t&&++n;return n}(x,A);if(r&&(x=nz(x,r,a,f)),s&&(x=nH(x,s,o,f)),y-=b,f&&y<h){var S=tG(x,A);return n6(e,t,n$,v.placeholder,i,x,S,l,c,h-y)}var w=d?i:this,M=p?w[e]:e;return y=x.length,l?x=function(e,t){for(var i=e.length,r=t3(t.length,i),a=nV(e);r--;){var s=t[r];e[r]=rA(s,i)?a[s]:n}return e}(x,l):m&&y>1&&x.reverse(),u&&c<y&&(x.length=c),this&&this!==e5&&this instanceof v&&(M=g||nQ(M)),M.apply(w,x)}}function n0(e,t){return function(i,n){var r,a;return r=t(n),a={},iY(i,function(t,i,n){e(a,r(t),i,n)}),a}}function n1(e,t){return function(i,r){var a;if(n===i&&n===r)return t;if(n!==i&&(a=i),n!==r){if(n===a)return r;"string"==typeof i||"string"==typeof r?(i=nS(i),r=nS(r)):(i=nb(i),r=nb(r)),a=e(i,r)}return a}}function n2(e){return ra(function(t){return t=tf(t,tL(ru())),np(function(i){var n=this;return e(t,function(e){return to(e,n,i)})})})}function n3(e,t){var i=(t=n===t?" ":nS(t)).length;if(i<2)return i?nd(t,e):t;var r=nd(t,tC(e/tj(t)));return tz(t)?nB(tq(r),0,e).join(""):r.slice(0,e)}function n4(e){return function(t,i,r){return r&&"number"!=typeof r&&rb(t,i,r)&&(i=r=n),t=a4(t),n===i?(i=t,t=0):i=a4(i),r=n===r?t<i?1:-1:a4(r),function(e,t,i,n){for(var r=-1,a=t2(tC((t-e)/(i||1)),0),s=ey(a);a--;)s[n?a:++r]=e,e+=i;return s}(t,i,r,e)}}function n5(e){return function(t,i){return"string"==typeof t&&"string"==typeof i||(t=a8(t),i=a8(i)),e(t,i)}}function n6(e,t,i,r,a,s,o,l,c,h){var u=8&t,d=u?o:n,p=u?n:o,f=u?s:n,m=u?n:s;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var g=[e,t,a,f,d,m,p,l,c,h],v=i.apply(n,g);return rw(e)&&rI(v,g),v.placeholder=r,rB(v,e,t)}function n8(e){var t=eb[e];return function(e,i){if(e=a8(e),(i=null==i?0:t3(a5(i),292))&&t$(e)){var n=(a7(e)+"e").split("e");return+((n=(a7(t(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return t(e)}}var n9=it&&1/tW(new it([,-0]))[1]==o?function(e){return new it(e)}:sG;function n7(e){return function(t){var i,n,r=rv(t);return r==v?tH(t):r==b?(i=-1,n=Array(t.size),t.forEach(function(e){n[++i]=[e,e]}),n):tf(e(t),function(e){return[e,t[e]]})}}function re(e,t,i,a,o,l,c,h){var u=2&t;if(!u&&"function"!=typeof e)throw new eE(r);var d=a?a.length:0;if(d||(t&=-97,a=o=n),c=n===c?c:t2(a5(c),0),h=n===h?h:a5(h),d-=o?o.length:0,64&t){var p=a,f=o;a=o=n}var m=u?n:rl(e),g=[e,t,i,a,o,p,f,l,c,h];if(m&&function(e,t){var i=e[1],n=t[1],r=i|n,a=r<131,o=128==n&&8==i||128==n&&256==i&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==i;if(a||o){1&n&&(e[2]=t[2],r|=1&i?0:4);var l=t[3];if(l){var c=e[3];e[3]=c?nz(c,l,t[4]):l,e[4]=c?tG(e[3],s):t[4]}(l=t[5])&&(c=e[5],e[5]=c?nH(c,l,t[6]):l,e[6]=c?tG(e[5],s):t[6]),(l=t[7])&&(e[7]=l),128&n&&(e[8]=null==e[8]?t[8]:t3(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=r}}(g,m),e=g[0],t=g[1],i=g[2],a=g[3],o=g[4],(h=g[9]=g[9]===n?u?0:e.length:t2(g[9]-d,0))||!(24&t)||(t&=-25),t&&1!=t)8==t||16==t?(v=e,y=t,x=h,_=nQ(v),L=function e(){for(var t=arguments.length,i=ey(t),r=t,a=rh(e);r--;)i[r]=arguments[r];var s=t<3&&i[0]!==a&&i[t-1]!==a?[]:tG(i,a);return(t-=s.length)<x?n6(v,y,n$,e.placeholder,n,i,s,n,n,x-t):to(this&&this!==e5&&this instanceof e?_:v,this,i)}):32!=t&&33!=t||o.length?L=n$.apply(n,g):(A=e,b=t,S=i,w=a,M=1&b,E=nQ(A),L=function e(){for(var t=-1,i=arguments.length,n=-1,r=w.length,a=ey(r+i),s=this&&this!==e5&&this instanceof e?E:A;++n<r;)a[n]=w[n];for(;i--;)a[n++]=arguments[++t];return to(s,M?S:this,a)});else var v,y,x,_,A,b,S,w,M,E,C,T,R,P,I,L=(C=e,T=t,R=i,P=1&T,I=nQ(C),function e(){return(this&&this!==e5&&this instanceof e?I:C).apply(P?R:this,arguments)});return rB((m?nm:rI)(L,g),e,t)}function rt(e,t,i,r){return n===e||aI(e,eR[i])&&!eL.call(r,i)?t:e}function ri(e,t,i,r,a,s){return aj(e)&&aj(t)&&(s.set(t,e),na(e,t,n,ri,s),s.delete(t)),e}function rn(e){return aK(e)?n:e}function rr(e,t,i,r,a,s){var o=1&i,l=e.length,c=t.length;if(l!=c&&!(o&&c>l))return!1;var h=s.get(e),u=s.get(t);if(h&&u)return h==t&&u==e;var d=-1,p=!0,f=2&i?new iw:n;for(s.set(e,t),s.set(t,e);++d<l;){var m=e[d],g=t[d];if(r)var v=o?r(g,m,d,t,e,s):r(m,g,d,e,t,s);if(n!==v){if(v)continue;p=!1;break}if(f){if(!ty(t,function(e,t){if(!tB(f,t)&&(m===e||a(m,e,i,r,s)))return f.push(t)})){p=!1;break}}else if(!(m===g||a(m,g,i,r,s))){p=!1;break}}return s.delete(e),s.delete(t),p}function ra(e){return rD(rT(e,n,rq),e+"")}function rs(e){return iZ(e,sd,rm)}function ro(e){return iZ(e,sp,rg)}var rl=ia?function(e){return ia.get(e)}:sG;function rc(e){for(var t=e.name+"",i=is[t],n=eL.call(is,t)?i.length:0;n--;){var r=i[n],a=r.func;if(null==a||a==e)return r.name}return t}function rh(e){return(eL.call(ig,"placeholder")?ig:e).placeholder}function ru(){var e=ig.iteratee||sk;return e=e===sk?i7:e,arguments.length?e(arguments[0],arguments[1]):e}function rd(e,t){var i,n,r=e.__data__;return("string"==(n=typeof(i=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function rp(e){for(var t=sd(e),i=t.length;i--;){var n,r=t[i],a=e[r];t[i]=[r,a,(n=a)==n&&!aj(n)]}return t}function rf(e,t){var i=null==e?n:e[t];return i9(i)?i:n}var rm=tJ?function(e){return null==e?[]:tu(tJ(e=eS(e)),function(t){return eY.call(e,t)})}:sQ,rg=tJ?function(e){for(var t=[];e;)tm(t,rm(e)),e=eG(e);return t}:sQ,rv=i$;function ry(e,t,i){t=nD(t,e);for(var n=-1,r=t.length,a=!1;++n<r;){var s=rF(t[n]);if(!(a=null!=e&&i(e,s)))break;e=e[s]}return a||++n!=r?a:!!(r=null==e?0:e.length)&&aW(r)&&rA(s,r)&&(aO(e)||aB(e))}function rx(e){return"function"!=typeof e.constructor||rE(e)?{}:iv(eG(e))}function r_(e){return aO(e)||aB(e)||!!(e3&&e&&e[e3])}function rA(e,t){var i=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==i||"symbol"!=i&&ed.test(e))&&e>-1&&e%1==0&&e<t}function rb(e,t,i){if(!aj(i))return!1;var n=typeof t;return("number"==n?!!(aU(i)&&rA(t,i.length)):"string"==n&&t in i)&&aI(i[t],e)}function rS(e,t){if(aO(e))return!1;var i=typeof e;return!!("number"==i||"symbol"==i||"boolean"==i||null==e||a$(e))||Y.test(e)||!X.test(e)||null!=t&&e in eS(t)}function rw(e){var t=rc(e),i=ig[t];if("function"!=typeof i||!(t in i_.prototype))return!1;if(e===i)return!0;var n=rl(i);return!!n&&e===n[0]}(t9&&rv(new t9(new ArrayBuffer(1)))!=C||t7&&rv(new t7)!=v||ie&&rv(ie.resolve())!=_||it&&rv(new it)!=b||ii&&rv(new ii)!=M)&&(rv=function(e){var t=i$(e),i=t==x?e.constructor:n,r=i?rk(i):"";if(r)switch(r){case io:return C;case il:return v;case ic:return _;case ih:return b;case iu:return M}return t});var rM=eP?aV:sJ;function rE(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||eR)}function rC(e,t){return function(i){return null!=i&&i[e]===t&&(n!==t||e in eS(i))}}function rT(e,t,i){return t=t2(n===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,a=t2(n.length-t,0),s=ey(a);++r<a;)s[r]=n[t+r];r=-1;for(var o=ey(t+1);++r<t;)o[r]=n[r];return o[t]=i(s),to(e,this,o)}}function rR(e,t){return t.length<2?e:iJ(e,nv(t,0,-1))}function rP(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var rI=rO(nm),rL=tx||function(e,t){return e5.setTimeout(e,t)},rD=rO(ng);function rB(e,t,i){var n,r,a,s=t+"";return rD(e,function(e,t){var i=t.length;if(!i)return e;var n=i-1;return t[n]=(i>1?"& ":"")+t[n],t=t.join(i>2?", ":" "),e.replace(ee,"{\n/* [wrapped with "+t+"] */\n")}(s,(n=(a=s.match(et))?a[1].split(ei):[],r=i,tc(c,function(e){var t="_."+e[0];r&e[1]&&!td(n,t)&&n.push(t)}),n.sort())))}function rO(e){var t=0,i=0;return function(){var r=t4(),a=16-(r-i);if(i=r,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(n,arguments)}}function rN(e,t){var i=-1,r=e.length,a=r-1;for(t=n===t?r:t;++i<t;){var s=nu(i,a),o=e[s];e[s]=e[i],e[i]=o}return e.length=t,e}var rU=(eg=($=aM(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(K,function(e,i,n,r){t.push(n?r.replace(ea,"$1"):i||e)}),t},function(e){return 500===eg.size&&eg.clear(),e})).cache,$);function rF(e){if("string"==typeof e||a$(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}function rk(e){if(null!=e){try{return eI.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function rz(e){if(e instanceof i_)return e.clone();var t=new ix(e.__wrapped__,e.__chain__);return t.__actions__=nV(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var rH=np(function(e,t){return aF(e)?ik(e,ij(t,1,aF,!0)):[]}),rV=np(function(e,t){var i=rJ(t);return aF(i)&&(i=n),aF(e)?ik(e,ij(t,1,aF,!0),ru(i,2)):[]}),rG=np(function(e,t){var i=rJ(t);return aF(i)&&(i=n),aF(e)?ik(e,ij(t,1,aF,!0),n,i):[]});function rW(e,t,i){var n=null==e?0:e.length;if(!n)return -1;var r=null==i?0:a5(i);return r<0&&(r=t2(n+r,0)),tA(e,ru(t,3),r)}function rj(e,t,i){var r=null==e?0:e.length;if(!r)return -1;var a=r-1;return n!==i&&(a=a5(i),a=i<0?t2(r+a,0):t3(a,r-1)),tA(e,ru(t,3),a,!0)}function rq(e){return(null==e?0:e.length)?ij(e,1):[]}function rX(e){return e&&e.length?e[0]:n}var rY=np(function(e){var t=tf(e,nI);return t.length&&t[0]===e[0]?i3(t):[]}),rK=np(function(e){var t=rJ(e),i=tf(e,nI);return t===rJ(i)?t=n:i.pop(),i.length&&i[0]===e[0]?i3(i,ru(t,2)):[]}),rQ=np(function(e){var t=rJ(e),i=tf(e,nI);return(t="function"==typeof t?t:n)&&i.pop(),i.length&&i[0]===e[0]?i3(i,n,t):[]});function rJ(e){var t=null==e?0:e.length;return t?e[t-1]:n}var rZ=np(r$);function r$(e,t){return e&&e.length&&t&&t.length?nc(e,t):e}var r0=ra(function(e,t){var i=null==e?0:e.length,n=iB(e,t);return nh(e,tf(t,function(e){return rA(e,i)?+e:e}).sort(nk)),n});function r1(e){return null==e?e:t8.call(e)}var r2=np(function(e){return nw(ij(e,1,aF,!0))}),r3=np(function(e){var t=rJ(e);return aF(t)&&(t=n),nw(ij(e,1,aF,!0),ru(t,2))}),r4=np(function(e){var t=rJ(e);return t="function"==typeof t?t:n,nw(ij(e,1,aF,!0),n,t)});function r5(e){if(!(e&&e.length))return[];var t=0;return e=tu(e,function(e){if(aF(e))return t=t2(e.length,t),!0}),tP(t,function(t){return tf(e,tE(t))})}function r6(e,t){if(!(e&&e.length))return[];var i=r5(e);return null==t?i:tf(i,function(e){return to(t,n,e)})}var r8=np(function(e,t){return aF(e)?ik(e,t):[]}),r9=np(function(e){return nR(tu(e,aF))}),r7=np(function(e){var t=rJ(e);return aF(t)&&(t=n),nR(tu(e,aF),ru(t,2))}),ae=np(function(e){var t=rJ(e);return t="function"==typeof t?t:n,nR(tu(e,aF),n,t)}),at=np(r5),ai=np(function(e){var t=e.length,i=t>1?e[t-1]:n;return i="function"==typeof i?(e.pop(),i):n,r6(e,i)});function an(e){var t=ig(e);return t.__chain__=!0,t}function ar(e,t){return t(e)}var aa=ra(function(e){var t=e.length,i=t?e[0]:0,r=this.__wrapped__,a=function(t){return iB(t,e)};return!(t>1)&&!this.__actions__.length&&r instanceof i_&&rA(i)?((r=r.slice(i,+i+(t?1:0))).__actions__.push({func:ar,args:[a],thisArg:n}),new ix(r,this.__chain__).thru(function(e){return t&&!e.length&&e.push(n),e})):this.thru(a)}),as=nW(function(e,t,i){eL.call(e,i)?++e[i]:iD(e,i,1)}),ao=nJ(rW),al=nJ(rj);function ac(e,t){return(aO(e)?tc:iz)(e,ru(t,3))}function ah(e,t){return(aO(e)?function(e,t){for(var i=null==e?0:e.length;i--&&!1!==t(e[i],i,e););return e}:iH)(e,ru(t,3))}var au=nW(function(e,t,i){eL.call(e,i)?e[i].push(t):iD(e,i,[t])}),ad=np(function(e,t,i){var n=-1,r="function"==typeof t,a=aU(e)?ey(e.length):[];return iz(e,function(e){a[++n]=r?to(t,e,i):i4(e,t,i)}),a}),ap=nW(function(e,t,i){iD(e,i,t)});function af(e,t){return(aO(e)?tf:ni)(e,ru(t,3))}var am=nW(function(e,t,i){e[i?0:1].push(t)},function(){return[[],[]]}),ag=np(function(e,t){if(null==e)return[];var i=t.length;return i>1&&rb(e,t[0],t[1])?t=[]:i>2&&rb(t[0],t[1],t[2])&&(t=[t[0]]),no(e,ij(t,1),[])}),av=te||function(){return e5.Date.now()};function ay(e,t,i){return t=i?n:t,t=e&&null==t?e.length:t,re(e,128,n,n,n,n,t)}function ax(e,t){var i;if("function"!=typeof t)throw new eE(r);return e=a5(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=n),i}}var a_=np(function(e,t,i){var n=1;if(i.length){var r=tG(i,rh(a_));n|=32}return re(e,n,t,i,r)}),aA=np(function(e,t,i){var n=3;if(i.length){var r=tG(i,rh(aA));n|=32}return re(t,n,e,i,r)});function ab(e,t,i){var a,s,o,l,c,h,u=0,d=!1,p=!1,f=!0;if("function"!=typeof e)throw new eE(r);function m(t){var i=a,r=s;return a=s=n,u=t,l=e.apply(r,i)}function g(e){var i=e-h,r=e-u;return n===h||i>=t||i<0||p&&r>=o}function v(){var e,i,n,r=av();if(g(r))return y(r);c=rL(v,(e=r-h,i=r-u,n=t-e,p?t3(n,o-i):n))}function y(e){return(c=n,f&&a)?m(e):(a=s=n,l)}function x(){var e,i=av(),r=g(i);if(a=arguments,s=this,h=i,r){if(n===c)return u=e=h,c=rL(v,t),d?m(e):l;if(p)return nO(c),c=rL(v,t),m(h)}return n===c&&(c=rL(v,t)),l}return t=a8(t)||0,aj(i)&&(d=!!i.leading,o=(p="maxWait"in i)?t2(a8(i.maxWait)||0,t):o,f="trailing"in i?!!i.trailing:f),x.cancel=function(){n!==c&&nO(c),u=0,a=h=s=c=n},x.flush=function(){return n===c?l:y(av())},x}var aS=np(function(e,t){return iF(e,1,t)}),aw=np(function(e,t,i){return iF(e,a8(t)||0,i)});function aM(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new eE(r);var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],a=i.cache;if(a.has(r))return a.get(r);var s=e.apply(this,n);return i.cache=a.set(r,s)||a,s};return i.cache=new(aM.Cache||iS),i}function aE(e){if("function"!=typeof e)throw new eE(r);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}aM.Cache=iS;var aC=np(function(e,t){var i=(t=1==t.length&&aO(t[0])?tf(t[0],tL(ru())):tf(ij(t,1),tL(ru()))).length;return np(function(n){for(var r=-1,a=t3(n.length,i);++r<a;)n[r]=t[r].call(this,n[r]);return to(e,this,n)})}),aT=np(function(e,t){var i=tG(t,rh(aT));return re(e,32,n,t,i)}),aR=np(function(e,t){var i=tG(t,rh(aR));return re(e,64,n,t,i)}),aP=ra(function(e,t){return re(e,256,n,n,n,t)});function aI(e,t){return e===t||e!=e&&t!=t}var aL=n5(i0),aD=n5(function(e,t){return e>=t}),aB=i5(function(){return arguments}())?i5:function(e){return aq(e)&&eL.call(e,"callee")&&!eY.call(e,"callee")},aO=ey.isArray,aN=tt?tL(tt):function(e){return aq(e)&&i$(e)==E};function aU(e){return null!=e&&aW(e.length)&&!aV(e)}function aF(e){return aq(e)&&aU(e)}var ak=tZ||sJ,az=ti?tL(ti):function(e){return aq(e)&&i$(e)==p};function aH(e){if(!aq(e))return!1;var t=i$(e);return t==f||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!aK(e)}function aV(e){if(!aj(e))return!1;var t=i$(e);return t==m||t==g||"[object AsyncFunction]"==t||"[object Proxy]"==t}function aG(e){return"number"==typeof e&&e==a5(e)}function aW(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff}function aj(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function aq(e){return null!=e&&"object"==typeof e}var aX=tn?tL(tn):function(e){return aq(e)&&rv(e)==v};function aY(e){return"number"==typeof e||aq(e)&&i$(e)==y}function aK(e){if(!aq(e)||i$(e)!=x)return!1;var t=eG(e);if(null===t)return!0;var i=eL.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&eI.call(i)==eN}var aQ=tr?tL(tr):function(e){return aq(e)&&i$(e)==A},aJ=ta?tL(ta):function(e){return aq(e)&&rv(e)==b};function aZ(e){return"string"==typeof e||!aO(e)&&aq(e)&&i$(e)==S}function a$(e){return"symbol"==typeof e||aq(e)&&i$(e)==w}var a0=ts?tL(ts):function(e){return aq(e)&&aW(e.length)&&!!eZ[i$(e)]},a1=n5(nt),a2=n5(function(e,t){return e<=t});function a3(e){if(!e)return[];if(aU(e))return aZ(e)?tq(e):nV(e);if(e4&&e[e4])return function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}(e[e4]());var t=rv(e);return(t==v?tH:t==b?tW:sA)(e)}function a4(e){return e?(e=a8(e))===o||e===-o?(e<0?-1:1)*17976931348623157e292:e==e?e:0:0===e?e:0}function a5(e){var t=a4(e),i=t%1;return t==t?i?t-i:t:0}function a6(e){return e?iO(a5(e),0,0xffffffff):0}function a8(e){if("number"==typeof e)return e;if(a$(e))return l;if(aj(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=aj(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=tI(e);var i=ec.test(e);return i||eu.test(e)?e2(e.slice(2),i?2:8):el.test(e)?l:+e}function a9(e){return nG(e,sp(e))}function a7(e){return null==e?"":nS(e)}var se=nj(function(e,t){if(rE(t)||aU(t)){nG(t,sd(t),e);return}for(var i in t)eL.call(t,i)&&iR(e,i,t[i])}),st=nj(function(e,t){nG(t,sp(t),e)}),si=nj(function(e,t,i,n){nG(t,sp(t),e,n)}),sn=nj(function(e,t,i,n){nG(t,sd(t),e,n)}),sr=ra(iB),sa=np(function(e,t){e=eS(e);var i=-1,r=t.length,a=r>2?t[2]:n;for(a&&rb(t[0],t[1],a)&&(r=1);++i<r;)for(var s=t[i],o=sp(s),l=-1,c=o.length;++l<c;){var h=o[l],u=e[h];(n===u||aI(u,eR[h])&&!eL.call(e,h))&&(e[h]=s[h])}return e}),ss=np(function(e){return e.push(n,ri),to(sm,n,e)});function so(e,t,i){var r=null==e?n:iJ(e,t);return n===r?i:r}function sl(e,t){return null!=e&&ry(e,t,i2)}var sc=n0(function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=eO.call(t)),e[t]=i},sO(sF)),sh=n0(function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=eO.call(t)),eL.call(e,t)?e[t].push(i):e[t]=[i]},ru),su=np(i4);function sd(e){return aU(e)?iE(e):ne(e)}function sp(e){return aU(e)?iE(e,!0):function(e){if(!aj(e))return function(e){var t=[];if(null!=e)for(var i in eS(e))t.push(i);return t}(e);var t=rE(e),i=[];for(var n in e)"constructor"==n&&(t||!eL.call(e,n))||i.push(n);return i}(e)}var sf=nj(function(e,t,i){na(e,t,i)}),sm=nj(function(e,t,i,n){na(e,t,i,n)}),sg=ra(function(e,t){var i={};if(null==e)return i;var n=!1;t=tf(t,function(t){return t=nD(t,e),n||(n=t.length>1),t}),nG(e,ro(e),i),n&&(i=iN(i,7,rn));for(var r=t.length;r--;)nM(i,t[r]);return i}),sv=ra(function(e,t){return null==e?{}:nl(e,t,function(t,i){return sl(e,i)})});function sy(e,t){if(null==e)return{};var i=tf(ro(e),function(e){return[e]});return t=ru(t),nl(e,i,function(e,i){return t(e,i[0])})}var sx=n7(sd),s_=n7(sp);function sA(e){return null==e?[]:tD(e,sd(e))}var sb=nK(function(e,t,i){return t=t.toLowerCase(),e+(i?sS(t):t)});function sS(e){return sI(a7(e).toLowerCase())}function sw(e){return(e=a7(e))&&e.replace(ep,tU).replace(ej,"")}var sM=nK(function(e,t,i){return e+(i?"-":"")+t.toLowerCase()}),sE=nK(function(e,t,i){return e+(i?" ":"")+t.toLowerCase()}),sC=nY("toLowerCase"),sT=nK(function(e,t,i){return e+(i?"_":"")+t.toLowerCase()}),sR=nK(function(e,t,i){return e+(i?" ":"")+sI(t)}),sP=nK(function(e,t,i){return e+(i?" ":"")+t.toUpperCase()}),sI=nY("toUpperCase");function sL(e,t,i){if(e=a7(e),t=i?n:t,n===t){var r;return(r=e,eK.test(r))?e.match(eX)||[]:e.match(en)||[]}return e.match(t)||[]}var sD=np(function(e,t){try{return to(e,n,t)}catch(e){return aH(e)?e:new e_(e)}}),sB=ra(function(e,t){return tc(t,function(t){iD(e,t=rF(t),a_(e[t],e))}),e});function sO(e){return function(){return e}}var sN=nZ(),sU=nZ(!0);function sF(e){return e}function sk(e){return i7("function"==typeof e?e:iN(e,1))}var sz=np(function(e,t){return function(i){return i4(i,e,t)}}),sH=np(function(e,t){return function(i){return i4(e,i,t)}});function sV(e,t,i){var n=sd(t),r=iQ(t,n);null!=i||aj(t)&&(r.length||!n.length)||(i=t,t=e,e=this,r=iQ(t,sd(t)));var a=!(aj(i)&&"chain"in i)||!!i.chain,s=aV(e);return tc(r,function(i){var n=t[i];e[i]=n,s&&(e.prototype[i]=function(){var t=this.__chain__;if(a||t){var i=e(this.__wrapped__);return(i.__actions__=nV(this.__actions__)).push({func:n,args:arguments,thisArg:e}),i.__chain__=t,i}return n.apply(e,tm([this.value()],arguments))})}),e}function sG(){}var sW=n2(tf),sj=n2(th),sq=n2(ty);function sX(e){return rS(e)?tE(rF(e)):function(t){return iJ(t,e)}}var sY=n4(),sK=n4(!0);function sQ(){return[]}function sJ(){return!1}var sZ=n1(function(e,t){return e+t},0),s$=n8("ceil"),s0=n1(function(e,t){return e/t},1),s1=n8("floor"),s2=n1(function(e,t){return e*t},1),s3=n8("round"),s4=n1(function(e,t){return e-t},0);return ig.after=function(e,t){if("function"!=typeof t)throw new eE(r);return e=a5(e),function(){if(--e<1)return t.apply(this,arguments)}},ig.ary=ay,ig.assign=se,ig.assignIn=st,ig.assignInWith=si,ig.assignWith=sn,ig.at=sr,ig.before=ax,ig.bind=a_,ig.bindAll=sB,ig.bindKey=aA,ig.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return aO(e)?e:[e]},ig.chain=an,ig.chunk=function(e,t,i){t=(i?rb(e,t,i):n===t)?1:t2(a5(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var a=0,s=0,o=ey(tC(r/t));a<r;)o[s++]=nv(e,a,a+=t);return o},ig.compact=function(e){for(var t=-1,i=null==e?0:e.length,n=0,r=[];++t<i;){var a=e[t];a&&(r[n++]=a)}return r},ig.concat=function(){var e=arguments.length;if(!e)return[];for(var t=ey(e-1),i=arguments[0],n=e;n--;)t[n-1]=arguments[n];return tm(aO(i)?nV(i):[i],ij(t,1))},ig.cond=function(e){var t=null==e?0:e.length,i=ru();return e=t?tf(e,function(e){if("function"!=typeof e[1])throw new eE(r);return[i(e[0]),e[1]]}):[],np(function(i){for(var n=-1;++n<t;){var r=e[n];if(to(r[0],this,i))return to(r[1],this,i)}})},ig.conforms=function(e){var t,i;return i=sd(t=iN(e,1)),function(e){return iU(e,t,i)}},ig.constant=sO,ig.countBy=as,ig.create=function(e,t){var i=iv(e);return null==t?i:iL(i,t)},ig.curry=function e(t,i,r){i=r?n:i;var a=re(t,8,n,n,n,n,n,i);return a.placeholder=e.placeholder,a},ig.curryRight=function e(t,i,r){i=r?n:i;var a=re(t,16,n,n,n,n,n,i);return a.placeholder=e.placeholder,a},ig.debounce=ab,ig.defaults=sa,ig.defaultsDeep=ss,ig.defer=aS,ig.delay=aw,ig.difference=rH,ig.differenceBy=rV,ig.differenceWith=rG,ig.drop=function(e,t,i){var r=null==e?0:e.length;return r?nv(e,(t=i||n===t?1:a5(t))<0?0:t,r):[]},ig.dropRight=function(e,t,i){var r=null==e?0:e.length;return r?nv(e,0,(t=r-(t=i||n===t?1:a5(t)))<0?0:t):[]},ig.dropRightWhile=function(e,t){return e&&e.length?nC(e,ru(t,3),!0,!0):[]},ig.dropWhile=function(e,t){return e&&e.length?nC(e,ru(t,3),!0):[]},ig.fill=function(e,t,i,r){var a=null==e?0:e.length;return a?(i&&"number"!=typeof i&&rb(e,t,i)&&(i=0,r=a),function(e,t,i,r){var a=e.length;for((i=a5(i))<0&&(i=-i>a?0:a+i),(r=n===r||r>a?a:a5(r))<0&&(r+=a),r=i>r?0:a6(r);i<r;)e[i++]=t;return e}(e,t,i,r)):[]},ig.filter=function(e,t){return(aO(e)?tu:iW)(e,ru(t,3))},ig.flatMap=function(e,t){return ij(af(e,t),1)},ig.flatMapDeep=function(e,t){return ij(af(e,t),o)},ig.flatMapDepth=function(e,t,i){return i=n===i?1:a5(i),ij(af(e,t),i)},ig.flatten=rq,ig.flattenDeep=function(e){return(null==e?0:e.length)?ij(e,o):[]},ig.flattenDepth=function(e,t){return(null==e?0:e.length)?ij(e,t=n===t?1:a5(t)):[]},ig.flip=function(e){return re(e,512)},ig.flow=sN,ig.flowRight=sU,ig.fromPairs=function(e){for(var t=-1,i=null==e?0:e.length,n={};++t<i;){var r=e[t];n[r[0]]=r[1]}return n},ig.functions=function(e){return null==e?[]:iQ(e,sd(e))},ig.functionsIn=function(e){return null==e?[]:iQ(e,sp(e))},ig.groupBy=au,ig.initial=function(e){return(null==e?0:e.length)?nv(e,0,-1):[]},ig.intersection=rY,ig.intersectionBy=rK,ig.intersectionWith=rQ,ig.invert=sc,ig.invertBy=sh,ig.invokeMap=ad,ig.iteratee=sk,ig.keyBy=ap,ig.keys=sd,ig.keysIn=sp,ig.map=af,ig.mapKeys=function(e,t){var i={};return t=ru(t,3),iY(e,function(e,n,r){iD(i,t(e,n,r),e)}),i},ig.mapValues=function(e,t){var i={};return t=ru(t,3),iY(e,function(e,n,r){iD(i,n,t(e,n,r))}),i},ig.matches=function(e){return nn(iN(e,1))},ig.matchesProperty=function(e,t){return nr(e,iN(t,1))},ig.memoize=aM,ig.merge=sf,ig.mergeWith=sm,ig.method=sz,ig.methodOf=sH,ig.mixin=sV,ig.negate=aE,ig.nthArg=function(e){return e=a5(e),np(function(t){return ns(t,e)})},ig.omit=sg,ig.omitBy=function(e,t){return sy(e,aE(ru(t)))},ig.once=function(e){return ax(2,e)},ig.orderBy=function(e,t,i,r){return null==e?[]:(aO(t)||(t=null==t?[]:[t]),aO(i=r?n:i)||(i=null==i?[]:[i]),no(e,t,i))},ig.over=sW,ig.overArgs=aC,ig.overEvery=sj,ig.overSome=sq,ig.partial=aT,ig.partialRight=aR,ig.partition=am,ig.pick=sv,ig.pickBy=sy,ig.property=sX,ig.propertyOf=function(e){return function(t){return null==e?n:iJ(e,t)}},ig.pull=rZ,ig.pullAll=r$,ig.pullAllBy=function(e,t,i){return e&&e.length&&t&&t.length?nc(e,t,ru(i,2)):e},ig.pullAllWith=function(e,t,i){return e&&e.length&&t&&t.length?nc(e,t,n,i):e},ig.pullAt=r0,ig.range=sY,ig.rangeRight=sK,ig.rearg=aP,ig.reject=function(e,t){return(aO(e)?tu:iW)(e,aE(ru(t,3)))},ig.remove=function(e,t){var i=[];if(!(e&&e.length))return i;var n=-1,r=[],a=e.length;for(t=ru(t,3);++n<a;){var s=e[n];t(s,n,e)&&(i.push(s),r.push(n))}return nh(e,r),i},ig.rest=function(e,t){if("function"!=typeof e)throw new eE(r);return np(e,t=n===t?t:a5(t))},ig.reverse=r1,ig.sampleSize=function(e,t,i){return t=(i?rb(e,t,i):n===t)?1:a5(t),(aO(e)?function(e,t){return rN(nV(e),iO(t,0,e.length))}:function(e,t){var i=sA(e);return rN(i,iO(t,0,i.length))})(e,t)},ig.set=function(e,t,i){return null==e?e:nf(e,t,i)},ig.setWith=function(e,t,i,r){return r="function"==typeof r?r:n,null==e?e:nf(e,t,i,r)},ig.shuffle=function(e){return(aO(e)?function(e){return rN(nV(e))}:function(e){return rN(sA(e))})(e)},ig.slice=function(e,t,i){var r=null==e?0:e.length;return r?(i&&"number"!=typeof i&&rb(e,t,i)?(t=0,i=r):(t=null==t?0:a5(t),i=n===i?r:a5(i)),nv(e,t,i)):[]},ig.sortBy=ag,ig.sortedUniq=function(e){return e&&e.length?nA(e):[]},ig.sortedUniqBy=function(e,t){return e&&e.length?nA(e,ru(t,2)):[]},ig.split=function(e,t,i){return(i&&"number"!=typeof i&&rb(e,t,i)&&(t=i=n),i=n===i?0xffffffff:i>>>0)?(e=a7(e))&&("string"==typeof t||null!=t&&!aQ(t))&&!(t=nS(t))&&tz(e)?nB(tq(e),0,i):e.split(t,i):[]},ig.spread=function(e,t){if("function"!=typeof e)throw new eE(r);return t=null==t?0:t2(a5(t),0),np(function(i){var n=i[t],r=nB(i,0,t);return n&&tm(r,n),to(e,this,r)})},ig.tail=function(e){var t=null==e?0:e.length;return t?nv(e,1,t):[]},ig.take=function(e,t,i){return e&&e.length?nv(e,0,(t=i||n===t?1:a5(t))<0?0:t):[]},ig.takeRight=function(e,t,i){var r=null==e?0:e.length;return r?nv(e,(t=r-(t=i||n===t?1:a5(t)))<0?0:t,r):[]},ig.takeRightWhile=function(e,t){return e&&e.length?nC(e,ru(t,3),!1,!0):[]},ig.takeWhile=function(e,t){return e&&e.length?nC(e,ru(t,3)):[]},ig.tap=function(e,t){return t(e),e},ig.throttle=function(e,t,i){var n=!0,a=!0;if("function"!=typeof e)throw new eE(r);return aj(i)&&(n="leading"in i?!!i.leading:n,a="trailing"in i?!!i.trailing:a),ab(e,t,{leading:n,maxWait:t,trailing:a})},ig.thru=ar,ig.toArray=a3,ig.toPairs=sx,ig.toPairsIn=s_,ig.toPath=function(e){return aO(e)?tf(e,rF):a$(e)?[e]:nV(rU(a7(e)))},ig.toPlainObject=a9,ig.transform=function(e,t,i){var n=aO(e),r=n||ak(e)||a0(e);if(t=ru(t,4),null==i){var a=e&&e.constructor;i=r?n?new a:[]:aj(e)&&aV(a)?iv(eG(e)):{}}return(r?tc:iY)(e,function(e,n,r){return t(i,e,n,r)}),i},ig.unary=function(e){return ay(e,1)},ig.union=r2,ig.unionBy=r3,ig.unionWith=r4,ig.uniq=function(e){return e&&e.length?nw(e):[]},ig.uniqBy=function(e,t){return e&&e.length?nw(e,ru(t,2)):[]},ig.uniqWith=function(e,t){return t="function"==typeof t?t:n,e&&e.length?nw(e,n,t):[]},ig.unset=function(e,t){return null==e||nM(e,t)},ig.unzip=r5,ig.unzipWith=r6,ig.update=function(e,t,i){return null==e?e:nE(e,t,nL(i))},ig.updateWith=function(e,t,i,r){return r="function"==typeof r?r:n,null==e?e:nE(e,t,nL(i),r)},ig.values=sA,ig.valuesIn=function(e){return null==e?[]:tD(e,sp(e))},ig.without=r8,ig.words=sL,ig.wrap=function(e,t){return aT(nL(t),e)},ig.xor=r9,ig.xorBy=r7,ig.xorWith=ae,ig.zip=at,ig.zipObject=function(e,t){return nP(e||[],t||[],iR)},ig.zipObjectDeep=function(e,t){return nP(e||[],t||[],nf)},ig.zipWith=ai,ig.entries=sx,ig.entriesIn=s_,ig.extend=st,ig.extendWith=si,sV(ig,ig),ig.add=sZ,ig.attempt=sD,ig.camelCase=sb,ig.capitalize=sS,ig.ceil=s$,ig.clamp=function(e,t,i){return n===i&&(i=t,t=n),n!==i&&(i=(i=a8(i))==i?i:0),n!==t&&(t=(t=a8(t))==t?t:0),iO(a8(e),t,i)},ig.clone=function(e){return iN(e,4)},ig.cloneDeep=function(e){return iN(e,5)},ig.cloneDeepWith=function(e,t){return iN(e,5,t="function"==typeof t?t:n)},ig.cloneWith=function(e,t){return iN(e,4,t="function"==typeof t?t:n)},ig.conformsTo=function(e,t){return null==t||iU(e,t,sd(t))},ig.deburr=sw,ig.defaultTo=function(e,t){return null==e||e!=e?t:e},ig.divide=s0,ig.endsWith=function(e,t,i){e=a7(e),t=nS(t);var r=e.length,a=i=n===i?r:iO(a5(i),0,r);return(i-=t.length)>=0&&e.slice(i,a)==t},ig.eq=aI,ig.escape=function(e){return(e=a7(e))&&G.test(e)?e.replace(H,tF):e},ig.escapeRegExp=function(e){return(e=a7(e))&&J.test(e)?e.replace(Q,"\\$&"):e},ig.every=function(e,t,i){var r=aO(e)?th:iV;return i&&rb(e,t,i)&&(t=n),r(e,ru(t,3))},ig.find=ao,ig.findIndex=rW,ig.findKey=function(e,t){return t_(e,ru(t,3),iY)},ig.findLast=al,ig.findLastIndex=rj,ig.findLastKey=function(e,t){return t_(e,ru(t,3),iK)},ig.floor=s1,ig.forEach=ac,ig.forEachRight=ah,ig.forIn=function(e,t){return null==e?e:iq(e,ru(t,3),sp)},ig.forInRight=function(e,t){return null==e?e:iX(e,ru(t,3),sp)},ig.forOwn=function(e,t){return e&&iY(e,ru(t,3))},ig.forOwnRight=function(e,t){return e&&iK(e,ru(t,3))},ig.get=so,ig.gt=aL,ig.gte=aD,ig.has=function(e,t){return null!=e&&ry(e,t,i1)},ig.hasIn=sl,ig.head=rX,ig.identity=sF,ig.includes=function(e,t,i,n){e=aU(e)?e:sA(e),i=i&&!n?a5(i):0;var r=e.length;return i<0&&(i=t2(r+i,0)),aZ(e)?i<=r&&e.indexOf(t,i)>-1:!!r&&tb(e,t,i)>-1},ig.indexOf=function(e,t,i){var n=null==e?0:e.length;if(!n)return -1;var r=null==i?0:a5(i);return r<0&&(r=t2(n+r,0)),tb(e,t,r)},ig.inRange=function(e,t,i){var r,a,s;return t=a4(t),n===i?(i=t,t=0):i=a4(i),(r=e=a8(e))>=t3(a=t,s=i)&&r<t2(a,s)},ig.invoke=su,ig.isArguments=aB,ig.isArray=aO,ig.isArrayBuffer=aN,ig.isArrayLike=aU,ig.isArrayLikeObject=aF,ig.isBoolean=function(e){return!0===e||!1===e||aq(e)&&i$(e)==d},ig.isBuffer=ak,ig.isDate=az,ig.isElement=function(e){return aq(e)&&1===e.nodeType&&!aK(e)},ig.isEmpty=function(e){if(null==e)return!0;if(aU(e)&&(aO(e)||"string"==typeof e||"function"==typeof e.splice||ak(e)||a0(e)||aB(e)))return!e.length;var t=rv(e);if(t==v||t==b)return!e.size;if(rE(e))return!ne(e).length;for(var i in e)if(eL.call(e,i))return!1;return!0},ig.isEqual=function(e,t){return i6(e,t)},ig.isEqualWith=function(e,t,i){var r=(i="function"==typeof i?i:n)?i(e,t):n;return n===r?i6(e,t,n,i):!!r},ig.isError=aH,ig.isFinite=function(e){return"number"==typeof e&&t$(e)},ig.isFunction=aV,ig.isInteger=aG,ig.isLength=aW,ig.isMap=aX,ig.isMatch=function(e,t){return e===t||i8(e,t,rp(t))},ig.isMatchWith=function(e,t,i){return i="function"==typeof i?i:n,i8(e,t,rp(t),i)},ig.isNaN=function(e){return aY(e)&&e!=+e},ig.isNative=function(e){if(rM(e))throw new e_("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return i9(e)},ig.isNil=function(e){return null==e},ig.isNull=function(e){return null===e},ig.isNumber=aY,ig.isObject=aj,ig.isObjectLike=aq,ig.isPlainObject=aK,ig.isRegExp=aQ,ig.isSafeInteger=function(e){return aG(e)&&e>=-0x1fffffffffffff&&e<=0x1fffffffffffff},ig.isSet=aJ,ig.isString=aZ,ig.isSymbol=a$,ig.isTypedArray=a0,ig.isUndefined=function(e){return n===e},ig.isWeakMap=function(e){return aq(e)&&rv(e)==M},ig.isWeakSet=function(e){return aq(e)&&"[object WeakSet]"==i$(e)},ig.join=function(e,t){return null==e?"":t0.call(e,t)},ig.kebabCase=sM,ig.last=rJ,ig.lastIndexOf=function(e,t,i){var r=null==e?0:e.length;if(!r)return -1;var a=r;return n!==i&&(a=(a=a5(i))<0?t2(r+a,0):t3(a,r-1)),t==t?function(e,t,i){for(var n=i+1;n--&&e[n]!==t;);return n}(e,t,a):tA(e,tw,a,!0)},ig.lowerCase=sE,ig.lowerFirst=sC,ig.lt=a1,ig.lte=a2,ig.max=function(e){return e&&e.length?iG(e,sF,i0):n},ig.maxBy=function(e,t){return e&&e.length?iG(e,ru(t,2),i0):n},ig.mean=function(e){return tM(e,sF)},ig.meanBy=function(e,t){return tM(e,ru(t,2))},ig.min=function(e){return e&&e.length?iG(e,sF,nt):n},ig.minBy=function(e,t){return e&&e.length?iG(e,ru(t,2),nt):n},ig.stubArray=sQ,ig.stubFalse=sJ,ig.stubObject=function(){return{}},ig.stubString=function(){return""},ig.stubTrue=function(){return!0},ig.multiply=s2,ig.nth=function(e,t){return e&&e.length?ns(e,a5(t)):n},ig.noConflict=function(){return e5._===this&&(e5._=eU),this},ig.noop=sG,ig.now=av,ig.pad=function(e,t,i){e=a7(e);var n=(t=a5(t))?tj(e):0;if(!t||n>=t)return e;var r=(t-n)/2;return n3(tQ(r),i)+e+n3(tC(r),i)},ig.padEnd=function(e,t,i){e=a7(e);var n=(t=a5(t))?tj(e):0;return t&&n<t?e+n3(t-n,i):e},ig.padStart=function(e,t,i){e=a7(e);var n=(t=a5(t))?tj(e):0;return t&&n<t?n3(t-n,i)+e:e},ig.parseInt=function(e,t,i){return i||null==t?t=0:t&&(t=+t),t5(a7(e).replace(Z,""),t||0)},ig.random=function(e,t,i){if(i&&"boolean"!=typeof i&&rb(e,t,i)&&(t=i=n),n===i&&("boolean"==typeof t?(i=t,t=n):"boolean"==typeof e&&(i=e,e=n)),n===e&&n===t?(e=0,t=1):(e=a4(e),n===t?(t=e,e=0):t=a4(t)),e>t){var r=e;e=t,t=r}if(i||e%1||t%1){var a=t6();return t3(e+a*(t-e+e1("1e-"+((a+"").length-1))),t)}return nu(e,t)},ig.reduce=function(e,t,i){var n=aO(e)?tg:tT,r=arguments.length<3;return n(e,ru(t,4),i,r,iz)},ig.reduceRight=function(e,t,i){var n=aO(e)?tv:tT,r=arguments.length<3;return n(e,ru(t,4),i,r,iH)},ig.repeat=function(e,t,i){return t=(i?rb(e,t,i):n===t)?1:a5(t),nd(a7(e),t)},ig.replace=function(){var e=arguments,t=a7(e[0]);return e.length<3?t:t.replace(e[1],e[2])},ig.result=function(e,t,i){t=nD(t,e);var r=-1,a=t.length;for(a||(a=1,e=n);++r<a;){var s=null==e?n:e[rF(t[r])];n===s&&(r=a,s=i),e=aV(s)?s.call(e):s}return e},ig.round=s3,ig.runInContext=e,ig.sample=function(e){return(aO(e)?iC:function(e){return iC(sA(e))})(e)},ig.size=function(e){if(null==e)return 0;if(aU(e))return aZ(e)?tj(e):e.length;var t=rv(e);return t==v||t==b?e.size:ne(e).length},ig.snakeCase=sT,ig.some=function(e,t,i){var r=aO(e)?ty:ny;return i&&rb(e,t,i)&&(t=n),r(e,ru(t,3))},ig.sortedIndex=function(e,t){return nx(e,t)},ig.sortedIndexBy=function(e,t,i){return n_(e,t,ru(i,2))},ig.sortedIndexOf=function(e,t){var i=null==e?0:e.length;if(i){var n=nx(e,t);if(n<i&&aI(e[n],t))return n}return -1},ig.sortedLastIndex=function(e,t){return nx(e,t,!0)},ig.sortedLastIndexBy=function(e,t,i){return n_(e,t,ru(i,2),!0)},ig.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var i=nx(e,t,!0)-1;if(aI(e[i],t))return i}return -1},ig.startCase=sR,ig.startsWith=function(e,t,i){return e=a7(e),i=null==i?0:iO(a5(i),0,e.length),t=nS(t),e.slice(i,i+t.length)==t},ig.subtract=s4,ig.sum=function(e){return e&&e.length?tR(e,sF):0},ig.sumBy=function(e,t){return e&&e.length?tR(e,ru(t,2)):0},ig.template=function(e,t,i){var r=ig.templateSettings;i&&rb(e,t,i)&&(t=n),e=a7(e),t=si({},t,r,rt);var a,s,o=si({},t.imports,r.imports,rt),l=sd(o),c=tD(o,l),h=0,u=t.interpolate||ef,d="__p += '",p=ew((t.escape||ef).source+"|"+u.source+"|"+(u===q?es:ef).source+"|"+(t.evaluate||ef).source+"|$","g"),f="//# sourceURL="+(eL.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++eJ+"]")+"\n";e.replace(p,function(t,i,n,r,o,l){return n||(n=r),d+=e.slice(h,l).replace(em,tk),i&&(a=!0,d+="' +\n__e("+i+") +\n'"),o&&(s=!0,d+="';\n"+o+";\n__p += '"),n&&(d+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),h=l+t.length,t}),d+="';\n";var m=eL.call(t,"variable")&&t.variable;if(m){if(er.test(m))throw new e_("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(s?d.replace(U,""):d).replace(F,"$1").replace(k,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=sD(function(){return eA(l,f+"return "+d).apply(n,c)});if(g.source=d,aH(g))throw g;return g},ig.times=function(e,t){if((e=a5(e))<1||e>0x1fffffffffffff)return[];var i=0xffffffff,n=t3(e,0xffffffff);t=ru(t),e-=0xffffffff;for(var r=tP(n,t);++i<e;)t(i);return r},ig.toFinite=a4,ig.toInteger=a5,ig.toLength=a6,ig.toLower=function(e){return a7(e).toLowerCase()},ig.toNumber=a8,ig.toSafeInteger=function(e){return e?iO(a5(e),-0x1fffffffffffff,0x1fffffffffffff):0===e?e:0},ig.toString=a7,ig.toUpper=function(e){return a7(e).toUpperCase()},ig.trim=function(e,t,i){if((e=a7(e))&&(i||n===t))return tI(e);if(!e||!(t=nS(t)))return e;var r=tq(e),a=tq(t),s=tO(r,a),o=tN(r,a)+1;return nB(r,s,o).join("")},ig.trimEnd=function(e,t,i){if((e=a7(e))&&(i||n===t))return e.slice(0,tX(e)+1);if(!e||!(t=nS(t)))return e;var r=tq(e),a=tN(r,tq(t))+1;return nB(r,0,a).join("")},ig.trimStart=function(e,t,i){if((e=a7(e))&&(i||n===t))return e.replace(Z,"");if(!e||!(t=nS(t)))return e;var r=tq(e),a=tO(r,tq(t));return nB(r,a).join("")},ig.truncate=function(e,t){var i=30,r="...";if(aj(t)){var a="separator"in t?t.separator:a;i="length"in t?a5(t.length):i,r="omission"in t?nS(t.omission):r}var s=(e=a7(e)).length;if(tz(e)){var o=tq(e);s=o.length}if(i>=s)return e;var l=i-tj(r);if(l<1)return r;var c=o?nB(o,0,l).join(""):e.slice(0,l);if(n===a)return c+r;if(o&&(l+=c.length-l),aQ(a)){if(e.slice(l).search(a)){var h,u=c;for(a.global||(a=ew(a.source,a7(eo.exec(a))+"g")),a.lastIndex=0;h=a.exec(u);)var d=h.index;c=c.slice(0,n===d?l:d)}}else if(e.indexOf(nS(a),l)!=l){var p=c.lastIndexOf(a);p>-1&&(c=c.slice(0,p))}return c+r},ig.unescape=function(e){return(e=a7(e))&&V.test(e)?e.replace(z,tY):e},ig.uniqueId=function(e){var t=++eD;return a7(e)+t},ig.upperCase=sP,ig.upperFirst=sI,ig.each=ac,ig.eachRight=ah,ig.first=rX,sV(ig,(ev={},iY(ig,function(e,t){eL.call(ig.prototype,t)||(ev[t]=e)}),ev),{chain:!1}),ig.VERSION="4.17.21",tc(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){ig[e].placeholder=ig}),tc(["drop","take"],function(e,t){i_.prototype[e]=function(i){i=n===i?1:t2(a5(i),0);var r=this.__filtered__&&!t?new i_(this):this.clone();return r.__filtered__?r.__takeCount__=t3(i,r.__takeCount__):r.__views__.push({size:t3(i,0xffffffff),type:e+(r.__dir__<0?"Right":"")}),r},i_.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),tc(["filter","map","takeWhile"],function(e,t){var i=t+1,n=1==i||3==i;i_.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ru(e,3),type:i}),t.__filtered__=t.__filtered__||n,t}}),tc(["head","last"],function(e,t){var i="take"+(t?"Right":"");i_.prototype[e]=function(){return this[i](1).value()[0]}}),tc(["initial","tail"],function(e,t){var i="drop"+(t?"":"Right");i_.prototype[e]=function(){return this.__filtered__?new i_(this):this[i](1)}}),i_.prototype.compact=function(){return this.filter(sF)},i_.prototype.find=function(e){return this.filter(e).head()},i_.prototype.findLast=function(e){return this.reverse().find(e)},i_.prototype.invokeMap=np(function(e,t){return"function"==typeof e?new i_(this):this.map(function(i){return i4(i,e,t)})}),i_.prototype.reject=function(e){return this.filter(aE(ru(e)))},i_.prototype.slice=function(e,t){e=a5(e);var i=this;return i.__filtered__&&(e>0||t<0)?new i_(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),n!==t&&(i=(t=a5(t))<0?i.dropRight(-t):i.take(t-e)),i)},i_.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},i_.prototype.toArray=function(){return this.take(0xffffffff)},iY(i_.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),a=ig[r?"take"+("last"==t?"Right":""):t],s=r||/^find/.test(t);a&&(ig.prototype[t]=function(){var t=this.__wrapped__,o=r?[1]:arguments,l=t instanceof i_,c=o[0],h=l||aO(t),u=function(e){var t=a.apply(ig,tm([e],o));return r&&d?t[0]:t};h&&i&&"function"==typeof c&&1!=c.length&&(l=h=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&h){t=m?t:new i_(this);var g=e.apply(t,o);return g.__actions__.push({func:ar,args:[u],thisArg:n}),new ix(g,d)}return f&&m?e.apply(this,o):(g=this.thru(u),f?r?g.value()[0]:g.value():g)})}),tc(["pop","push","shift","sort","splice","unshift"],function(e){var t=eC[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);ig.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var r=this.value();return t.apply(aO(r)?r:[],e)}return this[i](function(i){return t.apply(aO(i)?i:[],e)})}}),iY(i_.prototype,function(e,t){var i=ig[t];if(i){var n=i.name+"";eL.call(is,n)||(is[n]=[]),is[n].push({name:t,func:i})}}),is[n$(n,2).name]=[{name:"wrapper",func:n}],i_.prototype.clone=function(){var e=new i_(this.__wrapped__);return e.__actions__=nV(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nV(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nV(this.__views__),e},i_.prototype.reverse=function(){if(this.__filtered__){var e=new i_(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e},i_.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=aO(e),n=t<0,r=i?e.length:0,a=function(e,t,i){for(var n=-1,r=i.length;++n<r;){var a=i[n],s=a.size;switch(a.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=t3(t,e+s);break;case"takeRight":e=t2(e,t-s)}}return{start:e,end:t}}(0,r,this.__views__),s=a.start,o=a.end,l=o-s,c=n?o:s-1,h=this.__iteratees__,u=h.length,d=0,p=t3(l,this.__takeCount__);if(!i||!n&&r==l&&p==l)return nT(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,g=e[c+=t];++m<u;){var v=h[m],y=v.iteratee,x=v.type,_=y(g);if(2==x)g=_;else if(!_){if(1==x)continue e;break e}}f[d++]=g}return f},ig.prototype.at=aa,ig.prototype.chain=function(){return an(this)},ig.prototype.commit=function(){return new ix(this.value(),this.__chain__)},ig.prototype.next=function(){this.__values__===n&&(this.__values__=a3(this.value()));var e=this.__index__>=this.__values__.length,t=e?n:this.__values__[this.__index__++];return{done:e,value:t}},ig.prototype.plant=function(e){for(var t,i=this;i instanceof iy;){var r=rz(i);r.__index__=0,r.__values__=n,t?a.__wrapped__=r:t=r;var a=r;i=i.__wrapped__}return a.__wrapped__=e,t},ig.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof i_){var t=e;return this.__actions__.length&&(t=new i_(this)),(t=t.reverse()).__actions__.push({func:ar,args:[r1],thisArg:n}),new ix(t,this.__chain__)}return this.thru(r1)},ig.prototype.toJSON=ig.prototype.valueOf=ig.prototype.value=function(){return nT(this.__wrapped__,this.__actions__)},ig.prototype.first=ig.prototype.head,e4&&(ig.prototype[e4]=function(){return this}),ig}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(e5._=tK,define(function(){return tK})):e8?((e8.exports=tK)._=tK,e6._=tK):e5._=tK}).call(this)},7911:function(e,t,i){"use strict";i.r(t),i.d(t,{default:()=>m});var n=i(3379),r=i.n(n),a=i(9037),s=i.n(a),o=i(569),l=i.n(o),c=i(3565),h=i.n(c),u=i(9216),d=i.n(u),p=i(182),f={};f.setAttributes=h(),f.insert=l().bind(null,"head"),f.domAPI=s(),f.insertStyleElement=d(),r()(p.Z,f);let m=p.Z&&p.Z.locals?p.Z.locals:void 0},3379:function(e){"use strict";var t=[];function i(e){for(var i=-1,n=0;n<t.length;n++)if(t[n].identifier===e){i=n;break}return i}function n(e,n){for(var r={},a=[],s=0;s<e.length;s++){var o=e[s],l=n.base?o[0]+n.base:o[0],c=r[l]||0,h="".concat(l," ").concat(c);r[l]=c+1;var u=i(h),d={css:o[1],media:o[2],sourceMap:o[3],supports:o[4],layer:o[5]};if(-1!==u)t[u].references++,t[u].updater(d);else{var p=function(e,t){var i=t.domAPI(t);return i.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&i.update(e=t):i.remove()}}(d,n);n.byIndex=s,t.splice(s,0,{identifier:h,updater:p,references:1})}a.push(h)}return a}e.exports=function(e,r){var a=n(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<a.length;s++){var o=i(a[s]);t[o].references--}for(var l=n(e,r),c=0;c<a.length;c++){var h=i(a[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}a=l}}},569:function(e){"use strict";var t={};e.exports=function(e,i){var n=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!n)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(i)}},9216:function(e){"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:function(e,t,i){"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},9037:function(e){"use strict";var t,i=(t=[],function(e,i){return t[e]=i,t.filter(Boolean).join("\n")});function n(e,t,n,r){var a;if(n)a="";else{a="",r.supports&&(a+="@supports (".concat(r.supports,") {")),r.media&&(a+="@media ".concat(r.media," {"));var s=void 0!==r.layer;s&&(a+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),a+=r.css,s&&(a+="}"),r.media&&(a+="}"),r.supports&&(a+="}")}if(e.styleSheet)e.styleSheet.cssText=i(t,a);else{var o=document.createTextNode(a),l=e.childNodes;l[t]&&e.removeChild(l[t]),l.length?e.insertBefore(o,l[t]):e.appendChild(o)}}var r={singleton:null,singletonCounter:0};e.exports=function(e){var t=r.singletonCounter++,i=r.singleton||(r.singleton=e.insertStyleElement(e));return{update:function(e){n(i,t,!1,e)},remove:function(e){n(i,t,!0,e)}}}},6455:function(e){var t;t=function(){"use strict";let e;var t={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};let i=e=>{let t={};for(let i in e)t[e[i]]="swal2-"+e[i];return t},n=i(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","no-war"]),r=i(["success","warning","info","question","error"]),a="SweetAlert2:",s=e=>{let t=[];for(let i=0;i<e.length;i++)-1===t.indexOf(e[i])&&t.push(e[i]);return t},o=e=>e.charAt(0).toUpperCase()+e.slice(1),l=e=>{console.warn("".concat(a," ").concat("object"==typeof e?e.join(" "):e))},c=e=>{console.error("".concat(a," ").concat(e))},h=[],u=e=>{h.includes(e)||(h.push(e),l(e))},d=(e,t)=>{u('"'.concat(e,'" is deprecated and will be removed in the next major release. Please use "').concat(t,'" instead.'))},p=e=>"function"==typeof e?e():e,f=e=>e&&"function"==typeof e.toPromise,m=e=>f(e)?e.toPromise():Promise.resolve(e),g=e=>e&&Promise.resolve(e)===e,v=()=>document.body.querySelector(".".concat(n.container)),y=e=>{let t=v();return t?t.querySelector(e):null},x=e=>y(".".concat(e)),_=()=>x(n.popup),A=()=>x(n.icon),b=()=>x(n.title),S=()=>x(n["html-container"]),w=()=>x(n.image),M=()=>x(n["progress-steps"]),E=()=>x(n["validation-message"]),C=()=>y(".".concat(n.actions," .").concat(n.confirm)),T=()=>y(".".concat(n.actions," .").concat(n.deny)),R=()=>y(".".concat(n.loader)),P=()=>y(".".concat(n.actions," .").concat(n.cancel)),I=()=>x(n.actions),L=()=>x(n.footer),D=()=>x(n["timer-progress-bar"]),B=()=>x(n.close),O=()=>{let e=Array.from(_().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((e,t)=>{let i=parseInt(e.getAttribute("tabindex")),n=parseInt(t.getAttribute("tabindex"));return i>n?1:i<n?-1:0}),t=Array.from(_().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter(e=>"-1"!==e.getAttribute("tabindex"));return s(e.concat(t)).filter(e=>ee(e))},N=()=>z(document.body,n.shown)&&!z(document.body,n["toast-shown"])&&!z(document.body,n["no-backdrop"]),U=()=>_()&&z(_(),n.toast),F={previousBodyPadding:null},k=(e,t)=>{if(e.textContent="",t){let i=new DOMParser().parseFromString(t,"text/html");Array.from(i.querySelector("head").childNodes).forEach(t=>{e.appendChild(t)}),Array.from(i.querySelector("body").childNodes).forEach(t=>{t instanceof HTMLVideoElement||t instanceof HTMLAudioElement?e.appendChild(t.cloneNode(!0)):e.appendChild(t)})}},z=(e,t)=>{if(!t)return!1;let i=t.split(/\s+/);for(let t=0;t<i.length;t++)if(!e.classList.contains(i[t]))return!1;return!0},H=(e,t)=>{Array.from(e.classList).forEach(i=>{Object.values(n).includes(i)||Object.values(r).includes(i)||Object.values(t.showClass).includes(i)||e.classList.remove(i)})},V=(e,t,i)=>{if(H(e,t),t.customClass&&t.customClass[i]){if("string"!=typeof t.customClass[i]&&!t.customClass[i].forEach)return l("Invalid type of customClass.".concat(i,'! Expected string or iterable object, got "').concat(typeof t.customClass[i],'"'));q(e,t.customClass[i])}},G=(e,t)=>{if(!t)return null;switch(t){case"select":case"textarea":case"file":return e.querySelector(".".concat(n.popup," > .").concat(n[t]));case"checkbox":return e.querySelector(".".concat(n.popup," > .").concat(n.checkbox," input"));case"radio":return e.querySelector(".".concat(n.popup," > .").concat(n.radio," input:checked"))||e.querySelector(".".concat(n.popup," > .").concat(n.radio," input:first-child"));case"range":return e.querySelector(".".concat(n.popup," > .").concat(n.range," input"));default:return e.querySelector(".".concat(n.popup," > .").concat(n.input))}},W=e=>{if(e.focus(),"file"!==e.type){let t=e.value;e.value="",e.value=t}},j=(e,t,i)=>{e&&t&&("string"==typeof t&&(t=t.split(/\s+/).filter(Boolean)),t.forEach(t=>{Array.isArray(e)?e.forEach(e=>{i?e.classList.add(t):e.classList.remove(t)}):i?e.classList.add(t):e.classList.remove(t)}))},q=(e,t)=>{j(e,t,!0)},X=(e,t)=>{j(e,t,!1)},Y=(e,t)=>{let i=Array.from(e.children);for(let e=0;e<i.length;e++){let n=i[e];if(n instanceof HTMLElement&&z(n,t))return n}},K=(e,t,i)=>{i==="".concat(parseInt(i))&&(i=parseInt(i)),i||0===parseInt(i)?e.style[t]="number"==typeof i?"".concat(i,"px"):i:e.style.removeProperty(t)},Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex";e.style.display=t},J=e=>{e.style.display="none"},Z=(e,t,i,n)=>{let r=e.querySelector(t);r&&(r.style[i]=n)},$=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flex";t?Q(e,i):J(e)},ee=e=>!!(e&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)),et=()=>!ee(C())&&!ee(T())&&!ee(P()),ei=e=>e.scrollHeight>e.clientHeight,en=e=>{let t=window.getComputedStyle(e),i=parseFloat(t.getPropertyValue("animation-duration")||"0"),n=parseFloat(t.getPropertyValue("transition-duration")||"0");return i>0||n>0},er=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=D();ee(i)&&(t&&(i.style.transition="none",i.style.width="100%"),setTimeout(()=>{i.style.transition="width ".concat(e/1e3,"s linear"),i.style.width="0%"},10))},ea=()=>{let e=D(),t=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="100%";let i=parseInt(window.getComputedStyle(e).width);e.style.removeProperty("transition"),e.style.width="".concat(t/i*100,"%")},es={},eo=()=>{es.previousActiveElement instanceof HTMLElement?(es.previousActiveElement.focus(),es.previousActiveElement=null):document.body&&document.body.focus()},el=e=>new Promise(t=>{if(!e)return t();let i=window.scrollX,n=window.scrollY;es.restoreFocusTimeout=setTimeout(()=>{eo(),t()},100),window.scrollTo(i,n)}),ec=()=>"undefined"==typeof window||"undefined"==typeof document,eh='\n <div aria-labelledby="'.concat(n.title,'" aria-describedby="').concat(n["html-container"],'" class="').concat(n.popup,'" tabindex="-1">\n   <button type="button" class="').concat(n.close,'"></button>\n   <ul class="').concat(n["progress-steps"],'"></ul>\n   <div class="').concat(n.icon,'"></div>\n   <img class="').concat(n.image,'" />\n   <h2 class="').concat(n.title,'" id="').concat(n.title,'"></h2>\n   <div class="').concat(n["html-container"],'" id="').concat(n["html-container"],'"></div>\n   <input class="').concat(n.input,'" />\n   <input type="file" class="').concat(n.file,'" />\n   <div class="').concat(n.range,'">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="').concat(n.select,'"></select>\n   <div class="').concat(n.radio,'"></div>\n   <label for="').concat(n.checkbox,'" class="').concat(n.checkbox,'">\n     <input type="checkbox" />\n     <span class="').concat(n.label,'"></span>\n   </label>\n   <textarea class="').concat(n.textarea,'"></textarea>\n   <div class="').concat(n["validation-message"],'" id="').concat(n["validation-message"],'"></div>\n   <div class="').concat(n.actions,'">\n     <div class="').concat(n.loader,'"></div>\n     <button type="button" class="').concat(n.confirm,'"></button>\n     <button type="button" class="').concat(n.deny,'"></button>\n     <button type="button" class="').concat(n.cancel,'"></button>\n   </div>\n   <div class="').concat(n.footer,'"></div>\n   <div class="').concat(n["timer-progress-bar-container"],'">\n     <div class="').concat(n["timer-progress-bar"],'"></div>\n   </div>\n </div>\n').replace(/(^|\n)\s*/g,""),eu=()=>{let e=v();return!!e&&(e.remove(),X([document.documentElement,document.body],[n["no-backdrop"],n["toast-shown"],n["has-column"]]),!0)},ed=()=>{es.currentInstance.resetValidationMessage()},ep=()=>{let e=_(),t=Y(e,n.input),i=Y(e,n.file),r=e.querySelector(".".concat(n.range," input")),a=e.querySelector(".".concat(n.range," output")),s=Y(e,n.select),o=e.querySelector(".".concat(n.checkbox," input")),l=Y(e,n.textarea);t.oninput=ed,i.onchange=ed,s.onchange=ed,o.onchange=ed,l.oninput=ed,r.oninput=()=>{ed(),a.value=r.value},r.onchange=()=>{ed(),a.value=r.value}},ef=e=>"string"==typeof e?document.querySelector(e):e,em=e=>{let t=_();t.setAttribute("role",e.toast?"alert":"dialog"),t.setAttribute("aria-live",e.toast?"polite":"assertive"),e.toast||t.setAttribute("aria-modal","true")},eg=e=>{"rtl"===window.getComputedStyle(e).direction&&q(v(),n.rtl)},ev=e=>{let t=eu();if(ec()){c("SweetAlert2 requires document to initialize");return}let i=document.createElement("div");i.className=n.container,t&&q(i,n["no-transition"]),k(i,eh);let r=ef(e.target);r.appendChild(i),em(e),eg(r),ep()},ey=(e,t)=>{e instanceof HTMLElement?t.appendChild(e):"object"==typeof e?ex(e,t):e&&k(t,e)},ex=(e,t)=>{e.jquery?e_(t,e):k(t,e.toString())},e_=(e,t)=>{if(e.textContent="",0 in t)for(let i=0;i in t;i++)e.appendChild(t[i].cloneNode(!0));else e.appendChild(t.cloneNode(!0))},eA=(()=>{if(ec())return!1;let e=document.createElement("div"),t={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&void 0!==e.style[i])return t[i];return!1})(),eb=()=>{let e=document.createElement("div");e.className=n["scrollbar-measure"],document.body.appendChild(e);let t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},eS=(e,t)=>{let i=I(),r=R();t.showConfirmButton||t.showDenyButton||t.showCancelButton?Q(i):J(i),V(i,t,"actions"),function(e,t,i){let r=C(),a=T(),s=P();ew(r,"confirm",i),ew(a,"deny",i),ew(s,"cancel",i),function(e,t,i,r){if(!r.buttonsStyling){X([e,t,i],n.styled);return}q([e,t,i],n.styled),r.confirmButtonColor&&(e.style.backgroundColor=r.confirmButtonColor,q(e,n["default-outline"])),r.denyButtonColor&&(t.style.backgroundColor=r.denyButtonColor,q(t,n["default-outline"])),r.cancelButtonColor&&(i.style.backgroundColor=r.cancelButtonColor,q(i,n["default-outline"]))}(r,a,s,i),i.reverseButtons&&(i.toast?(e.insertBefore(s,r),e.insertBefore(a,r)):(e.insertBefore(s,t),e.insertBefore(a,t),e.insertBefore(r,t)))}(i,r,t),k(r,t.loaderHtml),V(r,t,"loader")};function ew(e,t,i){$(e,i["show".concat(o(t),"Button")],"inline-block"),k(e,i["".concat(t,"ButtonText")]),e.setAttribute("aria-label",i["".concat(t,"ButtonAriaLabel")]),e.className=n[t],V(e,i,"".concat(t,"Button")),q(e,i["".concat(t,"ButtonClass")])}let eM=(e,t)=>{let i=B();k(i,t.closeButtonHtml),V(i,t,"closeButton"),$(i,t.showCloseButton),i.setAttribute("aria-label",t.closeButtonAriaLabel)},eE=(e,t)=>{let i=v();if(i){var r,a,s,o;r=i,"string"==typeof(a=t.backdrop)?r.style.background=a:a||q([document.documentElement,document.body],n["no-backdrop"]),s=i,(o=t.position)in n?q(s,n[o]):(l('The "position" parameter is not valid, defaulting to "center"'),q(s,n.center)),function(e,t){if(t&&"string"==typeof t){let i="grow-".concat(t);i in n&&q(e,n[i])}}(i,t.grow),V(i,t,"container")}},eC=["input","file","range","select","radio","checkbox","textarea"],eT=(e,i)=>{let r=_(),a=t.innerParams.get(e),s=!a||i.input!==a.input;eC.forEach(e=>{let t=Y(r,n[e]);eI(e,i.inputAttributes),t.className=n[e],s&&J(t)}),i.input&&(s&&eR(i),eL(i))},eR=e=>{if(!eU[e.input]){c('Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "'.concat(e.input,'"'));return}let t=eO(e.input),i=eU[e.input](t,e);Q(t),setTimeout(()=>{W(i)})},eP=e=>{for(let t=0;t<e.attributes.length;t++){let i=e.attributes[t].name;["type","value","style"].includes(i)||e.removeAttribute(i)}},eI=(e,t)=>{let i=G(_(),e);if(i)for(let e in eP(i),t)i.setAttribute(e,t[e])},eL=e=>{let t=eO(e.input);"object"==typeof e.customClass&&q(t,e.customClass.input)},eD=(e,t)=>{(!e.placeholder||t.inputPlaceholder)&&(e.placeholder=t.inputPlaceholder)},eB=(e,t,i)=>{if(i.inputLabel){e.id=n.input;let r=document.createElement("label"),a=n["input-label"];r.setAttribute("for",e.id),r.className=a,"object"==typeof i.customClass&&q(r,i.customClass.inputLabel),r.innerText=i.inputLabel,t.insertAdjacentElement("beforebegin",r)}},eO=e=>Y(_(),n[e]||n.input),eN=(e,t)=>{["string","number"].includes(typeof t)?e.value="".concat(t):g(t)||l('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(typeof t,'"'))},eU={};eU.text=eU.email=eU.password=eU.number=eU.tel=eU.url=(e,t)=>(eN(e,t.inputValue),eB(e,e,t),eD(e,t),e.type=t.input,e),eU.file=(e,t)=>(eB(e,e,t),eD(e,t),e),eU.range=(e,t)=>{let i=e.querySelector("input"),n=e.querySelector("output");return eN(i,t.inputValue),i.type=t.input,eN(n,t.inputValue),eB(i,e,t),e},eU.select=(e,t)=>{if(e.textContent="",t.inputPlaceholder){let i=document.createElement("option");k(i,t.inputPlaceholder),i.value="",i.disabled=!0,i.selected=!0,e.appendChild(i)}return eB(e,e,t),e},eU.radio=e=>(e.textContent="",e),eU.checkbox=(e,t)=>{let i=G(_(),"checkbox");return i.value="1",i.id=n.checkbox,i.checked=!!t.inputValue,k(e.querySelector("span"),t.inputPlaceholder),i},eU.textarea=(e,t)=>{eN(e,t.inputValue),eD(e,t),eB(e,e,t);let i=e=>parseInt(window.getComputedStyle(e).marginLeft)+parseInt(window.getComputedStyle(e).marginRight);return setTimeout(()=>{if("MutationObserver"in window){let t=parseInt(window.getComputedStyle(_()).width);new MutationObserver(()=>{let n=e.offsetWidth+i(e);n>t?_().style.width="".concat(n,"px"):_().style.width=null}).observe(e,{attributes:!0,attributeFilter:["style"]})}}),e};let eF=(e,t)=>{let i=S();V(i,t,"htmlContainer"),t.html?(ey(t.html,i),Q(i,"block")):t.text?(i.textContent=t.text,Q(i,"block")):J(i),eT(e,t)},ek=(e,t)=>{let i=L();$(i,t.footer),t.footer&&ey(t.footer,i),V(i,t,"footer")},ez=(e,i)=>{let n=t.innerParams.get(e),a=A();if(n&&i.icon===n.icon){eG(a,i),eH(a,i);return}if(!i.icon&&!i.iconHtml){J(a);return}if(i.icon&&-1===Object.keys(r).indexOf(i.icon)){c('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(i.icon,'"')),J(a);return}Q(a),eG(a,i),eH(a,i),q(a,i.showClass.icon)},eH=(e,t)=>{for(let i in r)t.icon!==i&&X(e,r[i]);q(e,r[t.icon]),eW(e,t),eV(),V(e,t,"icon")},eV=()=>{let e=_(),t=window.getComputedStyle(e).getPropertyValue("background-color"),i=e.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let e=0;e<i.length;e++)i[e].style.backgroundColor=t},eG=(e,t)=>{let i,n=e.innerHTML;t.iconHtml?i=ej(t.iconHtml):"success"===t.icon?(i='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',n=n.replace(/ style=".*?"/g,"")):i="error"===t.icon?'\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':ej({question:"?",warning:"!",info:"i"}[t.icon]),n.trim()!==i.trim()&&k(e,i)},eW=(e,t)=>{if(t.iconColor){for(let i of(e.style.color=t.iconColor,e.style.borderColor=t.iconColor,[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"]))Z(e,i,"backgroundColor",t.iconColor);Z(e,".swal2-success-ring","borderColor",t.iconColor)}},ej=e=>'<div class="'.concat(n["icon-content"],'">').concat(e,"</div>"),eq=(e,t)=>{let i=w();if(!t.imageUrl){J(i);return}Q(i,""),i.setAttribute("src",t.imageUrl),i.setAttribute("alt",t.imageAlt),K(i,"width",t.imageWidth),K(i,"height",t.imageHeight),i.className=n.image,V(i,t,"image")},eX=(e,t)=>{let i=v(),n=_();t.toast?(K(i,"width",t.width),n.style.width="100%",n.insertBefore(R(),A())):K(n,"width",t.width),K(n,"padding",t.padding),t.color&&(n.style.color=t.color),t.background&&(n.style.background=t.background),J(E()),eY(n,t)},eY=(e,t)=>{e.className="".concat(n.popup," ").concat(ee(e)?t.showClass.popup:""),t.toast?(q([document.documentElement,document.body],n["toast-shown"]),q(e,n.toast)):q(e,n.modal),V(e,t,"popup"),"string"==typeof t.customClass&&q(e,t.customClass),t.icon&&q(e,n["icon-".concat(t.icon)])},eK=(e,t)=>{let i=M();if(!t.progressSteps||0===t.progressSteps.length){J(i);return}Q(i),i.textContent="",t.currentProgressStep>=t.progressSteps.length&&l("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),t.progressSteps.forEach((e,r)=>{let a=eQ(e);if(i.appendChild(a),r===t.currentProgressStep&&q(a,n["active-progress-step"]),r!==t.progressSteps.length-1){let e=eJ(t);i.appendChild(e)}})},eQ=e=>{let t=document.createElement("li");return q(t,n["progress-step"]),k(t,e),t},eJ=e=>{let t=document.createElement("li");return q(t,n["progress-step-line"]),e.progressStepsDistance&&K(t,"width",e.progressStepsDistance),t},eZ=(e,t)=>{let i=b();$(i,t.title||t.titleText,"block"),t.title&&ey(t.title,i),t.titleText&&(i.innerText=t.titleText),V(i,t,"title")},e$=(e,t)=>{eX(e,t),eE(e,t),eK(e,t),ez(e,t),eq(e,t),eZ(e,t),eM(e,t),eF(e,t),eS(e,t),ek(e,t),"function"==typeof t.didRender&&t.didRender(_())};function e0(){let e=t.innerParams.get(this);if(!e)return;let i=t.domCache.get(this);J(i.loader),U()?e.icon&&Q(A()):e1(i),X([i.popup,i.actions],n.loading),i.popup.removeAttribute("aria-busy"),i.popup.removeAttribute("data-loading"),i.confirmButton.disabled=!1,i.denyButton.disabled=!1,i.cancelButton.disabled=!1}let e1=e=>{let t=e.popup.getElementsByClassName(e.loader.getAttribute("data-button-to-replace"));t.length?Q(t[0],"inline-block"):et()&&J(e.actions)},e2=()=>C()&&C().click(),e3=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),e4=e=>{e.keydownTarget&&e.keydownHandlerAdded&&(e.keydownTarget.removeEventListener("keydown",e.keydownHandler,{capture:e.keydownListenerCapture}),e.keydownHandlerAdded=!1)},e5=(e,t,i,n)=>{e4(t),i.toast||(t.keydownHandler=t=>e7(e,t,n),t.keydownTarget=i.keydownListenerCapture?window:_(),t.keydownListenerCapture=i.keydownListenerCapture,t.keydownTarget.addEventListener("keydown",t.keydownHandler,{capture:t.keydownListenerCapture}),t.keydownHandlerAdded=!0)},e6=(e,t,i)=>{let n=O();if(n.length)return(t+=i)===n.length?t=0:-1===t&&(t=n.length-1),n[t].focus();_().focus()},e8=["ArrowRight","ArrowDown"],e9=["ArrowLeft","ArrowUp"],e7=(e,i,n)=>{let r=t.innerParams.get(e);r&&!i.isComposing&&229!==i.keyCode&&(r.stopKeydownPropagation&&i.stopPropagation(),"Enter"===i.key?te(e,i,r):"Tab"===i.key?tt(i,r):[...e8,...e9].includes(i.key)?ti(i.key):"Escape"===i.key&&tn(i,r,n))},te=(e,t,i)=>{if(p(i.allowEnterKey)&&t.target&&e.getInput()&&t.target instanceof HTMLElement&&t.target.outerHTML===e.getInput().outerHTML){if(!["textarea","file"].includes(i.input))e2(),t.preventDefault()}},tt=(e,t)=>{let i=e.target,n=O(),r=-1;for(let e=0;e<n.length;e++)if(i===n[e]){r=e;break}e.shiftKey?e6(t,r,-1):e6(t,r,1),e.stopPropagation(),e.preventDefault()},ti=e=>{let t=C(),i=T(),n=P();if(document.activeElement instanceof HTMLElement&&![t,i,n].includes(document.activeElement))return;let r=e8.includes(e)?"nextElementSibling":"previousElementSibling",a=document.activeElement;for(let e=0;e<I().children.length;e++){if(!(a=a[r]))return;if(a instanceof HTMLButtonElement&&ee(a))break}a instanceof HTMLButtonElement&&a.focus()},tn=(e,t,i)=>{p(t.allowEscapeKey)&&(e.preventDefault(),i(e3.esc))};var tr={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};let ta=()=>{Array.from(document.body.children).forEach(e=>{!(e===v()||e.contains(v()))&&(e.hasAttribute("aria-hidden")&&e.setAttribute("data-previous-aria-hidden",e.getAttribute("aria-hidden")),e.setAttribute("aria-hidden","true"))})},ts=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},to=()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!z(document.body,n.iosfix)){let e=document.body.scrollTop;document.body.style.top="".concat(-1*e,"px"),q(document.body,n.iosfix),tc(),tl()}},tl=()=>{let e=navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),i=!!e.match(/WebKit/i);t&&i&&!e.match(/CriOS/i)&&_().scrollHeight>window.innerHeight-44&&(v().style.paddingBottom="".concat(44,"px"))},tc=()=>{let e;let t=v();t.ontouchstart=t=>{e=th(t)},t.ontouchmove=t=>{e&&(t.preventDefault(),t.stopPropagation())}},th=e=>{let t=e.target,i=v();return!(tu(e)||td(e))&&!!(t===i||!ei(i)&&t instanceof HTMLElement&&"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!(ei(S())&&S().contains(t)))},tu=e=>e.touches&&e.touches.length&&"stylus"===e.touches[0].touchType,td=e=>e.touches&&e.touches.length>1,tp=()=>{if(z(document.body,n.iosfix)){let e=parseInt(document.body.style.top,10);X(document.body,n.iosfix),document.body.style.top="",document.body.scrollTop=-1*e}},tf=()=>{null===F.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(F.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(F.previousBodyPadding+eb(),"px"))},tm=()=>{null!==F.previousBodyPadding&&(document.body.style.paddingRight="".concat(F.previousBodyPadding,"px"),F.previousBodyPadding=null)};function tg(e,t,i,r){U()?tS(e,r):(el(i).then(()=>tS(e,r)),e4(es)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(t.setAttribute("style","display:none !important"),t.removeAttribute("class"),t.innerHTML=""):t.remove(),N()&&(tm(),tp(),ts()),X([document.documentElement,document.body],[n.shown,n["height-auto"],n["no-backdrop"],n["toast-shown"]])}function tv(e){e=t_(e);let t=tr.swalPromiseResolve.get(this),i=ty(this);this.isAwaitingPromise()?e.isDismissed||(tx(this),t(e)):i&&t(e)}let ty=e=>{let i=_();if(!i)return!1;let n=t.innerParams.get(e);if(!n||z(i,n.hideClass.popup))return!1;X(i,n.showClass.popup),q(i,n.hideClass.popup);let r=v();return X(r,n.showClass.backdrop),q(r,n.hideClass.backdrop),tA(e,i,n),!0},tx=e=>{e.isAwaitingPromise()&&(t.awaitingPromise.delete(e),t.innerParams.get(e)||e._destroy())},t_=e=>void 0===e?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},e),tA=(e,t,i)=>{let n=v(),r=eA&&en(t);"function"==typeof i.willClose&&i.willClose(t),r?tb(e,t,n,i.returnFocus,i.didClose):tg(e,n,i.returnFocus,i.didClose)},tb=(e,t,i,n,r)=>{es.swalCloseEventFinishedCallback=tg.bind(null,e,i,n,r),t.addEventListener(eA,function(e){e.target===t&&(es.swalCloseEventFinishedCallback(),delete es.swalCloseEventFinishedCallback)})},tS=(e,t)=>{setTimeout(()=>{"function"==typeof t&&t.bind(e.params)(),e._destroy()})};function tw(e,i,n){let r=t.domCache.get(e);i.forEach(e=>{r[e].disabled=n})}function tM(e,t){if(e){if("radio"===e.type){let i=e.parentNode.parentNode.querySelectorAll("input");for(let e=0;e<i.length;e++)i[e].disabled=t}else e.disabled=t}}let tE={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},tC=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],tT={},tR=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],tP=e=>Object.prototype.hasOwnProperty.call(tE,e),tI=e=>-1!==tC.indexOf(e),tL=e=>tT[e],tD=e=>{tP(e)||l('Unknown parameter "'.concat(e,'"'))},tB=e=>{tR.includes(e)&&l('The parameter "'.concat(e,'" is incompatible with toasts'))},tO=e=>{tL(e)&&d(e,tL(e))},tN=e=>{for(let t in!e.backdrop&&e.allowOutsideClick&&l('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),e)tD(t),e.toast&&tB(t),tO(t)},tU=e=>{let t={};return Object.keys(e).forEach(i=>{tI(i)?t[i]=e[i]:l("Invalid parameter to update: ".concat(i))}),t},tF=e=>{tk(e),delete e.params,delete es.keydownHandler,delete es.keydownTarget,delete es.currentInstance},tk=e=>{e.isAwaitingPromise()?(tz(t,e),t.awaitingPromise.set(e,!0)):(tz(tr,e),tz(t,e))},tz=(e,t)=>{for(let i in e)e[i].delete(t)};var tH=Object.freeze({hideLoading:e0,disableLoading:e0,getInput:function(e){let i=t.innerParams.get(e||this),n=t.domCache.get(e||this);return n?G(n.popup,i.input):null},close:tv,isAwaitingPromise:function(){return!!t.awaitingPromise.get(this)},rejectPromise:function(e){let t=tr.swalPromiseReject.get(this);tx(this),t&&t(e)},handleAwaitingPromise:tx,closePopup:tv,closeModal:tv,closeToast:tv,enableButtons:function(){tw(this,["confirmButton","denyButton","cancelButton"],!1)},disableButtons:function(){tw(this,["confirmButton","denyButton","cancelButton"],!0)},enableInput:function(){tM(this.getInput(),!1)},disableInput:function(){tM(this.getInput(),!0)},showValidationMessage:function(e){let i=t.domCache.get(this),r=t.innerParams.get(this);k(i.validationMessage,e),i.validationMessage.className=n["validation-message"],r.customClass&&r.customClass.validationMessage&&q(i.validationMessage,r.customClass.validationMessage),Q(i.validationMessage);let a=this.getInput();a&&(a.setAttribute("aria-invalid",!0),a.setAttribute("aria-describedby",n["validation-message"]),W(a),q(a,n.inputerror))},resetValidationMessage:function(){let e=t.domCache.get(this);e.validationMessage&&J(e.validationMessage);let i=this.getInput();i&&(i.removeAttribute("aria-invalid"),i.removeAttribute("aria-describedby"),X(i,n.inputerror))},getProgressSteps:function(){return t.domCache.get(this).progressSteps},update:function(e){let i=_(),n=t.innerParams.get(this);if(!i||z(i,n.hideClass.popup))return l("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");let r=Object.assign({},n,tU(e));e$(this,r),t.innerParams.set(this,r),Object.defineProperties(this,{params:{value:Object.assign({},this.params,e),writable:!1,enumerable:!0}})},_destroy:function(){let e=t.domCache.get(this),i=t.innerParams.get(this);if(!i){tk(this);return}e.popup&&es.swalCloseEventFinishedCallback&&(es.swalCloseEventFinishedCallback(),delete es.swalCloseEventFinishedCallback),"function"==typeof i.didDestroy&&i.didDestroy(),tF(this)}});let tV=e=>{let t=_();t||new iH,t=_();let i=R();U()?J(A()):tG(t,e),Q(i),t.setAttribute("data-loading","true"),t.setAttribute("aria-busy","true"),t.focus()},tG=(e,t)=>{let i=I(),r=R();!t&&ee(C())&&(t=C()),Q(i),t&&(J(t),r.setAttribute("data-button-to-replace",t.className)),r.parentNode.insertBefore(r,t),q([e,i],n.loading)},tW=(e,t)=>{"select"===t.input||"radio"===t.input?tK(e,t):["text","email","number","tel","textarea"].includes(t.input)&&(f(t.inputValue)||g(t.inputValue))&&(tV(C()),tQ(e,t))},tj=(e,t)=>{let i=e.getInput();if(!i)return null;switch(t.input){case"checkbox":return tq(i);case"radio":return tX(i);case"file":return tY(i);default:return t.inputAutoTrim?i.value.trim():i.value}},tq=e=>e.checked?1:0,tX=e=>e.checked?e.value:null,tY=e=>e.files.length?null!==e.getAttribute("multiple")?e.files:e.files[0]:null,tK=(e,t)=>{let i=_(),n=e=>{tJ[t.input](i,tZ(e),t)};f(t.inputOptions)||g(t.inputOptions)?(tV(C()),m(t.inputOptions).then(t=>{e.hideLoading(),n(t)})):"object"==typeof t.inputOptions?n(t.inputOptions):c("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(typeof t.inputOptions))},tQ=(e,t)=>{let i=e.getInput();J(i),m(t.inputValue).then(n=>{i.value="number"===t.input?"".concat(parseFloat(n)||0):"".concat(n),Q(i),i.focus(),e.hideLoading()}).catch(t=>{c("Error in inputValue promise: ".concat(t)),i.value="",Q(i),i.focus(),e.hideLoading()})},tJ={select:(e,t,i)=>{let r=Y(e,n.select),a=(e,t,n)=>{let r=document.createElement("option");r.value=n,k(r,t),r.selected=t$(n,i.inputValue),e.appendChild(r)};t.forEach(e=>{let t=e[0],i=e[1];if(Array.isArray(i)){let e=document.createElement("optgroup");e.label=t,e.disabled=!1,r.appendChild(e),i.forEach(t=>a(e,t[1],t[0]))}else a(r,i,t)}),r.focus()},radio:(e,t,i)=>{let r=Y(e,n.radio);t.forEach(e=>{let t=e[0],a=e[1],s=document.createElement("input"),o=document.createElement("label");s.type="radio",s.name=n.radio,s.value=t,t$(t,i.inputValue)&&(s.checked=!0);let l=document.createElement("span");k(l,a),l.className=n.label,o.appendChild(s),o.appendChild(l),r.appendChild(o)});let a=r.querySelectorAll("input");a.length&&a[0].focus()}},tZ=e=>{let t=[];return"undefined"!=typeof Map&&e instanceof Map?e.forEach((e,i)=>{let n=e;"object"==typeof n&&(n=tZ(n)),t.push([i,n])}):Object.keys(e).forEach(i=>{let n=e[i];"object"==typeof n&&(n=tZ(n)),t.push([i,n])}),t},t$=(e,t)=>t&&t.toString()===e.toString(),t0=e=>{let i=t.innerParams.get(e);e.disableButtons(),i.input?t3(e,"confirm"):t9(e,!0)},t1=e=>{let i=t.innerParams.get(e);e.disableButtons(),i.returnInputValueOnDeny?t3(e,"deny"):t5(e,!1)},t2=(e,t)=>{e.disableButtons(),t(e3.cancel)},t3=(e,i)=>{let n=t.innerParams.get(e);if(!n.input){c('The "input" parameter is needed to be set when using returnInputValueOn'.concat(o(i)));return}let r=tj(e,n);n.inputValidator?t4(e,r,i):e.getInput().checkValidity()?"deny"===i?t5(e,r):t9(e,r):(e.enableButtons(),e.showValidationMessage(n.validationMessage))},t4=(e,i,n)=>{let r=t.innerParams.get(e);e.disableInput(),Promise.resolve().then(()=>m(r.inputValidator(i,r.validationMessage))).then(t=>{e.enableButtons(),e.enableInput(),t?e.showValidationMessage(t):"deny"===n?t5(e,i):t9(e,i)})},t5=(e,i)=>{let n=t.innerParams.get(e||void 0);n.showLoaderOnDeny&&tV(T()),n.preDeny?(t.awaitingPromise.set(e||void 0,!0),Promise.resolve().then(()=>m(n.preDeny(i,n.validationMessage))).then(t=>{!1===t?(e.hideLoading(),tx(e)):e.close({isDenied:!0,value:void 0===t?i:t})}).catch(t=>t8(e||void 0,t))):e.close({isDenied:!0,value:i})},t6=(e,t)=>{e.close({isConfirmed:!0,value:t})},t8=(e,t)=>{e.rejectPromise(t)},t9=(e,i)=>{let n=t.innerParams.get(e||void 0);n.showLoaderOnConfirm&&tV(),n.preConfirm?(e.resetValidationMessage(),t.awaitingPromise.set(e||void 0,!0),Promise.resolve().then(()=>m(n.preConfirm(i,n.validationMessage))).then(t=>{ee(E())||!1===t?(e.hideLoading(),tx(e)):t6(e,void 0===t?i:t)}).catch(t=>t8(e||void 0,t))):t6(e,i)},t7=(e,i,n)=>{t.innerParams.get(e).toast?ie(e,i,n):(ir(i),ia(i),is(e,i,n))},ie=(e,i,n)=>{i.popup.onclick=()=>{let i=t.innerParams.get(e);!(i&&(it(i)||i.timer||i.input))&&n(e3.close)}},it=e=>e.showConfirmButton||e.showDenyButton||e.showCancelButton||e.showCloseButton,ii=!1,ir=e=>{e.popup.onmousedown=()=>{e.container.onmouseup=function(t){e.container.onmouseup=void 0,t.target===e.container&&(ii=!0)}}},ia=e=>{e.container.onmousedown=()=>{e.popup.onmouseup=function(t){e.popup.onmouseup=void 0,(t.target===e.popup||e.popup.contains(t.target))&&(ii=!0)}}},is=(e,i,n)=>{i.container.onclick=r=>{let a=t.innerParams.get(e);if(ii){ii=!1;return}r.target===i.container&&p(a.allowOutsideClick)&&n(e3.backdrop)}},io=e=>"object"==typeof e&&e.jquery,il=e=>e instanceof Element||io(e),ic=()=>{if(es.timeout)return ea(),es.timeout.stop()},ih=()=>{if(es.timeout){let e=es.timeout.start();return er(e),e}},iu=!1,id={},ip=e=>{for(let t=e.target;t&&t!==document;t=t.parentNode)for(let e in id){let i=t.getAttribute(e);if(i){id[e].fire({template:i});return}}};var im=Object.freeze({isValidParameter:tP,isUpdatableParameter:tI,isDeprecatedParameter:tL,argsToParams:e=>{let t={};return"object"!=typeof e[0]||il(e[0])?["title","html","icon"].forEach((i,n)=>{let r=e[n];"string"==typeof r||il(r)?t[i]=r:void 0!==r&&c("Unexpected type of ".concat(i,'! Expected "string" or "Element", got ').concat(typeof r))}):Object.assign(t,e[0]),t},isVisible:()=>ee(_()),clickConfirm:e2,clickDeny:()=>T()&&T().click(),clickCancel:()=>P()&&P().click(),getContainer:v,getPopup:_,getTitle:b,getHtmlContainer:S,getImage:w,getIcon:A,getInputLabel:()=>x(n["input-label"]),getCloseButton:B,getActions:I,getConfirmButton:C,getDenyButton:T,getCancelButton:P,getLoader:R,getFooter:L,getTimerProgressBar:D,getFocusableElements:O,getValidationMessage:E,isLoading:()=>_().hasAttribute("data-loading"),fire:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return new this(...t)},mixin:function(e){return class extends this{_main(t,i){return super._main(t,Object.assign({},e,i))}}},showLoading:tV,enableLoading:tV,getTimerLeft:()=>es.timeout&&es.timeout.getTimerLeft(),stopTimer:ic,resumeTimer:ih,toggleTimer:()=>{let e=es.timeout;return e&&(e.running?ic():ih())},increaseTimer:e=>{if(es.timeout){let t=es.timeout.increase(e);return er(t,!0),t}},isTimerRunning:()=>es.timeout&&es.timeout.isRunning(),bindClickHandler:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template";id[e]=this,iu||(document.body.addEventListener("click",ip),iu=!0)}});class ig{constructor(e,t){this.callback=e,this.remaining=t,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(e){let t=this.running;return t&&this.stop(),this.remaining+=e,t&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}let iv=["swal-title","swal-html","swal-footer"],iy=e=>{let t="string"==typeof e.template?document.querySelector(e.template):e.template;if(!t)return{};let i=t.content;return iM(i),Object.assign(ix(i),i_(i),iA(i),ib(i),iS(i),iw(i,iv))},ix=e=>{let t={};return Array.from(e.querySelectorAll("swal-param")).forEach(e=>{iE(e,["name","value"]);let i=e.getAttribute("name"),n=e.getAttribute("value");"boolean"==typeof tE[i]?t[i]="false"!==n:"object"==typeof tE[i]?t[i]=JSON.parse(n):t[i]=n}),t},i_=e=>{let t={};return Array.from(e.querySelectorAll("swal-button")).forEach(e=>{iE(e,["type","color","aria-label"]);let i=e.getAttribute("type");t["".concat(i,"ButtonText")]=e.innerHTML,t["show".concat(o(i),"Button")]=!0,e.hasAttribute("color")&&(t["".concat(i,"ButtonColor")]=e.getAttribute("color")),e.hasAttribute("aria-label")&&(t["".concat(i,"ButtonAriaLabel")]=e.getAttribute("aria-label"))}),t},iA=e=>{let t={},i=e.querySelector("swal-image");return i&&(iE(i,["src","width","height","alt"]),i.hasAttribute("src")&&(t.imageUrl=i.getAttribute("src")),i.hasAttribute("width")&&(t.imageWidth=i.getAttribute("width")),i.hasAttribute("height")&&(t.imageHeight=i.getAttribute("height")),i.hasAttribute("alt")&&(t.imageAlt=i.getAttribute("alt"))),t},ib=e=>{let t={},i=e.querySelector("swal-icon");return i&&(iE(i,["type","color"]),i.hasAttribute("type")&&(t.icon=i.getAttribute("type")),i.hasAttribute("color")&&(t.iconColor=i.getAttribute("color")),t.iconHtml=i.innerHTML),t},iS=e=>{let t={},i=e.querySelector("swal-input");i&&(iE(i,["type","label","placeholder","value"]),t.input=i.getAttribute("type")||"text",i.hasAttribute("label")&&(t.inputLabel=i.getAttribute("label")),i.hasAttribute("placeholder")&&(t.inputPlaceholder=i.getAttribute("placeholder")),i.hasAttribute("value")&&(t.inputValue=i.getAttribute("value")));let n=Array.from(e.querySelectorAll("swal-input-option"));return n.length&&(t.inputOptions={},n.forEach(e=>{iE(e,["value"]);let i=e.getAttribute("value"),n=e.innerHTML;t.inputOptions[i]=n})),t},iw=(e,t)=>{let i={};for(let n in t){let r=t[n],a=e.querySelector(r);a&&(iE(a,[]),i[r.replace(/^swal-/,"")]=a.innerHTML.trim())}return i},iM=e=>{let t=iv.concat(["swal-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(e.children).forEach(e=>{let i=e.tagName.toLowerCase();t.includes(i)||l("Unrecognized element <".concat(i,">"))})},iE=(e,t)=>{Array.from(e.attributes).forEach(i=>{-1===t.indexOf(i.name)&&l(['Unrecognized attribute "'.concat(i.name,'" on <').concat(e.tagName.toLowerCase(),">."),"".concat(t.length?"Allowed attributes are: ".concat(t.join(", ")):"To set the value, use HTML within the element.")])})},iC=e=>{let t=v(),i=_();"function"==typeof e.willOpen&&e.willOpen(i);let r=window.getComputedStyle(document.body).overflowY;iI(t,i,e),setTimeout(()=>{iR(t,i)},10),N()&&(iP(t,e.scrollbarPadding,r),ta()),U()||es.previousActiveElement||(es.previousActiveElement=document.activeElement),"function"==typeof e.didOpen&&setTimeout(()=>e.didOpen(i)),X(t,n["no-transition"])},iT=e=>{let t=_();if(e.target!==t)return;let i=v();t.removeEventListener(eA,iT),i.style.overflowY="auto"},iR=(e,t)=>{eA&&en(t)?(e.style.overflowY="hidden",t.addEventListener(eA,iT)):e.style.overflowY="auto"},iP=(e,t,i)=>{to(),t&&"hidden"!==i&&tf(),setTimeout(()=>{e.scrollTop=0})},iI=(e,t,i)=>{q(e,i.showClass.backdrop),t.style.setProperty("opacity","0","important"),Q(t,"grid"),setTimeout(()=>{q(t,i.showClass.popup),t.style.removeProperty("opacity")},10),q([document.documentElement,document.body],n.shown),i.heightAuto&&i.backdrop&&!i.toast&&q([document.documentElement,document.body],n["height-auto"])};var iL={email:(e,t)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid email address"),url:(e,t)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(e)?Promise.resolve():Promise.resolve(t||"Invalid URL")};class iD{constructor(){if("undefined"==typeof window)return;e=this;for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];Object.defineProperties(this,{params:{value:Object.freeze(this.constructor.argsToParams(n)),writable:!1,enumerable:!0,configurable:!0}});let a=e._main(e.params);t.promise.set(this,a)}_main(i){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};tN(Object.assign({},n,i)),es.currentInstance&&(es.currentInstance._destroy(),N()&&ts()),es.currentInstance=e;let r=iO(i,n);r.inputValidator||Object.keys(iL).forEach(e=>{r.input===e&&(r.inputValidator=iL[e])}),r.showLoaderOnConfirm&&!r.preConfirm&&l("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),r.target&&("string"!=typeof r.target||document.querySelector(r.target))&&("string"==typeof r.target||r.target.appendChild)||(l('Target parameter is not valid, defaulting to "body"'),r.target="body"),"string"==typeof r.title&&(r.title=r.title.split("\n").join("<br />")),ev(r),Object.freeze(r),es.timeout&&(es.timeout.stop(),delete es.timeout),clearTimeout(es.restoreFocusTimeout);let a=iN(e);return e$(e,r),t.innerParams.set(e,r),iB(e,a,r)}then(e){return t.promise.get(this).then(e)}finally(e){return t.promise.get(this).finally(e)}}let iB=(e,t,i)=>new Promise((n,r)=>{let a=t=>{e.close({isDismissed:!0,dismiss:t})};tr.swalPromiseResolve.set(e,n),tr.swalPromiseReject.set(e,r),t.confirmButton.onclick=()=>{t0(e)},t.denyButton.onclick=()=>{t1(e)},t.cancelButton.onclick=()=>{t2(e,a)},t.closeButton.onclick=()=>{a(e3.close)},t7(e,t,a),e5(e,es,i,a),tW(e,i),iC(i),iU(es,i,a),iF(t,i),setTimeout(()=>{t.container.scrollTop=0})}),iO=(e,t)=>{let i=Object.assign({},tE,t,iy(e),e);return i.showClass=Object.assign({},tE.showClass,i.showClass),i.hideClass=Object.assign({},tE.hideClass,i.hideClass),i},iN=e=>{let i={popup:_(),container:v(),actions:I(),confirmButton:C(),denyButton:T(),cancelButton:P(),loader:R(),closeButton:B(),validationMessage:E(),progressSteps:M()};return t.domCache.set(e,i),i},iU=(e,t,i)=>{let n=D();J(n),t.timer&&(e.timeout=new ig(()=>{i("timer"),delete e.timeout},t.timer),t.timerProgressBar&&(Q(n),V(n,t,"timerProgressBar"),setTimeout(()=>{e.timeout&&e.timeout.running&&er(t.timer)})))},iF=(e,t)=>{if(!t.toast){if(!p(t.allowEnterKey)){iz();return}ik(e,t)||e6(t,-1,1)}},ik=(e,t)=>t.focusDeny&&ee(e.denyButton)?(e.denyButton.focus(),!0):t.focusCancel&&ee(e.cancelButton)?(e.cancelButton.focus(),!0):!!(t.focusConfirm&&ee(e.confirmButton))&&(e.confirmButton.focus(),!0),iz=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if("undefined"!=typeof window&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|xn--p1ai)$/)&&.3>Math.random()){let e;let t=document.createElement("div");t.className="save-yourself-from-war";let i=(e=[{text:"   -           .",id:"X39ZkynPjpQ"}])[Math.floor(Math.random()*e.length)];k(t,"<div>".concat(i.text,'</div>\n      <iframe width="560" height="315" src="https://www.youtube.com/embed/').concat(i.id,'" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>\n      <div>    !</div>\n      '));let n=document.createElement("button");n.innerHTML="&times;",n.onclick=()=>t.remove(),t.appendChild(n),window.addEventListener("load",()=>{setTimeout(()=>{document.body.appendChild(t)},1e3)})}Object.assign(iD.prototype,tH),Object.assign(iD,im),Object.keys(tH).forEach(t=>{iD[t]=function(){if(e)return e[t](...arguments)}}),iD.DismissReason=e3,iD.version="11.4.38";let iH=iD;return iH.default=iH,iH},e.exports=t(),void 0!==this&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),"undefined"!=typeof document&&function(e,t){var i=e.createElement("style");if(e.getElementsByTagName("head")[0].appendChild(i),i.styleSheet)i.styleSheet.disabled||(i.styleSheet.cssText=t);else try{i.innerHTML=t}catch(e){i.innerText=t}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4!important;grid-row:1/4!important;grid-template-columns:1fr 99fr 1fr;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px hsla(0deg,0%,0%,.075),0 1px 2px hsla(0deg,0%,0%,.075),1px 2px 4px hsla(0deg,0%,0%,.075),1px 3px 8px hsla(0deg,0%,0%,.075),2px 4px 16px hsla(0deg,0%,0%,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:700}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.8em;left:-.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;top:0;right:0;bottom:0;left:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content,auto) minmax(min-content,auto) minmax(min-content,auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:0 0!important}.swal2-container.swal2-bottom-start,.swal2-container.swal2-center-start,.swal2-container.swal2-top-start{grid-template-columns:minmax(0,1fr) auto auto}.swal2-container.swal2-bottom,.swal2-container.swal2-center,.swal2-container.swal2-top{grid-template-columns:auto minmax(0,1fr) auto}.swal2-container.swal2-bottom-end,.swal2-container.swal2-center-end,.swal2-container.swal2-top-end{grid-template-columns:auto auto minmax(0,1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-left>.swal2-popup,.swal2-container.swal2-center-start>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-left>.swal2-popup,.swal2-container.swal2-bottom-start>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-fullscreen>.swal2-popup,.swal2-container.swal2-grow-row>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none!important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0,100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:0}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0,0,0,.1),rgba(0,0,0,.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 transparent #2778c4 transparent}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px transparent;font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:0}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto!important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:0 0;color:#ccc;font-family:serif;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:0 0;color:#f27474}.swal2-close:focus{outline:0;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:400;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-checkbox,.swal2-file,.swal2-input,.swal2-radio,.swal2-select,.swal2-textarea{margin:1em 2em 3px}.swal2-file,.swal2-input,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:0 0;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px transparent;color:inherit;font-size:1.125em}.swal2-file.swal2-inputerror,.swal2-input.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474!important;box-shadow:0 0 2px #f27474!important}.swal2-file:focus,.swal2-input:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-file::-moz-placeholder,.swal2-input::-moz-placeholder,.swal2-textarea::-moz-placeholder{color:#ccc}.swal2-file::placeholder,.swal2-input::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 3px;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:0 0;font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:0 0;color:inherit;font-size:1.125em}.swal2-checkbox,.swal2-radio{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-checkbox label,.swal2-radio label{margin:0 .6em;font-size:1.125em}.swal2-checkbox input,.swal2-radio input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid transparent;border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;-webkit-user-select:none;-moz-user-select:none;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-.25em;left:-.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:0 0;font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:transparent}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.save-yourself-from-war{display:flex;position:fixed;z-index:1939;top:0;right:0;bottom:0;left:0;flex-direction:column;align-items:center;justify-content:center;padding:25px 0 20px;background:#20232a;color:#fff;text-align:center}.save-yourself-from-war div{max-width:560px;margin:10px;line-height:146%}.save-yourself-from-war iframe{max-width:100%;max-height:55.5555555556vmin;margin:16px auto}.save-yourself-from-war strong{border-bottom:2px dashed #fff}.save-yourself-from-war button{display:flex;position:fixed;z-index:1940;top:0;right:0;align-items:center;justify-content:center;width:48px;height:48px;margin-right:10px;margin-bottom:-10px;border:none;background:0 0;color:#aaa;font-size:48px;font-weight:700;cursor:pointer}.save-yourself-from-war button:hover{color:#fff}@keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto!important}body.swal2-no-backdrop .swal2-container{background-color:transparent!important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll!important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static!important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:transparent;pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{top:0;right:auto;bottom:auto;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{top:0;right:0;bottom:auto;left:auto}body.swal2-toast-shown .swal2-container.swal2-top-left,body.swal2-toast-shown .swal2-container.swal2-top-start{top:0;right:auto;bottom:auto;left:0}body.swal2-toast-shown .swal2-container.swal2-center-left,body.swal2-toast-shown .swal2-container.swal2-center-start{top:50%;right:auto;bottom:auto;left:0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{top:50%;right:auto;bottom:auto;left:50%;transform:translate(-50%,-50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{top:50%;right:0;bottom:auto;left:auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-left,body.swal2-toast-shown .swal2-container.swal2-bottom-start{top:auto;right:auto;bottom:0;left:0}body.swal2-toast-shown .swal2-container.swal2-bottom{top:auto;right:auto;bottom:0;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{top:auto;right:0;bottom:0;left:auto}')},4301:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Character=void 0;let n=i(7678),r=i(3687),a=i(6486),s=i(870),o=i(2385),l=i(9019),c=i(5126),h=i(7482),u=i(5353),d=i(3169),p=i(301),f=i(1012),m=i(201),g=i(8508),v=i(7545),y=i(271),x=i(4291),_=i(5506),A=i(6196),b=i(2545);class S extends n.Object3D{constructor(e){super(),this.updateOrder=1,this.entityType=b.EntityType.Character,this.height=0,this.materials=[],this.actionClips={},this.acceleration=new n.Vector3,this.velocity=new n.Vector3,this.arcadeVelocityInfluence=new n.Vector3,this.velocityTarget=new n.Vector3,this.arcadeVelocityIsAdditive=!1,this.defaultVelocitySimulatorDamping=.8,this.defaultVelocitySimulatorMass=50,this.moveSpeed=4,this.angularVelocity=0,this.orientation=new n.Vector3(0,0,1),this.orientationTarget=new n.Vector3(0,0,1),this.defaultRotationSimulatorDamping=.5,this.defaultRotationSimulatorMass=10,this.rayResult=new r.RaycastResult,this.rayHasHit=!1,this.rayCastLength=.57,this.raySafeOffset=.03,this.wantsToJump=!1,this.initJumpSpeed=-1,this.groundImpactData=new _.GroundImpactData,this.occupyingSeat=null,this.vehicleEntryInstance=null,this.physicsEnabled=!0,this.readCharacterData(e),this.mixer=new n.AnimationMixer(e.scene),this.setAnimations(e.animations),this.tiltContainer=new n.Group,this.add(this.tiltContainer),this.modelContainer=new n.Group,this.modelContainer.position.y=-.57,this.tiltContainer.add(this.modelContainer),this.modelContainer.add(e.scene),this.velocitySimulator=new l.VectorSpringSimulator(60,this.defaultVelocitySimulatorMass,this.defaultVelocitySimulatorDamping),this.rotationSimulator=new c.RelativeSpringSimulator(60,this.defaultRotationSimulatorMass,this.defaultRotationSimulatorDamping),this.viewVector=new n.Vector3,this.actions={up:new o.KeyBinding("KeyW"),down:new o.KeyBinding("KeyS"),left:new o.KeyBinding("KeyA"),right:new o.KeyBinding("KeyD"),run:new o.KeyBinding("ShiftLeft"),jump:new o.KeyBinding("Space"),use:new o.KeyBinding("KeyE"),enter:new o.KeyBinding("KeyF"),enter_passenger:new o.KeyBinding("KeyG"),seat_switch:new o.KeyBinding("KeyX"),primary:new o.KeyBinding("Mouse0"),secondary:new o.KeyBinding("Mouse1")},this.characterCapsule=new v.CapsuleCollider({mass:1,position:new r.Vec3,height:.5,radius:.25,segments:8,friction:0}),this.characterCapsule.body.shapes.forEach(e=>{e.collisionFilterMask=~g.CollisionGroups.TrimeshColliders}),this.characterCapsule.body.allowSleep=!1,this.characterCapsule.body.collisionFilterGroup=2,this.characterCapsule.body.fixedRotation=!0,this.characterCapsule.body.updateMassProperties();let t=new n.BoxGeometry(.1,.1,.1),i=new n.MeshLambertMaterial({color:0xff0000});this.raycastBox=new n.Mesh(t,i),this.raycastBox.visible=!1,this.setState(new h.Idle(this))}setAnimations(e){this.animations=e,this.animations.map(e=>{let t=this.mixer.clipAction(e);this.actionClips[e.name]=t,"idle"==t.getClip().name?t.setEffectiveWeight(1):t.setEffectiveWeight(0),t.play()})}setArcadeVelocityInfluence(e,t=e,i=e){this.arcadeVelocityInfluence.set(e,t,i)}setViewVector(e){this.viewVector.copy(e).normalize()}setState(e){this.charState=e,this.charState.onInputChange()}setPosition(e,t,i){this.physicsEnabled?(this.characterCapsule.body.previousPosition=new r.Vec3(e,t,i),this.characterCapsule.body.position=new r.Vec3(e,t,i),this.characterCapsule.body.interpolatedPosition=new r.Vec3(e,t,i)):(this.position.x=e,this.position.y=t,this.position.z=i)}resetVelocity(){this.velocity.x=0,this.velocity.y=0,this.velocity.z=0,this.characterCapsule.body.velocity.x=0,this.characterCapsule.body.velocity.y=0,this.characterCapsule.body.velocity.z=0,this.velocitySimulator.init()}setArcadeVelocityTarget(e,t=0,i=0){this.velocityTarget.z=e,this.velocityTarget.x=t,this.velocityTarget.y=i}setOrientation(e,t=!1){let i=new n.Vector3().copy(e).setY(0).normalize();this.orientationTarget.copy(i),t&&this.orientation.copy(i)}resetOrientation(){let e=s.getForward(this);this.setOrientation(e,!0)}setBehaviour(e){e.character=this,this.behaviour=e}setPhysicsEnabled(e){this.physicsEnabled=e,!0===e?this.world.physicsWorld.addBody(this.characterCapsule.body):this.world.physicsWorld.removeBody(this.characterCapsule.body)}readCharacterData(e){e.scene.traverse(e=>{e.isMesh&&(s.setupMeshProperties(e),void 0!==e.material&&this.materials.push(e.material))})}handleKeyboardEvent(e,t,i){if(void 0!==this.controlledObject)this.controlledObject.handleKeyboardEvent(e,t,i);else if("KeyC"===t&&!0===i&&!0===e.shiftKey)this.resetControls(),this.world.cameraOperator.characterCaller=this,this.world.inputManager.setInputReceiver(this.world.cameraOperator);else if("KeyR"===t&&!0===i&&!0===e.shiftKey)this.world.restartScenario();else for(let e in this.actions)if(this.actions.hasOwnProperty(e)){let n=this.actions[e];a.includes(n.eventCodes,t)&&this.triggerAction(e,i)}}handleMouseButton(e,t,i){if(void 0!==this.controlledObject)this.controlledObject.handleMouseButton(e,t,i);else for(let e in this.actions)if(this.actions.hasOwnProperty(e)){let n=this.actions[e];a.includes(n.eventCodes,t)&&this.triggerAction(e,i)}}handleMouseMove(e,t,i){void 0!==this.controlledObject?this.controlledObject.handleMouseMove(e,t,i):this.world.cameraOperator.move(t,i)}handleMouseWheel(e,t){void 0!==this.controlledObject?this.controlledObject.handleMouseWheel(e,t):this.world.scrollTheTimeScale(t)}triggerAction(e,t){let i=this.actions[e];i.isPressed!==t&&(i.isPressed=t,i.justPressed=!1,i.justReleased=!1,t?i.justPressed=!0:i.justReleased=!0,this.charState.onInputChange(),i.justPressed=!1,i.justReleased=!1)}takeControl(){void 0!==this.world?this.world.inputManager.setInputReceiver(this):console.warn("Attempting to take control of a character that doesn't belong to a world.")}resetControls(){for(let e in this.actions)this.actions.hasOwnProperty(e)&&this.triggerAction(e,!1)}update(e){var t,i,r;if(null===(t=this.behaviour)||void 0===t||t.update(e),null===(i=this.vehicleEntryInstance)||void 0===i||i.update(e),null===(r=this.charState)||void 0===r||r.update(e),this.physicsEnabled&&this.springMovement(e),this.physicsEnabled&&this.springRotation(e),this.physicsEnabled&&this.rotateModel(),void 0!==this.mixer&&this.mixer.update(e),this.physicsEnabled)this.position.set(this.characterCapsule.body.interpolatedPosition.x,this.characterCapsule.body.interpolatedPosition.y,this.characterCapsule.body.interpolatedPosition.z);else{let e=new n.Vector3;this.getWorldPosition(e),this.characterCapsule.body.position.copy(s.cannonVector(e)),this.characterCapsule.body.interpolatedPosition.copy(s.cannonVector(e))}this.updateMatrixWorld()}inputReceiverInit(){if(void 0!==this.controlledObject){this.controlledObject.inputReceiverInit();return}this.world.cameraOperator.setRadius(1.6,!0),this.world.cameraOperator.followMode=!1,this.displayControls()}displayControls(){this.world.updateControls([{keys:["W","A","S","D"],desc:"Movement"},{keys:["Shift"],desc:"Sprint"},{keys:["Space"],desc:"Jump"},{keys:["F","or","G"],desc:"Enter vehicle"},{keys:["Shift","+","R"],desc:"Respawn"},{keys:["Shift","+","C"],desc:"Free camera"}])}inputReceiverUpdate(e){void 0!==this.controlledObject?this.controlledObject.inputReceiverUpdate(e):(this.viewVector=new n.Vector3().subVectors(this.position,this.world.camera.position),this.getWorldPosition(this.world.cameraOperator.target))}setAnimation(e,t){if(void 0!==this.mixer){let i=this.actionClips[e];if(null===i)return console.error(`Animation ${e} not found!`),0;for(let e in this.actionClips)Object.prototype.hasOwnProperty.call(this.actionClips,e)&&this.actionClips[e].fadeOut(.2);return this.setWeight(i,1),i.reset(),i.fadeIn(t),i.getClip().duration}}setWeight(e,t){e.enabled=!0,e.setEffectiveTimeScale(.7),e.setEffectiveWeight(t)}springMovement(e){this.velocitySimulator.target.copy(this.velocityTarget),this.velocitySimulator.simulate(e),this.velocity.copy(this.velocitySimulator.position),this.acceleration.copy(this.velocitySimulator.velocity)}springRotation(e){let t=s.getSignedAngleBetweenVectors(this.orientation,this.orientationTarget);this.rotationSimulator.target=t,this.rotationSimulator.simulate(e);let i=this.rotationSimulator.position;this.orientation.applyAxisAngle(new n.Vector3(0,1,0),i),this.angularVelocity=this.rotationSimulator.velocity}getLocalMovementDirection(){let e=this.actions.right.isPressed?-1:0,t=this.actions.left.isPressed?1:0,i=this.actions.up.isPressed?1:0,r=this.actions.down.isPressed?-1:0;return new n.Vector3(e+t,0,i+r).normalize()}getCameraRelativeMovementVector(){let e=this.getLocalMovementDirection(),t=new n.Vector3(this.viewVector.x,0,this.viewVector.z).normalize();return s.appplyVectorMatrixXZ(t,e)}setCameraRelativeOrientationTarget(){if(null===this.vehicleEntryInstance){let e=this.getCameraRelativeMovementVector();0===e.x&&0===e.y&&0===e.z?this.setOrientation(this.orientation):this.setOrientation(e)}}rotateModel(){this.lookAt(this.position.x+this.orientation.x,this.position.y+this.orientation.y,this.position.z+this.orientation.z),this.tiltContainer.rotation.z=-(2.3*this.angularVelocity)*this.velocity.length(),this.tiltContainer.position.setY(Math.cos(Math.abs(2.3*this.angularVelocity*this.velocity.length()))/2-.5)}jump(e=-1){this.wantsToJump=!0,this.initJumpSpeed=e}findVehicleToEnter(e){let t=new n.Vector3,i=new A.ClosestObjectFinder(this.position,10);if(this.world.vehicles.forEach(e=>{i.consider(e,e.position)}),void 0!==i.closestObject){let n=i.closestObject,r=new y.VehicleEntryInstance(this);r.wantsToDrive=e;let a=new A.ClosestObjectFinder(this.position);for(let i of n.seats)if(e){if(i.type===x.SeatType.Driver)i.seatPointObject.getWorldPosition(t),a.consider(i,t);else if(i.type===x.SeatType.Passenger){for(let e of i.connectedSeats)if(e.type===x.SeatType.Driver){i.seatPointObject.getWorldPosition(t),a.consider(i,t);break}}}else i.type===x.SeatType.Passenger&&(i.seatPointObject.getWorldPosition(t),a.consider(i,t));if(void 0!==a.closestObject){let e=a.closestObject;r.targetSeat=e;let i=new A.ClosestObjectFinder(this.position);for(let n of e.entryPoints)n.getWorldPosition(t),i.consider(n,t);void 0!==i.closestObject&&(r.entryPoint=i.closestObject,this.triggerAction("up",!0),this.vehicleEntryInstance=r)}}}enterVehicle(e,t){var i;this.resetControls(),(null===(i=e.door)||void 0===i?void 0:i.rotation)<.5?this.setState(new p.OpenVehicleDoor(this,e,t)):this.setState(new u.EnteringVehicle(this,e,t))}teleportToVehicle(e,t){this.resetVelocity(),this.rotateModel(),this.setPhysicsEnabled(!1),e.attach(this),this.setPosition(t.seatPointObject.position.x,t.seatPointObject.position.y+.6,t.seatPointObject.position.z),this.quaternion.copy(t.seatPointObject.quaternion),this.occupySeat(t),this.setState(new f.Driving(this,t)),this.startControllingVehicle(e,t)}startControllingVehicle(e,t){this.controlledObject!==e&&(this.transferControls(e),this.resetControls(),this.controlledObject=e,this.controlledObject.allowSleep(!1),e.inputReceiverInit(),e.controllingCharacter=this)}transferControls(e){for(let t in this.actions)if(this.actions.hasOwnProperty(t)){for(let i in e.actions)if(e.actions.hasOwnProperty(i)){let n=this.actions[t],r=e.actions[i];n.eventCodes.forEach(t=>{r.eventCodes.forEach(r=>{t===r&&e.triggerAction(i,n.isPressed)})})}}}stopControllingVehicle(){var e;(null===(e=this.controlledObject)||void 0===e?void 0:e.controllingCharacter)===this&&(this.controlledObject.allowSleep(!0),this.controlledObject.controllingCharacter=void 0,this.controlledObject.resetControls(),this.controlledObject=void 0,this.inputReceiverInit())}exitVehicle(){null!==this.occupyingSeat&&(this.occupyingSeat.vehicle.entityType===b.EntityType.Airplane?this.setState(new m.ExitingAirplane(this,this.occupyingSeat)):this.setState(new d.ExitingVehicle(this,this.occupyingSeat)),this.stopControllingVehicle())}occupySeat(e){this.occupyingSeat=e,e.occupiedBy=this}leaveSeat(){null!==this.occupyingSeat&&(this.occupyingSeat.occupiedBy=null,this.occupyingSeat=null)}physicsPreStep(e,t){t.feetRaycast(),t.rayHasHit?t.raycastBox.visible&&(t.raycastBox.position.x=t.rayResult.hitPointWorld.x,t.raycastBox.position.y=t.rayResult.hitPointWorld.y,t.raycastBox.position.z=t.rayResult.hitPointWorld.z):t.raycastBox.visible&&t.raycastBox.position.set(e.position.x,e.position.y-t.rayCastLength-t.raySafeOffset,e.position.z)}feetRaycast(){let e=this.characterCapsule.body,t=new r.Vec3(e.position.x,e.position.y,e.position.z),i=new r.Vec3(e.position.x,e.position.y-this.rayCastLength-this.raySafeOffset,e.position.z),n={collisionFilterMask:g.CollisionGroups.Default,skipBackfaces:!0};this.rayHasHit=this.world.physicsWorld.raycastClosest(t,i,n,this.rayResult)}physicsPostStep(e,t){let i=new n.Vector3(e.velocity.x,e.velocity.y,e.velocity.z),a=new n.Vector3().copy(t.velocity).multiplyScalar(t.moveSpeed);a=s.appplyVectorMatrixXZ(t.orientation,a);let o=new n.Vector3;if(t.arcadeVelocityIsAdditive){o.copy(i);let e=s.appplyVectorMatrixXZ(t.orientation,t.velocityTarget),r=new n.Vector3().copy(a).multiply(t.arcadeVelocityInfluence);(Math.abs(i.x)<Math.abs(e.x*t.moveSpeed)||s.haveDifferentSigns(i.x,a.x))&&(o.x+=r.x),(Math.abs(i.y)<Math.abs(e.y*t.moveSpeed)||s.haveDifferentSigns(i.y,a.y))&&(o.y+=r.y),(Math.abs(i.z)<Math.abs(e.z*t.moveSpeed)||s.haveDifferentSigns(i.z,a.z))&&(o.z+=r.z)}else o=new n.Vector3(n.MathUtils.lerp(i.x,a.x,t.arcadeVelocityInfluence.x),n.MathUtils.lerp(i.y,a.y,t.arcadeVelocityInfluence.y),n.MathUtils.lerp(i.z,a.z,t.arcadeVelocityInfluence.z));if(t.rayHasHit){if(o.y=0,t.rayResult.body.mass>0){let e=new r.Vec3;t.rayResult.body.getVelocityAtWorldPoint(t.rayResult.hitPointWorld,e),o.add(s.threeVector(e))}let i=new n.Vector3(0,1,0),a=new n.Vector3(t.rayResult.hitNormalWorld.x,t.rayResult.hitNormalWorld.y,t.rayResult.hitNormalWorld.z),l=new n.Quaternion().setFromUnitVectors(i,a),c=new n.Matrix4().makeRotationFromQuaternion(l);o.applyMatrix4(c),e.velocity.x=o.x,e.velocity.y=o.y,e.velocity.z=o.z,e.position.y=t.rayResult.hitPointWorld.y+t.rayCastLength+o.y/t.world.physicsFrameRate}else e.velocity.x=o.x,e.velocity.y=o.y,e.velocity.z=o.z,t.groundImpactData.velocity.x=e.velocity.x,t.groundImpactData.velocity.y=e.velocity.y,t.groundImpactData.velocity.z=e.velocity.z;if(t.wantsToJump){if(t.initJumpSpeed>-1){e.velocity.y=0;let i=Math.max(4*t.velocitySimulator.position.length(),t.initJumpSpeed);e.velocity=s.cannonVector(t.orientation.clone().multiplyScalar(i))}else{let i=new r.Vec3;t.rayResult.body.getVelocityAtWorldPoint(t.rayResult.hitPointWorld,i),e.velocity.vsub(i,e.velocity)}e.velocity.y+=4,e.position.y+=2*t.raySafeOffset,t.wantsToJump=!1}}addToWorld(e){a.includes(e.characters,this)?console.warn("Adding character to a world in which it already exists."):(this.world=e,e.characters.push(this),e.physicsWorld.addBody(this.characterCapsule.body),this.preStep=()=>{this.physicsPreStep(this.characterCapsule.body,this)},this.postStep=()=>{this.physicsPostStep(this.characterCapsule.body,this)},this.world.physicsWorld.addEventListener("preStep",this.preStep),this.world.physicsWorld.addEventListener("postStep",this.postStep),e.graphicsWorld.add(this),e.graphicsWorld.add(this.raycastBox),this.materials.forEach(t=>{e.sky.csm.setupMaterial(t)}))}removeFromWorld(e){a.includes(e.characters,this)?(e.inputManager.inputReceiver===this&&(e.inputManager.inputReceiver=void 0),this.world.physicsWorld.removeEventListener("preStep",this.preStep),this.world.physicsWorld.removeEventListener("postStep",this.postStep),this.world=void 0,a.pull(e.characters,this),e.physicsWorld.removeBody(this.characterCapsule.body),e.graphicsWorld.remove(this),e.graphicsWorld.remove(this.raycastBox)):console.warn("Removing character from a world in which it isn't present.")}}t.Character=S},5506:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroundImpactData=void 0;let n=i(7678);t.GroundImpactData=class{constructor(){this.velocity=new n.Vector3}}},271:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VehicleEntryInstance=void 0;let n=i(7678);t.VehicleEntryInstance=class{constructor(e){this.wantsToDrive=!1,this.character=e}update(e){let t=new n.Vector3;this.entryPoint.getWorldPosition(t);let i=new n.Vector3().subVectors(t,this.character.position);this.character.setOrientation(i);let r=i.y;i.y=0,this.character.charState.canEnterVehicles&&.2>i.length()&&r<2&&this.character.enterVehicle(this.targetSeat,this.entryPoint)}}},4422:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FollowPath=void 0;let n=i(7678),r=i(3687),a=i(870),s=i(5619);class o extends s.FollowTarget{constructor(e,t){super(e.object,0),this.reverse=!1,this.staleTimer=0,this.nodeRadius=t,this.targetNode=e}update(e){super.update(e);let t=new n.Vector3,i=new n.Vector3;this.character.getWorldPosition(t),this.target.getWorldPosition(i);let s=new n.Vector3().subVectors(i,t);s.y=0;let o=this.targetNode.nextNode.object.position.clone().sub(this.targetNode.object.position);o.y=0,o.normalize();let l=s.clone().normalize().dot(o),c=this.character.controlledObject.collision.velocity.length();if(l<.7&&50>s.length()&&c>10&&(this.character.controlledObject.triggerAction("reverse",!0),this.character.controlledObject.triggerAction("throttle",!1)),c<1||0===this.character.controlledObject.rayCastVehicle.numWheelsOnGround?this.staleTimer+=e:this.staleTimer=0,this.staleTimer>5){let e=new n.Vector3;this.targetNode.object.getWorldPosition(e),e.y+=3,this.character.controlledObject.collision.position=a.cannonVector(e),this.character.controlledObject.collision.interpolatedPosition=a.cannonVector(e),this.character.controlledObject.collision.angularVelocity=new r.Vec3,this.character.controlledObject.collision.quaternion.copy(this.character.controlledObject.collision.initQuaternion),this.staleTimer=0}s.length()<this.nodeRadius&&(this.reverse?(super.setTarget(this.targetNode.previousNode.object),this.targetNode=this.targetNode.previousNode):(super.setTarget(this.targetNode.nextNode.object),this.targetNode=this.targetNode.nextNode))}}t.FollowPath=o},5619:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FollowTarget=void 0;let n=i(7678),r=i(870);t.FollowTarget=class{constructor(e,t=1.3){this.target=e,this.stopDistance=t}setTarget(e){this.target=e}update(e){if(void 0!==this.character.controlledObject){let e=new n.Vector3,t=new n.Vector3;this.character.getWorldPosition(e),this.target.getWorldPosition(t);let i=new n.Vector3().subVectors(t,e);i.length()>this.stopDistance?this.isTargetReached=!1:this.isTargetReached=!0;let a=new n.Vector3(0,0,1).applyQuaternion(this.character.controlledObject.quaternion);i.y=0,i.normalize();let s=r.getSignedAngleBetweenVectors(a,i),o=a.dot(r.threeVector(this.character.controlledObject.collision.velocity))>0;this.character.controlledObject.collision.velocity.length(),0>a.dot(i)?(this.character.controlledObject.triggerAction("reverse",!0),this.character.controlledObject.triggerAction("throttle",!1)):(this.character.controlledObject.triggerAction("throttle",!0),this.character.controlledObject.triggerAction("reverse",!1)),Math.abs(s)>.15?a.dot(i)>0||o?s>0?(this.character.controlledObject.triggerAction("left",!0),this.character.controlledObject.triggerAction("right",!1)):(this.character.controlledObject.triggerAction("right",!0),this.character.controlledObject.triggerAction("left",!1)):s>0?(this.character.controlledObject.triggerAction("right",!0),this.character.controlledObject.triggerAction("left",!1)):(this.character.controlledObject.triggerAction("left",!0),this.character.controlledObject.triggerAction("right",!1)):(this.character.controlledObject.triggerAction("left",!1),this.character.controlledObject.triggerAction("right",!1))}else{let e=new n.Vector3().subVectors(this.target.position,this.character.position);this.character.setViewVector(e),e.length()>this.stopDistance?(this.isTargetReached=!1,this.character.triggerAction("up",!0)):(this.isTargetReached=!0,this.character.triggerAction("up",!1),this.character.setOrientation(e))}}}},4466:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterStateBase=void 0;let n=i(870),r=i(6412);t.CharacterStateBase=class{constructor(e){this.character=e,this.character.velocitySimulator.damping=this.character.defaultVelocitySimulatorDamping,this.character.velocitySimulator.mass=this.character.defaultVelocitySimulatorMass,this.character.rotationSimulator.damping=this.character.defaultRotationSimulatorDamping,this.character.rotationSimulator.mass=this.character.defaultRotationSimulatorMass,this.character.arcadeVelocityIsAdditive=!1,this.character.setArcadeVelocityInfluence(1,0,1),this.canFindVehiclesToEnter=!0,this.canEnterVehicles=!1,this.canLeaveVehicles=!0,this.timer=0}update(e){this.timer+=e}onInputChange(){this.canFindVehiclesToEnter&&this.character.actions.enter.justPressed?this.character.findVehicleToEnter(!0):this.canFindVehiclesToEnter&&this.character.actions.enter_passenger.justPressed?this.character.findVehicleToEnter(!1):this.canEnterVehicles&&null!==this.character.vehicleEntryInstance&&(this.character.actions.up.justPressed||this.character.actions.down.justPressed||this.character.actions.left.justPressed||this.character.actions.right.justPressed)&&(this.character.vehicleEntryInstance=null,this.character.actions.up.isPressed=!1)}noDirection(){return!this.character.actions.up.isPressed&&!this.character.actions.down.isPressed&&!this.character.actions.left.isPressed&&!this.character.actions.right.isPressed}anyDirection(){return this.character.actions.up.isPressed||this.character.actions.down.isPressed||this.character.actions.left.isPressed||this.character.actions.right.isPressed}fallInAir(){this.character.rayHasHit||this.character.setState(new r.Falling(this.character))}animationEnded(e){return void 0===this.character.mixer||(void 0===this.animationLength?(console.error(this.constructor.name+"Error: Set this.animationLength in state constructor!"),!1):this.timer>this.animationLength-e)}setAppropriateDropState(){this.character.groundImpactData.velocity.y<-6?this.character.setState(new r.DropRolling(this.character)):this.anyDirection()?this.character.groundImpactData.velocity.y<-2?this.character.setState(new r.DropRunning(this.character)):this.character.actions.run.isPressed?this.character.setState(new r.Sprint(this.character)):this.character.setState(new r.Walk(this.character)):this.character.setState(new r.DropIdle(this.character))}setAppropriateStartWalkState(){let e=Math.PI,t=n.getSignedAngleBetweenVectors(this.character.orientation,this.character.getCameraRelativeMovementVector());t>.8*e?this.character.setState(new r.StartWalkBackLeft(this.character)):t<-(.8*e)?this.character.setState(new r.StartWalkBackRight(this.character)):t>.3*e?this.character.setState(new r.StartWalkLeft(this.character)):t<-(.3*e)?this.character.setState(new r.StartWalkRight(this.character)):this.character.setState(new r.StartWalkForward(this.character))}playAnimation(e,t){this.animationLength=this.character.setAnimation(e,t)}}},4726:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropIdle=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.velocitySimulator.damping=.5,this.character.velocitySimulator.mass=7,this.character.setArcadeVelocityTarget(0),this.playAnimation("drop_idle",.1),this.anyDirection()&&this.character.setState(new n.StartWalkForward(e))}update(e){super.update(e),this.character.setCameraRelativeOrientationTarget(),this.animationEnded(e)&&this.character.setState(new n.Idle(this.character)),this.fallInAir()}onInputChange(){super.onInputChange(),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpIdle(this.character)),this.anyDirection()&&this.character.setState(new n.StartWalkForward(this.character))}}t.DropIdle=r},5358:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropRolling=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.velocitySimulator.mass=1,this.character.velocitySimulator.damping=.6,this.character.setArcadeVelocityTarget(.8),this.playAnimation("drop_running_roll",.03)}update(e){super.update(e),this.character.setCameraRelativeOrientationTarget(),this.animationEnded(e)&&(this.anyDirection()?this.character.setState(new n.Walk(this.character)):this.character.setState(new n.EndWalk(this.character)))}}t.DropRolling=r},7304:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DropRunning=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.setArcadeVelocityTarget(.8),this.playAnimation("drop_running",.1)}update(e){super.update(e),this.character.setCameraRelativeOrientationTarget(),this.animationEnded(e)&&this.character.setState(new n.Walk(this.character))}onInputChange(){super.onInputChange(),this.noDirection()&&this.character.setState(new n.EndWalk(this.character)),this.anyDirection()&&this.character.actions.run.justPressed&&this.character.setState(new n.Sprint(this.character)),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpRunning(this.character))}}t.DropRunning=r},1825:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EndWalk=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.setArcadeVelocityTarget(0),this.animationLength=e.setAnimation("stop",.1)}update(e){super.update(e),this.animationEnded(e)&&this.character.setState(new n.Idle(this.character)),this.fallInAir()}onInputChange(){super.onInputChange(),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpIdle(this.character)),this.anyDirection()&&(this.character.actions.run.isPressed?this.character.setState(new n.Sprint(this.character)):this.character.velocity.length()>.5?this.character.setState(new n.Walk(this.character)):this.setAppropriateStartWalkState())}}t.EndWalk=r},2243:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Falling=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.velocitySimulator.mass=100,this.character.rotationSimulator.damping=.3,this.character.arcadeVelocityIsAdditive=!0,this.character.setArcadeVelocityInfluence(.05,0,.05),this.playAnimation("falling",.3)}update(e){super.update(e),this.character.setCameraRelativeOrientationTarget(),this.character.setArcadeVelocityTarget(this.anyDirection()?.8:0),this.character.rayHasHit&&this.setAppropriateDropState()}}t.Falling=r},7482:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Idle=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.velocitySimulator.damping=.6,this.character.velocitySimulator.mass=10,this.character.setArcadeVelocityTarget(0),this.playAnimation("idle",.1)}update(e){super.update(e),this.fallInAir()}onInputChange(){super.onInputChange(),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpIdle(this.character)),this.anyDirection()&&(this.character.velocity.length()>.5?this.character.setState(new n.Walk(this.character)):this.setAppropriateStartWalkState())}}t.Idle=r},2024:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdleRotateLeft=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.rotationSimulator.mass=30,this.character.rotationSimulator.damping=.6,this.character.velocitySimulator.damping=.6,this.character.velocitySimulator.mass=10,this.character.setArcadeVelocityTarget(0),this.playAnimation("rotate_left",.1)}update(e){super.update(e),this.animationEnded(e)&&this.character.setState(new n.Idle(this.character)),this.fallInAir()}onInputChange(){super.onInputChange(),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpIdle(this.character)),this.anyDirection()&&(this.character.velocity.length()>.5?this.character.setState(new n.Walk(this.character)):this.setAppropriateStartWalkState())}}t.IdleRotateLeft=r},9920:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdleRotateRight=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.rotationSimulator.mass=30,this.character.rotationSimulator.damping=.6,this.character.velocitySimulator.damping=.6,this.character.velocitySimulator.mass=10,this.character.setArcadeVelocityTarget(0),this.playAnimation("rotate_right",.1)}update(e){super.update(e),this.animationEnded(e)&&this.character.setState(new n.Idle(this.character)),this.fallInAir()}onInputChange(){super.onInputChange(),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpIdle(this.character)),this.anyDirection()&&(this.character.velocity.length()>.5?this.character.setState(new n.Walk(this.character)):this.setAppropriateStartWalkState())}}t.IdleRotateRight=r},1929:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JumpIdle=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.velocitySimulator.mass=50,this.character.setArcadeVelocityTarget(0),this.playAnimation("jump_idle",.1),this.alreadyJumped=!1}update(e){super.update(e),this.alreadyJumped&&(this.character.setCameraRelativeOrientationTarget(),this.character.setArcadeVelocityTarget(this.anyDirection()?.8:0)),this.timer>.2&&!this.alreadyJumped?(this.character.jump(),this.alreadyJumped=!0,this.character.velocitySimulator.mass=100,this.character.rotationSimulator.damping=.3,this.character.rayResult.body.velocity.length()>0?this.character.setArcadeVelocityInfluence(0,0,0):this.character.setArcadeVelocityInfluence(.3,0,.3)):this.timer>.3&&this.character.rayHasHit?this.setAppropriateDropState():this.animationEnded(e)&&this.character.setState(new n.Falling(this.character))}}t.JumpIdle=r},4046:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JumpRunning=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.character.velocitySimulator.mass=100,this.playAnimation("jump_running",.03),this.alreadyJumped=!1}update(e){super.update(e),this.character.setCameraRelativeOrientationTarget(),this.alreadyJumped&&this.character.setArcadeVelocityTarget(this.anyDirection()?.8:0),this.timer>.13&&!this.alreadyJumped?(this.character.jump(4),this.alreadyJumped=!0,this.character.rotationSimulator.damping=.3,this.character.arcadeVelocityIsAdditive=!0,this.character.setArcadeVelocityInfluence(.05,0,.05)):this.timer>.24&&this.character.rayHasHit?this.setAppropriateDropState():this.animationEnded(e)&&this.character.setState(new n.Falling(this.character))}}t.JumpRunning=r},1553:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprint=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.canEnterVehicles=!0,this.character.velocitySimulator.mass=10,this.character.rotationSimulator.damping=.8,this.character.rotationSimulator.mass=50,this.character.setArcadeVelocityTarget(1.4),this.playAnimation("sprint",.1)}update(e){super.update(e),this.character.setCameraRelativeOrientationTarget(),this.fallInAir()}onInputChange(){super.onInputChange(),this.character.actions.run.isPressed||this.character.setState(new n.Walk(this.character)),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpRunning(this.character)),this.noDirection()&&this.character.setState(new n.EndWalk(this.character))}}t.Sprint=r},7247:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartWalkBackLeft=void 0;let n=i(6412);class r extends n.StartWalkBase{constructor(e){super(e),this.animationLength=e.setAnimation("start_back_left",.1)}}t.StartWalkBackLeft=r},7078:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartWalkBackRight=void 0;let n=i(6412);class r extends n.StartWalkBase{constructor(e){super(e),this.animationLength=e.setAnimation("start_back_right",.1)}}t.StartWalkBackRight=r},8607:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartWalkBase=void 0;let n=i(870),r=i(6412);class a extends r.CharacterStateBase{constructor(e){super(e),this.canEnterVehicles=!0,this.character.rotationSimulator.mass=20,this.character.rotationSimulator.damping=.7,this.character.setArcadeVelocityTarget(.8)}update(e){super.update(e),this.animationEnded(e)&&this.character.setState(new r.Walk(this.character)),this.character.setCameraRelativeOrientationTarget(),this.fallInAir()}onInputChange(){if(super.onInputChange(),this.character.actions.jump.justPressed&&this.character.setState(new r.JumpRunning(this.character)),this.noDirection()){if(this.timer<.1){let e=n.getSignedAngleBetweenVectors(this.character.orientation,this.character.orientationTarget);e>.4*Math.PI?this.character.setState(new r.IdleRotateLeft(this.character)):e<-(.4*Math.PI)?this.character.setState(new r.IdleRotateRight(this.character)):this.character.setState(new r.Idle(this.character))}else this.character.setState(new r.Idle(this.character))}this.character.actions.run.justPressed&&this.character.setState(new r.Sprint(this.character))}}t.StartWalkBase=a},9076:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartWalkForward=void 0;let n=i(6412);class r extends n.StartWalkBase{constructor(e){super(e),this.animationLength=e.setAnimation("start_forward",.1)}}t.StartWalkForward=r},7551:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartWalkLeft=void 0;let n=i(6412);class r extends n.StartWalkBase{constructor(e){super(e),this.animationLength=e.setAnimation("start_left",.1)}}t.StartWalkLeft=r},5115:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartWalkRight=void 0;let n=i(6412);class r extends n.StartWalkBase{constructor(e){super(e),this.animationLength=e.setAnimation("start_right",.1)}}t.StartWalkRight=r},9340:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Walk=void 0;let n=i(6412);class r extends n.CharacterStateBase{constructor(e){super(e),this.canEnterVehicles=!0,this.character.setArcadeVelocityTarget(.8),this.playAnimation("run",.1)}update(e){super.update(e),this.character.setCameraRelativeOrientationTarget(),this.fallInAir()}onInputChange(){super.onInputChange(),this.noDirection()&&this.character.setState(new n.EndWalk(this.character)),this.character.actions.run.isPressed&&this.character.setState(new n.Sprint(this.character)),this.character.actions.run.justPressed&&this.character.setState(new n.Sprint(this.character)),this.character.actions.jump.justPressed&&this.character.setState(new n.JumpRunning(this.character)),this.noDirection()&&(this.character.velocity.length()>1?this.character.setState(new n.EndWalk(this.character)):this.character.setState(new n.Idle(this.character)))}}t.Walk=r},6412:function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4466),t),r(i(4726),t),r(i(5358),t),r(i(7304),t),r(i(1825),t),r(i(2243),t),r(i(7482),t),r(i(2024),t),r(i(9920),t),r(i(1929),t),r(i(4046),t),r(i(1553),t),r(i(8607),t),r(i(7247),t),r(i(7078),t),r(i(9076),t),r(i(7551),t),r(i(5115),t),r(i(9340),t)},5840:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloseVehicleDoorInside=void 0;let n=i(6412),r=i(8696),a=i(1012),s=i(4291),o=i(8295),l=i(870);class c extends n.CharacterStateBase{constructor(e,t){var i;super(e),this.hasClosedDoor=!1,this.seat=t,this.canFindVehiclesToEnter=!1,this.canLeaveVehicles=!1;let n=l.detectRelativeSide(t.seatPointObject,t.door.doorObject);n===r.Side.Left?this.playAnimation("close_door_sitting_left",.1):n===r.Side.Right&&this.playAnimation("close_door_sitting_right",.1),null===(i=this.seat.door)||void 0===i||i.open()}update(e){var t;super.update(e),this.timer>.4&&!this.hasClosedDoor&&(this.hasClosedDoor=!0,null===(t=this.seat.door)||void 0===t||t.close()),this.animationEnded(e)&&(this.seat.type===s.SeatType.Driver?this.character.setState(new a.Driving(this.character,this.seat)):this.seat.type===s.SeatType.Passenger&&this.character.setState(new o.Sitting(this.character,this.seat)))}}t.CloseVehicleDoorInside=c},8623:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloseVehicleDoorOutside=void 0;let n=i(6412),r=i(8696),a=i(7482),s=i(870);class o extends n.CharacterStateBase{constructor(e,t){super(e),this.hasClosedDoor=!1,this.seat=t,this.canFindVehiclesToEnter=!1;let i=s.detectRelativeSide(t.seatPointObject,t.door.doorObject);i===r.Side.Left?this.playAnimation("close_door_standing_right",.1):i===r.Side.Right&&this.playAnimation("close_door_standing_left",.1)}update(e){super.update(e),this.timer>.3&&!this.hasClosedDoor&&(this.hasClosedDoor=!0,this.seat.door.close()),this.animationEnded(e)&&(this.character.setState(new a.Idle(this.character)),this.character.leaveSeat())}}t.CloseVehicleDoorOutside=o},1012:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Driving=void 0;let n=i(6412),r=i(5840);class a extends n.CharacterStateBase{constructor(e,t){super(e),this.seat=t,this.canFindVehiclesToEnter=!1,this.playAnimation("driving",.1),this.character.startControllingVehicle(t.vehicle,this.seat),this.seat.vehicle.onInputChange(),this.character.vehicleEntryInstance=null}update(e){var t,i;super.update(e),!(null===(t=this.seat.door)||void 0===t?void 0:t.achievingTargetRotation)&&(null===(i=this.seat.door)||void 0===i?void 0:i.rotation)>0&&this.seat.vehicle.noDirectionPressed()&&this.character.setState(new r.CloseVehicleDoorInside(this.character,this.seat))}}t.Driving=a},5353:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnteringVehicle=void 0;let n=i(7678),r=i(6412),a=i(1012),s=i(8696),o=i(8295),l=i(4291),c=i(2545),h=i(870),u=i(9719);class d extends r.CharacterStateBase{constructor(e,t,i){super(e),this.initialPositionOffset=new n.Vector3,this.startPosition=new n.Vector3,this.endPosition=new n.Vector3,this.startRotation=new n.Quaternion,this.endRotation=new n.Quaternion,this.canFindVehiclesToEnter=!1,this.vehicle=t.vehicle,this.seat=t;let r=h.detectRelativeSide(i,t.seatPointObject);this.animData=this.getEntryAnimations(t.vehicle.entityType),this.playAnimation(this.animData[r],.1),this.character.resetVelocity(),this.character.tiltContainer.rotation.z=0,this.character.setPhysicsEnabled(!1),this.seat.vehicle.attach(this.character),this.startPosition.copy(i.position),this.startPosition.y+=.53,this.endPosition.copy(t.seatPointObject.position),this.endPosition.y+=.6,this.initialPositionOffset.copy(this.startPosition).sub(this.character.position),this.startRotation.copy(this.character.quaternion),this.endRotation.copy(this.seat.seatPointObject.quaternion),this.factorSimulator=new u.SpringSimulator(60,10,.5),this.factorSimulator.target=1}update(e){if(super.update(e),this.animationEnded(e))this.character.occupySeat(this.seat),this.character.setPosition(this.endPosition.x,this.endPosition.y,this.endPosition.z),this.seat.type===l.SeatType.Driver?(this.seat.door&&(this.seat.door.physicsEnabled=!0),this.character.setState(new a.Driving(this.character,this.seat))):this.seat.type===l.SeatType.Passenger&&this.character.setState(new o.Sitting(this.character,this.seat));else{this.seat.door&&(this.seat.door.physicsEnabled=!1,this.seat.door.rotation=1);let t=n.MathUtils.clamp(this.timer/(this.animationLength-this.animData.end_early),0,1),i=h.easeInOutSine(t);this.factorSimulator.simulate(e);let r=new n.Vector3().lerpVectors(this.initialPositionOffset,new n.Vector3,this.factorSimulator.position),a=new n.Vector3().lerpVectors(this.startPosition.clone().sub(r),this.endPosition,i);this.character.setPosition(a.x,a.y,a.z),this.character.quaternion.slerpQuaternions(this.startRotation,this.endRotation,this.factorSimulator.position)}}getEntryAnimations(e){return e===c.EntityType.Airplane?{[s.Side.Left]:"enter_airplane_left",[s.Side.Right]:"enter_airplane_right",end_early:.3}:{[s.Side.Left]:"sit_down_left",[s.Side.Right]:"sit_down_right",end_early:0}}}t.EnteringVehicle=d},201:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExitingAirplane=void 0;let n=i(7678),r=i(870),a=i(2243),s=i(5875);class o extends s.ExitingStateBase{constructor(e,t){super(e,t),this.endPosition.copy(this.startPosition),this.endPosition.y+=1;let i=r.threeQuat(t.vehicle.collision.quaternion),a=new n.Vector3(0,0,1).applyQuaternion(i);this.exitPoint=new n.Object3D,this.exitPoint.lookAt(a),this.exitPoint.position.copy(this.endPosition),this.playAnimation("jump_idle",.1)}update(e){if(super.update(e),this.animationEnded(e))this.detachCharacterFromVehicle(),this.character.setState(new a.Falling(this.character)),this.character.leaveSeat();else{let e=n.MathUtils.clamp((this.timer/this.animationLength-.3)*1.4285714285714286,0,1),t=r.easeOutQuad(e),i=new n.Vector3().lerpVectors(this.startPosition,this.endPosition,t);this.character.setPosition(i.x,i.y,i.z),this.updateEndRotation(),this.character.quaternion.slerpQuaternions(this.startRotation,this.endRotation,t)}}}t.ExitingAirplane=o},5875:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExitingStateBase=void 0;let n=i(7678),r=i(870),a=i(6412);class s extends a.CharacterStateBase{constructor(e,t){var i;super(e),this.startPosition=new n.Vector3,this.endPosition=new n.Vector3,this.startRotation=new n.Quaternion,this.endRotation=new n.Quaternion,this.canFindVehiclesToEnter=!1,this.seat=t,this.vehicle=t.vehicle,null===(i=this.seat.door)||void 0===i||i.open(),this.startPosition.copy(this.character.position),this.startRotation.copy(this.character.quaternion),this.dummyObj=new n.Object3D}detachCharacterFromVehicle(){this.character.controlledObject=void 0,this.character.resetOrientation(),this.character.world.graphicsWorld.attach(this.character),this.character.resetVelocity(),this.character.setPhysicsEnabled(!0),this.character.setPosition(this.character.position.x,this.character.position.y,this.character.position.z),this.character.inputReceiverUpdate(0),this.character.characterCapsule.body.velocity.copy(this.vehicle.rayCastVehicle.chassisBody.velocity),this.character.feetRaycast()}updateEndRotation(){let e=r.getForward(this.exitPoint);e.y=0,e.normalize(),this.character.world.graphicsWorld.attach(this.dummyObj),this.exitPoint.getWorldPosition(this.dummyObj.position);let t=this.dummyObj.position.clone().add(e);this.dummyObj.lookAt(t),this.seat.seatPointObject.parent.attach(this.dummyObj),this.endRotation.copy(this.dummyObj.quaternion)}}t.ExitingStateBase=s},3169:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExitingVehicle=void 0;let n=i(7678),r=i(870),a=i(8696),s=i(7482),o=i(8623),l=i(2243),c=i(5358),h=i(5875);class u extends h.ExitingStateBase{constructor(e,t){super(e,t),this.exitPoint=t.entryPoints[0],this.endPosition.copy(this.exitPoint.position),this.endPosition.y+=.52;let i=r.detectRelativeSide(t.seatPointObject,this.exitPoint);i===a.Side.Left?this.playAnimation("stand_up_left",.1):i===a.Side.Right&&this.playAnimation("stand_up_right",.1)}update(e){if(super.update(e),this.animationEnded(e))this.detachCharacterFromVehicle(),this.seat.door.physicsEnabled=!0,this.character.rayHasHit?this.vehicle.collision.velocity.length()>1?(this.character.setState(new c.DropRolling(this.character)),this.character.leaveSeat()):this.anyDirection()||void 0===this.seat.door?(this.character.setState(new s.Idle(this.character)),this.character.leaveSeat()):this.character.setState(new o.CloseVehicleDoorOutside(this.character,this.seat)):(this.character.setState(new l.Falling(this.character)),this.character.leaveSeat());else{this.seat.door&&(this.seat.door.physicsEnabled=!1);let e=this.timer/this.animationLength,t=r.easeInOutSine(e),i=new n.Vector3().lerpVectors(this.startPosition,this.endPosition,t);this.character.setPosition(i.x,i.y,i.z),this.updateEndRotation(),this.character.quaternion.slerpQuaternions(this.startRotation,this.endRotation,t)}}}t.ExitingVehicle=u},301:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenVehicleDoor=void 0;let n=i(7678),r=i(6412),a=i(8696),s=i(7482),o=i(5353),l=i(870),c=i(9719);class h extends r.CharacterStateBase{constructor(e,t,i){super(e),this.hasOpenedDoor=!1,this.startPosition=new n.Vector3,this.endPosition=new n.Vector3,this.startRotation=new n.Quaternion,this.endRotation=new n.Quaternion,this.canFindVehiclesToEnter=!1,this.seat=t,this.entryPoint=i;let r=l.detectRelativeSide(i,t.seatPointObject);r===a.Side.Left?this.playAnimation("open_door_standing_left",.1):r===a.Side.Right&&this.playAnimation("open_door_standing_right",.1),this.character.resetVelocity(),this.character.rotateModel(),this.character.setPhysicsEnabled(!1),this.character.setPhysicsEnabled(!1),this.seat.vehicle.attach(this.character),this.startPosition.copy(this.character.position),this.endPosition.copy(this.entryPoint.position),this.endPosition.y+=.53,this.startRotation.copy(this.character.quaternion),this.endRotation.copy(this.entryPoint.quaternion),this.factorSimluator=new c.SpringSimulator(60,10,.5),this.factorSimluator.target=1}update(e){var t;if(super.update(e),this.timer>.3&&!this.hasOpenedDoor&&(this.hasOpenedDoor=!0,null===(t=this.seat.door)||void 0===t||t.open()),this.animationEnded(e))this.anyDirection()?(this.character.vehicleEntryInstance=null,this.character.world.graphicsWorld.attach(this.character),this.character.setPhysicsEnabled(!0),this.character.setState(new s.Idle(this.character))):this.character.setState(new o.EnteringVehicle(this.character,this.seat,this.entryPoint));else{this.factorSimluator.simulate(e);let t=new n.Vector3().lerpVectors(this.startPosition,this.endPosition,this.factorSimluator.position);this.character.setPosition(t.x,t.y,t.z),this.character.quaternion.slerpQuaternions(this.startRotation,this.endRotation,this.factorSimluator.position)}}}t.OpenVehicleDoor=h},8295:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sitting=void 0;let n=i(6412),r=i(5840),a=i(4291),s=i(5210);class o extends n.CharacterStateBase{constructor(e,t){super(e),this.seat=t,this.canFindVehiclesToEnter=!1,this.character.world.updateControls([{keys:["X"],desc:"Switch seats"},{keys:["F"],desc:"Leave seat"}]),this.playAnimation("sitting",.1)}update(e){var t,i,n;if(super.update(e),!(null===(t=this.seat.door)||void 0===t?void 0:t.achievingTargetRotation)&&(null===(i=this.seat.door)||void 0===i?void 0:i.rotation)>0&&this.noDirection())this.character.setState(new r.CloseVehicleDoorInside(this.character,this.seat));else if(null!==this.character.vehicleEntryInstance){if(this.character.vehicleEntryInstance.wantsToDrive){for(let e of this.seat.connectedSeats)if(e.type===a.SeatType.Driver){(null===(n=this.seat.door)||void 0===n?void 0:n.rotation)>0&&(this.seat.door.physicsEnabled=!0),this.character.setState(new s.SwitchingSeats(this.character,this.seat,e));break}}else this.character.vehicleEntryInstance=null}}onInputChange(){this.character.actions.seat_switch.justPressed&&this.seat.connectedSeats.length>0&&this.character.setState(new s.SwitchingSeats(this.character,this.seat,this.seat.connectedSeats[0])),this.character.actions.enter.justPressed&&(this.character.exitVehicle(),this.character.displayControls())}}t.Sitting=o},5210:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SwitchingSeats=void 0;let n=i(7678),r=i(6412),a=i(8696),s=i(4291),o=i(1012),l=i(8295),c=i(870),h=i(516);class u extends r.CharacterStateBase{constructor(e,t,i){super(e),this.startPosition=new n.Vector3,this.endPosition=new n.Vector3,this.startRotation=new n.Quaternion,this.endRotation=new n.Quaternion,this.toSeat=i,this.canFindVehiclesToEnter=!1,this.canLeaveVehicles=!1,e.leaveSeat(),this.character.occupySeat(i);let r=c.getRight(t.seatPointObject,h.Space.Local),s=i.seatPointObject.position.clone().sub(t.seatPointObject.position).normalize(),o=r.dot(s)>0?a.Side.Left:a.Side.Right;o===a.Side.Left?this.playAnimation("sitting_shift_left",.1):o===a.Side.Right&&this.playAnimation("sitting_shift_right",.1),this.startPosition.copy(t.seatPointObject.position),this.startPosition.y+=.6,this.endPosition.copy(i.seatPointObject.position),this.endPosition.y+=.6,this.startRotation.copy(t.seatPointObject.quaternion),this.endRotation.copy(i.seatPointObject.quaternion)}update(e){if(super.update(e),this.animationEnded(e))this.toSeat.type===s.SeatType.Driver?this.character.setState(new o.Driving(this.character,this.toSeat)):this.toSeat.type===s.SeatType.Passenger&&this.character.setState(new l.Sitting(this.character,this.toSeat));else{let e=this.timer/this.animationLength,t=c.easeInOutSine(e),i=new n.Vector3().lerpVectors(this.startPosition,this.endPosition,t);this.character.setPosition(i.x,i.y,i.z),this.character.quaternion.slerpQuaternions(this.startRotation,this.endRotation,t)}}}t.SwitchingSeats=u},6920:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraOperator=void 0;let n=i(7678),r=i(870),a=i(2385),s=i(6486);t.CameraOperator=class{constructor(e,t,i=1,r=.8*i){this.updateOrder=4,this.radius=1,this.targetRadius=1,this.upVelocity=0,this.forwardVelocity=0,this.rightVelocity=0,this.followMode=!1,this.world=e,this.camera=t,this.target=new n.Vector3,this.sensitivity=new n.Vector2(i,r),this.movementSpeed=.06,this.radius=3,this.theta=0,this.phi=0,this.onMouseDownPosition=new n.Vector2,this.onMouseDownTheta=this.theta,this.onMouseDownPhi=this.phi,this.actions={forward:new a.KeyBinding("KeyW"),back:new a.KeyBinding("KeyS"),left:new a.KeyBinding("KeyA"),right:new a.KeyBinding("KeyD"),up:new a.KeyBinding("KeyE"),down:new a.KeyBinding("KeyQ"),fast:new a.KeyBinding("ShiftLeft")},e.registerUpdatable(this)}setSensitivity(e,t=e){this.sensitivity=new n.Vector2(e,t)}setRadius(e,t=!1){this.targetRadius=Math.max(.001,e),!0===t&&(this.radius=e)}move(e,t){this.theta-=e*(this.sensitivity.x/2),this.theta%=360,this.phi+=t*(this.sensitivity.y/2),this.phi=Math.min(85,Math.max(-85,this.phi))}update(e){if(!0===this.followMode){this.camera.position.y=n.MathUtils.clamp(this.camera.position.y,this.target.y,Number.POSITIVE_INFINITY),this.camera.lookAt(this.target);let e=this.target.clone().add(new n.Vector3().subVectors(this.camera.position,this.target).normalize().multiplyScalar(this.targetRadius));this.camera.position.x=e.x,this.camera.position.y=e.y,this.camera.position.z=e.z}else this.radius=n.MathUtils.lerp(this.radius,this.targetRadius,.1),this.camera.position.x=this.target.x+this.radius*Math.sin(this.theta*Math.PI/180)*Math.cos(this.phi*Math.PI/180),this.camera.position.y=this.target.y+this.radius*Math.sin(this.phi*Math.PI/180),this.camera.position.z=this.target.z+this.radius*Math.cos(this.theta*Math.PI/180)*Math.cos(this.phi*Math.PI/180),this.camera.updateMatrix(),this.camera.lookAt(this.target)}handleKeyboardEvent(e,t,i){if("KeyC"===t&&!0===i&&!0===e.shiftKey)void 0!==this.characterCaller&&(this.world.inputManager.setInputReceiver(this.characterCaller),this.characterCaller=void 0);else for(let e in this.actions)if(this.actions.hasOwnProperty(e)){let n=this.actions[e];s.includes(n.eventCodes,t)&&(n.isPressed=i)}}handleMouseWheel(e,t){this.world.scrollTheTimeScale(t)}handleMouseButton(e,t,i){for(let e in this.actions)if(this.actions.hasOwnProperty(e)){let n=this.actions[e];s.includes(n.eventCodes,t)&&(n.isPressed=i)}}handleMouseMove(e,t,i){this.move(t,i)}inputReceiverInit(){this.target.copy(this.camera.position),this.setRadius(0,!0),this.world.updateControls([{keys:["W","S","A","D"],desc:"Move around"},{keys:["E","Q"],desc:"Move up / down"},{keys:["Shift"],desc:"Speed up"},{keys:["Shift","+","C"],desc:"Exit free camera mode"}])}inputReceiverUpdate(e){let t=this.movementSpeed*(this.actions.fast.isPressed?600*e:60*e),i=r.getUp(this.camera),a=r.getRight(this.camera),s=r.getBack(this.camera);this.upVelocity=n.MathUtils.lerp(this.upVelocity,+this.actions.up.isPressed-+this.actions.down.isPressed,.3),this.forwardVelocity=n.MathUtils.lerp(this.forwardVelocity,+this.actions.forward.isPressed-+this.actions.back.isPressed,.3),this.rightVelocity=n.MathUtils.lerp(this.rightVelocity,+this.actions.right.isPressed-+this.actions.left.isPressed,.3),this.target.add(i.multiplyScalar(t*this.upVelocity)),this.target.add(s.multiplyScalar(t*this.forwardVelocity)),this.target.add(a.multiplyScalar(t*this.rightVelocity))}}},6196:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClosestObjectFinder=void 0,t.ClosestObjectFinder=class{constructor(e,t){this.closestDistance=Number.POSITIVE_INFINITY,this.maxDistance=Number.POSITIVE_INFINITY,this.referencePosition=e,void 0!==t&&(this.maxDistance=t)}consider(e,t){let i=this.referencePosition.distanceTo(t);i<this.maxDistance&&i<this.closestDistance&&(this.closestDistance=i,this.closestObject=e)}}},870:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countSleepyBodies=t.getMatrix=t.getBack=t.getForward=t.getUp=t.getRight=t.easeOutQuad=t.easeInOutSine=t.detectRelativeSide=t.setupMeshProperties=t.cannonQuat=t.threeQuat=t.cannonVector=t.threeVector=t.springV=t.spring=t.getGlobalProperties=t.setDefaults=t.haveDifferentSigns=t.haveSameSigns=t.getSignedAngleBetweenVectors=t.getAngleBetweenVectors=t.roundVector=t.round=t.appplyVectorMatrixXZ=t.createCapsuleGeometry=void 0;let n=i(7678),r=i(3687),a=i(6486),s=i(8917),o=i(8696),l=i(516);function c(e,t=l.Space.Global){let i=h(e,t);return new n.Vector3(i.elements[0],i.elements[1],i.elements[2])}function h(e,t){switch(t){case l.Space.Local:return e.matrix;case l.Space.Global:return e.matrixWorld}}t.createCapsuleGeometry=function(e=1,t=2,i=32){let r=new n.BufferGeometry,a=2*Math.PI,s=[],o=[],l=[];for(let r=0;r<=i/4;r++)for(let l=0;l<=i;l++){let c=l*a/i,h=-1.5707963267948966+Math.PI*r/(i/2),u=new n.Vector3,d=new n.Vector3;u.x=e*Math.cos(h)*Math.cos(c),u.y=e*Math.cos(h)*Math.sin(c),u.z=e*Math.sin(h),u.z-=t/2,d.x=u.x,d.y=u.y,d.z=u.z,o.push(u),s.push(d)}for(let r=i/4;r<=i/2;r++)for(let l=0;l<=i;l++){let c=l*a/i,h=-1.5707963267948966+Math.PI*r/(i/2),u=new n.Vector3,d=new n.Vector3;u.x=e*Math.cos(h)*Math.cos(c),u.y=e*Math.cos(h)*Math.sin(c),u.z=e*Math.sin(h),u.z+=t/2,d.x=u.x,d.y=u.y,d.z=u.z,o.push(u),s.push(d)}for(let e=0;e<=i/2;e++)for(let t=0;t<i;t++){let r=new n.Vector4(e*(i+1)+t,e*(i+1)+(t+1),(e+1)*(i+1)+(t+1),(e+1)*(i+1)+t),a=[o[r.x],o[r.y],o[r.z]],s=[o[r.x],o[r.z],o[r.w]];e===i/4?l.push(...a,...s):l.push(...s,...a)}return r.setAttribute("position",new n.Float32BufferAttribute(l,3)),r.setAttribute("normal",new n.Float32BufferAttribute(s,3)),r.rotateX(Math.PI/2),r.computeVertexNormals(),r},t.appplyVectorMatrixXZ=function(e,t){return new n.Vector3(e.x*t.z+e.z*t.x,t.y,e.z*t.z+-e.x*t.x)},t.round=function(e,t=0){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},t.roundVector=function(e,t=0){return new n.Vector3(this.round(e.x,t),this.round(e.y,t),this.round(e.z,t))},t.getAngleBetweenVectors=function(e,t,i=5e-4){let n;let r=e.dot(t);return r>1-i?0:r<-1+i?Math.PI:Math.acos(r)},t.getSignedAngleBetweenVectors=function(e,t,i=new n.Vector3(0,1,0),r=5e-4){let a=this.getAngleBetweenVectors(e,t,r),s=new n.Vector3().crossVectors(e,t);return 0>i.dot(s)&&(a=-a),a},t.haveSameSigns=function(e,t){return e<0==t<0},t.haveDifferentSigns=function(e,t){return e<0!=t<0},t.setDefaults=function(e,t){return a.defaults({},a.clone(e),t)},t.getGlobalProperties=function(e=""){let t=[],i=window;for(let n in i)0===n.indexOf(e)&&t.push(n);return t},t.spring=function(e,t,i,n,r){let a=t-e;a/=n,i+=a;let o=e+(i*=r);return new s.SimulationFrame(o,i)},t.springV=function(e,t,i,r,a){let s=new n.Vector3().subVectors(t,e);s.divideScalar(r),i.add(s),i.multiplyScalar(a),e.add(i)},t.threeVector=function(e){return new n.Vector3(e.x,e.y,e.z)},t.cannonVector=function(e){return new r.Vec3(e.x,e.y,e.z)},t.threeQuat=function(e){return new n.Quaternion(e.x,e.y,e.z,e.w)},t.cannonQuat=function(e){return new r.Quaternion(e.x,e.y,e.z,e.w)},t.setupMeshProperties=function(e){if(e.castShadow=!0,e.receiveShadow=!0,null!==e.material.map){let t=new n.MeshPhongMaterial;t.shininess=0,t.name=e.material.name,t.map=e.material.map,t.map.anisotropy=4,t.aoMap=e.material.aoMap,t.transparent=e.material.transparent,e.material=t}},t.detectRelativeSide=function(e,t){let i=c(e,l.Space.Local),n=t.position.clone().sub(e.position).normalize();return i.dot(n)>0?o.Side.Left:o.Side.Right},t.easeInOutSine=function(e){return-(Math.cos(Math.PI*e)-1)/2},t.easeOutQuad=function(e){return 1-(1-e)*(1-e)},t.getRight=c,t.getUp=function(e,t=l.Space.Global){let i=h(e,t);return new n.Vector3(i.elements[4],i.elements[5],i.elements[6])},t.getForward=function(e,t=l.Space.Global){let i=h(e,t);return new n.Vector3(i.elements[8],i.elements[9],i.elements[10])},t.getBack=function(e,t=l.Space.Global){let i=h(e,t);return new n.Vector3(-i.elements[8],-i.elements[9],-i.elements[10])},t.getMatrix=h,t.countSleepyBodies=function(){}},4577:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputManager=void 0,t.InputManager=class{constructor(e,t){this.updateOrder=3,this.world=e,this.pointerLock=e.params.Pointer_Lock,this.domElement=t||document.body,this.isLocked=!1,this.boundOnMouseDown=e=>this.onMouseDown(e),this.boundOnMouseMove=e=>this.onMouseMove(e),this.boundOnMouseUp=e=>this.onMouseUp(e),this.boundOnMouseWheelMove=e=>this.onMouseWheelMove(e),this.boundOnPointerlockChange=e=>this.onPointerlockChange(e),this.boundOnPointerlockError=e=>this.onPointerlockError(e),this.boundOnKeyDown=e=>this.onKeyDown(e),this.boundOnKeyUp=e=>this.onKeyUp(e),this.domElement.addEventListener("mousedown",this.boundOnMouseDown,!1),document.addEventListener("wheel",this.boundOnMouseWheelMove,!1),document.addEventListener("pointerlockchange",this.boundOnPointerlockChange,!1),document.addEventListener("pointerlockerror",this.boundOnPointerlockError,!1),document.addEventListener("keydown",this.boundOnKeyDown,!1),document.addEventListener("keyup",this.boundOnKeyUp,!1),e.registerUpdatable(this)}update(e,t){var i;void 0===this.inputReceiver&&void 0!==this.world&&void 0!==this.world.cameraOperator&&this.setInputReceiver(this.world.cameraOperator),null===(i=this.inputReceiver)||void 0===i||i.inputReceiverUpdate(t)}setInputReceiver(e){this.inputReceiver=e,this.inputReceiver.inputReceiverInit()}setPointerLock(e){this.pointerLock=e}onPointerlockChange(e){document.pointerLockElement===this.domElement?(this.domElement.addEventListener("mousemove",this.boundOnMouseMove,!1),this.domElement.addEventListener("mouseup",this.boundOnMouseUp,!1),this.isLocked=!0):(this.domElement.removeEventListener("mousemove",this.boundOnMouseMove,!1),this.domElement.removeEventListener("mouseup",this.boundOnMouseUp,!1),this.isLocked=!1)}onPointerlockError(e){console.error("PointerLockControls: Unable to use Pointer Lock API")}onMouseDown(e){this.pointerLock?this.domElement.requestPointerLock():(this.domElement.addEventListener("mousemove",this.boundOnMouseMove,!1),this.domElement.addEventListener("mouseup",this.boundOnMouseUp,!1)),void 0!==this.inputReceiver&&this.inputReceiver.handleMouseButton(e,"mouse"+e.button,!0)}onMouseMove(e){void 0!==this.inputReceiver&&this.inputReceiver.handleMouseMove(e,e.movementX,e.movementY)}onMouseUp(e){this.pointerLock||(this.domElement.removeEventListener("mousemove",this.boundOnMouseMove,!1),this.domElement.removeEventListener("mouseup",this.boundOnMouseUp,!1)),void 0!==this.inputReceiver&&this.inputReceiver.handleMouseButton(e,"mouse"+e.button,!1)}onKeyDown(e){void 0!==this.inputReceiver&&this.inputReceiver.handleKeyboardEvent(e,e.code,!0)}onKeyUp(e){void 0!==this.inputReceiver&&this.inputReceiver.handleKeyboardEvent(e,e.code,!1)}onMouseWheelMove(e){void 0!==this.inputReceiver&&this.inputReceiver.handleMouseWheel(e,e.deltaY)}}},2385:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyBinding=void 0,t.KeyBinding=class{constructor(...e){this.isPressed=!1,this.justPressed=!1,this.justReleased=!1,this.eventCodes=e}}},2461:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingManager=void 0;let n=i(450),r=i(7918),a=i(207),s=i(6455);t.LoadingManager=class{constructor(e){this.firstLoad=!0,this.loadingTracker=[],this.world=e,this.gltfLoader=new n.GLTFLoader,this.world.setTimeScale(0),a.UIManager.setUserInterfaceVisible(!1),a.UIManager.setLoadingScreenVisible(!0)}loadGLTF(e,t){let i=this.addLoadingEntry(e);this.gltfLoader.load(e,e=>{t(e),this.doneLoading(i)},e=>{e.lengthComputable&&(i.progress=e.loaded/e.total)},e=>{console.error(e)})}addLoadingEntry(e){let t=new r.LoadingTrackerEntry(e);return this.loadingTracker.push(t),t}doneLoading(e){e.finished=!0,e.progress=1,this.isLoadingDone()&&(void 0!==this.onFinishedCallback?this.onFinishedCallback():a.UIManager.setUserInterfaceVisible(!0),a.UIManager.setLoadingScreenVisible(!1))}createWelcomeScreenCallback(e){void 0===this.onFinishedCallback&&(this.onFinishedCallback=()=>{this.world.update(1,1),s.default.fire({title:e.descriptionTitle,html:e.descriptionContent,confirmButtonText:"Play",buttonsStyling:!1}).then(e=>{this.world.setTimeScale(1),a.UIManager.setUserInterfaceVisible(!0)})})}getLoadingPercentage(){let e=0,t=0;for(let i of this.loadingTracker)e++,t+=i.progress,i.finished;return t/e*100}isLoadingDone(){for(let e of this.loadingTracker)if(!e.finished)return!1;return!0}}},7918:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingTrackerEntry=void 0,t.LoadingTrackerEntry=class{constructor(e){this.progress=0,this.finished=!1,this.path=e}}},207:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIManager=void 0,t.UIManager=class{static setUserInterfaceVisible(e){document.getElementById("ui-container").style.display=e?"block":"none"}static setLoadingScreenVisible(e){document.getElementById("loading-screen").style.display=e?"flex":"none"}static setFPSVisible(e){document.getElementById("statsBox").style.display=e?"block":"none",document.getElementById("dat-gui-container").style.top=e?"48px":"0px"}}},8508:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CollisionGroups=void 0,(i=t.CollisionGroups||(t.CollisionGroups={}))[i.Default=1]="Default",i[i.Characters=2]="Characters",i[i.TrimeshColliders=4]="TrimeshColliders"},2545:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EntityType=void 0,(i=t.EntityType||(t.EntityType={}))[i.Character=0]="Character",i[i.Airplane=1]="Airplane",i[i.Car=2]="Car",i[i.Helicopter=3]="Helicopter",i[i.Decoration=4]="Decoration",i[i.System=5]="System"},4291:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SeatType=void 0,(i=t.SeatType||(t.SeatType={})).Driver="driver",i.Passenger="passenger"},8696:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Side=void 0,(i=t.Side||(t.Side={})).Left="left",i.Right="right"},516:function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Space=void 0,(i=t.Space||(t.Space={})).Local="local",i.Global="global"},9594:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoxCollider=void 0;let n=i(3687),r=i(7678),a=i(870);t.BoxCollider=class{constructor(e){let t={mass:0,position:new r.Vector3,size:new r.Vector3(.3,.3,.3),friction:.3};e=a.setDefaults(e,t),this.options=e,e.position=new n.Vec3(e.position.x,e.position.y,e.position.z),e.size=new n.Vec3(e.size.x,e.size.y,e.size.z);let i=new n.Material("boxMat");i.friction=e.friction;let s=new n.Box(e.size),o=new n.Body({mass:e.mass,position:e.position,shape:s});o.material=i,this.body=o}}},7545:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CapsuleCollider=void 0;let n=i(3687),r=i(870);t.CapsuleCollider=class{constructor(e){let t={mass:0,position:new n.Vec3,height:.5,radius:.3,segments:8,friction:.3};e=r.setDefaults(e,t),this.options=e;let i=new n.Material("capsuleMat");i.friction=e.friction;let a=new n.Body({mass:e.mass,position:e.position}),s=new n.Sphere(e.radius);a.material=i,a.addShape(s,new n.Vec3(0,0,0)),a.addShape(s,new n.Vec3(0,e.height/2,0)),a.addShape(s,new n.Vec3(0,-e.height/2,0)),this.body=a}}},5980:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrimeshCollider=void 0;let n=i(3687),r=i(870),a=i(8482);t.TrimeshCollider=class{constructor(e,t){this.mesh=e.clone();let i={mass:0,position:e.position,rotation:e.quaternion,friction:.3};t=r.setDefaults(t,i),this.options=t;let s=new n.Material("triMat");s.friction=t.friction;let o=(0,a.threeToCannon)(this.mesh,{type:a.threeToCannon.Type.MESH}),l=new n.Body({mass:t.mass,position:t.position,quaternion:t.rotation,shape:o});l.material=s,this.body=l}}},5126:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RelativeSpringSimulator=void 0;let n=i(7678),r=i(6020),a=i(870);class s extends r.SimulatorBase{constructor(e,t,i,n=0,r=0){super(e,t,i),this.position=n,this.velocity=r,this.target=0,this.lastLerp=0,this.cache=[];for(let e=0;e<2;e++)this.cache.push({position:n,velocity:r})}simulate(e){this.generateFrames(e);let t=n.MathUtils.lerp(0,this.cache[1].position,this.offset/this.frameTime);this.position=t-this.lastLerp,this.lastLerp=t,this.velocity=n.MathUtils.lerp(this.cache[0].velocity,this.cache[1].velocity,this.offset/this.frameTime)}getFrame(e){let t=Object.assign({},this.lastFrame());return e&&(t.position=0,this.lastLerp=this.lastLerp-this.lastFrame().position),(0,a.spring)(t.position,this.target,t.velocity,this.mass,this.damping)}}t.RelativeSpringSimulator=s},8917:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationFrame=void 0,t.SimulationFrame=class{constructor(e,t){this.position=e,this.velocity=t}}},4361:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationFrameVector=void 0,t.SimulationFrameVector=class{constructor(e,t){this.position=e,this.velocity=t}}},6020:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimulatorBase=void 0,t.SimulatorBase=class{constructor(e,t,i){this.mass=t,this.damping=i,this.frameTime=1/e,this.offset=0}setFPS(e){this.frameTime=1/e}lastFrame(){return this.cache[this.cache.length-1]}generateFrames(e){let t=this.offset+e,i=Math.floor(t/this.frameTime);if(this.offset=t%this.frameTime,i>0){for(let e=0;e<i;e++)this.cache.push(this.getFrame(e+1===i));this.cache=this.cache.slice(-2)}}}},9719:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpringSimulator=void 0;let n=i(7678),r=i(6020),a=i(8917),s=i(870);class o extends r.SimulatorBase{constructor(e,t,i,n=0,r=0){super(e,t,i),this.position=n,this.velocity=r,this.target=0,this.cache=[];for(let e=0;e<2;e++)this.cache.push(new a.SimulationFrame(n,r))}simulate(e){this.generateFrames(e),this.position=n.MathUtils.lerp(this.cache[0].position,this.cache[1].position,this.offset/this.frameTime),this.velocity=n.MathUtils.lerp(this.cache[0].velocity,this.cache[1].velocity,this.offset/this.frameTime)}getFrame(e){return(0,s.spring)(this.lastFrame().position,this.target,this.lastFrame().velocity,this.mass,this.damping)}}t.SpringSimulator=o},9019:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorSpringSimulator=void 0;let n=i(7678),r=i(6020),a=i(4361),s=i(870);class o extends r.SimulatorBase{constructor(e,t,i){super(e,t,i),this.init()}init(){this.position=new n.Vector3,this.velocity=new n.Vector3,this.target=new n.Vector3,this.cache=[];for(let e=0;e<2;e++)this.cache.push(new a.SimulationFrameVector(new n.Vector3,new n.Vector3))}simulate(e){this.generateFrames(e),this.position.lerpVectors(this.cache[0].position,this.cache[1].position,this.offset/this.frameTime),this.velocity.lerpVectors(this.cache[0].velocity,this.cache[1].velocity,this.offset/this.frameTime)}getFrame(e){let t=new a.SimulationFrameVector(this.lastFrame().position.clone(),this.lastFrame().velocity.clone());return(0,s.springV)(t.position,this.target,t.velocity,this.mass,this.damping),t}}t.VectorSpringSimulator=o},1923:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Airplane=void 0;let n=i(7678),r=i(3687),a=i(654),s=i(2385),o=i(9719),l=i(870),c=i(2545);class h extends a.Vehicle{constructor(e){super(e,{radius:.12,suspensionStiffness:150,suspensionRestLength:.25,dampingRelaxation:5,dampingCompression:5,directionLocal:new r.Vec3(0,-1,0),axleLocal:new r.Vec3(-1,0,0),chassisConnectionPointLocal:new r.Vec3}),this.entityType=c.EntityType.Airplane,this.elevators=[],this.enginePower=0,this.lastDrag=0,this.readAirplaneData(e),this.actions={throttle:new s.KeyBinding("ShiftLeft"),brake:new s.KeyBinding("Space"),wheelBrake:new s.KeyBinding("KeyB"),pitchUp:new s.KeyBinding("KeyS"),pitchDown:new s.KeyBinding("KeyW"),yawLeft:new s.KeyBinding("KeyQ"),yawRight:new s.KeyBinding("KeyE"),rollLeft:new s.KeyBinding("KeyA"),rollRight:new s.KeyBinding("KeyD"),exitVehicle:new s.KeyBinding("KeyF"),seat_switch:new s.KeyBinding("KeyX"),view:new s.KeyBinding("KeyV")},this.steeringSimulator=new o.SpringSimulator(60,10,.6),this.aileronSimulator=new o.SpringSimulator(60,5,.6),this.elevatorSimulator=new o.SpringSimulator(60,7,.6),this.rudderSimulator=new o.SpringSimulator(60,10,.6)}noDirectionPressed(){return!this.actions.throttle.isPressed&&!this.actions.brake.isPressed&&!this.actions.yawLeft.isPressed&&!this.actions.yawRight.isPressed&&!this.actions.rollLeft.isPressed&&!this.actions.rollRight.isPressed}update(e){super.update(e),void 0!==this.controllingCharacter?(this.enginePower<1&&(this.enginePower+=.4*e),this.enginePower>1&&(this.enginePower=1)):(this.enginePower>0&&(this.enginePower-=.12*e),this.enginePower<0&&(this.enginePower=0)),this.rotor.rotateX(this.enginePower*e*60),this.rayCastVehicle.numWheelsOnGround>0?(this.actions.yawLeft.isPressed||this.actions.rollLeft.isPressed)&&!this.actions.yawRight.isPressed&&!this.actions.rollRight.isPressed?this.steeringSimulator.target=.8:(this.actions.yawRight.isPressed||this.actions.rollRight.isPressed)&&!this.actions.yawLeft.isPressed&&!this.actions.rollLeft.isPressed?this.steeringSimulator.target=-.8:this.steeringSimulator.target=0:this.steeringSimulator.target=0,this.steeringSimulator.simulate(e),this.setSteeringValue(this.steeringSimulator.position),this.actions.rollLeft.isPressed&&!this.actions.rollRight.isPressed?this.aileronSimulator.target=.7:!this.actions.rollLeft.isPressed&&this.actions.rollRight.isPressed?this.aileronSimulator.target=-.7:this.aileronSimulator.target=0,this.actions.pitchUp.isPressed&&!this.actions.pitchDown.isPressed?this.elevatorSimulator.target=.7:!this.actions.pitchUp.isPressed&&this.actions.pitchDown.isPressed?this.elevatorSimulator.target=-.7:this.elevatorSimulator.target=0,this.actions.yawLeft.isPressed&&!this.actions.yawRight.isPressed?this.rudderSimulator.target=.7:!this.actions.yawLeft.isPressed&&this.actions.yawRight.isPressed?this.rudderSimulator.target=-.7:this.rudderSimulator.target=0,this.aileronSimulator.simulate(e),this.elevatorSimulator.simulate(e),this.rudderSimulator.simulate(e),this.leftAileron.rotation.y=this.aileronSimulator.position,this.rightAileron.rotation.y=-this.aileronSimulator.position,this.elevators.forEach(e=>{e.rotation.y=this.elevatorSimulator.position}),this.rudder.rotation.y=this.rudderSimulator.position}physicsPreStep(e,t){let i=l.threeQuat(e.quaternion),a=new n.Vector3(1,0,0).applyQuaternion(i),s=new n.Vector3(0,1,0).applyQuaternion(i),o=new n.Vector3(0,0,1).applyQuaternion(i),c=new r.Vec3().copy(this.collision.velocity),h=e.velocity.length(),u=c.dot(l.cannonVector(o)),d=u/10;d=n.MathUtils.clamp(d,0,1);let p=u/10;p=n.MathUtils.clamp(p,0,1),this.collision.mass=50*(1-.6*p);let f=e.velocity.clone();f.normalize();let m=new n.Quaternion().setFromUnitVectors(o,l.threeVector(f));m.x*=.3,m.y*=.3,m.z*=.3,m.w*=.3;let g=new n.Euler().setFromQuaternion(m),v=n.MathUtils.clamp(h-1,0,.1);v*=this.rayCastVehicle.numWheelsOnGround>0&&u<0?0:1;let y=this.actions.throttle.isPressed&&u>0?0:1;e.angularVelocity.x+=g.x*v*y,e.angularVelocity.y+=g.y*v,e.angularVelocity.z+=g.z*v*y,t.actions.pitchUp.isPressed&&(e.angularVelocity.x-=.04*a.x*d*this.enginePower,e.angularVelocity.y-=.04*a.y*d*this.enginePower,e.angularVelocity.z-=.04*a.z*d*this.enginePower),t.actions.pitchDown.isPressed&&(e.angularVelocity.x+=.04*a.x*d*this.enginePower,e.angularVelocity.y+=.04*a.y*d*this.enginePower,e.angularVelocity.z+=.04*a.z*d*this.enginePower),t.actions.yawLeft.isPressed&&(e.angularVelocity.x+=.02*s.x*d*this.enginePower,e.angularVelocity.y+=.02*s.y*d*this.enginePower,e.angularVelocity.z+=.02*s.z*d*this.enginePower),t.actions.yawRight.isPressed&&(e.angularVelocity.x-=.02*s.x*d*this.enginePower,e.angularVelocity.y-=.02*s.y*d*this.enginePower,e.angularVelocity.z-=.02*s.z*d*this.enginePower),t.actions.rollLeft.isPressed&&(e.angularVelocity.x-=.055*o.x*d*this.enginePower,e.angularVelocity.y-=.055*o.y*d*this.enginePower,e.angularVelocity.z-=.055*o.z*d*this.enginePower),t.actions.rollRight.isPressed&&(e.angularVelocity.x+=.055*o.x*d*this.enginePower,e.angularVelocity.y+=.055*o.y*d*this.enginePower,e.angularVelocity.z+=.055*o.z*d*this.enginePower);let x=.02;t.actions.throttle.isPressed&&!t.actions.brake.isPressed?x=.06:!t.actions.throttle.isPressed&&t.actions.brake.isPressed?x=-.05:this.rayCastVehicle.numWheelsOnGround>0&&(x=0),e.velocity.x+=(h*this.lastDrag+x)*o.x*this.enginePower,e.velocity.y+=(h*this.lastDrag+x)*o.y*this.enginePower,e.velocity.z+=(h*this.lastDrag+x)*o.z*this.enginePower;let _=e.velocity.length(),A=.003*Math.pow(_,1)*this.enginePower;e.velocity.x-=e.velocity.x*A,e.velocity.y-=e.velocity.y*A,e.velocity.z-=e.velocity.z*A,this.lastDrag=A;let b=.005*Math.pow(_,1)*this.enginePower;b=n.MathUtils.clamp(b,0,.05),e.velocity.x+=s.x*b,e.velocity.y+=s.y*b,e.velocity.z+=s.z*b,e.angularVelocity.x=n.MathUtils.lerp(e.angularVelocity.x,.98*e.angularVelocity.x,d),e.angularVelocity.y=n.MathUtils.lerp(e.angularVelocity.y,.98*e.angularVelocity.y,d),e.angularVelocity.z=n.MathUtils.lerp(e.angularVelocity.z,.98*e.angularVelocity.z,d)}onInputChange(){super.onInputChange(),this.actions.exitVehicle.justPressed&&void 0!==this.controllingCharacter&&this.forceCharacterOut(),this.actions.wheelBrake.justPressed&&this.setBrake(100),this.actions.wheelBrake.justReleased&&this.setBrake(0),this.actions.view.justPressed&&this.toggleFirstPersonView()}readAirplaneData(e){e.scene.traverse(e=>{e.hasOwnProperty("userData")&&e.userData.hasOwnProperty("data")&&("rotor"===e.userData.data&&(this.rotor=e),"rudder"===e.userData.data&&(this.rudder=e),"elevator"===e.userData.data&&this.elevators.push(e),"aileron"===e.userData.data&&e.userData.hasOwnProperty("side")&&("left"===e.userData.side?this.leftAileron=e:"right"===e.userData.side&&(this.rightAileron=e)))})}inputReceiverInit(){super.inputReceiverInit(),this.world.updateControls([{keys:["Shift"],desc:"Accelerate"},{keys:["Space"],desc:"Decelerate"},{keys:["W","S"],desc:"Elevators"},{keys:["A","D"],desc:"Ailerons"},{keys:["Q","E"],desc:"Rudder / Steering"},{keys:["B"],desc:"Brake"},{keys:["V"],desc:"View select"},{keys:["F"],desc:"Exit vehicle"},{keys:["Shift","+","R"],desc:"Respawn"},{keys:["Shift","+","C"],desc:"Free camera"}])}}t.Airplane=h},7040:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Car=void 0;let n=i(3687),r=i(654),a=i(2385),s=i(7678),o=i(870),l=i(9719),c=i(2545);class h extends r.Vehicle{constructor(e){super(e,{radius:.25,suspensionStiffness:20,suspensionRestLength:.35,maxSuspensionTravel:1,frictionSlip:.8,dampingRelaxation:2,dampingCompression:2,rollInfluence:.8}),this.entityType=c.EntityType.Car,this.drive="awd",this._speed=0,this.airSpinTimer=0,this.gear=1,this.timeToShift=.2,this.canTiltForwards=!1,this.characterWantsToExit=!1,this.readCarData(e),this.actions={throttle:new a.KeyBinding("KeyW"),reverse:new a.KeyBinding("KeyS"),brake:new a.KeyBinding("Space"),left:new a.KeyBinding("KeyA"),right:new a.KeyBinding("KeyD"),exitVehicle:new a.KeyBinding("KeyF"),seat_switch:new a.KeyBinding("KeyX"),view:new a.KeyBinding("KeyV")},this.steeringSimulator=new l.SpringSimulator(60,10,.6)}get speed(){return this._speed}noDirectionPressed(){return!this.actions.throttle.isPressed&&!this.actions.reverse.isPressed&&!this.actions.left.isPressed&&!this.actions.right.isPressed}update(e){super.update(e),this.rayCastVehicle.numWheelsOnGround>0?(this.canTiltForwards=!1,this.airSpinTimer=0):(this.airSpinTimer+=e,this.actions.throttle.isPressed||(this.canTiltForwards=!0));let t={R:-4,0:0,1:5,2:9,3:13,4:17,5:22};if(this.shiftTimer>0)this.shiftTimer-=e,this.shiftTimer<0&&(this.shiftTimer=0);else if(this.actions.reverse.isPressed){let e=(t.R-this.speed)/Math.abs(t.R),i=500/this.gear*Math.pow(Math.abs(e),1);this.applyEngineForce(i)}else{let e=(t[this.gear]-this.speed)/(t[this.gear]-t[this.gear-1]);if(e<.1&&this.gear<5)this.shiftUp();else if(this.gear>1&&e>1.2)this.shiftDown();else if(this.actions.throttle.isPressed){let t=500/this.gear*Math.pow(e,1);this.applyEngineForce(-t)}}if(this.steeringSimulator.simulate(e),this.setSteeringValue(this.steeringSimulator.position),void 0!==this.steeringWheel&&(this.steeringWheel.rotation.z=-(2*this.steeringSimulator.position)),this.rayCastVehicle.numWheelsOnGround<3&&.5>Math.abs(this.collision.velocity.length())&&this.collision.quaternion.copy(this.collision.initQuaternion),this.characterWantsToExit&&void 0!==this.controllingCharacter&&this.controllingCharacter.charState.canLeaveVehicles){let e=this.collision.velocity.length();e>.1&&e<4?this.triggerAction("brake",!0):this.forceCharacterOut()}}shiftUp(){this.gear++,this.shiftTimer=this.timeToShift,this.applyEngineForce(0)}shiftDown(){this.gear--,this.shiftTimer=this.timeToShift,this.applyEngineForce(0)}physicsPreStep(e,t){let i=o.threeQuat(e.quaternion),r=new s.Vector3(0,0,1).applyQuaternion(i),a=new s.Vector3(1,0,0).applyQuaternion(i),l=new s.Vector3(0,1,0).applyQuaternion(i);this._speed=this.collision.velocity.dot(o.cannonVector(r));let c=s.MathUtils.clamp(this.airSpinTimer/2,0,1);c*=s.MathUtils.clamp(this.speed,0,1);let h=s.MathUtils.clamp(1-this.speed,0,1),u=l.dot(new s.Vector3(0,-1,0))/2+.5,d=this.collision.angularVelocity,p=o.cannonVector(r.clone()),f=o.cannonVector(a.clone()),m=o.cannonVector(r.clone().multiplyScalar(.15*(c+h*u*3))),g=o.cannonVector(a.clone().multiplyScalar(.15*c));this.actions.right.isPressed&&!this.actions.left.isPressed?2>d.dot(p)&&d.vadd(m,d):this.actions.left.isPressed&&!this.actions.right.isPressed&&d.dot(p)>-2&&d.vsub(m,d),this.canTiltForwards&&this.actions.throttle.isPressed&&!this.actions.reverse.isPressed?2>d.dot(f)&&d.vadd(g,d):this.actions.reverse.isPressed&&!this.actions.throttle.isPressed&&d.dot(f)>-2&&d.vsub(g,d);let v=new n.Vec3().copy(this.collision.velocity);v.normalize();let y=o.getSignedAngleBetweenVectors(o.threeVector(v),r),x=s.MathUtils.clamp(.3*this.speed,1,Number.MAX_VALUE);if(this.actions.right.isPressed){let e=Math.min(-.8/x,-y);this.steeringSimulator.target=s.MathUtils.clamp(e,-.8,.8)}else if(this.actions.left.isPressed){let e=Math.max(.8/x,-y);this.steeringSimulator.target=s.MathUtils.clamp(e,-.8,.8)}else this.steeringSimulator.target=0;this.seats.forEach(e=>{var t;null===(t=e.door)||void 0===t||t.preStepCallback()})}onInputChange(){super.onInputChange(),this.actions.exitVehicle.justPressed&&(this.characterWantsToExit=!0),this.actions.exitVehicle.justReleased&&(this.characterWantsToExit=!1,this.triggerAction("brake",!1)),(this.actions.throttle.justReleased||this.actions.reverse.justReleased)&&this.applyEngineForce(0),this.actions.brake.justPressed&&this.setBrake(1e6,"rwd"),this.actions.brake.justReleased&&this.setBrake(0,"rwd"),this.actions.view.justPressed&&this.toggleFirstPersonView()}inputReceiverInit(){super.inputReceiverInit(),this.world.updateControls([{keys:["W","S"],desc:"Accelerate, Brake / Reverse"},{keys:["A","D"],desc:"Steering"},{keys:["Space"],desc:"Handbrake"},{keys:["V"],desc:"View select"},{keys:["F"],desc:"Exit vehicle"},{keys:["Shift","+","R"],desc:"Respawn"},{keys:["Shift","+","C"],desc:"Free camera"}])}readCarData(e){e.scene.traverse(e=>{e.hasOwnProperty("userData")&&e.userData.hasOwnProperty("data")&&"steering_wheel"===e.userData.data&&(this.steeringWheel=e)})}}t.Car=h},8483:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Helicopter=void 0;let n=i(7678),r=i(3687),a=i(870),s=i(654),o=i(2385),l=i(2545);class c extends s.Vehicle{constructor(e){super(e),this.entityType=l.EntityType.Helicopter,this.rotors=[],this.enginePower=0,this.readHelicopterData(e),this.actions={ascend:new o.KeyBinding("ShiftLeft"),descend:new o.KeyBinding("Space"),pitchUp:new o.KeyBinding("KeyS"),pitchDown:new o.KeyBinding("KeyW"),yawLeft:new o.KeyBinding("KeyQ"),yawRight:new o.KeyBinding("KeyE"),rollLeft:new o.KeyBinding("KeyA"),rollRight:new o.KeyBinding("KeyD"),exitVehicle:new o.KeyBinding("KeyF"),seat_switch:new o.KeyBinding("KeyX"),view:new o.KeyBinding("KeyV")}}noDirectionPressed(){return!this.actions.ascend.isPressed&&!this.actions.descend.isPressed}update(e){super.update(e),void 0!==this.controllingCharacter?(this.enginePower<1&&(this.enginePower+=.2*e),this.enginePower>1&&(this.enginePower=1)):(this.enginePower>0&&(this.enginePower-=.06*e),this.enginePower<0&&(this.enginePower=0)),this.rotors.forEach(t=>{t.rotateX(this.enginePower*e*30)})}onInputChange(){super.onInputChange(),this.actions.exitVehicle.justPressed&&void 0!==this.controllingCharacter&&this.forceCharacterOut(),this.actions.view.justPressed&&this.toggleFirstPersonView()}physicsPreStep(e,t){let i=a.threeQuat(e.quaternion),s=new n.Vector3(1,0,0).applyQuaternion(i),o=new n.Vector3(0,1,0),l=new n.Vector3(0,1,0).applyQuaternion(i),c=new n.Vector3(0,0,1).applyQuaternion(i);t.actions.ascend.isPressed&&(e.velocity.x+=.15*l.x*this.enginePower,e.velocity.y+=.15*l.y*this.enginePower,e.velocity.z+=.15*l.z*this.enginePower),t.actions.descend.isPressed&&(e.velocity.x-=.15*l.x*this.enginePower,e.velocity.y-=.15*l.y*this.enginePower,e.velocity.z-=.15*l.z*this.enginePower);let h=t.world.physicsWorld.gravity,u=new r.Vec3(-h.x,-h.y,-h.z).length();u*=.98*t.world.physicsFrameTime;let d=o.dot(l);u*=Math.sqrt(n.MathUtils.clamp(d,0,1));let p=new n.Vector3(0,e.velocity.y,0).multiplyScalar(-.01),f=l.clone();if(f.multiplyScalar(u),f.add(p),f.multiplyScalar(t.enginePower),e.velocity.x+=f.x,e.velocity.y+=f.y,e.velocity.z+=f.z,e.velocity.x*=n.MathUtils.lerp(1,.995,this.enginePower),e.velocity.z*=n.MathUtils.lerp(1,.995,this.enginePower),void 0!==this.controllingCharacter){let t=new n.Quaternion().setFromUnitVectors(l,o);t.x*=.3,t.y*=.3,t.z*=.3,t.w*=.3;let i=new n.Euler().setFromQuaternion(t);e.angularVelocity.x+=i.x*this.enginePower,e.angularVelocity.y+=i.y*this.enginePower,e.angularVelocity.z+=i.z*this.enginePower}t.actions.pitchUp.isPressed&&(e.angularVelocity.x-=.07*s.x*this.enginePower,e.angularVelocity.y-=.07*s.y*this.enginePower,e.angularVelocity.z-=.07*s.z*this.enginePower),t.actions.pitchDown.isPressed&&(e.angularVelocity.x+=.07*s.x*this.enginePower,e.angularVelocity.y+=.07*s.y*this.enginePower,e.angularVelocity.z+=.07*s.z*this.enginePower),t.actions.yawLeft.isPressed&&(e.angularVelocity.x+=.07*l.x*this.enginePower,e.angularVelocity.y+=.07*l.y*this.enginePower,e.angularVelocity.z+=.07*l.z*this.enginePower),t.actions.yawRight.isPressed&&(e.angularVelocity.x-=.07*l.x*this.enginePower,e.angularVelocity.y-=.07*l.y*this.enginePower,e.angularVelocity.z-=.07*l.z*this.enginePower),t.actions.rollLeft.isPressed&&(e.angularVelocity.x-=.07*c.x*this.enginePower,e.angularVelocity.y-=.07*c.y*this.enginePower,e.angularVelocity.z-=.07*c.z*this.enginePower),t.actions.rollRight.isPressed&&(e.angularVelocity.x+=.07*c.x*this.enginePower,e.angularVelocity.y+=.07*c.y*this.enginePower,e.angularVelocity.z+=.07*c.z*this.enginePower),e.angularVelocity.x*=.97,e.angularVelocity.y*=.97,e.angularVelocity.z*=.97}readHelicopterData(e){e.scene.traverse(e=>{e.hasOwnProperty("userData")&&e.userData.hasOwnProperty("data")&&"rotor"===e.userData.data&&this.rotors.push(e)})}inputReceiverInit(){super.inputReceiverInit(),this.world.updateControls([{keys:["Shift"],desc:"Ascend"},{keys:["Space"],desc:"Descend"},{keys:["W","S"],desc:"Pitch"},{keys:["Q","E"],desc:"Yaw"},{keys:["A","D"],desc:"Roll"},{keys:["V"],desc:"View select"},{keys:["F"],desc:"Exit vehicle"},{keys:["Shift","+","R"],desc:"Respawn"},{keys:["Shift","+","C"],desc:"Free camera"}])}}t.Helicopter=c},654:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vehicle=void 0;let n=i(7678),r=i(3687),a=i(6486),s=i(7444),o=i(1821),l=i(870),c=i(8508),h=i(5210);class u extends n.Object3D{constructor(e,t){super(),this.updateOrder=2,this.actions={},this.seats=[],this.wheels=[],this.materials=[],this.firstPerson=!1,void 0===t&&(t={}),t.chassisConnectionPointLocal=new r.Vec3,t.axleLocal=new r.Vec3(-1,0,0),t.directionLocal=new r.Vec3(0,-1,0);let i=new r.Material("Mat");i.friction=.01,this.collision=new r.Body({mass:50}),this.collision.material=i,this.readVehicleData(e),this.modelContainer=new n.Group,this.add(this.modelContainer),this.modelContainer.add(e.scene),this.rayCastVehicle=new r.RaycastVehicle({chassisBody:this.collision,indexUpAxis:1,indexRightAxis:0,indexForwardAxis:2}),this.wheels.forEach(e=>{t.chassisConnectionPointLocal.set(e.position.x,e.position.y+.2,e.position.z);let i=this.rayCastVehicle.addWheel(t);e.rayCastWheelInfoIndex=i}),this.help=new n.AxesHelper(2)}noDirectionPressed(){return!0}update(e){this.position.set(this.collision.position.x,this.collision.position.y,this.collision.position.z),this.quaternion.set(this.collision.quaternion.x,this.collision.quaternion.y,this.collision.quaternion.z,this.collision.quaternion.w),this.seats.forEach(t=>{t.update(e)});for(let e=0;e<this.rayCastVehicle.wheelInfos.length;e++){this.rayCastVehicle.updateWheelTransform(e);let t=this.rayCastVehicle.wheelInfos[e].worldTransform,i=this.wheels[e].wheelObject;i.position.copy(l.threeVector(t.position)),i.quaternion.copy(l.threeQuat(t.quaternion));let n=new r.Vec3;this.getVehicleAxisWorld(this.rayCastVehicle.indexUpAxis,n)}this.updateMatrixWorld()}getVehicleAxisWorld(e,t){t.set(0===e?1:0,1===e?1:0,2===e?1:0),this.rayCastVehicle.chassisBody.vectorToWorldFrame(t,t)}forceCharacterOut(){this.controllingCharacter.modelContainer.visible=!0,this.controllingCharacter.exitVehicle()}onInputChange(){var e,t;this.actions.seat_switch.justPressed&&(null===(t=null===(e=this.controllingCharacter)||void 0===e?void 0:e.occupyingSeat)||void 0===t?void 0:t.connectedSeats.length)>0&&(this.controllingCharacter.modelContainer.visible=!0,this.controllingCharacter.setState(new h.SwitchingSeats(this.controllingCharacter,this.controllingCharacter.occupyingSeat,this.controllingCharacter.occupyingSeat.connectedSeats[0])),this.controllingCharacter.stopControllingVehicle())}resetControls(){for(let e in this.actions)this.actions.hasOwnProperty(e)&&this.triggerAction(e,!1)}allowSleep(e){this.collision.allowSleep=e,!1===e&&this.collision.wakeUp()}handleKeyboardEvent(e,t,i){if("KeyC"===t&&!0===i&&!0===e.shiftKey)this.resetControls(),this.world.cameraOperator.characterCaller=this.controllingCharacter,this.world.inputManager.setInputReceiver(this.world.cameraOperator);else if("KeyR"===t&&!0===i&&!0===e.shiftKey)this.world.restartScenario();else for(let e in this.actions)if(this.actions.hasOwnProperty(e)){let n=this.actions[e];a.includes(n.eventCodes,t)&&this.triggerAction(e,i)}}setFirstPersonView(e){this.firstPerson=e,void 0!==this.controllingCharacter&&(this.controllingCharacter.modelContainer.visible=!e),e?this.world.cameraOperator.setRadius(0,!0):this.world.cameraOperator.setRadius(3,!0)}toggleFirstPersonView(){this.setFirstPersonView(!this.firstPerson)}triggerAction(e,t){let i=this.actions[e];i.isPressed!==t&&(i.isPressed=t,i.justPressed=!1,i.justReleased=!1,t?i.justPressed=!0:i.justReleased=!0,this.onInputChange(),i.justPressed=!1,i.justReleased=!1)}handleMouseButton(e,t,i){}handleMouseMove(e,t,i){this.world.cameraOperator.move(t,i)}handleMouseWheel(e,t){this.world.scrollTheTimeScale(t)}inputReceiverInit(){this.collision.allowSleep=!1,this.setFirstPersonView(!1)}inputReceiverUpdate(e){if(this.firstPerson){let e=new n.Vector3().copy(this.camera.position);e.applyQuaternion(this.quaternion),this.world.cameraOperator.target.copy(e.add(this.position))}else this.world.cameraOperator.target.set(this.position.x,this.position.y+.5,this.position.z)}setPosition(e,t,i){this.collision.position.x=e,this.collision.position.y=t,this.collision.position.z=i}setSteeringValue(e){this.wheels.forEach(t=>{t.steering&&this.rayCastVehicle.setSteeringValue(e,t.rayCastWheelInfoIndex)})}applyEngineForce(e){this.wheels.forEach(t=>{(this.drive===t.drive||"awd"===this.drive)&&this.rayCastVehicle.applyEngineForce(e,t.rayCastWheelInfoIndex)})}setBrake(e,t){this.wheels.forEach(i=>{(void 0===t||t===i.drive)&&this.rayCastVehicle.setBrake(e,i.rayCastWheelInfoIndex)})}addToWorld(e){a.includes(e.vehicles,this)?console.warn("Adding character to a world in which it already exists."):void 0===this.rayCastVehicle?console.error("Trying to create vehicle without raycastVehicleComponent"):(this.world=e,e.vehicles.push(this),e.graphicsWorld.add(this),this.rayCastVehicle.addToWorld(e.physicsWorld),this.wheels.forEach(t=>{e.graphicsWorld.attach(t.wheelObject)}),this.materials.forEach(t=>{e.sky.csm.setupMaterial(t)}),this.preStep=()=>{this.physicsPreStep(this.collision,this)},this.world.physicsWorld.addEventListener("preStep",this.preStep))}removeFromWorld(e){a.includes(e.vehicles,this)?(this.world.physicsWorld.removeEventListener("preStep",this.preStep),this.world=void 0,a.pull(e.vehicles,this),e.graphicsWorld.remove(this),this.rayCastVehicle.removeFromWorld(e.physicsWorld),this.wheels.forEach(t=>{e.graphicsWorld.remove(t.wheelObject)})):console.warn("Removing character from a world in which it isn't present.")}readVehicleData(e){e.scene.traverse(t=>{if(t.isMesh&&(l.setupMeshProperties(t),void 0!==t.material&&this.materials.push(t.material)),t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("data")){if("seat"===t.userData.data&&this.seats.push(new s.VehicleSeat(this,t,e)),"camera"===t.userData.data&&(this.camera=t),"wheel"===t.userData.data&&this.wheels.push(new o.Wheel(t)),"collision"===t.userData.data){if("box"===t.userData.shape){t.visible=!1;let e=new r.Box(new r.Vec3(t.scale.x,t.scale.y,t.scale.z));e.collisionFilterMask=~c.CollisionGroups.TrimeshColliders,this.collision.addShape(e,new r.Vec3(t.position.x,t.position.y,t.position.z))}else if("sphere"===t.userData.shape){t.visible=!1;let e=new r.Sphere(t.scale.x);e.collisionFilterGroup=c.CollisionGroups.TrimeshColliders,this.collision.addShape(e,new r.Vec3(t.position.x,t.position.y,t.position.z))}}"navmesh"===t.userData.data&&(t.visible=!1)}}),0===this.collision.shapes.length&&console.warn("Vehicle "+typeof this+" has no collision data."),0===this.seats.length?console.warn("Vehicle "+typeof this+" has no seats."):this.connectSeats()}connectSeats(){for(let e of this.seats)if(void 0!==e.connectedSeatsString){for(let t of e.connectedSeatsString.split(";"))if(t.length>0)for(let i of this.seats)i.seatPointObject.name===t&&e.connectedSeats.push(i)}}}t.Vehicle=u},8230:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VehicleDoor=void 0;let n=i(7678),r=i(870),a=i(8696);t.VehicleDoor=class{constructor(e,t){this.doorVelocity=0,this.doorWorldPos=new n.Vector3,this.lastTrailerPos=new n.Vector3,this.lastTrailerVel=new n.Vector3,this.rotation=0,this.achievingTargetRotation=!1,this.physicsEnabled=!1,this.targetRotation=0,this.rotationSpeed=5,this.lastVehicleVel=new n.Vector3,this.lastVehiclePos=new n.Vector3,this.seat=e,this.vehicle=e.vehicle,this.doorObject=t;let i=r.detectRelativeSide(this.seat.seatPointObject,this.doorObject);i===a.Side.Left?this.sideMultiplier=-1:i===a.Side.Right?this.sideMultiplier=1:this.sideMultiplier=0}update(e){this.achievingTargetRotation&&(this.rotation<this.targetRotation?(this.rotation+=e*this.rotationSpeed,this.rotation>this.targetRotation&&(this.rotation=this.targetRotation,this.achievingTargetRotation=!1,this.physicsEnabled=!0)):this.rotation>this.targetRotation&&(this.rotation-=e*this.rotationSpeed,this.rotation<this.targetRotation&&(this.rotation=this.targetRotation,this.achievingTargetRotation=!1,this.physicsEnabled=!1))),this.doorObject.setRotationFromEuler(new n.Euler(0,this.sideMultiplier*this.rotation,0))}preStepCallback(){if(this.physicsEnabled&&!this.achievingTargetRotation){this.doorObject.getWorldPosition(this.doorWorldPos);let e=r.threeVector(this.vehicle.rayCastVehicle.chassisBody.velocity),t=e.clone().sub(this.lastVehicleVel),i=r.threeQuat(this.vehicle.rayCastVehicle.chassisBody.quaternion),a=new n.Vector3(0,0,-1).applyQuaternion(i),s=new n.Vector3(0,1,0).applyQuaternion(i),o=a.clone().applyAxisAngle(s,this.sideMultiplier*this.rotation).add(this.doorWorldPos),l=o.clone().sub(t);this.lastVehicleVel.copy(e),this.lastTrailerPos.copy(o);let c=o.clone().sub(this.doorWorldPos).normalize(),h=l.clone().sub(this.doorWorldPos).normalize(),u=r.getSignedAngleBetweenVectors(c,h,s);this.doorVelocity+=this.sideMultiplier*u*.05,this.rotation+=this.doorVelocity,this.rotation<0&&(this.rotation=0,this.doorVelocity<-.08?(this.close(),this.doorVelocity=0):this.doorVelocity=-this.doorVelocity/2),this.rotation>1&&(this.rotation=1,this.doorVelocity=-this.doorVelocity/2),this.doorVelocity=.98*this.doorVelocity}}open(){this.achievingTargetRotation=!0,this.targetRotation=1}close(){this.achievingTargetRotation=!0,this.targetRotation=0}resetPhysTrailer(){this.doorObject.getWorldPosition(this.doorWorldPos),this.lastVehicleVel=new n.Vector3;let e=r.threeQuat(this.vehicle.rayCastVehicle.chassisBody.quaternion),t=new n.Vector3(0,0,-1).applyQuaternion(e);this.lastTrailerPos.copy(t.add(this.doorWorldPos))}}},7444:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VehicleSeat=void 0;let n=i(8230);t.VehicleSeat=class{constructor(e,t,i){if(this.connectedSeats=[],this.entryPoints=[],this.occupiedBy=null,this.vehicle=e,this.seatPointObject=t,t.hasOwnProperty("userData")&&t.userData.hasOwnProperty("data")){if(t.userData.hasOwnProperty("door_object")&&(this.door=new n.VehicleDoor(this,i.scene.getObjectByName(t.userData.door_object))),t.userData.hasOwnProperty("entry_points"))for(let e of t.userData.entry_points.split(";"))e.length>0&&this.entryPoints.push(i.scene.getObjectByName(e));else console.error("Seat object "+t+" has no entry point reference property.");t.userData.hasOwnProperty("seat_type")?this.type=t.userData.seat_type:console.error("Seat object "+t+" has no seat type property."),t.userData.hasOwnProperty("connected_seats")&&(this.connectedSeatsString=t.userData.connected_seats)}}update(e){void 0!==this.door&&this.door.update(e)}}},1821:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wheel=void 0,t.Wheel=class{constructor(e){this.steering=!1,this.wheelObject=e,this.position=e.position,e.hasOwnProperty("userData")&&e.userData.hasOwnProperty("data")&&(e.userData.hasOwnProperty("steering")&&(this.steering="true"===e.userData.steering),e.userData.hasOwnProperty("drive")&&(this.drive=e.userData.drive))}}},3364:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterSpawnPoint=void 0;let n=i(7678),r=i(4301),a=i(870);t.CharacterSpawnPoint=class{constructor(e){this.object=e}spawn(e,t){e.loadGLTF("build/assets/boxman.glb",e=>{let i=new r.Character(e),s=new n.Vector3;this.object.getWorldPosition(s),i.setPosition(s.x,s.y,s.z);let o=a.getForward(this.object);i.setOrientation(o,!0),t.add(i),i.takeControl()})}}},7296:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ocean=void 0;let n=i(7678),r=i(9385);t.Ocean=class{constructor(e,t){this.updateOrder=10,this.world=t;let i=n.UniformsUtils.clone(r.WaterShader.uniforms);i.iResolution.value.x=window.innerWidth,i.iResolution.value.y=window.innerHeight,this.material=new n.ShaderMaterial({uniforms:i,fragmentShader:r.WaterShader.fragmentShader,vertexShader:r.WaterShader.vertexShader}),e.material=this.material,e.material.transparent=!0}update(e){this.material.uniforms.cameraPos.value.copy(this.world.camera.position),this.material.uniforms.lightDir.value.copy(new n.Vector3().copy(this.world.sky.sunPosition).normalize()),this.material.uniforms.iGlobalTime.value+=e}}},7663:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Path=void 0;let n=i(8762);t.Path=class{constructor(e){this.nodes={},this.rootNode=e,this.rootNode.traverse(e=>{this.addNode(e)}),this.connectNodes()}addNode(e){if(e.hasOwnProperty("userData")&&e.userData.hasOwnProperty("data")&&"pathNode"===e.userData.data){let t=new n.PathNode(e,this);this.nodes[e.name]=t}}connectNodes(){for(let e in this.nodes)if(this.nodes.hasOwnProperty(e)){let t=this.nodes[e];t.nextNode=this.nodes[t.object.userData.nextNode],t.previousNode=this.nodes[t.object.userData.previousNode]}}}},8762:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PathNode=void 0,t.PathNode=class{constructor(e,t){this.object=e,this.path=t}}},6818:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scenario=void 0;let n=i(5626),r=i(3364);t.Scenario=class{constructor(e,t){this.spawnAlways=!1,this.default=!1,this.spawnPoints=[],this.invisible=!1,this.rootNode=e,this.world=t,this.id=e.name,e.userData.hasOwnProperty("name")&&(this.name=e.userData.name),e.userData.hasOwnProperty("default")&&"true"===e.userData.default&&(this.default=!0),e.userData.hasOwnProperty("spawn_always")&&"true"===e.userData.spawn_always&&(this.spawnAlways=!0),e.userData.hasOwnProperty("invisible")&&"true"===e.userData.invisible&&(this.invisible=!0),e.userData.hasOwnProperty("desc_title")&&(this.descriptionTitle=e.userData.desc_title),e.userData.hasOwnProperty("desc_content")&&(this.descriptionContent=e.userData.desc_content),e.userData.hasOwnProperty("camera_angle")&&(this.initialCameraAngle=e.userData.camera_angle),this.invisible||this.createLaunchLink(),e.traverse(e=>{if(e.hasOwnProperty("userData")&&e.userData.hasOwnProperty("data")&&"spawn"===e.userData.data){if("car"===e.userData.type||"airplane"===e.userData.type||"heli"===e.userData.type){let t=new n.VehicleSpawnPoint(e);e.userData.hasOwnProperty("type")&&(t.type=e.userData.type),e.userData.hasOwnProperty("driver")&&(t.driver=e.userData.driver,"ai"===e.userData.driver&&e.userData.hasOwnProperty("first_node")&&(t.firstAINode=e.userData.first_node)),this.spawnPoints.push(t)}else if("player"===e.userData.type){let t=new r.CharacterSpawnPoint(e);this.spawnPoints.push(t)}}})}createLaunchLink(){this.world.params[this.name]=()=>{this.world.launchScenario(this.id)},this.world.scenarioGUIFolder.add(this.world.params,this.name)}launch(e,t){this.spawnPoints.forEach(i=>{i.spawn(e,t)}),this.spawnAlways||(e.createWelcomeScreenCallback(this),t.cameraOperator.theta=this.initialCameraAngle,t.cameraOperator.phi=15)}}},5239:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sky=void 0;let n=i(7745),r=i(7678),a=i(1570);class s extends r.Object3D{constructor(e){super(),this.updateOrder=5,this.sunPosition=new r.Vector3,this._phi=50,this._theta=145,this.maxHemiIntensity=.9,this.minHemiIntensity=.3,this.world=e,this.skyMaterial=new r.ShaderMaterial({uniforms:r.UniformsUtils.clone(n.SkyShader.uniforms),fragmentShader:n.SkyShader.fragmentShader,vertexShader:n.SkyShader.vertexShader,side:r.BackSide}),this.skyMesh=new r.Mesh(new r.SphereGeometry(1e3,24,12),this.skyMaterial),this.attach(this.skyMesh),this.hemiLight=new r.HemisphereLight(0xffffff,0xffffff,1),this.refreshHemiIntensity(),this.hemiLight.color.setHSL(.59,.4,.6),this.hemiLight.groundColor.setHSL(.095,.2,.75),this.hemiLight.position.set(0,50,0),this.world.graphicsWorld.add(this.hemiLight),this.csm=new a.CSM({maxFar:300,lightIntensity:.8,cascades:3,shadowMapSize:4096,camera:e.camera,parent:e.graphicsWorld,mode:"custom",customSplitsCallback:(e,t,i,n)=>{for(let t=e-1;t>=0;t--)n.push(Math.pow(1/4,t))}}),this.csm.fade=!1,this.refreshSunPosition(),e.graphicsWorld.add(this),e.registerUpdatable(this)}set theta(e){this._theta=e,this.refreshSunPosition()}set phi(e){this._phi=e,this.refreshSunPosition(),this.refreshHemiIntensity()}update(e){this.position.copy(this.world.camera.position),this.refreshSunPosition(),this.csm.update(),this.csm.lightDirection=new r.Vector3(-this.sunPosition.x,-this.sunPosition.y,-this.sunPosition.z).normalize()}refreshSunPosition(){this.sunPosition.x=10*Math.sin(this._theta*Math.PI/180)*Math.cos(this._phi*Math.PI/180),this.sunPosition.y=10*Math.sin(this._phi*Math.PI/180),this.sunPosition.z=10*Math.cos(this._theta*Math.PI/180)*Math.cos(this._phi*Math.PI/180),this.skyMaterial.uniforms.sunPosition.value.copy(this.sunPosition),this.skyMaterial.uniforms.cameraPos.value.copy(this.world.camera.position)}refreshHemiIntensity(){this.hemiLight.intensity=this.minHemiIntensity+Math.pow(1-Math.abs(this._phi-90)/90,.25)*(this.maxHemiIntensity-this.minHemiIntensity)}}t.Sky=s},5626:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VehicleSpawnPoint=void 0;let n=i(7678),r=i(8483),a=i(1923),s=i(7040),o=i(870),l=i(4301),c=i(4422);t.VehicleSpawnPoint=class{constructor(e){this.object=e}spawn(e,t){e.loadGLTF("build/assets/"+this.type+".glb",i=>{let r=this.getNewVehicleByType(i,this.type);r.spawnPoint=this.object;let a=new n.Vector3,s=new n.Quaternion;this.object.getWorldPosition(a),this.object.getWorldQuaternion(s),r.setPosition(a.x,a.y+1,a.z),r.collision.quaternion.copy(o.cannonQuat(s)),t.add(r),void 0!==this.driver&&e.loadGLTF("build/assets/boxman.glb",e=>{let i=new l.Character(e);if(t.add(i),i.teleportToVehicle(r,r.seats[0]),"player"===this.driver)i.takeControl();else if("ai"===this.driver&&void 0!==this.firstAINode){let e=!1;for(let n in t.paths)if(t.paths.hasOwnProperty(n)){let r=t.paths[n];for(let t in r.nodes)if(Object.prototype.hasOwnProperty.call(r.nodes,t)){let n=r.nodes[t];n.object.name===this.firstAINode&&(i.setBehaviour(new c.FollowPath(n,10)),e=!0)}}e||console.error("Path node "+this.firstAINode+"not found.")}})})}getNewVehicleByType(e,t){switch(t){case"car":return new s.Car(e);case"heli":return new r.Helicopter(e);case"airplane":return new a.Airplane(e)}}}},3985:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.World=void 0;let n=i(7678),r=i(3687),a=i(6455),s=i(9755),o=i(6920),l=i(4105),c=i(3162),h=i(8448),u=i(7606),d=i(6653),p=i(4932),f=i(2118),m=i(7665),g=i(6486),v=i(4577),y=i(870),x=i(2461),_=i(207),A=i(7663),b=i(8508),S=i(9594),w=i(5980),M=i(6818),E=i(5239),C=i(7296),T=i(8204);t.World=class{constructor(e){this.timeScaleTarget=1,this.scenarios=[],this.characters=[],this.vehicles=[],this.paths=[],this.updatables=[];let t=this;d.Detector.webgl||a.default.fire({icon:"warning",title:"WebGL compatibility",text:"This browser doesn't seem to have the required WebGL capabilities. The application may not work correctly.",footer:'<a href="https://get.webgl.org/" target="_blank">Click here for more information</a>',showConfirmButton:!1,buttonsStyling:!1}),this.renderer=new n.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.toneMapping=n.ACESFilmicToneMapping,this.renderer.toneMappingExposure=1,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=n.PCFSoftShadowMap,this.generateHTML(),window.addEventListener("resize",function(){t.camera.aspect=window.innerWidth/window.innerHeight,t.camera.updateProjectionMatrix(),t.renderer.setSize(window.innerWidth,window.innerHeight),f.uniforms.resolution.value.set(1/(window.innerWidth*m),1/(window.innerHeight*m)),t.composer.setSize(window.innerWidth*m,window.innerHeight*m)},!1),this.graphicsWorld=new n.Scene,this.camera=new n.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.1,1010);let i=new T.DropInViewer({antialiased:!0,sphericalHarmonicsDegree:2});i.addSplatScenes([{path:"build/assets/tami_verydense.splat",rotation:[0,0,1,0],scale:[3,3,3],position:[0,17,0],splatAlphaRemovalThreshold:5}]),this.graphicsWorld.add(i);let s=new c.RenderPass(this.graphicsWorld,this.camera),f=new h.ShaderPass(u.FXAAShader),m=this.renderer.getPixelRatio();f.material.uniforms.resolution.value.x=1/(window.innerWidth*m),f.material.uniforms.resolution.value.y=1/(window.innerHeight*m),this.composer=new l.EffectComposer(this.renderer),this.composer.addPass(s),this.composer.addPass(f),this.physicsWorld=new r.World,this.physicsWorld.gravity.set(0,-9.81,0),this.physicsWorld.broadphase=new r.SAPBroadphase(this.physicsWorld);let g=new r.GSSolver;if(g.iterations=10,this.physicsWorld.solver=g,this.physicsWorld.allowSleep=!0,this.parallelPairs=[],this.physicsFrameRate=60,this.physicsFrameTime=1/this.physicsFrameRate,this.physicsMaxPrediction=this.physicsFrameRate,this.clock=new n.Clock,this.renderDelta=0,this.logicDelta=0,this.sinceLastFrame=0,this.justRendered=!1,this.stats=(0,p.Stats)(),this.createParamsGUI(t),this.inputManager=new v.InputManager(this,this.renderer.domElement),this.cameraOperator=new o.CameraOperator(this,this.camera,this.params.Mouse_Sensitivity),this.sky=new E.Sky(this),void 0!==e){let t=new x.LoadingManager(this);t.onFinishedCallback=()=>{this.update(1,1),this.setTimeScale(1),a.default.fire({title:"Welcome to Sketchbook!",text:"Feel free to explore the world and interact with available vehicles. There are also various scenarios ready to launch from the right panel.",footer:'<a href="https://github.com/swift502/Sketchbook" target="_blank">GitHub page</a><a href="https://discord.gg/fGuEqCe" target="_blank">Discord server</a>',confirmButtonText:"Okay",buttonsStyling:!1}).then(e=>{_.UIManager.setUserInterfaceVisible(!0)})},t.loadGLTF(e,e=>{this.loadScene(t,e)})}else _.UIManager.setUserInterfaceVisible(!0),_.UIManager.setLoadingScreenVisible(!1),a.default.fire({icon:"success",title:"Hello world!",text:"Empty Sketchbook world was succesfully initialized. Enjoy the blueness of the sky.",buttonsStyling:!1});this.render(this)}update(e,t){this.updatePhysics(e),this.updatables.forEach(i=>{i.update(e,t)}),this.params.Time_Scale=n.MathUtils.lerp(this.params.Time_Scale,this.timeScaleTarget,.2),this.params.Debug_Physics&&this.cannonDebugRenderer.update()}updatePhysics(e){this.physicsWorld.step(this.physicsFrameTime,e),this.characters.forEach(e=>{this.isOutOfBounds(e.characterCapsule.body.position)&&this.outOfBoundsRespawn(e.characterCapsule.body)}),this.vehicles.forEach(e=>{if(this.isOutOfBounds(e.rayCastVehicle.chassisBody.position)){let t=new n.Vector3;e.spawnPoint.getWorldPosition(t),t.y+=1,this.outOfBoundsRespawn(e.rayCastVehicle.chassisBody,y.cannonVector(t))}})}isOutOfBounds(e){let t=e.x>-211.882&&e.x<211.882&&e.z>-169.098&&e.z<153.232&&e.y>.107,i=e.y<14.989;return!t&&i}outOfBoundsRespawn(e,t){let i=t||new r.Vec3(0,16,0),n=new r.Quaternion(0,0,0,1);e.position.copy(i),e.interpolatedPosition.copy(i),e.quaternion.copy(n),e.interpolatedQuaternion.copy(n),e.velocity.setZero(),e.angularVelocity.setZero()}render(e){this.requestDelta=this.clock.getDelta(),requestAnimationFrame(()=>{e.render(e)});let t=this.requestDelta+this.renderDelta+this.logicDelta,i=t*this.params.Time_Scale;i=Math.min(i,1/30),e.update(i,t),e.updatePlayerPosition(),this.logicDelta=this.clock.getDelta(),this.sinceLastFrame+=this.requestDelta+this.renderDelta+this.logicDelta,this.sinceLastFrame%=1/60,this.stats.end(),this.stats.begin(),this.params.FXAA?this.composer.render():this.renderer.render(this.graphicsWorld,this.camera),this.renderDelta=this.clock.getDelta()}setTimeScale(e){this.params.Time_Scale=e,this.timeScaleTarget=e}add(e){e.addToWorld(this),this.registerUpdatable(e)}registerUpdatable(e){this.updatables.push(e),this.updatables.sort((e,t)=>e.updateOrder>t.updateOrder?1:-1)}remove(e){e.removeFromWorld(this),this.unregisterUpdatable(e)}unregisterUpdatable(e){g.pull(this.updatables,e)}loadScene(e,t){let i;for(let e of(t.scene.traverse(e=>{if(e.hasOwnProperty("userData")&&("Mesh"===e.type&&(y.setupMeshProperties(e),this.sky.csm.setupMaterial(e.material),"ocean"===e.material.name&&this.registerUpdatable(new C.Ocean(e,this))),e.userData.hasOwnProperty("data"))){if("physics"===e.userData.data&&e.userData.hasOwnProperty("type")){if("box"===e.userData.type){let t=new S.BoxCollider({size:new n.Vector3(e.scale.x,e.scale.y,e.scale.z)});t.body.position.copy(y.cannonVector(e.position)),t.body.quaternion.copy(y.cannonQuat(e.quaternion)),t.body.updateAABB(),t.body.shapes.forEach(e=>{e.collisionFilterMask=~b.CollisionGroups.TrimeshColliders}),this.physicsWorld.addBody(t.body)}else if("trimesh"===e.userData.type){let t=new w.TrimeshCollider(e,{});this.physicsWorld.addBody(t.body)}e.visible=!1}"path"===e.userData.data&&this.paths.push(new A.Path(e)),"scenario"===e.userData.data&&this.scenarios.push(new M.Scenario(e,this))}}),this.graphicsWorld.add(t.scene),this.scenarios))if(e.default){i=e.id;break}void 0!==i&&this.launchScenario(i,e)}launchScenario(e,t){for(let i of(this.lastScenarioID=e,this.clearEntities(),t||(t=new x.LoadingManager(this)),this.scenarios))(i.id===e||i.spawnAlways)&&i.launch(t,this)}restartScenario(){void 0!==this.lastScenarioID?(document.exitPointerLock(),this.launchScenario(this.lastScenarioID)):console.warn("Can't restart scenario. Last scenarioID is undefined.")}clearEntities(){for(let e=0;e<this.characters.length;e++)this.remove(this.characters[e]),e--;for(let e=0;e<this.vehicles.length;e++)this.remove(this.vehicles[e]),e--}scrollTheTimeScale(e){e>0?(this.timeScaleTarget/=1.3,this.timeScaleTarget<.003&&(this.timeScaleTarget=0)):(this.timeScaleTarget*=1.3,this.timeScaleTarget<.003&&(this.timeScaleTarget=.003),this.timeScaleTarget=Math.min(this.timeScaleTarget,1))}updateControls(e){let t="";t+='<h2 class="controls-title">Controls:</h2>',e.forEach(e=>{t+='<div class="ctrl-row">',e.keys.forEach(e=>{"+"===e||"and"===e||"or"===e||"&"===e?t+="&nbsp;"+e+"&nbsp;":t+='<span class="ctrl-key">'+e+"</span>"}),t+='<span class="ctrl-desc">'+e.desc+"</span></div>"}),document.getElementById("controls").innerHTML=t}generateHTML(){s("head").append('<link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap" rel="stylesheet">'),s("head").append('<link href="https://fonts.googleapis.com/css2?family=Solway:wght@400;500;700&display=swap" rel="stylesheet">'),s("head").append('<link href="https://fonts.googleapis.com/css2?family=Cutive+Mono&display=swap" rel="stylesheet">'),s(`	<div id="loading-screen">
				<div id="loading-screen-background"></div>
				<h1 id="main-title" class="sb-font">Sketchbook 0.4</h1>
				<div class="cubeWrap">
					<div class="cube">
						<div class="faces1"></div>
						<div class="faces2"></div>     
					</div> 
				</div> 
				<div id="loading-text">Loading...</div>
			</div>
		`).appendTo("body"),s(`	<div id="ui-container" style="display: none;">
				<div class="github-corner">
					<a href="https://github.com/swift502/Sketchbook" target="_blank" title="Fork me on GitHub">
						<svg viewbox="0 0 100 100" fill="currentColor">
							<title>Fork me on GitHub</title>
							<path d="M0 0v100h100V0H0zm60 70.2h.2c1 2.7.3 4.7 0 5.2 1.4 1.4 2 3 2 5.2 0 7.4-4.4 9-8.7 9.5.7.7 1.3 2
							1.3 3.7V99c0 .5 1.4 1 1.4 1H44s1.2-.5 1.2-1v-3.8c-3.5 1.4-5.2-.8-5.2-.8-1.5-2-3-2-3-2-2-.5-.2-1-.2-1
							2-.7 3.5.8 3.5.8 2 1.7 4 1 5 .3.2-1.2.7-2 1.2-2.4-4.3-.4-8.8-2-8.8-9.4 0-2 .7-4 2-5.2-.2-.5-1-2.5.2-5
							0 0 1.5-.6 5.2 1.8 1.5-.4 3.2-.6 4.8-.6 1.6 0 3.3.2 4.8.7 2.8-2 4.4-2 5-2z"></path>
						</svg>
					</a>
				</div>
				<div class="left-panel">
					<div id="player-position" class="panel-segment">Position: 0, 0, 0</div>
					<div id="controls" class="panel-segment flex-bottom"></div>
				</div>
			</div>
		`).appendTo("body"),document.body.appendChild(this.renderer.domElement),this.renderer.domElement.id="canvas"}updatePlayerPosition(){let e=this.camera.position,t=e.x.toFixed(2),i=e.y.toFixed(2),n=e.z.toFixed(2);document.getElementById("player-position").innerHTML=`Position: ${t}, ${i}, ${n}`}createParamsGUI(e){this.params={Pointer_Lock:!0,Mouse_Sensitivity:.3,Time_Scale:1,Shadows:!0,FXAA:!0,Debug_Physics:!1,Debug_FPS:!1,Sun_Elevation:50,Sun_Rotation:145};let t=new f.GUI;this.scenarioGUIFolder=t.addFolder("Scenarios"),this.scenarioGUIFolder.open();let i=t.addFolder("World");i.add(this.params,"Time_Scale",0,1).listen().onChange(t=>{e.timeScaleTarget=t}),i.add(this.params,"Sun_Elevation",0,180).listen().onChange(t=>{e.sky.phi=t}),i.add(this.params,"Sun_Rotation",0,360).listen().onChange(t=>{e.sky.theta=t});let n=t.addFolder("Settings");n.add(this.params,"FXAA"),n.add(this.params,"Shadows").onChange(e=>{e?this.sky.csm.lights.forEach(e=>{e.castShadow=!0}):this.sky.csm.lights.forEach(e=>{e.castShadow=!1})}),n.add(this.params,"Pointer_Lock").onChange(t=>{e.inputManager.setPointerLock(t)}),n.add(this.params,"Mouse_Sensitivity",0,1).onChange(t=>{e.cameraOperator.setSensitivity(t,.8*t)}),n.add(this.params,"Debug_Physics").onChange(t=>{t?this.cannonDebugRenderer=new m.CannonDebugRenderer(this.graphicsWorld,this.physicsWorld):(this.cannonDebugRenderer.clearMeshes(),this.cannonDebugRenderer=void 0),e.characters.forEach(e=>{e.raycastBox.visible=t})}),n.add(this.params,"Debug_FPS").onChange(e=>{_.UIManager.setFPSVisible(e)}),t.open()}}},7665:function(e,t,i){"use strict";i.r(t),i.d(t,{CannonDebugRenderer:()=>a});var n=i(1795),r=i(3687);i(6653);var a=function(e,t,i){i=i||{},this.scene=e,this.world=t,this._meshes=[],this._boxMaterial=new n.vBJ({color:255,wireframe:!0}),this._triMaterial=new n.vBJ({color:0xff0000,wireframe:!0}),this._sphereMaterial=new n.vBJ({color:65280,wireframe:!0}),this._sphereGeometry=new n.xo$(1),this._boxGeometry=new n.DvJ(1,1,1),this._planeGeometry=new n._12(10,10,10,10),this._cylinderGeometry=new n.fHI(1,1,10,10)};a.prototype={tmpVec0:new r.Vec3,tmpVec1:new r.Vec3,tmpVec2:new r.Vec3,tmpQuat0:new r.Vec3,update:function(){for(var e=this.world.bodies,t=this._meshes,i=this.tmpVec0,n=this.tmpQuat0,r=0,a=0;a!==e.length;a++)for(var s=e[a],o=0;o!==s.shapes.length;o++){var l=s.shapes[o];this._updateMesh(r,s,l);var c=t[r];c&&(s.interpolatedQuaternion.vmult(s.shapeOffsets[o],i),s.interpolatedPosition.vadd(i,i),s.quaternion.mult(s.shapeOrientations[o],n),c.position.copy(i),c.quaternion.copy(n)),r++}for(var a=r;a<t.length;a++){var c=t[a];c&&this.scene.remove(c)}t.length=r},_updateMesh:function(e,t,i){var n=this._meshes[e];this._typeMatch(n,i)||(n&&this.scene.remove(n),n=this._meshes[e]=this._createMesh(i)),this._scaleMesh(n,i)},_typeMatch:function(e,t){if(!e)return!1;var i=e.geometry;return i instanceof n.xo$&&t instanceof r.Sphere||i instanceof n.DvJ&&t instanceof r.Box||i instanceof n._12&&t instanceof r.Plane||i.id===t.geometryId&&t instanceof r.ConvexPolyhedron||i.id===t.geometryId&&t instanceof r.Trimesh||i.id===t.geometryId&&t instanceof r.Heightfield},_createMesh:function(e){var t,i=this._sphereMaterial,a=this._boxMaterial,s=this._triMaterial;switch(e.type){case r.Shape.types.SPHERE:t=new n.Kj0(this._sphereGeometry,i);break;case r.Shape.types.BOX:t=new n.Kj0(this._boxGeometry,a);break;case r.Shape.types.PLANE:t=new n.Kj0(this._planeGeometry,i);break;case r.Shape.types.CONVEXPOLYHEDRON:for(var o=[],l=[],c=0;c<e.vertices.length;c++){var h=e.vertices[c];o.push(new n.Pa4(h.x,h.y,h.z))}for(var c=0;c<e.faces.length;c++)for(var u=e.faces[c],d=u[0],p=1;p<u.length-1;p++){var f=u[p],m=u[p+1];l.push(o[d],o[f],o[m])}var g=new n.u9r().setFromPoints(l);g.computeBoundingSphere(),g.computeFaceNormals(),t=new n.Kj0(g,a),e.geometryId=g.id;break;case r.Shape.types.TRIMESH:var o=[],l=[],v=this.tmpVec0;for(let t=0;t<e.indices.length;t++){let i=e.indices[t];e.getVertex(i,v),o.push(new n.Pa4(v.x,v.y,v.z))}var y=new n.u9r().setFromPoints(o);y.computeBoundingSphere(),t=new n.Kj0(y,s),e.geometryId=y.id;break;case r.Shape.types.HEIGHTFIELD:for(var o=[],l=[],v=this.tmpVec0,x=this.tmpVec1,_=this.tmpVec2,A=0;A<e.data.length-1;A++)for(var b=0;b<e.data[A].length-1;b++)for(var S=0;S<2;S++){e.getConvexTrianglePillar(A,b,0===S),v.copy(e.pillarConvex.vertices[0]),x.copy(e.pillarConvex.vertices[1]),_.copy(e.pillarConvex.vertices[2]),v.vadd(e.pillarOffset,v),x.vadd(e.pillarOffset,x),_.vadd(e.pillarOffset,_),o.push(new n.Pa4(v.x,v.y,v.z),new n.Pa4(x.x,x.y,x.z),new n.Pa4(_.x,_.y,_.z));var c=o.length-3;l.push(o[c],o[c+1],o[c+2])}var y=new n.u9r().setFromPoints(l);y.computeBoundingSphere(),y.computeFaceNormals(),t=new n.Kj0(y,s),e.geometryId=y.id}return t&&this.scene.add(t),t},_scaleMesh:function(e,t){switch(t.type){case r.Shape.types.SPHERE:var i=t.radius;e.scale.set(i,i,i);break;case r.Shape.types.BOX:e.scale.copy(t.halfExtents),e.scale.multiplyScalar(2);break;case r.Shape.types.CONVEXPOLYHEDRON:e.scale.set(1,1,1);break;case r.Shape.types.TRIMESH:e.scale.copy(t.scale);break;case r.Shape.types.HEIGHTFIELD:e.scale.set(1,1,1)}},clearMeshes:function(){this._meshes.forEach(e=>{this.scene.remove(e)})}}},7745:function(e,t,i){"use strict";i.r(t),i.d(t,{SkyShader:()=>r});let n=i(7678),r={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new n.Vector3},cameraPos:{value:new n.Vector3}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
  
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;
  
      const vec3 up = vec3( 0.0, 1.0, 0.0 );
  
      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;
  
      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );
  
      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );
  
      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;
  
      float sunIntensity( float zenithAngleCos ) {
      	zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
      	return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }
  
      vec3 totalMie( float T ) {
      	float c = ( 0.2 * T ) * 10E-18;
      	return 0.434 * c * MieConst;
      }
  
      void main() {
  
      	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
      	vWorldPosition = worldPosition.xyz;
  
      	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  
      	vSunDirection = normalize( sunPosition );
  
      	vSunE = sunIntensity( dot( vSunDirection, up ) );
  
      	vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );
  
      	float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );
  
      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
      	vBetaR = totalRayleigh * rayleighCoefficient;
  
      // mie coefficients
      	vBetaM = totalMie( turbidity ) * mieCoefficient;
  
      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;
  
      uniform float luminance;
      uniform float mieDirectionalG;
      uniform vec3 cameraPos;
  
      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;
  
      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at
      // 288.15K and 1013mb (sea level -45 celsius)
  
      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      const vec3 up = vec3( 0.0, 1.0, 0.0 );
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;
  
      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;
  
      float rayleighPhase( float cosTheta ) {
      	return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }
  
      float hgPhase( float cosTheta, float g ) {
      	float g2 = pow( g, 2.0 );
      	float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
      	return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }
  
      // Filmic ToneMapping http://filmicgames.com/archives/75
      const float A = 0.15;
      const float B = 0.50;
      const float C = 0.10;
      const float D = 0.20;
      const float E = 0.02;
      const float F = 0.30;
  
      const float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)
  
      vec3 Uncharted2Tonemap( vec3 x ) {
      	return ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;
      }
  
      void main() {
      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
      	float zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );
      	float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
      	float sR = rayleighZenithLength * inverse;
      	float sM = mieZenithLength * inverse;
  
      // combined extinction factor
      	vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );
  
      // in scattering
      	float cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );
  
      	float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
      	vec3 betaRTheta = vBetaR * rPhase;
  
      	float mPhase = hgPhase( cosTheta, mieDirectionalG );
      	vec3 betaMTheta = vBetaM * mPhase;
  
      	vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
      	Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );
  
      // nightsky
      	vec3 direction = normalize( vWorldPosition - cameraPos );
      	float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
      	float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
      	vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
      	vec3 L0 = vec3( 0.1 ) * Fex;
  
      // composition + solar disc
      	float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
      	L0 += ( vSunE * 19000.0 * Fex ) * sundisk;
  
      	vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );
  
      	//vec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );
        // vec3 color = texColor * whiteScale;
        vec3 color = texColor * 0.3;
  
      	vec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );
  
      	gl_FragColor = vec4( retColor, 1.0 );
  
        #if defined( TONE_MAPPING )
          gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
        #endif
      } `}},9385:function(e,t,i){"use strict";i.r(t),i.d(t,{WaterShader:()=>r});let n=i(7678),r={uniforms:{iGlobalTime:{type:"f",value:.1},iResolution:{type:"v2",value:new n.Vector2},cameraPos:{value:new n.Vector3},lightDir:{value:new n.Vector3}},vertexShader:`

    varying vec3 vWorldPosition;
    varying vec2 vTexCoord;

    void main()	{
        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        vTexCoord = uv;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
      }
    `,fragmentShader:`
    uniform float iGlobalTime;
    uniform vec2 iResolution;
    uniform vec3 cameraPos;
    uniform vec3 lightDir;

    varying vec3 vWorldPosition;
    varying vec2 vTexCoord;
  
    const int NUM_STEPS = 8;
    const float PI	 	= 3.1415;
    const float EPSILON	= 1e-3;
  
    // sea variables
    const int ITER_GEOMETRY = 3;
    const int ITER_FRAGMENT = 5;
    const float SEA_HEIGHT = 0.6;
    const float SEA_CHOPPY = 1.0;
    const float SEA_SPEED = 1.0;
    const float SEA_FREQ = 0.16;
    const vec3 SEA_BASE = vec3(0.1,0.19,0.22);
    const vec3 SEA_WATER_COLOR = vec3(0.8,0.9,0.6);
    mat2 octave_m = mat2(1.6,1.2,-1.2,1.6);
  
    mat3 fromEuler(vec3 ang) {
      vec2 a1 = vec2(sin(ang.x),cos(ang.x));
      vec2 a2 = vec2(sin(ang.y),cos(ang.y));
      vec2 a3 = vec2(sin(ang.z),cos(ang.z));
      mat3 m;
      m[0] = vec3(
          a1.y*a3.y+a1.x*a2.x*a3.x,
          a1.y*a2.x*a3.x+a3.y*a1.x,
          -a2.y*a3.x
      );
      m[1] = vec3(-a2.y*a1.x,a1.y*a2.y,a2.x);
      m[2] = vec3(
          a3.y*a1.x*a2.x+a1.y*a3.x,
        a1.x*a3.x-a1.y*a3.y*a2.x,
        a2.y*a3.y
      );
      return m;
    }
  
    float hash( vec2 p ) {
      float h = dot(p,vec2(127.1,311.7));	
      return fract(sin(h)*43758.5453123);
    }
  
    float noise( in vec2 p ) {
      vec2 i = floor(p);
      vec2 f = fract(p);	
      vec2 u = f * f * (3.0 - 2.0 * f);
      return -1.0 + 2.0 * mix(
          mix(
            hash(i + vec2(0.0,0.0)
        ), 
          hash(i + vec2(1.0,0.0)), u.x),
          mix(hash(i + vec2(0.0,1.0) ), 
          hash(i + vec2(1.0,1.0) ), u.x), 
        u.y
      );
    }
  
    float diffuse(vec3 n,vec3 l,float p) {
      return pow(dot(n,l) * 0.4 + 0.6,p);
    }
  
    float specular(vec3 n,vec3 l,vec3 e,float s) {    
      float nrm = (s + 8.0) / (3.1415 * 8.0);
      return pow(max(dot(reflect(e,n),l),0.0),s) * nrm;
    }
  
    vec3 getSkyColor(vec3 e) {
      e.y = max(e.y, 0.0);
      vec3 ret;
      ret.x = pow(1.0 - e.y, 2.0);
      ret.y = 1.0 - e.y;
      ret.z = 0.6+(1.0 - e.y) * 0.4;
      return ret;
    }
  
  
    float sea_octave(vec2 uv, float choppy) {
      uv += noise(uv);         
      vec2 wv = 1.0 - abs(sin(uv));
      vec2 swv = abs(cos(uv));    
      wv = mix(wv, swv, wv);
      return pow(1.0 - pow(wv.x * wv.y, 0.65), choppy);
    }
  
    float map(vec3 p) {
      float freq = SEA_FREQ;
      float amp = SEA_HEIGHT ;
      float choppy = SEA_CHOPPY;
      vec2 uv = p.xz; 
      uv.x *= 0.75;
  
	  float SEA_TIME = iGlobalTime * SEA_SPEED;
      float d, h = 0.0;    
      for(int i = 0; i < ITER_GEOMETRY; i++) {        
        d = sea_octave((uv + SEA_TIME) * freq, choppy);
        d += sea_octave((uv - SEA_TIME) * freq, choppy);
        h += d * amp;        
        uv *= octave_m;
        freq *= 1.9; 
        amp *= 0.22;
        choppy = mix(choppy, 1.0, 0.2);
      }
      return p.y - h;
    }
  
    float map_detailed(vec3 p) {
        float freq = SEA_FREQ;
        float amp = SEA_HEIGHT;
        float choppy = SEA_CHOPPY;
        vec2 uv = p.xz;
        uv.x *= 0.75;
  
		float SEA_TIME = iGlobalTime * SEA_SPEED;
        float d, h = 0.0;    
        for(int i = 0; i < ITER_FRAGMENT; i++) {        
          d = sea_octave((uv+SEA_TIME) * freq, choppy);
          d += sea_octave((uv-SEA_TIME) * freq, choppy);
          h += d * amp;        
          uv *= octave_m;
          freq *= 1.9; 
          amp *= 0.22;
          choppy = mix(choppy,1.0,0.2);
        }
        return p.y - h;
    }
  
    vec3 getSeaColor(
        vec3 p,
      vec3 n, 
      vec3 l, 
      vec3 eye, 
      vec3 dist
    ) {  
      float fresnel = 1.0 - max(dot(n,-eye),0.0);
      fresnel = pow(fresnel,3.0) * 0.65;
  
      vec3 reflected = getSkyColor(reflect(eye,n));    
      vec3 refracted = SEA_BASE + diffuse(n,l,80.0) * SEA_WATER_COLOR * 0.12; 
  
      vec3 color = mix(refracted,reflected,fresnel);
  
      float atten = max(1.0 - dot(dist,dist) * 0.001, 0.0);
      color += SEA_WATER_COLOR * (p.y - SEA_HEIGHT) * 0.18 * atten;
  
      float night = dot(l, vec3(0.0, 1.0, 0.0));
      night = clamp(night + 0.1, 0.0, 0.5) * 2.0;
      color *= vec3(night);

      color += vec3(specular(n,l,eye,60.0));
  
      return color;
    }
  
    // tracing
    vec3 getNormal(vec3 p, float eps) {
      vec3 n;
      n.y = map_detailed(p);    
      n.x = map_detailed(vec3(p.x+eps,p.y,p.z)) - n.y;
      n.z = map_detailed(vec3(p.x,p.y,p.z+eps)) - n.y;
      n.y = eps;
      return normalize(n);
    }
  
    float heightMapTracing(vec3 ori, vec3 dir, out vec3 p) {  

      vec3 oriComp = ori;
      oriComp.y -= vWorldPosition.y - SEA_HEIGHT;

      float tm = 0.0;
      float tx = 1000.0;
      float hx = map(oriComp + dir * tx);

      if(hx > 0.0) {
        return tx;   
      }
  
      float hm = map(oriComp + dir * tm);    
      float tmid = 0.0;
      for(int i = 0; i < NUM_STEPS; i++) {
        tmid = mix(tm,tx, hm/(hm-hx));                   
        p = oriComp + dir * tmid;   
        float hmid = map(p);
        if(hmid < 0.0) {
          tx = tmid;
          hx = hmid;
        } else {
          tm = tmid;
          hm = hmid;
         }
      }

      return tmid;
    }
  
    void main() {
      float time = iGlobalTime * 0.3;
  
      // ray
      vec3 ang = vec3(
        sin(time*3.0)*0.1,sin(time)*0.2+0.3,time
      );    

      vec3 dir = normalize( vWorldPosition - cameraPos );
  
      // tracing
      vec3 p;
      heightMapTracing(cameraPos,dir,p);
	  vec3 dist = vWorldPosition - cameraPos;
	  float EPSILON_NRM	= 0.1 / iResolution.x;
      vec3 n = getNormal(
        p,
        dot(dist,dist) * EPSILON_NRM
      );
  
      // color
      vec3 color = mix(
        getSkyColor(dir),
        getSeaColor(p,n,lightDir,dir,dist),
        pow(smoothstep(0.0,-0.05,dir.y),0.3)
      );
  
      // post
      gl_FragColor = vec4(pow(color,vec3(0.8)), 1.0) * 1.2;

      float fogfac = clamp(length(dist), 300.0, 600.0);
      fogfac -= 300.0;
      fogfac /= 300.0;
      gl_FragColor.a = 1.0 - fogfac;

      #if defined( TONE_MAPPING )
        gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
      #endif
    }
    `}},6653:function(e,t,i){"use strict";i.r(t),i.d(t,{Detector:()=>n});var n={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl")))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>\nFind out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'),e},addGetWebGLMessage:function(e){var t,i,r;t=void 0!==(e=e||{}).parent?e.parent:document.body,i=void 0!==e.id?e.id:"oldie",(r=n.getWebGLErrorMessage()).id=i,t.appendChild(r)}}},4932:function(e,t,i){"use strict";i.r(t),i.d(t,{Stats:()=>n});var n=function(){var e=document.createElement("div");function t(t){return e.appendChild(t.dom),t}function i(t){for(var i=0;i<e.children.length;i++)e.children[i].style.display="inline-block"}e.id="statsBox",e.style.display="none",document.getElementById("ui-container").appendChild(e);var r=(performance||Date).now(),a=r,s=0,o=t(new n.Panel("FPS","#0ff","#002")),l=t(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new n.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(l.update(e-r,200),e>a+1e3&&(o.update(1e3*s/(e-a),100),a=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){r=this.end()},domElement:e,setMode:i}};n.Panel=function(e,t,i){var n=1/0,r=0,a=Math.round,s=a(window.devicePixelRatio||1),o=100*s,l=48*s,c=3*s,h=2*s,u=3*s,d=15*s,p=94*s,f=30*s,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:100px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,o,l),g.fillStyle=t,g.fillText(e,c,h),g.fillRect(u,d,p,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,d,p,f),{dom:m,update:function(l,v){n=Math.min(n,l),r=Math.max(r,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=t,g.fillText(a(l)+" "+e+" ("+a(n)+"-"+a(r)+")",c,h),g.drawImage(m,u+s,d,p-s,f,u,d,p-s,f),g.fillRect(u+p-s,d,s,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+p-s,d,s,a((1-l/v)*f))}}}},2118:function(e){var t;t=function(){"use strict";function e(e,t){var i=e.__state.conversionName.toString(),n=Math.round(e.r),r=Math.round(e.g),a=Math.round(e.b),s=e.a,o=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var h=e.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}if("CSS_RGB"===i)return"rgb("+n+","+r+","+a+")";if("CSS_RGBA"===i)return"rgba("+n+","+r+","+a+","+s+")";if("HEX"===i)return"0x"+e.hex.toString(16);if("RGB_ARRAY"===i)return"["+n+","+r+","+a+"]";else if("RGBA_ARRAY"===i)return"["+n+","+r+","+a+","+s+"]";else if("RGB_OBJ"===i)return"{r:"+n+",g:"+r+",b:"+a+"}";else if("RGBA_OBJ"===i)return"{r:"+n+",g:"+r+",b:"+a+",a:"+s+"}";else if("HSV_OBJ"===i)return"{h:"+o+",s:"+l+",v:"+c+"}";else if("HSVA_OBJ"===i)return"{h:"+o+",s:"+l+",v:"+c+",a:"+s+"}";return"unknown format"}var t=Array.prototype.forEach,i=Array.prototype.slice,n={BREAK:{},extend:function(e){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach((function(i){this.isUndefined(t[i])||(e[i]=t[i])}).bind(this))},this),e},defaults:function(e){return this.each(i.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach((function(i){this.isUndefined(e[i])&&(e[i]=t[i])}).bind(this))},this),e},compose:function(){var e=i.call(arguments);return function(){for(var t=i.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,i,n){if(e){if(t&&e.forEach&&e.forEach===t)e.forEach(i,n);else if(e.length===e.length+0){var r=void 0,a=void 0;for(r=0,a=e.length;r<a;r++)if(r in e&&i.call(n,e[r],r)===this.BREAK)return}else for(var s in e)if(i.call(n,e[s],s)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var n=void 0;return function(){var r=this,a=arguments,s=i||!n;clearTimeout(n),n=setTimeout(function(){n=null,i||e.apply(r,a)},t),s&&e.apply(r,a)}},toArray:function(e){return e.toArray?e.toArray():i.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},r=[{litmus:n.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:n.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:n.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:n.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(n.isNumber(e.r)&&n.isNumber(e.g)&&n.isNumber(e.b)&&n.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(n.isNumber(e.r)&&n.isNumber(e.g)&&n.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(n.isNumber(e.h)&&n.isNumber(e.s)&&n.isNumber(e.v)&&n.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(n.isNumber(e.h)&&n.isNumber(e.s)&&n.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],a=void 0,s=void 0,o=function(){s=!1;var e=arguments.length>1?n.toArray(arguments):arguments[0];return n.each(r,function(t){if(t.litmus(e))return n.each(t.conversions,function(t,i){if(a=t.read(e),!1===s&&!1!==a)return s=a,a.conversionName=i,a.conversion=t,n.BREAK}),n.BREAK}),s},l=void 0,c={hsv_to_rgb:function(e,t,i){var n=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),a=i*(1-t),s=i*(1-r*t),o=i*(1-(1-r)*t),l=[[i,o,a],[s,i,a],[a,i,o],[a,s,i],[o,a,i],[i,a,s]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,i){var n=Math.min(e,t,i),r=Math.max(e,t,i),a=r-n,s=void 0,o=void 0;return 0===r?{h:NaN,s:0,v:0}:(o=a/r,(s=(e===r?(t-i)/a:t===r?2+(i-e)/a:4+(e-t)/a)/6)<0&&(s+=1),{h:360*s,s:o,v:r/255})},rgb_to_hex:function(e,t,i){var n=this.hex_with_component(0,2,e);return n=this.hex_with_component(n,1,t),n=this.hex_with_component(n,0,i)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,i){return i<<(l=8*t)|e&~(255<<l)}},h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),p=function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,i,n)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(n)},f=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e},g=function(){function t(){if(u(this,t),this.__state=o.apply(this,arguments),!1===this.__state)throw Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return d(t,[{key:"toString",value:function(){return e(this)}},{key:"toHexString",value:function(){return e(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function v(e,t,i){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||g.recalculateRGB(this,t,i),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(g.recalculateRGB(this,t,i),this.__state.space="RGB"),this.__state[t]=e}})}function y(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||g.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(g.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}g.recalculateRGB=function(e,t,i){if("HEX"===e.__state.space)e.__state[t]=c.component_from_hex(e.__state.hex,i);else if("HSV"===e.__state.space)n.extend(e.__state,c.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v));else throw Error("Corrupted color state")},g.recalculateHSV=function(e){var t=c.rgb_to_hsv(e.r,e.g,e.b);n.extend(e.__state,{s:t.s,v:t.v}),n.isNaN(t.h)?n.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},g.COMPONENTS=["r","g","b","h","s","v","hex","a"],v(g.prototype,"r",2),v(g.prototype,"g",1),v(g.prototype,"b",0),y(g.prototype,"h"),y(g.prototype,"s"),y(g.prototype,"v"),Object.defineProperty(g.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(g.prototype,"hex",{get:function(){return this.__state.space,this.__state.hex=c.rgb_to_hex(this.r,this.g,this.b),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var x=function(){function e(t,i){u(this,e),this.initialValue=t[i],this.domElement=document.createElement("div"),this.object=t,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return d(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),_={};n.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){n.each(e,function(e){_[e]=t})});var A=/(\d+(\.\d+)?)px/;function b(e){if("0"===e||n.isUndefined(e))return 0;var t=e.match(A);return n.isNull(t)?0:parseFloat(t[1])}var S={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var r=i,a=t;n.isUndefined(a)&&(a=!0),n.isUndefined(r)&&(r=!0),e.style.position="absolute",a&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,r){var a=i||{},s=_[t];if(!s)throw Error("Event type "+t+" not supported.");var o=document.createEvent(s);switch(s){case"MouseEvents":var l=a.x||a.clientX||0,c=a.y||a.clientY||0;o.initMouseEvent(t,a.bubbles||!1,a.cancelable||!0,window,a.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=o.initKeyboardEvent||o.initKeyEvent;n.defaults(a,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(t,a.bubbles||!1,a.cancelable,window,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);break;default:o.initEvent(t,a.bubbles||!1,a.cancelable||!0)}n.defaults(o,r),e.dispatchEvent(o)},bind:function(e,t,i,n){return e.addEventListener?e.addEventListener(t,i,n||!1):e.attachEvent&&e.attachEvent("on"+t,i),S},unbind:function(e,t,i,n){return e.removeEventListener?e.removeEventListener(t,i,n||!1):e.detachEvent&&e.detachEvent("on"+t,i),S},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);-1===i.indexOf(t)&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return S},removeClass:function(e,t){if(t){if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),n=i.indexOf(t);-1!==n&&(i.splice(n,1),e.className=i.join(" "))}}else e.className=void 0;return S},hasClass:function(e,t){return RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return b(t["border-left-width"])+b(t["border-right-width"])+b(t["padding-left"])+b(t["padding-right"])+b(t.width)},getHeight:function(e){var t=getComputedStyle(e);return b(t["border-top-width"])+b(t["border-bottom-width"])+b(t["padding-top"])+b(t["padding-bottom"])+b(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent;while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},w=function(e){function t(e,i){u(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),S.bind(n.__checkbox,"change",function(){n.setValue(!n.__prev)},!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return f(t,e),d(t,[{key:"setValue",value:function(e){var i=p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(x),M=function(e){function t(e,i,r){u(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),s=r;if(a.__select=document.createElement("select"),n.isArray(s)){var o={};n.each(s,function(e){o[e]=e}),s=o}return n.each(s,function(e,t){var i=document.createElement("option");i.innerHTML=t,i.setAttribute("value",e),a.__select.appendChild(i)}),a.updateDisplay(),S.bind(a.__select,"change",function(){var e=this.options[this.selectedIndex].value;a.setValue(e)}),a.domElement.appendChild(a.__select),a}return f(t,e),d(t,[{key:"setValue",value:function(e){var i=p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return S.isActive(this.__select)?this:(this.__select.value=this.getValue(),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(x),E=function(e){function t(e,i){u(this,t);var n=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));function r(){n.setValue(n.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),S.bind(n.__input,"keyup",r),S.bind(n.__input,"change",r),S.bind(n.__input,"blur",function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}),S.bind(n.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return f(t,e),d(t,[{key:"updateDisplay",value:function(){return S.isActive(this.__input)||(this.__input.value=this.getValue()),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(x);function C(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var T=function(e){function t(e,i,r){u(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),s=r||{};return a.__min=s.min,a.__max=s.max,a.__step=s.step,n.isUndefined(a.__step)?0===a.initialValue?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=C(a.__impliedStep),a}return f(t,e),d(t,[{key:"setValue",value:function(e){var i=e;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=C(e),this}}]),t}(x),R=function(e){function t(e,i,r){u(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,r));a.__truncationSuspended=!1;var s=void 0;function o(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(e){var t=s-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),s=e.clientY}function c(){S.unbind(window,"mousemove",l),S.unbind(window,"mouseup",c),o()}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),S.bind(a.__input,"change",function(){var e=parseFloat(a.__input.value);n.isNaN(e)||a.setValue(e)}),S.bind(a.__input,"blur",function(){o()}),S.bind(a.__input,"mousedown",function(e){S.bind(window,"mousemove",l),S.bind(window,"mouseup",c),s=e.clientY}),S.bind(a.__input,"keydown",function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,o())}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return f(t,e),d(t,[{key:"updateDisplay",value:function(){var e;return this.__input.value=this.__truncationSuspended?this.getValue():Math.round(this.getValue()*(e=Math.pow(10,this.__precision)))/e,p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(T),P=function(e){function t(e,i,n,r,a){u(this,t);var s=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,{min:n,max:r,step:a}));function o(e){e.preventDefault();var t,i,n,r,a=s.__background.getBoundingClientRect();return s.setValue((t=e.clientX,i=a.left,n=a.right,(r=s.__min)+(t-i)/(n-i)*(s.__max-r))),!1}function l(){S.unbind(window,"mousemove",o),S.unbind(window,"mouseup",l),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t,i,n,r=e.touches[0].clientX,a=s.__background.getBoundingClientRect();s.setValue((t=a.left,i=a.right,(n=s.__min)+(r-t)/(i-t)*(s.__max-n)))}function h(){S.unbind(window,"touchmove",c),S.unbind(window,"touchend",h),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),S.bind(s.__background,"mousedown",function(e){document.activeElement.blur(),S.bind(window,"mousemove",o),S.bind(window,"mouseup",l),o(e)}),S.bind(s.__background,"touchstart",function(e){1===e.touches.length&&(S.bind(window,"touchmove",c),S.bind(window,"touchend",h),c(e))}),S.addClass(s.__background,"slider"),S.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return f(t,e),d(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(T),I=function(e){function t(e,i,n){u(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===n?"Fire":n,S.bind(r.__button,"click",function(e){return e.preventDefault(),r.fire(),!1}),S.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return f(t,e),d(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(x),L=function(e){function t(e,i){u(this,t);var r,a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));a.__color=new g(a.getValue()),a.__temp=new g(0),a.domElement=document.createElement("div"),S.makeSelectable(a.domElement,!1),a.__selector=document.createElement("div"),a.__selector.className="selector",a.__saturation_field=document.createElement("div"),a.__saturation_field.className="saturation-field",a.__field_knob=document.createElement("div"),a.__field_knob.className="field-knob",a.__field_knob_border="2px solid ",a.__hue_knob=document.createElement("div"),a.__hue_knob.className="hue-knob",a.__hue_field=document.createElement("div"),a.__hue_field.className="hue-field",a.__input=document.createElement("input"),a.__input.type="text",a.__input_textShadow="0 1px 1px ",S.bind(a.__input,"keydown",function(e){13===e.keyCode&&p.call(this)}),S.bind(a.__input,"blur",p),S.bind(a.__selector,"mousedown",function(){S.addClass(this,"drag").bind(window,"mouseup",function(){S.removeClass(a.__selector,"drag")})}),S.bind(a.__selector,"touchstart",function(){S.addClass(this,"drag").bind(window,"touchend",function(){S.removeClass(a.__selector,"drag")})});var s=document.createElement("div");function l(e){v(e),S.bind(window,"mousemove",v),S.bind(window,"touchmove",v),S.bind(window,"mouseup",h),S.bind(window,"touchend",h)}function c(e){y(e),S.bind(window,"mousemove",y),S.bind(window,"touchmove",y),S.bind(window,"mouseup",d),S.bind(window,"touchend",d)}function h(){S.unbind(window,"mousemove",v),S.unbind(window,"touchmove",v),S.unbind(window,"mouseup",h),S.unbind(window,"touchend",h),f()}function d(){S.unbind(window,"mousemove",y),S.unbind(window,"touchmove",y),S.unbind(window,"mouseup",d),S.unbind(window,"touchend",d),f()}function p(){var e=o(this.value);!1!==e?(a.__color.__state=e,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function f(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=a.__saturation_field.getBoundingClientRect(),i=e.touches&&e.touches[0]||e,n=i.clientX,r=i.clientY,s=(n-t.left)/(t.right-t.left),o=1-(r-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),s>1?s=1:s<0&&(s=0),a.__color.v=o,a.__color.s=s,a.setValue(a.__color.toOriginal()),!1}function y(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=a.__hue_field.getBoundingClientRect(),i=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),a.__color.h=360*i,a.setValue(a.__color.toOriginal()),!1}return n.extend(a.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),n.extend(a.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:a.__field_knob_border+(a.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),n.extend(a.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),n.extend(a.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),n.extend(s.style,{width:"100%",height:"100%",background:"none"}),B(s,"top","rgba(0,0,0,0)","#000"),n.extend(a.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=a.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.extend(a.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,textShadow:a.__input_textShadow+"rgba(0,0,0,0.7)"}),S.bind(a.__saturation_field,"mousedown",l),S.bind(a.__saturation_field,"touchstart",l),S.bind(a.__field_knob,"mousedown",l),S.bind(a.__field_knob,"touchstart",l),S.bind(a.__hue_field,"mousedown",c),S.bind(a.__hue_field,"touchstart",c),a.__saturation_field.appendChild(s),a.__selector.appendChild(a.__field_knob),a.__selector.appendChild(a.__saturation_field),a.__selector.appendChild(a.__hue_field),a.__hue_field.appendChild(a.__hue_knob),a.domElement.appendChild(a.__input),a.domElement.appendChild(a.__selector),a.updateDisplay(),a}return f(t,e),d(t,[{key:"updateDisplay",value:function(){var e=o(this.getValue());if(!1!==e){var t=!1;n.each(g.COMPONENTS,function(i){if(!n.isUndefined(e[i])&&!n.isUndefined(this.__color.__state[i])&&e[i]!==this.__color.__state[i])return t=!0,{}},this),t&&n.extend(this.__color.__state,e)}n.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,r=255-i;n.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,B(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),n.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(x),D=["-moz-","-o-","-webkit-","-ms-",""];function B(e,t,i,r){e.style.background="",n.each(D,function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+i+" 0%, "+r+" 100%); "})}var O=function(e,t){var i=e[t];if(n.isArray(arguments[2])||n.isObject(arguments[2]))return new M(e,t,arguments[2]);if(n.isNumber(i))return n.isNumber(arguments[2])&&n.isNumber(arguments[3])?n.isNumber(arguments[4])?new P(e,t,arguments[2],arguments[3],arguments[4]):new P(e,t,arguments[2],arguments[3]):n.isNumber(arguments[4])?new R(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new R(e,t,{min:arguments[2],max:arguments[3]});return n.isString(i)?new E(e,t):n.isFunction(i)?new I(e,t,""):n.isBoolean(i)?new w(e,t):null},N=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},U=function(){function e(){u(this,e),this.backgroundElement=document.createElement("div"),n.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),S.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),n.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;S.bind(this.backgroundElement,"click",function(){t.hide()})}return d(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),n.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",S.unbind(e.domElement,"webkitTransitionEnd",t),S.unbind(e.domElement,"transitionend",t),S.unbind(e.domElement,"oTransitionEnd",t)};S.bind(this.domElement,"webkitTransitionEnd",t),S.bind(this.domElement,"transitionend",t),S.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-S.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-S.getHeight(this.domElement)/2+"px"}}]),e}(),F="Default",k=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),z=void 0,H=!0,V=void 0,G=!1,W=[],j=function e(t){var i,r=this,a=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),S.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=n.defaults(a,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),a=n.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),n.isUndefined(a.load)?a.load={preset:F}:a.preset&&(a.load.preset=a.preset),n.isUndefined(a.parent)&&a.hideable&&W.push(this),a.resizable=n.isUndefined(a.parent)&&a.resizable,a.autoPlace&&n.isUndefined(a.scrollable)&&(a.scrollable=!0);var s=k&&"true"===localStorage.getItem(J(this,"isLocal")),o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},closeOnTop:{get:function(){return a.closeOnTop}},preset:{get:function(){return r.parent?r.getRoot().preset:a.load.preset},set:function(e){r.parent?r.getRoot().preset=e:a.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),r.revert()}},width:{get:function(){return a.width},set:function(e){a.width=e,ee(r,e)}},name:{get:function(){return a.name},set:function(e){a.name=e,titleRowName&&(titleRowName.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(t){a.closed=t,a.closed?S.addClass(r.__ul,e.CLASS_CLOSED):S.removeClass(r.__ul,e.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return s},set:function(e){k&&(s=e,e?S.bind(window,"unload",o):S.unbind(window,"unload",o),localStorage.setItem(J(r,"isLocal"),e))}}}),n.isUndefined(a.parent)){if(a.closed=!1,S.addClass(this.domElement,e.CLASS_MAIN),S.makeSelectable(this.domElement,!1),k&&s){r.useLocalStorage=!0;var l=localStorage.getItem(J(this,"gui"));l&&(a.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,S.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),a.closeOnTop?(S.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(S.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),S.bind(this.__closeButton,"click",function(){r.closed=!r.closed})}else{void 0===a.closed&&(a.closed=!0);var c=document.createTextNode(a.name);S.addClass(c,"controller-name");var h=q(r,c);S.addClass(this.__ul,e.CLASS_CLOSED),S.addClass(h,"title"),S.bind(h,"click",function(e){return e.preventDefault(),r.closed=!r.closed,!1}),a.closed||(this.closed=!1)}a.autoPlace&&(n.isUndefined(a.parent)&&(H&&((V=document.createElement("div")).id="dat-gui-container",S.addClass(V,"dg"),S.addClass(V,e.CLASS_AUTO_PLACE_CONTAINER),document.getElementById("ui-container").appendChild(V),H=!1),V.appendChild(this.domElement),S.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ee(r,a.width)),o=function(){k&&"true"===localStorage.getItem(J(r,"isLocal"))&&localStorage.setItem(J(r,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=o,!a.parent&&(i=r.getRoot(),i.width+=1,n.defer(function(){i.width-=1}))};function q(e,t,i){var n=document.createElement("li");return t&&n.appendChild(t),i?e.__ul.insertBefore(n,i):e.__ul.appendChild(n),e.onResize(),n}function X(e){S.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&S.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Y(e,t){var i=e.__preset_select[e.__preset_select.selectedIndex];t?i.innerHTML=i.value+"*":i.innerHTML=i.value}function K(e,t){var i=e.getRoot(),n=i.__rememberedObjects.indexOf(t.object);if(-1!==n){var r=i.__rememberedObjectIndecesToControllers[n];if(void 0===r&&(r={},i.__rememberedObjectIndecesToControllers[n]=r),r[t.property]=t,i.load&&i.load.remembered){var a=i.load.remembered,s=void 0;if(a[e.preset])s=a[e.preset];else{if(!a[F])return;s=a[F]}if(s[n]&&void 0!==s[n][t.property]){var o=s[n][t.property];t.initialValue=o,t.setValue(o)}}}}function Q(e,t,i,r){if(void 0===t[i])throw Error('Object "'+t+'" has no property "'+i+'"');var a=void 0;if(r.color)a=new L(t,i);else{var s=[t,i].concat(r.factoryArgs);a=O.apply(e,s)}r.before instanceof x&&(r.before=r.before.__li),K(e,a),S.addClass(a.domElement,"c");var o=document.createElement("span");S.addClass(o,"property-name"),o.innerHTML=a.property;var l=document.createElement("div");l.appendChild(o),l.appendChild(a.domElement);var c=q(e,l,r.before);return S.addClass(c,j.CLASS_CONTROLLER_ROW),a instanceof L?S.addClass(c,"color"):S.addClass(c,h(a.getValue())),function(e,t,i){if(i.__li=t,i.__gui=e,n.extend(i,{options:function(t){if(arguments.length>1){var r=i.__li.nextElementSibling;return i.remove(),Q(e,i.object,i.property,{before:r,factoryArgs:[n.toArray(arguments)]})}if(n.isArray(t)||n.isObject(t)){var a=i.__li.nextElementSibling;return i.remove(),Q(e,i.object,i.property,{before:a,factoryArgs:[t]})}},name:function(e){return i.__li.firstElementChild.firstElementChild.innerHTML=e,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof P){var r=new R(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});n.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=i[e],n=r[e];i[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(r,e),t.apply(i,e)}}),S.addClass(t,"has-slider"),i.domElement.insertBefore(r.domElement,i.domElement.firstElementChild)}else if(i instanceof R){var a=function(t){if(n.isNumber(i.__min)&&n.isNumber(i.__max)){var r=i.__li.firstElementChild.firstElementChild.innerHTML,a=i.__gui.__listening.indexOf(i)>-1;i.remove();var s=Q(e,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return s.name(r),a&&s.listen(),s}return t};i.min=n.compose(a,i.min),i.max=n.compose(a,i.max)}else i instanceof w?(S.bind(t,"click",function(){S.fakeEvent(i.__checkbox,"click")}),S.bind(i.__checkbox,"click",function(e){e.stopPropagation()})):i instanceof I?(S.bind(t,"click",function(){S.fakeEvent(i.__button,"click")}),S.bind(t,"mouseover",function(){S.addClass(i.__button,"hover")}),S.bind(t,"mouseout",function(){S.removeClass(i.__button,"hover")})):i instanceof L&&(S.addClass(t,"color"),i.updateDisplay=n.compose(function(e){return t.style.borderLeftColor=i.__color.toString(),e},i.updateDisplay),i.updateDisplay());i.setValue=n.compose(function(t){return e.getRoot().__preset_select&&i.isModified()&&Y(e.getRoot(),!0),t},i.setValue)}(e,c,a),e.__controllers.push(a),a}function J(e,t){return document.location.href+"."+t}function Z(e,t,i){var n=document.createElement("option");n.innerHTML=t,n.value=t,e.__preset_select.appendChild(n),i&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function $(e,t){t.style.display=e.useLocalStorage?"block":"none"}function ee(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function et(e,t){var i={};return n.each(e.__rememberedObjects,function(r,a){var s={},o=e.__rememberedObjectIndecesToControllers[a];n.each(o,function(e,i){s[i]=t?e.initialValue:e.getValue()}),i[a]=s}),i}return j.toggleHide=function(){G=!G,n.each(W,function(e){e.domElement.style.display=G?"none":""})},j.CLASS_AUTO_PLACE="a",j.CLASS_AUTO_PLACE_CONTAINER="ac",j.CLASS_MAIN="main",j.CLASS_CONTROLLER_ROW="cr",j.CLASS_TOO_TALL="taller-than-window",j.CLASS_CLOSED="closed",j.CLASS_CLOSE_BUTTON="close-button",j.CLASS_CLOSE_TOP="close-top",j.CLASS_CLOSE_BOTTOM="close-bottom",j.CLASS_DRAG="drag",j.DEFAULT_WIDTH=300,j.TEXT_CLOSED="Close Controls",j.TEXT_OPEN="Open Controls",j._keydownHandler=function(e){"text"!==document.activeElement.type&&(72===e.which||72===e.keyCode)&&j.toggleHide()},S.bind(window,"keydown",j._keydownHandler,!1),n.extend(j.prototype,{add:function(e,t){return Q(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Q(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;n.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&V.removeChild(this.domElement);var e=this;n.each(this.__folders,function(t){e.removeFolder(t)}),S.unbind(window,"keydown",j._keydownHandler,!1),X(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new j(t);this.__folders[e]=i;var n=q(this,i.domElement);return S.addClass(n,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],X(e);var t=this;n.each(e.__folders,function(t){e.removeFolder(t)}),n.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=S.getOffset(e.__ul).top,i=0;n.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(i+=S.getHeight(t))}),window.innerHeight-t-20<i?(S.addClass(e.domElement,j.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(S.removeClass(e.domElement,j.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&n.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:n.debounce(function(){this.onResize()},50),remember:function(){if(n.isUndefined(z)&&((z=new U).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw Error("You can only call remember on a top level GUI.");var e=this;n.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");S.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),S.addClass(t,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",S.addClass(i,"button gears");var r=document.createElement("span");r.innerHTML="Save",S.addClass(r,"button"),S.addClass(r,"save");var a=document.createElement("span");a.innerHTML="New",S.addClass(a,"button"),S.addClass(a,"save-as");var s=document.createElement("span");s.innerHTML="Revert",S.addClass(s,"button"),S.addClass(s,"revert");var o=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?n.each(e.load.remembered,function(t,i){Z(e,i,i===e.preset)}):Z(e,F,!1),S.bind(o,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(a),t.appendChild(s),k){var l=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(J(e,"isLocal"))&&c.setAttribute("checked","checked"),$(e,l),S.bind(c,"change",function(){e.useLocalStorage=!e.useLocalStorage,$(e,l)})}var h=document.getElementById("dg-new-constructor");S.bind(h,"keydown",function(e){e.metaKey&&(67===e.which||67===e.keyCode)&&z.hide()}),S.bind(i,"click",function(){h.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),z.show(),h.focus(),h.select()}),S.bind(r,"click",function(){e.save()}),S.bind(a,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),S.bind(s,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ee(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=et(this)),e.folders={},n.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=et(this),Y(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[F]=et(this,!0)),this.load.remembered[e]=et(this),this.preset=e,Z(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){n.each(this.__controllers,function(t){this.getRoot().load.remembered?K(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),n.each(this.__folders,function(e){e.revert(e)}),e||Y(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&N.call(window,function(){e(t)}),n.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){n.each(this.__controllers,function(e){e.updateDisplay()}),n.each(this.__folders,function(e){e.updateDisplay()})}}),{color:{Color:g,math:c,interpret:o},controllers:{Controller:x,BooleanController:w,OptionController:M,StringController:E,NumberController:T,NumberControllerBox:R,NumberControllerSlider:P,FunctionController:I,ColorController:L},dom:{dom:S},gui:{GUI:j},GUI:j}},e.exports=t()},8482:function(e,t,i){"use strict";i.r(t),i.d(t,{threeToCannon:()=>l});var n=i(1795),r=i(4646),a=i(3687),s=Math.PI/2,o={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"};let l=function(e,t){var i,r,l,d,p,f,m,g,v,y,x,_,A,b,S,w;if((t=t||{}).type===o.BOX)return h(e);if(t.type===o.CYLINDER){return r=e,l=t,m=new n.ZzF,y=(g=["x","y","z"]).splice(g.indexOf(v=l.cylinderAxis||"y"),1)&&g,(m.setFromObject(r),isFinite(m.min.lengthSq()))?(p=m.max[v]-m.min[v],f=.5*Math.max(m.max[y[0]]-m.min[y[0]],m.max[y[1]]-m.min[y[1]]),(d=new a.Cylinder(f,f,p,12))._type=a.Shape.types.CYLINDER,d.radiusTop=f,d.radiusBottom=f,d.height=p,d.numSegments=12,d.orientation=new a.Quaternion,d.orientation.setFromEuler("y"===v?s:0,"z"===v?s:0,0,"XYZ").normalize(),d):null}if(t.type===o.SPHERE)return function(e,t){if(t.sphereRadius)return new a.Sphere(t.sphereRadius);var i=u(e);return i?(i.computeBoundingSphere(),new a.Sphere(i.boundingSphere.radius)):null}(e,t);if(t.type===o.HULL)return function(e){var t,i,n,r,s=u(e);if(!s||!s.vertices.length)return null;for(t=0;t<s.vertices.length;t++)s.vertices[t].x+=(Math.random()-.5)*1e-4,s.vertices[t].y+=(Math.random()-.5)*1e-4,s.vertices[t].z+=(Math.random()-.5)*1e-4;for(t=0,i=Array(r.vertices.length);t<r.vertices.length;t++)i[t]=new a.Vec3(r.vertices[t].x,r.vertices[t].y,r.vertices[t].z);for(t=0,n=Array(r.faces.length);t<r.faces.length;t++)n[t]=[r.faces[t].a,r.faces[t].b,r.faces[t].c];return new a.ConvexPolyhedron(i,n)}(e);if(t.type===o.MESH){let t,n;return(i=u(e))?(n=(n=Object.keys(t=null===(x=i).index?x.attributes.position.array:x.clone().toNonIndexed().attributes.position.array).map(Number)).slice(0,n.length/3),new a.Trimesh(t,n)):null}else if(t.type)throw Error('[CANNON.threeToCannon] Invalid type "%s".',t.type);if(!(i=u(e)))return null;switch(i.metadata?i.metadata.type:i.type){case"BoxGeometry":case"BoxBufferGeometry":return c(i);case"CylinderGeometry":case"CylinderBufferGeometry":return b=(_=i).metadata?_.metadata.parameters:_.parameters,(A=new a.Cylinder(b.radiusTop,b.radiusBottom,b.height,b.radialSegments))._type=a.Shape.types.CYLINDER,A.radiusTop=b.radiusTop,A.radiusBottom=b.radiusBottom,A.height=b.height,A.numSegments=b.radialSegments,A.orientation=new a.Quaternion,A.orientation.setFromEuler(n.M8C.degToRad(90),0,0,"XYZ").normalize(),A;case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();var t=e.boundingBox;return new a.Box(new a.Vec3((t.max.x-t.min.x)/2||.1,(t.max.y-t.min.y)/2||.1,(t.max.z-t.min.z)/2||.1))}(i);case"SphereGeometry":case"SphereBufferGeometry":return w=(S=i).metadata?S.metadata.parameters:S.parameters,new a.Sphere(w.radius);case"TubeGeometry":case"Geometry":case"BufferGeometry":return h(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',i.type),c(i)}};function c(e){if(!((t=e).attributes||(t=new n.u9r().fromGeometry(t)),(t.attributes.position||{}).array||[]).length)return null;e.computeBoundingBox();var t,i=e.boundingBox;return new a.Box(new a.Vec3((i.max.x-i.min.x)/2,(i.max.y-i.min.y)/2,(i.max.z-i.min.z)/2))}function h(e){var t,i,r=new n.ZzF,s=e.clone();return(s.quaternion.set(0,0,0,1),s.updateMatrixWorld(),r.setFromObject(s),isFinite(r.min.lengthSq()))?(t=new a.Box(new a.Vec3((r.max.x-r.min.x)/2,(r.max.y-r.min.y)/2,(r.max.z-r.min.z)/2)),(i=r.translate(s.position.negate()).getCenter(new n.Pa4)).lengthSq()&&(t.offset=i),t):null}function u(e){var t,i,a,s=(t=[],e.traverse(function(e){"Mesh"===e.type&&t.push(e)}),t),o=new n.u9r,l=new n.u9r;if(0===s.length)return null;if(1===s.length){var c=new n.Pa4,h=new n._fP,u=new n.Pa4;return s[0].geometry.attributes.position&&s[0].geometry.attributes.position.itemSize>2&&(o=s[0].geometry),o.metadata=s[0].geometry.metadata,s[0].updateMatrixWorld(),s[0].matrixWorld.decompose(c,h,u),o.scale(u.x,u.y,u.z)}for(;a=s.pop();)if(a.updateMatrixWorld(),a.geometry.attributes.position&&a.geometry.attributes.position.itemSize>2){var d=a.geometry;l=r.qf([l,d]),d.dispose()}return(i=new n.yGw).scale(e.scale),l.applyMatrix(i),l}l.Type=o},8895:function(e){"use strict";e.exports="data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw=="},1561:function(e){"use strict";e.exports="data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw=="},2294:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg=="},7678:function(e,t){"use strict";let i,n,r,a,s;let o="attached",l="detached",c="srgb",h="srgb-linear",u="display-p3",d="display-p3-linear",p="linear",f="srgb",m="rec709",g="300 es";class v{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let i=this._listeners[e];if(void 0!==i){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}let y=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],x=1234567,_=Math.PI/180,A=180/Math.PI;function b(){let e=0xffffffff*Math.random()|0,t=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0;return(y[255&e]+y[e>>8&255]+y[e>>16&255]+y[e>>24&255]+"-"+y[255&t]+y[t>>8&255]+"-"+y[t>>16&15|64]+y[t>>24&255]+"-"+y[63&i|128]+y[i>>8&255]+"-"+y[i>>16&255]+y[i>>24&255]+y[255&n]+y[n>>8&255]+y[n>>16&255]+y[n>>24&255]).toLowerCase()}function S(e,t,i){return Math.max(t,Math.min(i,e))}function w(e,t){return(e%t+t)%t}function M(e,t,i){return(1-i)*e+i*t}function E(e){return(e&e-1)==0&&0!==e}function C(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function T(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/0xffffffff;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/0x7fffffff,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function R(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(0xffffffff*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(0x7fffffff*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}class P{constructor(e=0,t=0){P.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(S(this.dot(e)/t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*i-a*n+e.x,this.y=r*n+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class I{constructor(e,t,i,n,r,a,s,o,l){I.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,n,r,a,s,o,l)}set(e,t,i,n,r,a,s,o,l){let c=this.elements;return c[0]=e,c[1]=n,c[2]=s,c[3]=t,c[4]=r,c[5]=o,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[3],o=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],x=n[7],_=n[2],A=n[5],b=n[8];return r[0]=a*f+s*v+o*_,r[3]=a*m+s*y+o*A,r[6]=a*g+s*x+o*b,r[1]=l*f+c*v+h*_,r[4]=l*m+c*y+h*A,r[7]=l*g+c*x+h*b,r[2]=u*f+d*v+p*_,r[5]=u*m+d*y+p*A,r[8]=u*g+d*x+p*b,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-i*r*c+i*s*o+n*r*l-n*a*o}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=c*a-s*l,u=s*o-c*r,d=l*r-a*o,p=t*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(n*l-c*i)*f,e[2]=(s*i-n*a)*f,e[3]=u*f,e[4]=(c*t-n*o)*f,e[5]=(n*r-s*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(a*t-i*r)*f,this}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,a,s){let o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*a+l*s)+a+e,-n*l,n*o,-n*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(L.makeScale(e,t)),this}rotate(e){return this.premultiply(L.makeRotation(-e)),this}translate(e,t){return this.premultiply(L.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let L=new I;function D(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}let B={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function O(e,t){return new B[e](t)}function N(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function U(){let e=N("canvas");return e.style.display="block",e}let F={};function k(e){e in F||(F[e]=!0,console.warn(e))}let z=new I().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),H=new I().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),V={[h]:{transfer:p,primaries:m,toReference:e=>e,fromReference:e=>e},[c]:{transfer:f,primaries:m,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[d]:{transfer:p,primaries:"p3",toReference:e=>e.applyMatrix3(H),fromReference:e=>e.applyMatrix3(z)},[u]:{transfer:f,primaries:"p3",toReference:e=>e.convertSRGBToLinear().applyMatrix3(H),fromReference:e=>e.applyMatrix3(z).convertLinearToSRGB()}},G=new Set([h,d]),W={enabled:!0,_workingColorSpace:h,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(colorSpace){if(!G.has(colorSpace))throw Error(`Unsupported working color space, "${colorSpace}".`);this._workingColorSpace=colorSpace},convert:function(e,t,i){if(!1===this.enabled||t===i||!t||!i)return e;let n=V[t].toReference;return(0,V[i].fromReference)(n(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return V[e].primaries},getTransfer:function(e){return""===e?p:V[e].transfer}};function j(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function q(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class X{static getDataURL(e){let t;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===i&&(i=N("canvas")),i.width=e.width,i.height=e.height;let n=i.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=i}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let t=N("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e++)r[e]=255*j(r[e]/255);return i.putImageData(n,0,0),t}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*j(t[e]/255)):t[e]=j(t[e]);return{data:t,width:e.width,height:e.height}}}}let Y=0;class K{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Y++}),this.uuid=b(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(Q(n[t].image)):e.push(Q(n[t]))}else e=Q(n);i.url=e}return t||(e.images[this.uuid]=i),i}}function Q(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?X.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let J=0;class Z extends v{constructor(e=Z.DEFAULT_IMAGE,t=Z.DEFAULT_MAPPING,i=1001,n=1001,r=1006,a=1008,s=1023,o=1009,l=Z.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:J++}),this.uuid=b(),this.name="",this.source=new K(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new P(0,0),this.repeat=new P(1,1),this.center=new P(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new I,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof h?this.colorSpace=h:(k("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=3001===h?c:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return k("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===c?3001:3e3}set encoding(e){k("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=3001===e?c:""}}Z.DEFAULT_IMAGE=null,Z.DEFAULT_MAPPING=300,Z.DEFAULT_ANISOTROPY=1;class ${constructor(e=0,t=0,i=0,n=1){$.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*t+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*t+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*t+a[7]*i+a[11]*n+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;let a=e.elements,s=a[0],o=a[4],l=a[8],c=a[1],h=a[5],u=a[9],d=a[2],p=a[6],f=a[10];if(.01>Math.abs(o-c)&&.01>Math.abs(l-d)&&.01>Math.abs(u-p)){if(.1>Math.abs(o+c)&&.1>Math.abs(l+d)&&.1>Math.abs(u+p)&&.1>Math.abs(s+h+f-3))return this.set(1,0,0,0),this;t=Math.PI;let e=(s+1)/2,a=(h+1)/2,m=(f+1)/2,g=(o+c)/4,v=(l+d)/4,y=(u+p)/4;return e>a&&e>m?e<.01?(i=0,n=.707106781,r=.707106781):(n=g/(i=Math.sqrt(e)),r=v/i):a>m?a<.01?(i=.707106781,n=0,r=.707106781):(i=g/(n=Math.sqrt(a)),r=y/n):m<.01?(i=.707106781,n=.707106781,r=0):(i=v/(r=Math.sqrt(m)),n=y/r),this.set(i,n,r,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-o)*(c-o));return .001>Math.abs(m)&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-o)/m,this.w=Math.acos((s+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ee extends v{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new $(0,0,e,t),this.scissorTest=!1,this.viewport=new $(0,0,e,t),void 0!==i.encoding&&(k("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=3001===i.encoding?c:""),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:1006,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},i),this.texture=new Z({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps,this.texture.internalFormat=i.internalFormat,this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new K(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class et extends ee{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class ei extends Z{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class en extends Z{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class er{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,a,s){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],u=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===s){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h;return}if(1===s){e[t+0]=u,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(h!==f||o!==u||l!==d||c!==p){let e=1-s,t=o*u+l*d+c*p+h*f,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){let r=Math.sqrt(n),a=Math.atan2(r,t*i);e=Math.sin(e*a)/r,s=Math.sin(s*a)/r}let r=s*i;if(o=o*e+u*r,l=l*e+d*r,c=c*e+p*r,h=h*e+f*r,e===1-s){let e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,a){let s=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[a],u=r[a+1],d=r[a+2],p=r[a+3];return e[t]=s*p+c*h+o*d-l*u,e[t+1]=o*p+c*u+l*h-s*d,e[t+2]=l*p+c*d+s*u-o*h,e[t+3]=c*p-s*h-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let i=e._x,n=e._y,r=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(i/2),c=s(n/2),h=s(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(a){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],n=t[4],r=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],h=t[10],u=i+s+h;if(u>0){let e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(a-n)*e}else if(i>s&&i>h){let e=2*Math.sqrt(1+i-s-h);this._w=(c-o)/e,this._x=.25*e,this._y=(n+a)/e,this._z=(r+l)/e}else if(s>h){let e=2*Math.sqrt(1+s-i-h);this._w=(r-l)/e,this._x=(n+a)/e,this._y=.25*e,this._z=(o+c)/e}else{let e=2*Math.sqrt(1+h-i-s);this._w=(a-n)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=i,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(S(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,n=e._y,r=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+a*s+n*l-r*o,this._y=n*c+a*o+r*s-i*l,this._z=r*c+a*l+i*o-n*s,this._w=a*c-i*s-n*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,n=this._y,r=this._z,a=this._w,s=a*e._w+i*e._x+n*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=i,this._y=n,this._z=r,this;let o=1-s*s;if(o<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}let l=Math.sqrt(o),c=Math.atan2(l,s),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=a*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ea{constructor(e=0,t=0,i=0){ea.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(eo.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(eo.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=e.elements,a=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*a,this}applyQuaternion(e){let t=this.x,i=this.y,n=this.z,r=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*n-s*i),c=2*(s*t-r*n),h=2*(r*i-a*t);return this.x=t+o*l+a*h-s*c,this.y=i+o*c+s*l-r*h,this.z=n+o*h+r*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,n=e.y,r=e.z,a=t.x,s=t.y,o=t.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return es.copy(this).projectOnVector(e),this.sub(es)}reflect(e){return this.sub(es.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(S(this.dot(e)/t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let es=new ea,eo=new er;class el{constructor(e=new ea(Infinity,Infinity,Infinity),t=new ea(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(eh.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(eh.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=eh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(void 0!==i){let n=i.getAttribute("position");if(!0===t&&void 0!==n&&!0!==e.isInstancedMesh)for(let t=0,i=n.count;t<i;t++)!0===e.isMesh?e.getVertexPosition(t,eh):eh.fromBufferAttribute(n,t),eh.applyMatrix4(e.matrixWorld),this.expandByPoint(eh);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),eu.copy(e.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),eu.copy(i.boundingBox)),eu.applyMatrix4(e.matrixWorld),this.union(eu)}let n=e.children;for(let e=0,i=n.length;e<i;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)&&!(e.z<this.min.z)&&!(e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)&&!(e.max.z<this.min.z)&&!(e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,eh),eh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ey),ex.subVectors(this.max,ey),ed.subVectors(e.a,ey),ep.subVectors(e.b,ey),ef.subVectors(e.c,ey),em.subVectors(ep,ed),eg.subVectors(ef,ep),ev.subVectors(ed,ef);let t=[0,-em.z,em.y,0,-eg.z,eg.y,0,-ev.z,ev.y,em.z,0,-em.x,eg.z,0,-eg.x,ev.z,0,-ev.x,-em.y,em.x,0,-eg.y,eg.x,0,-ev.y,ev.x,0];return!!(eb(t,ed,ep,ef,ex)&&eb(t=[1,0,0,0,1,0,0,0,1],ed,ep,ef,ex))&&(e_.crossVectors(em,eg),eb(t=[e_.x,e_.y,e_.z],ed,ep,ef,ex))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,eh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(eh).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ec[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ec[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ec[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ec[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ec[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ec[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ec[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ec[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ec)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let ec=[new ea,new ea,new ea,new ea,new ea,new ea,new ea,new ea],eh=new ea,eu=new el,ed=new ea,ep=new ea,ef=new ea,em=new ea,eg=new ea,ev=new ea,ey=new ea,ex=new ea,e_=new ea,eA=new ea;function eb(e,t,i,n,r){for(let a=0,s=e.length-3;a<=s;a+=3){eA.fromArray(e,a);let s=r.x*Math.abs(eA.x)+r.y*Math.abs(eA.y)+r.z*Math.abs(eA.z),o=t.dot(eA),l=i.dot(eA),c=n.dot(eA);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}let eS=new el,ew=new ea,eM=new ea;class eE{constructor(e=new ea,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;void 0!==t?i.copy(t):eS.setFromPoints(e).getCenter(i);let n=0;for(let t=0,r=e.length;t<r;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ew.subVectors(e,this.center);let t=ew.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),i=(e-this.radius)*.5;this.center.addScaledVector(ew,i/e),this.radius+=i}return this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(eM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ew.copy(e.center).add(eM)),this.expandByPoint(ew.copy(e.center).sub(eM)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}let eC=new ea,eT=new ea,eR=new ea,eP=new ea,eI=new ea,eL=new ea,eD=new ea;class eB{constructor(e=new ea,t=new ea(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,eC)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=eC.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(eC.copy(this.origin).addScaledVector(this.direction,t),eC.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){let r,a,s,o;eT.copy(e).add(t).multiplyScalar(.5),eR.copy(t).sub(e).normalize(),eP.copy(this.origin).sub(eT);let l=.5*e.distanceTo(t),c=-this.direction.dot(eR),h=eP.dot(this.direction),u=-eP.dot(eR),d=eP.lengthSq(),p=Math.abs(1-c*c);if(p>0){if(r=c*u-h,a=c*h-u,o=l*p,r>=0){if(a>=-o){if(a<=o){let e=1/p;r*=e,a*=e,s=r*(r+c*a+2*h)+a*(c*r+a+2*u)+d}else s=-(r=Math.max(0,-(c*(a=l)+h)))*r+a*(a+2*u)+d}else s=-(r=Math.max(0,-(c*(a=-l)+h)))*r+a*(a+2*u)+d}else a<=-o?(a=(r=Math.max(0,-(-c*l+h)))>0?-l:Math.min(Math.max(-l,-u),l),s=-r*r+a*(a+2*u)+d):a<=o?(r=0,s=(a=Math.min(Math.max(-l,-u),l))*(a+2*u)+d):(a=(r=Math.max(0,-(c*l+h)))>0?l:Math.min(Math.max(-l,-u),l),s=-r*r+a*(a+2*u)+d)}else a=c>0?-l:l,s=-(r=Math.max(0,-(c*a+h)))*r+a*(a+2*u)+d;return i&&i.copy(this.origin).addScaledVector(this.direction,r),n&&n.copy(eT).addScaledVector(eR,a),s}intersectSphere(e,t){eC.subVectors(e.center,this.origin);let i=eC.dot(this.direction),n=eC.dot(eC)-i*i,r=e.radius*e.radius;if(n>r)return null;let a=Math.sqrt(r-n),s=i-a,o=i+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return!!(0===t||e.normal.dot(this.direction)*t<0)}intersectBox(e,t){let i,n,r,a,s,o;let l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return(l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,a=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,a=(e.min.y-u.y)*c),i>a||r>n)?null:((r>i||isNaN(i))&&(i=r),(a<n||isNaN(n))&&(n=a),h>=0?(s=(e.min.z-u.z)*h,o=(e.max.z-u.z)*h):(s=(e.max.z-u.z)*h,o=(e.min.z-u.z)*h),i>o||s>n)?null:((s>i||i!=i)&&(i=s),(o<n||n!=n)&&(n=o),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return null!==this.intersectBox(e,eC)}intersectTriangle(e,t,i,n,r){let a;eI.subVectors(t,e),eL.subVectors(i,e),eD.crossVectors(eI,eL);let s=this.direction.dot(eD);if(s>0){if(n)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}eP.subVectors(this.origin,e);let o=a*this.direction.dot(eL.crossVectors(eP,eL));if(o<0)return null;let l=a*this.direction.dot(eI.cross(eP));if(l<0||o+l>s)return null;let c=-a*eP.dot(eD);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class eO{constructor(e,t,i,n,r,a,s,o,l,c,h,u,d,p,f,m){eO.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,n,r,a,s,o,l,c,h,u,d,p,f,m)}set(e,t,i,n,r,a,s,o,l,c,h,u,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new eO().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,n=1/eN.setFromMatrixColumn(e,0).length(),r=1/eN.setFromMatrixColumn(e,1).length(),a=1/eN.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,n=e.y,r=e.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){let e=a*c,i=a*h,n=s*c,r=s*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-s*o,t[2]=r-e*l,t[6]=n+i*l,t[10]=a*o}else if("YXZ"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e+r*s,t[4]=n*s-i,t[8]=a*l,t[1]=a*h,t[5]=a*c,t[9]=-s,t[2]=i*s-n,t[6]=r+e*s,t[10]=a*o}else if("ZXY"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e-r*s,t[4]=-a*h,t[8]=n+i*s,t[1]=i+n*s,t[5]=a*c,t[9]=r-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){let e=a*c,i=a*h,n=s*c,r=s*h;t[0]=o*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){let e=a*o,i=a*l,n=s*o,r=s*l;t[0]=o*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){let e=a*o,i=a*l,n=s*o,r=s*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=a*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=s*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(eF,e,ek)}lookAt(e,t,i){let n=this.elements;return eV.subVectors(e,t),0===eV.lengthSq()&&(eV.z=1),eV.normalize(),ez.crossVectors(i,eV),0===ez.lengthSq()&&(1===Math.abs(i.z)?eV.x+=1e-4:eV.z+=1e-4,eV.normalize(),ez.crossVectors(i,eV)),ez.normalize(),eH.crossVectors(eV,ez),n[0]=ez.x,n[4]=eH.x,n[8]=eV.x,n[1]=ez.y,n[5]=eH.y,n[9]=eV.y,n[2]=ez.z,n[6]=eH.z,n[10]=eV.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[4],o=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],x=i[11],_=i[15],A=n[0],b=n[4],S=n[8],w=n[12],M=n[1],E=n[5],C=n[9],T=n[13],R=n[2],P=n[6],I=n[10],L=n[14],D=n[3],B=n[7],O=n[11],N=n[15];return r[0]=a*A+s*M+o*R+l*D,r[4]=a*b+s*E+o*P+l*B,r[8]=a*S+s*C+o*I+l*O,r[12]=a*w+s*T+o*L+l*N,r[1]=c*A+h*M+u*R+d*D,r[5]=c*b+h*E+u*P+d*B,r[9]=c*S+h*C+u*I+d*O,r[13]=c*w+h*T+u*L+d*N,r[2]=p*A+f*M+m*R+g*D,r[6]=p*b+f*E+m*P+g*B,r[10]=p*S+f*C+m*I+g*O,r[14]=p*w+f*T+m*L+g*N,r[3]=v*A+y*M+x*R+_*D,r[7]=v*b+y*E+x*P+_*B,r[11]=v*S+y*C+x*I+_*O,r[15]=v*w+y*T+x*L+_*N,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14],p=e[3],f=e[7];return p*(+r*o*h-n*l*h-r*s*u+i*l*u+n*s*d-i*o*d)+f*(+t*o*d-t*l*u+r*a*u-n*a*d+n*l*c-r*o*c)+e[11]*(+t*l*h-t*s*d-r*a*h+i*a*d+r*s*c-i*l*c)+e[15]*(-n*s*c-t*o*h+t*s*u+n*a*h-i*a*u+i*o*c)}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,i){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*u*l+f*o*d-s*m*d-h*o*g+s*u*g,y=p*u*l-c*m*l-p*o*d+a*m*d+c*o*g-a*u*g,x=c*f*l-p*h*l+p*s*d-a*f*d-c*s*g+a*h*g,_=p*h*o-c*f*o-p*s*u+a*f*u+c*s*m-a*h*m,A=t*v+i*y+n*x+r*_;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let b=1/A;return e[0]=v*b,e[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*b,e[2]=(s*m*r-f*o*r+f*n*l-i*m*l-s*n*g+i*o*g)*b,e[3]=(h*o*r-s*u*r-h*n*l+i*u*l+s*n*d-i*o*d)*b,e[4]=y*b,e[5]=(c*m*r-p*u*r+p*n*d-t*m*d-c*n*g+t*u*g)*b,e[6]=(p*o*r-a*m*r-p*n*l+t*m*l+a*n*g-t*o*g)*b,e[7]=(a*u*r-c*o*r+c*n*l-t*u*l-a*n*d+t*o*d)*b,e[8]=x*b,e[9]=(p*h*r-c*f*r-p*i*d+t*f*d+c*i*g-t*h*g)*b,e[10]=(a*f*r-p*s*r+p*i*l-t*f*l-a*i*g+t*s*g)*b,e[11]=(c*s*r-a*h*r-c*i*l+t*h*l+a*i*d-t*s*d)*b,e[12]=_*b,e[13]=(c*f*n-p*h*n+p*i*u-t*f*u-c*i*m+t*h*m)*b,e[14]=(p*s*n-a*f*n-p*i*o+t*f*o+a*i*m-t*s*m)*b,e[15]=(a*h*n-c*s*n+c*i*o-t*h*o-a*i*u+t*s*u)*b,this}scale(e){let t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.sqrt(Math.max(t,e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),n=Math.sin(t),r=1-i,a=e.x,s=e.y,o=e.z,l=r*a,c=r*s;return this.set(l*a+i,l*s-n*o,l*o+n*s,0,l*s+n*o,c*s+i,c*o-n*a,0,l*o-n*s,c*o+n*a,r*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,a){return this.set(1,i,r,0,e,1,a,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){let n=this.elements,r=t._x,a=t._y,s=t._z,o=t._w,l=r+r,c=a+a,h=s+s,u=r*l,d=r*c,p=r*h,f=a*c,m=a*h,g=s*h,v=o*l,y=o*c,x=o*h,_=i.x,A=i.y,b=i.z;return n[0]=(1-(f+g))*_,n[1]=(d+x)*_,n[2]=(p-y)*_,n[3]=0,n[4]=(d-x)*A,n[5]=(1-(u+g))*A,n[6]=(m+v)*A,n[7]=0,n[8]=(p+y)*b,n[9]=(m-v)*b,n[10]=(1-(u+f))*b,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){let n=this.elements,r=eN.set(n[0],n[1],n[2]).length(),a=eN.set(n[4],n[5],n[6]).length(),s=eN.set(n[8],n[9],n[10]).length();0>this.determinant()&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],eU.copy(this);let o=1/r,l=1/a,c=1/s;return eU.elements[0]*=o,eU.elements[1]*=o,eU.elements[2]*=o,eU.elements[4]*=l,eU.elements[5]*=l,eU.elements[6]*=l,eU.elements[8]*=c,eU.elements[9]*=c,eU.elements[10]*=c,t.setFromRotationMatrix(eU),i.x=r,i.y=a,i.z=s,this}makePerspective(e,t,i,n,r,a,s=2e3){let o,l;let c=this.elements;if(2e3===s)o=-(a+r)/(a-r),l=-2*a*r/(a-r);else if(2001===s)o=-a/(a-r),l=-a*r/(a-r);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return c[0]=2*r/(t-e),c[4]=0,c[8]=(t+e)/(t-e),c[12]=0,c[1]=0,c[5]=2*r/(i-n),c[9]=(i+n)/(i-n),c[13]=0,c[2]=0,c[6]=0,c[10]=o,c[14]=l,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,n,r,a,s=2e3){let o,l;let c=this.elements,h=1/(t-e),u=1/(i-n),d=1/(a-r);if(2e3===s)o=(a+r)*d,l=-2*d;else if(2001===s)o=r*d,l=-1*d;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-((t+e)*h),c[1]=0,c[5]=2*u,c[9]=0,c[13]=-((i+n)*u),c[2]=0,c[6]=0,c[10]=l,c[14]=-o,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}let eN=new ea,eU=new eO,eF=new ea(0,0,0),ek=new ea(1,1,1),ez=new ea,eH=new ea,eV=new ea,eG=new eO,eW=new er;class ej{constructor(e=0,t=0,i=0,n=ej.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let n=e.elements,r=n[0],a=n[4],s=n[8],o=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(S(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-S(c,-1,1)),.9999999>Math.abs(c)?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(S(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-S(h,-1,1)),.9999999>Math.abs(h)?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(S(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-S(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return eG.makeRotationFromQuaternion(e),this.setFromRotationMatrix(eG,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return eW.setFromEuler(this),this.setFromQuaternion(eW,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ej.DEFAULT_ORDER="XYZ";class eq{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let eX=0,eY=new ea,eK=new er,eQ=new eO,eJ=new ea,eZ=new ea,e$=new ea,e0=new er,e1=new ea(1,0,0),e2=new ea(0,1,0),e3=new ea(0,0,1),e4={type:"added"},e5={type:"removed"};class e6 extends v{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:eX++}),this.uuid=b(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=e6.DEFAULT_UP.clone();let e=new ea,t=new ej,i=new er,n=new ea(1,1,1);t._onChange(function(){i.setFromEuler(t,!1)}),i._onChange(function(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new eO},normalMatrix:{value:new I}}),this.matrix=new eO,this.matrixWorld=new eO,this.matrixAutoUpdate=e6.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=e6.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new eq,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return eK.setFromAxisAngle(e,t),this.quaternion.multiply(eK),this}rotateOnWorldAxis(e,t){return eK.setFromAxisAngle(e,t),this.quaternion.premultiply(eK),this}rotateX(e){return this.rotateOnAxis(e1,e)}rotateY(e){return this.rotateOnAxis(e2,e)}rotateZ(e){return this.rotateOnAxis(e3,e)}translateOnAxis(e,t){return eY.copy(e).applyQuaternion(this.quaternion),this.position.add(eY.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(e1,e)}translateY(e){return this.translateOnAxis(e2,e)}translateZ(e){return this.translateOnAxis(e3,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(eQ.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?eJ.copy(e):eJ.set(e,t,i);let n=this.parent;this.updateWorldMatrix(!0,!1),eZ.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?eQ.lookAt(eZ,eJ,this.up):eQ.lookAt(eJ,eZ,this.up),this.quaternion.setFromRotationMatrix(eQ),n&&(eQ.extractRotation(n.matrixWorld),eK.setFromRotationMatrix(eQ),this.quaternion.premultiply(eK.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(e4)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return -1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(e5)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),eQ.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),eQ.multiply(e.parent.matrixWorld)),e.applyMatrix4(eQ),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){let n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);let n=this.children;for(let r=0,a=n.length;r<a;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(eZ,e,e$),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(eZ,e0,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,n=t.length;i<n;i++){let n=t[i];(!0===n.matrixWorldAutoUpdate||!0===e)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,i=e.length;t<i;t++){let i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){let n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material)}if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){let i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){let t=a(e.geometries),n=a(e.materials),r=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),c=a(e.animations),h=a(e.nodes);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),s.length>0&&(i.images=s),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function a(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){let i=e.children[t];this.add(i.clone())}return this}}e6.DEFAULT_UP=new ea(0,1,0),e6.DEFAULT_MATRIX_AUTO_UPDATE=!0,e6.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let e8=new ea,e9=new ea,e7=new ea,te=new ea,tt=new ea,ti=new ea,tn=new ea,tr=new ea,ta=new ea,ts=new ea,to=!1;class tl{constructor(e=new ea,t=new ea,i=new ea){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),e8.subVectors(e,t),n.cross(e8);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){e8.subVectors(n,t),e9.subVectors(i,t),e7.subVectors(e,t);let a=e8.dot(e8),s=e8.dot(e9),o=e8.dot(e7),l=e9.dot(e9),c=e9.dot(e7),h=a*l-s*s;if(0===h)return r.set(0,0,0),null;let u=1/h,d=(l*o-s*c)*u,p=(a*c-s*o)*u;return r.set(1-d-p,p,d)}static containsPoint(e,t,i,n){return null!==this.getBarycoord(e,t,i,n,te)&&te.x>=0&&te.y>=0&&te.x+te.y<=1}static getUV(e,t,i,n,r,a,s,o){return!1===to&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),to=!0),this.getInterpolation(e,t,i,n,r,a,s,o)}static getInterpolation(e,t,i,n,r,a,s,o){return null===this.getBarycoord(e,t,i,n,te)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,te.x),o.addScaledVector(a,te.y),o.addScaledVector(s,te.z),o)}static isFrontFacing(e,t,i,n){return e8.subVectors(i,t),e9.subVectors(e,t),0>e8.cross(e9).dot(n)}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return e8.subVectors(this.c,this.b),e9.subVectors(this.a,this.b),.5*e8.cross(e9).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return tl.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return tl.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return!1===to&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),to=!0),tl.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}getInterpolation(e,t,i,n,r){return tl.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return tl.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return tl.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i,n;let r=this.a,a=this.b,s=this.c;tt.subVectors(a,r),ti.subVectors(s,r),tr.subVectors(e,r);let o=tt.dot(tr),l=ti.dot(tr);if(o<=0&&l<=0)return t.copy(r);ta.subVectors(e,a);let c=tt.dot(ta),h=ti.dot(ta);if(c>=0&&h<=c)return t.copy(a);let u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return i=o/(o-c),t.copy(r).addScaledVector(tt,i);ts.subVectors(e,s);let d=tt.dot(ts),p=ti.dot(ts);if(p>=0&&d<=p)return t.copy(s);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),t.copy(r).addScaledVector(ti,n);let m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return tn.subVectors(s,a),n=(h-c)/(h-c+(d-p)),t.copy(a).addScaledVector(tn,n);let g=1/(m+f+u);return i=f*g,n=u*g,t.copy(r).addScaledVector(tt,i).addScaledVector(ti,n)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let tc={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},th={h:0,s:0,l:0},tu={h:0,s:0,l:0};function td(e,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?e+(t-e)*6*i:i<.5?t:i<2/3?e+(t-e)*6*(2/3-i):e}class tp{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){return void 0===t&&void 0===i?e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e):this.setRGB(e,t,i),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=c){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,W.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=W.workingColorSpace){return this.r=e,this.g=t,this.b=i,W.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=W.workingColorSpace){if(e=w(e,1),t=S(t,0,1),i=S(i,0,1),0===t)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=td(r,n,e+1/3),this.g=td(r,n,e),this.b=td(r,n,e-1/3)}return W.toWorkingColorSpace(this,n),this}setStyle(e,t=c){let i;function n(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;let a=i[1],s=i[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=c){let i=tc[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=j(e.r),this.g=j(e.g),this.b=j(e.b),this}copyLinearToSRGB(e){return this.r=q(e.r),this.g=q(e.g),this.b=q(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=c){return W.fromWorkingColorSpace(tf.copy(this),e),65536*Math.round(S(255*tf.r,0,255))+256*Math.round(S(255*tf.g,0,255))+Math.round(S(255*tf.b,0,255))}getHexString(e=c){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=W.workingColorSpace){let i,n;W.fromWorkingColorSpace(tf.copy(this),t);let r=tf.r,a=tf.g,s=tf.b,o=Math.max(r,a,s),l=Math.min(r,a,s),c=(l+o)/2;if(l===o)i=0,n=0;else{let e=o-l;switch(n=c<=.5?e/(o+l):e/(2-o-l),o){case r:i=(a-s)/e+(a<s?6:0);break;case a:i=(s-r)/e+2;break;case s:i=(r-a)/e+4}i/=6}return e.h=i,e.s=n,e.l=c,e}getRGB(e,t=W.workingColorSpace){return W.fromWorkingColorSpace(tf.copy(this),t),e.r=tf.r,e.g=tf.g,e.b=tf.b,e}getStyle(e=c){W.fromWorkingColorSpace(tf.copy(this),e);let t=tf.r,i=tf.g,n=tf.b;return e!==c?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(e,t,i){return this.getHSL(th),this.setHSL(th.h+e,th.s+t,th.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(th),e.getHSL(tu);let i=M(th.h,tu.h,t),n=M(th.s,tu.s,t),r=M(th.l,tu.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let tf=new tp;tp.NAMES=tc;let tm=0;class tg extends v{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:tm++}),this.uuid=b(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new tp(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let n=this[t];if(void 0===n){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),204!==this.blendSrc&&(i.blendSrc=this.blendSrc),205!==this.blendDst&&(i.blendDst=this.blendDst),100!==this.blendEquation&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(i.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(i.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){let t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(null!==t){let e=t.length;i=Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class tv extends tg{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new tp(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let ty=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(n[e]=0,n[256|e]=32768,r[e]=24,r[256|e]=24):t<-14?(n[e]=1024>>-t-14,n[256|e]=1024>>-t-14|32768,r[e]=-t-1,r[256|e]=-t-1):t<=15?(n[e]=t+15<<10,n[256|e]=t+15<<10|32768,r[e]=13,r[256|e]=13):t<128?(n[e]=31744,n[256|e]=64512,r[e]=24,r[256|e]=24):(n[e]=31744,n[256|e]=64512,r[e]=13,r[256|e]=13)}let a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;(8388608&t)==0;)t<<=1,i-=8388608;t&=-8388609,i+=0x38800000,a[e]=t|i}for(let e=1024;e<2048;++e)a[e]=0x38000000+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=0x47800000,s[32]=0x80000000;for(let e=33;e<63;++e)s[e]=0x80000000+(e-32<<23);s[63]=0xc7800000;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:a,exponentTable:s,offsetTable:o}}();function tx(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=S(e,-65504,65504),ty.floatView[0]=e;let t=ty.uint32View[0],i=t>>23&511;return ty.baseTable[i]+((8388607&t)>>ty.shiftTable[i])}function t_(e){let t=e>>10;return ty.uint32View[0]=ty.mantissaTable[ty.offsetTable[t]+(1023&e)]+ty.exponentTable[t],ty.floatView[0]}let tA=new ea,tb=new P;class tS{constructor(e,t,i=!1){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)tb.fromBufferAttribute(this,t),tb.applyMatrix3(e),this.setXY(t,tb.x,tb.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)tA.fromBufferAttribute(this,t),tA.applyMatrix3(e),this.setXYZ(t,tA.x,tA.y,tA.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)tA.fromBufferAttribute(this,t),tA.applyMatrix4(e),this.setXYZ(t,tA.x,tA.y,tA.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)tA.fromBufferAttribute(this,t),tA.applyNormalMatrix(e),this.setXYZ(t,tA.x,tA.y,tA.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)tA.fromBufferAttribute(this,t),tA.transformDirection(e),this.setXYZ(t,tA.x,tA.y,tA.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=T(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=R(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=T(t,this.array)),t}setX(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=T(t,this.array)),t}setY(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=T(t,this.array)),t}setZ(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=T(t,this.array)),t}setW(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=R(t,this.array),i=R(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=R(t,this.array),i=R(i,this.array),n=R(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=R(t,this.array),i=R(i,this.array),n=R(n,this.array),r=R(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class tw extends tS{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class tM extends tS{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class tE extends tS{constructor(e,t,i){super(new Float32Array(e),t,i)}}let tC=0,tT=new eO,tR=new e6,tP=new ea,tI=new el,tL=new el,tD=new ea;class tB extends v{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:tC++}),this.uuid=b(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(D(e)?tM:tw)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let t=new I().getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return tT.makeRotationFromQuaternion(e),this.applyMatrix4(tT),this}rotateX(e){return tT.makeRotationX(e),this.applyMatrix4(tT),this}rotateY(e){return tT.makeRotationY(e),this.applyMatrix4(tT),this}rotateZ(e){return tT.makeRotationZ(e),this.applyMatrix4(tT),this}translate(e,t,i){return tT.makeTranslation(e,t,i),this.applyMatrix4(tT),this}scale(e,t,i){return tT.makeScale(e,t,i),this.applyMatrix4(tT),this}lookAt(e){return tR.lookAt(e),tR.updateMatrix(),this.applyMatrix4(tR.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tP).negate(),this.translate(tP.x,tP.y,tP.z),this}setFromPoints(e){let t=[];for(let i=0,n=e.length;i<n;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new tE(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new el);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new ea(-1/0,-1/0,-1/0),new ea(Infinity,Infinity,Infinity));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){let i=t[e];tI.setFromBufferAttribute(i),this.morphTargetsRelative?(tD.addVectors(this.boundingBox.min,tI.min),this.boundingBox.expandByPoint(tD),tD.addVectors(this.boundingBox.max,tI.max),this.boundingBox.expandByPoint(tD)):(this.boundingBox.expandByPoint(tI.min),this.boundingBox.expandByPoint(tI.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new eE);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new ea,1/0);return}if(e){let i=this.boundingSphere.center;if(tI.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){let i=t[e];tL.setFromBufferAttribute(i),this.morphTargetsRelative?(tD.addVectors(tI.min,tL.min),tI.expandByPoint(tD),tD.addVectors(tI.max,tL.max),tI.expandByPoint(tD)):(tI.expandByPoint(tL.min),tI.expandByPoint(tL.max))}tI.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)tD.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(tD));if(t)for(let r=0,a=t.length;r<a;r++){let a=t[r],s=this.morphTargetsRelative;for(let t=0,r=a.count;t<r;t++)tD.fromBufferAttribute(a,t),s&&(tP.fromBufferAttribute(e,t),tD.add(tP)),n=Math.max(n,i.distanceToSquared(tD))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,n=t.position.array,r=t.normal.array,a=t.uv.array,s=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new tS(new Float32Array(4*s),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<s;e++)l[e]=new ea,c[e]=new ea;let h=new ea,u=new ea,d=new ea,p=new P,f=new P,m=new P,g=new ea,v=new ea,y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let e=0,t=y.length;e<t;++e){let t=y[e],r=t.start,s=t.count;for(let e=r,t=r+s;e<t;e+=3)!function(e,t,i){h.fromArray(n,3*e),u.fromArray(n,3*t),d.fromArray(n,3*i),p.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*i),u.sub(h),d.sub(h),f.sub(p),m.sub(p);let r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(v),c[t].add(v),c[i].add(v))}(i[e+0],i[e+1],i[e+2])}let x=new ea,_=new ea,A=new ea,b=new ea;function S(e){A.fromArray(r,3*e),b.copy(A);let t=l[e];x.copy(t),x.sub(A.multiplyScalar(A.dot(t))).normalize(),_.crossVectors(b,t);let i=_.dot(c[e]);o[4*e]=x.x,o[4*e+1]=x.y,o[4*e+2]=x.z,o[4*e+3]=i<0?-1:1}for(let e=0,t=y.length;e<t;++e){let t=y[e],n=t.start,r=t.count;for(let e=n,t=n+r;e<t;e+=3)S(i[e+0]),S(i[e+1]),S(i[e+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new tS(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);let n=new ea,r=new ea,a=new ea,s=new ea,o=new ea,l=new ea,c=new ea,h=new ea;if(e)for(let u=0,d=e.count;u<d;u+=3){let d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);n.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),c.subVectors(a,r),h.subVectors(n,r),c.cross(h),s.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),s.add(c),o.add(c),l.add(c),i.setXYZ(d,s.x,s.y,s.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,r),h.subVectors(n,r),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)tD.fromBufferAttribute(e,t),tD.normalize(),e.setXYZ(t,tD.x,tD.y,tD.z)}toNonIndexed(){function e(e,t){let i=e.array,n=e.itemSize,r=e.normalized,a=new i.constructor(t.length*n),s=0,o=0;for(let r=0,l=t.length;r<l;r++){s=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*n;for(let e=0;e<n;e++)a[o++]=i[s++]}return new tS(a,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new tB,i=this.index.array,n=this.attributes;for(let r in n){let a=e(n[r],i);t.setAttribute(r,a)}let r=this.morphAttributes;for(let n in r){let a=[],s=r[n];for(let t=0,n=s.length;t<n;t++){let n=e(s[t],i);a.push(n)}t.morphAttributes[n]=a}t.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,i=a.length;e<i;e++){let i=a[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let t in i){let n=i[t];e.data.attributes[t]=n.toJSON(e.data)}let n={},r=!1;for(let t in this.morphAttributes){let i=this.morphAttributes[t],a=[];for(let t=0,n=i.length;t<n;t++){let n=i[t];a.push(n.toJSON(e.data))}a.length>0&&(n[t]=a,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;null!==i&&this.setIndex(i.clone(t));let n=e.attributes;for(let e in n){let i=n[e];this.setAttribute(e,i.clone(t))}let r=e.morphAttributes;for(let e in r){let i=[],n=r[e];for(let e=0,r=n.length;e<r;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,t=a.length;e<t;e++){let t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}let s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let tO=new eO,tN=new eB,tU=new eE,tF=new ea,tk=new ea,tz=new ea,tH=new ea,tV=new ea,tG=new ea,tW=new P,tj=new P,tq=new P,tX=new ea,tY=new ea,tK=new ea,tQ=new ea,tJ=new ea;class tZ extends e6{constructor(e=new tB,t=new tv){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(n,e);let s=this.morphTargetInfluences;if(r&&s){tG.set(0,0,0);for(let i=0,n=r.length;i<n;i++){let n=s[i],o=r[i];0!==n&&(tV.fromBufferAttribute(o,e),a?tG.addScaledVector(tV,n):tG.addScaledVector(tV.sub(t),n))}t.add(tG)}return t}raycast(e,t){let i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),tU.copy(i.boundingSphere),tU.applyMatrix4(r),tN.copy(e.ray).recast(e.near),!1===tU.containsPoint(tN.origin)&&(null===tN.intersectSphere(tU,tF)||tN.origin.distanceToSquared(tF)>(e.far-e.near)**2)||(tO.copy(r).invert(),tN.copy(e.ray).applyMatrix4(tO),null!==i.boundingBox&&!1===tN.intersectsBox(i.boundingBox)))return;this._computeIntersections(e,t,tN)}}_computeIntersections(e,t,i){let n;let r=this.geometry,a=this.material,s=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==s){if(Array.isArray(a))for(let r=0,o=u.length;r<o;r++){let o=u[r],p=a[o.materialIndex],f=Math.max(o.start,d.start),m=Math.min(s.count,Math.min(o.start+o.count,d.start+d.count));for(let r=f;r<m;r+=3){let a=s.getX(r);(n=t$(this,p,e,i,l,c,h,a,s.getX(r+1),s.getX(r+2)))&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=o.materialIndex,t.push(n))}}else{let r=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);for(let u=r;u<o;u+=3){let r=s.getX(u);(n=t$(this,a,e,i,l,c,h,r,s.getX(u+1),s.getX(u+2)))&&(n.faceIndex=Math.floor(u/3),t.push(n))}}}else if(void 0!==o){if(Array.isArray(a))for(let r=0,s=u.length;r<s;r++){let s=u[r],p=a[s.materialIndex],f=Math.max(s.start,d.start),m=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));for(let r=f;r<m;r+=3)(n=t$(this,p,e,i,l,c,h,r,r+1,r+2))&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=s.materialIndex,t.push(n))}else{let r=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);for(let o=r;o<s;o+=3)(n=t$(this,a,e,i,l,c,h,o,o+1,o+2))&&(n.faceIndex=Math.floor(o/3),t.push(n))}}}}function t$(e,t,i,n,r,a,s,o,l,c){e.getVertexPosition(o,tk),e.getVertexPosition(l,tz),e.getVertexPosition(c,tH);let h=function(e,t,i,n,r,a,s,o){let l;if(null===(1===t.side?n.intersectTriangle(s,a,r,!0,o):n.intersectTriangle(r,a,s,0===t.side,o)))return null;tJ.copy(o),tJ.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(tJ);return c<i.near||c>i.far?null:{distance:c,point:tJ.clone(),object:e}}(e,t,i,n,tk,tz,tH,tQ);if(h){r&&(tW.fromBufferAttribute(r,o),tj.fromBufferAttribute(r,l),tq.fromBufferAttribute(r,c),h.uv=tl.getInterpolation(tQ,tk,tz,tH,tW,tj,tq,new P)),a&&(tW.fromBufferAttribute(a,o),tj.fromBufferAttribute(a,l),tq.fromBufferAttribute(a,c),h.uv1=tl.getInterpolation(tQ,tk,tz,tH,tW,tj,tq,new P),h.uv2=h.uv1),s&&(tX.fromBufferAttribute(s,o),tY.fromBufferAttribute(s,l),tK.fromBufferAttribute(s,c),h.normal=tl.getInterpolation(tQ,tk,tz,tH,tX,tY,tK,new ea),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));let e={a:o,b:l,c:c,normal:new ea,materialIndex:0};tl.getNormal(tk,tz,tH,e.normal),h.face=e}return h}class t0 extends tB{constructor(e=1,t=1,i=1,n=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};let s=this;n=Math.floor(n),r=Math.floor(r);let o=[],l=[],c=[],h=[],u=0,d=0;function p(e,t,i,n,r,a,p,f,m,g,v){let y=a/m,x=p/g,_=a/2,A=p/2,b=f/2,S=m+1,w=g+1,M=0,E=0,C=new ea;for(let a=0;a<w;a++){let s=a*x-A;for(let o=0;o<S;o++){let u=o*y-_;C[e]=u*n,C[t]=s*r,C[i]=b,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[i]=f>0?1:-1,c.push(C.x,C.y,C.z),h.push(o/m),h.push(1-a/g),M+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){let i=u+t+S*e,n=u+t+S*(e+1),r=u+(t+1)+S*(e+1),a=u+(t+1)+S*e;o.push(i,n,a),o.push(n,r,a),E+=6}s.addGroup(d,E,v),d+=E,u+=M}p("z","y","x",-1,-1,i,t,e,a=Math.floor(a),r,0),p("z","y","x",1,-1,i,t,-e,a,r,1),p("x","z","y",1,1,e,i,t,n,a,2),p("x","z","y",1,-1,e,i,-t,n,a,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new tE(l,3)),this.setAttribute("normal",new tE(c,3)),this.setAttribute("uv",new tE(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new t0(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function t1(e){let t={};for(let i in e)for(let n in t[i]={},e[i]){let r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][n]=null):t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}return t}function t2(e){let t={};for(let i=0;i<e.length;i++){let n=t1(e[i]);for(let e in n)t[e]=n[e]}return t}function t3(e){return null===e.getRenderTarget()?e.outputColorSpace:W.workingColorSpace}let t4={clone:t1,merge:t2};class t5 extends tg{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=t1(e.uniforms),this.uniformsGroups=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);for(let i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){let n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;let i={};for(let e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class t6 extends e6{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new eO,this.projectionMatrix=new eO,this.projectionMatrixInverse=new eO,this.coordinateSystem=2e3}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class t8 extends t6{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*A*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*_*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*A*Math.atan(Math.tan(.5*_*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*_*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,s=a.fullHeight;r+=a.offsetX*n/e,t-=a.offsetY*i/s,n*=a.width/e,i*=a.height/s}let s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class t9 extends e6{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;let n=new t8(-90,1,e,t);n.layers=this.layers,this.add(n);let r=new t8(-90,1,e,t);r.layers=this.layers,this.add(r);let a=new t8(-90,1,e,t);a.layers=this.layers,this.add(a);let s=new t8(-90,1,e,t);s.layers=this.layers,this.add(s);let o=new t8(-90,1,e,t);o.layers=this.layers,this.add(o);let l=new t8(-90,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){let e=this.coordinateSystem,t=this.children.concat(),[i,n,r,a,s,o]=t;for(let e of t)this.remove(e);if(2e3===e)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else if(2001===e)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(let e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();let{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[r,a,s,o,l,c]=this.children,h=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;let f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,r),e.setRenderTarget(i,1,n),e.render(t,a),e.setRenderTarget(i,2,n),e.render(t,s),e.setRenderTarget(i,3,n),e.render(t,o),e.setRenderTarget(i,4,n),e.render(t,l),i.texture.generateMipmaps=f,e.setRenderTarget(i,5,n),e.render(t,c),e.setRenderTarget(h,u,d),e.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class t7 extends Z{constructor(e,t,i,n,r,a,s,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:301,i,n,r,a,s,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ie extends et{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1};void 0!==t.encoding&&(k("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=3001===t.encoding?c:""),this.texture=new t7([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:1006}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new t0(5,5,5),r=new t5({name:"CubemapFromEquirect",uniforms:t1(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=t;let a=new tZ(n,r),s=t.minFilter;return 1008===t.minFilter&&(t.minFilter=1006),new t9(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,n){let r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,n);e.setRenderTarget(r)}}let it=new ea,ii=new ea,ir=new I;class ia{constructor(e=new ea(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let n=it.subVectors(i,t).cross(ii.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let i=e.delta(it),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||ir.getNormalMatrix(e),n=this.coplanarPoint(it).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}let is=new eE,io=new ea;class il{constructor(e=new ia,t=new ia,i=new ia,n=new ia,r=new ia,a=new ia){this.planes=[e,t,i,n,r,a]}set(e,t,i,n,r,a){let s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=2e3){let i=this.planes,n=e.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],c=n[5],h=n[6],u=n[7],d=n[8],p=n[9],f=n[10],m=n[11],g=n[12],v=n[13],y=n[14],x=n[15];if(i[0].setComponents(o-r,u-l,m-d,x-g).normalize(),i[1].setComponents(o+r,u+l,m+d,x+g).normalize(),i[2].setComponents(o+a,u+c,m+p,x+v).normalize(),i[3].setComponents(o-a,u-c,m-p,x-v).normalize(),i[4].setComponents(o-s,u-h,m-f,x-y).normalize(),2e3===t)i[5].setComponents(o+s,u+h,m+f,x+y).normalize();else if(2001===t)i[5].setComponents(s,h,f,y).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),is.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),is.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(is)}intersectsSprite(e){return is.center.set(0,0,0),is.radius=.7071067811865476,is.applyMatrix4(e.matrixWorld),this.intersectsSphere(is)}intersectsSphere(e){let t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let n=t[i];if(io.x=n.normal.x>0?e.max.x:e.min.x,io.y=n.normal.y>0?e.max.y:e.min.y,io.z=n.normal.z>0?e.max.z:e.min.z,0>n.distanceToPoint(io))return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(0>t[i].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}function ic(){let e=null,t=!1,i=null,n=null;function r(t,a){i(t,a),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function ih(e,t){let i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){let e=n.get(t);(!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version});return}t.isInterleavedBufferAttribute&&(t=t.data);let a=n.get(t);if(void 0===a)n.set(t,function(t,n){let r;let a=t.array,s=t.usage,o=a.byteLength,l=e.createBuffer();if(e.bindBuffer(n,l),e.bufferData(n,a,s),t.onUploadCallback(),a instanceof Float32Array)r=e.FLOAT;else if(a instanceof Uint16Array){if(t.isFloat16BufferAttribute){if(i)r=e.HALF_FLOAT;else throw Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.")}else r=e.UNSIGNED_SHORT}else if(a instanceof Int16Array)r=e.SHORT;else if(a instanceof Uint32Array)r=e.UNSIGNED_INT;else if(a instanceof Int32Array)r=e.INT;else if(a instanceof Int8Array)r=e.BYTE;else if(a instanceof Uint8Array)r=e.UNSIGNED_BYTE;else if(a instanceof Uint8ClampedArray)r=e.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);return{buffer:l,type:r,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version,size:o}}(t,r));else if(a.version<t.version){if(a.size!==t.array.byteLength)throw Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){let a=n.array,s=n._updateRange,o=n.updateRanges;if(e.bindBuffer(r,t),-1===s.count&&0===o.length&&e.bufferSubData(r,0,a),0!==o.length){for(let t=0,n=o.length;t<n;t++){let n=o[t];i?e.bufferSubData(r,n.start*a.BYTES_PER_ELEMENT,a,n.start,n.count):e.bufferSubData(r,n.start*a.BYTES_PER_ELEMENT,a.subarray(n.start,n.start+n.count))}n.clearUpdateRanges()}-1!==s.count&&(i?e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),n.onUploadCallback()}(a.buffer,t,r),a.version=t.version}}}}class iu extends tB{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};let r=e/2,a=t/2,s=Math.floor(i),o=Math.floor(n),l=s+1,c=o+1,h=e/s,u=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){let t=e*u-a;for(let i=0;i<l;i++){let n=i*h-r;p.push(n,-t,0),f.push(0,0,1),m.push(i/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){let i=t+l*e,n=t+l*(e+1),r=t+1+l*(e+1),a=t+1+l*e;d.push(i,n,a),d.push(n,r,a)}this.setIndex(d),this.setAttribute("position",new tE(p,3)),this.setAttribute("normal",new tE(f,3)),this.setAttribute("uv",new tE(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iu(e.width,e.height,e.widthSegments,e.heightSegments)}}let id={alphahash_fragment:"#ifdef USE_ALPHAHASH\n	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n	const float ALPHA_HASH_SCALE = 0.05;\n	float hash2D( vec2 value ) {\n		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n	}\n	float hash3D( vec3 value ) {\n		return hash2D( vec2( hash2D( value.xy ), value.z ) );\n	}\n	float getAlphaHashThreshold( vec3 position ) {\n		float maxDeriv = max(\n			length( dFdx( position.xyz ) ),\n			length( dFdy( position.xyz ) )\n		);\n		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n		vec2 pixScales = vec2(\n			exp2( floor( log2( pixScale ) ) ),\n			exp2( ceil( log2( pixScale ) ) )\n		);\n		vec2 alpha = vec2(\n			hash3D( floor( pixScales.x * position.xyz ) ),\n			hash3D( floor( pixScales.y * position.xyz ) )\n		);\n		float lerpFactor = fract( log2( pixScale ) );\n		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n		float a = min( lerpFactor, 1.0 - lerpFactor );\n		vec3 cases = vec3(\n			x * x / ( 2.0 * a * ( 1.0 - a ) ),\n			( x - 0.5 * a ) / ( 1.0 - a ),\n			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n		);\n		float threshold = ( x < ( 1.0 - a ) )\n			? ( ( x < a ) ? cases.x : cases.y )\n			: cases.z;\n		return clamp( threshold , 1.0e-6, 1.0 );\n	}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n	if ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_CLEARCOAT ) \n		clearcoatSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_SHEEN ) \n		sheenSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n	attribute float batchId;\n	uniform highp sampler2D batchingTexture;\n	mat4 getBatchingMatrix( const in float i ) {\n		int size = textureSize( batchingTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n	mat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n	vPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vBumpMapUv );\n		vec2 dSTdy = dFdy( vBumpMapUv );\n		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n		plane = clippingPlanes[ i ];\n		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n	}\n	#pragma unroll_loop_end\n	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n		bool clipped = true;\n		#pragma unroll_loop_start\n		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n		}\n		#pragma unroll_loop_end\n		if ( clipped ) discard;\n	#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	varying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n	varying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n	return dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n	vec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n	mat3 bm = mat3( batchingMatrix );\n	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n	transformedNormal = bm * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = bm * transformedTangent;\n	#endif\n#endif\n#ifdef USE_INSTANCING\n	mat3 im = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n	transformedNormal = im * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = im * transformedTangent;\n	#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n	vec3( 0.8224621, 0.177538, 0.0 ),\n	vec3( 0.0331941, 0.9668058, 0.0 ),\n	vec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n	vec3( 1.2249401, - 0.2249404, 0.0 ),\n	vec3( - 0.0420569, 1.0420571, 0.0 ),\n	vec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n	return value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n	return value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n	return sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	#ifdef USE_ANISOTROPY\n		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n			#ifdef ENVMAP_TYPE_CUBE_UV\n				vec3 bentNormal = cross( bitangent, viewDir );\n				bentNormal = normalize( cross( bentNormal, bitangent ) );\n				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n				return getIBLRadiance( viewDir, bentNormal, roughness );\n			#else\n				return vec3( 0.0 );\n			#endif\n		}\n	#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n	reflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n	uniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	#if defined ( LEGACY_LIGHTS )\n		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n		}\n		return 1.0;\n	#else\n		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n		if ( cutoffDistance > 0.0 ) {\n			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n		}\n		return distanceFalloff;\n	#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef USE_SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULAR_COLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n		#endif\n		#ifdef USE_SPECULAR_INTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEEN_COLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	#ifdef USE_ANISOTROPYMAP\n		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n	#else\n		vec2 anisotropyV = anisotropyVector;\n	#endif\n	material.anisotropy = length( anisotropyV );\n	if( material.anisotropy == 0.0 ) {\n		anisotropyV = vec2( 1.0, 0.0 );\n	} else {\n		anisotropyV /= material.anisotropy;\n		material.anisotropy = saturate( material.anisotropy );\n	}\n	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n	#ifdef USE_ANISOTROPY\n		float anisotropy;\n		float alphaT;\n		vec3 anisotropyT;\n		vec3 anisotropyB;\n	#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n		float v = 0.5 / ( gv + gl );\n		return saturate(v);\n	}\n	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n		float a2 = alphaT * alphaB;\n		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n		highp float v2 = dot( v, v );\n		float w2 = a2 / v2;\n		return RECIPROCAL_PI * a2 * pow2 ( w2 );\n	}\n#endif\n#ifdef USE_CLEARCOAT\n	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n		vec3 f0 = material.clearcoatF0;\n		float f90 = material.clearcoatF90;\n		float roughness = material.clearcoatRoughness;\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = F_Schlick( f0, f90, dotVH );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n	vec3 f0 = material.specularColor;\n	float f90 = material.specularF90;\n	float roughness = material.roughness;\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	#ifdef USE_IRIDESCENCE\n		F = mix( F, material.iridescenceFresnel, material.iridescence );\n	#endif\n	#ifdef USE_ANISOTROPY\n		float dotTL = dot( material.anisotropyT, lightDir );\n		float dotTV = dot( material.anisotropyT, viewDir );\n		float dotTH = dot( material.anisotropyT, halfDir );\n		float dotBL = dot( material.anisotropyB, lightDir );\n		float dotBV = dot( material.anisotropyB, viewDir );\n		float dotBH = dot( material.anisotropyB, halfDir );\n		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n	#else\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n	#endif\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometryNormal;\n		vec3 viewDir = geometryViewDir;\n		vec3 position = geometryPosition;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n	#endif\n	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n	geometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometryViewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometryPosition, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometryPosition, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	#if defined( USE_LIGHT_PROBES )\n		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n	#endif\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometryNormal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	#ifdef USE_ANISOTROPY\n		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n	#else\n		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n	#endif\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		varying float vFragDepth;\n		varying float vIsPerspective;\n	#else\n		uniform float logDepthBufFC;\n	#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		vFragDepth = 1.0 + gl_Position.w;\n		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n	#else\n		if ( isPerspectiveMatrix( projectionMatrix ) ) {\n			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n			gl_Position.z *= gl_Position.w;\n		}\n	#endif\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n	\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	#if defined( USE_POINTS_UV )\n		vec2 uv = vUv;\n	#else\n		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n	#endif\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n	varying vec2 vUv;\n#else\n	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n		uniform mat3 uvTransform;\n	#endif\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n	#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	uniform float morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n		uniform sampler2DArray morphTargetsTexture;\n		uniform ivec2 morphTargetsTextureSize;\n		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n			int y = texelIndex / morphTargetsTextureSize.x;\n			int x = texelIndex - y * morphTargetsTextureSize.x;\n			ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n			return texelFetch( morphTargetsTexture, morphUV, 0 );\n		}\n	#else\n		#ifndef USE_MORPHNORMALS\n			uniform float morphTargetInfluences[ 8 ];\n		#else\n			uniform float morphTargetInfluences[ 4 ];\n		#endif\n	#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		transformed += morphTarget0 * morphTargetInfluences[ 0 ];\n		transformed += morphTarget1 * morphTargetInfluences[ 1 ];\n		transformed += morphTarget2 * morphTargetInfluences[ 2 ];\n		transformed += morphTarget3 * morphTargetInfluences[ 3 ];\n		#ifndef USE_MORPHNORMALS\n			transformed += morphTarget4 * morphTargetInfluences[ 4 ];\n			transformed += morphTarget5 * morphTargetInfluences[ 5 ];\n			transformed += morphTarget6 * morphTargetInfluences[ 6 ];\n			transformed += morphTarget7 * morphTargetInfluences[ 7 ];\n		#endif\n	#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal *= faceDirection;\n	#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n	#ifdef USE_TANGENT\n		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn = getTangentFrame( - vViewPosition, normal,\n		#if defined( USE_NORMALMAP )\n			vNormalMapUv\n		#elif defined( USE_CLEARCOAT_NORMALMAP )\n			vClearcoatNormalMapUv\n		#else\n			vUv\n		#endif\n		);\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn[0] *= faceDirection;\n		tbn[1] *= faceDirection;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	#ifdef USE_TANGENT\n		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn2[0] *= faceDirection;\n		tbn2[1] *= faceDirection;\n	#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	normal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( uv.st );\n		vec2 st1 = dFdy( uv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n		return mat3( T * scale, B * scale, N );\n	}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	clearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n	vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n	return packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n	mvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return shadow;\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n		vec3 lightToPosition = shadowCoord.xyz;\n		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;\n		vec3 bd3D = normalize( lightToPosition );\n		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n			return (\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n			) * ( 1.0 / 9.0 );\n		#else\n			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n		#endif\n	}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n	vec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	mat4 getBoneMatrix( const in float i ) {\n		int size = textureSize( boneTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n	vec3( 1.6605, - 0.1246, - 0.0182 ),\n	vec3( - 0.5876, 1.1329, - 0.1006 ),\n	vec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n	vec3( 0.6274, 0.0691, 0.0164 ),\n	vec3( 0.3293, 0.9195, 0.0880 ),\n	vec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n	vec3 x2 = x * x;\n	vec3 x4 = x2 * x2;\n	return + 15.5 * x4 * x2\n		- 40.14 * x4 * x\n		+ 31.96 * x4\n		- 6.868 * x2 * x\n		+ 0.4298 * x2\n		+ 0.1191 * x\n		- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n	const mat3 AgXInsetMatrix = mat3(\n		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n	);\n	const mat3 AgXOutsetMatrix = mat3(\n		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n	);\n	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;\n	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n	color *= toneMappingExposure;\n	color = AgXInsetMatrix * color;\n	color = max( color, 1e-10 );	color = log2( color );\n	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n	color = clamp( color, 0.0, 1.0 );\n	color = agxDefaultContrastApprox( color );\n	color = AgXOutsetMatrix * color;\n	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n	return color;\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmitted = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	float w0( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n	}\n	float w1( float a ) {\n		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n	}\n	float w2( float a ){\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n	}\n	float w3( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * a * a );\n	}\n	float g0( float a ) {\n		return w0( a ) + w1( a );\n	}\n	float g1( float a ) {\n		return w2( a ) + w3( a );\n	}\n	float h0( float a ) {\n		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n	}\n	float h1( float a ) {\n		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n	}\n	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n		uv = uv * texelSize.zw + 0.5;\n		vec2 iuv = floor( uv );\n		vec2 fuv = fract( uv );\n		float g0x = g0( fuv.x );\n		float g1x = g1( fuv.x );\n		float h0x = h0( fuv.x );\n		float h1x = h1( fuv.x );\n		float h0y = h0( fuv.y );\n		float h1y = h1( fuv.y );\n		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n	}\n	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n		vec2 fLodSizeInv = 1.0 / fLodSize;\n		vec2 cLodSizeInv = 1.0 / cLodSize;\n		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n		return mix( fSample, cSample, fract( lod ) );\n	}\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n	}\n	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( isinf( attenuationDistance ) ) {\n			return vec3( 1.0 );\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n		vec3 refractedRayExit = position + transmissionRay;\n		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n		vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n		refractionCoords += 1.0;\n		refractionCoords /= 2.0;\n		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n		vec3 attenuatedColor = transmittance * transmittedLight.rgb;\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n	}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform mat3 mapTransform;\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform mat3 alphaMapTransform;\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	uniform mat3 lightMapTransform;\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	uniform mat3 aoMapTransform;\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	uniform mat3 bumpMapTransform;\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	uniform mat3 normalMapTransform;\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	uniform mat3 displacementMapTransform;\n	varying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	uniform mat3 emissiveMapTransform;\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	uniform mat3 metalnessMapTransform;\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	uniform mat3 roughnessMapTransform;\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	uniform mat3 anisotropyMapTransform;\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	uniform mat3 clearcoatMapTransform;\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform mat3 clearcoatNormalMapTransform;\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform mat3 clearcoatRoughnessMapTransform;\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	uniform mat3 sheenColorMapTransform;\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	uniform mat3 sheenRoughnessMapTransform;\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	uniform mat3 iridescenceMapTransform;\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform mat3 iridescenceThicknessMapTransform;\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	uniform mat3 specularMapTransform;\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	uniform mat3 specularColorMapTransform;\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	uniform mat3 specularIntensityMapTransform;\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	vUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_BATCHING\n		worldPosition = batchingMatrix * worldPosition;\n	#endif\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n	vec2 scale;\n	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},ip={common:{diffuse:{value:new tp(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new I},alphaMap:{value:null},alphaMapTransform:{value:new I},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new I}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new I}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new I}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new I},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new I},normalScale:{value:new P(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new I},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new I}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new I}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new I}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tp(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new tp(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new I},alphaTest:{value:0},uvTransform:{value:new I}},sprite:{diffuse:{value:new tp(0xffffff)},opacity:{value:1},center:{value:new P(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new I},alphaMap:{value:null},alphaMapTransform:{value:new I},alphaTest:{value:0}}},im={basic:{uniforms:t2([ip.common,ip.specularmap,ip.envmap,ip.aomap,ip.lightmap,ip.fog]),vertexShader:id.meshbasic_vert,fragmentShader:id.meshbasic_frag},lambert:{uniforms:t2([ip.common,ip.specularmap,ip.envmap,ip.aomap,ip.lightmap,ip.emissivemap,ip.bumpmap,ip.normalmap,ip.displacementmap,ip.fog,ip.lights,{emissive:{value:new tp(0)}}]),vertexShader:id.meshlambert_vert,fragmentShader:id.meshlambert_frag},phong:{uniforms:t2([ip.common,ip.specularmap,ip.envmap,ip.aomap,ip.lightmap,ip.emissivemap,ip.bumpmap,ip.normalmap,ip.displacementmap,ip.fog,ip.lights,{emissive:{value:new tp(0)},specular:{value:new tp(1118481)},shininess:{value:30}}]),vertexShader:id.meshphong_vert,fragmentShader:id.meshphong_frag},standard:{uniforms:t2([ip.common,ip.envmap,ip.aomap,ip.lightmap,ip.emissivemap,ip.bumpmap,ip.normalmap,ip.displacementmap,ip.roughnessmap,ip.metalnessmap,ip.fog,ip.lights,{emissive:{value:new tp(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:id.meshphysical_vert,fragmentShader:id.meshphysical_frag},toon:{uniforms:t2([ip.common,ip.aomap,ip.lightmap,ip.emissivemap,ip.bumpmap,ip.normalmap,ip.displacementmap,ip.gradientmap,ip.fog,ip.lights,{emissive:{value:new tp(0)}}]),vertexShader:id.meshtoon_vert,fragmentShader:id.meshtoon_frag},matcap:{uniforms:t2([ip.common,ip.bumpmap,ip.normalmap,ip.displacementmap,ip.fog,{matcap:{value:null}}]),vertexShader:id.meshmatcap_vert,fragmentShader:id.meshmatcap_frag},points:{uniforms:t2([ip.points,ip.fog]),vertexShader:id.points_vert,fragmentShader:id.points_frag},dashed:{uniforms:t2([ip.common,ip.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:id.linedashed_vert,fragmentShader:id.linedashed_frag},depth:{uniforms:t2([ip.common,ip.displacementmap]),vertexShader:id.depth_vert,fragmentShader:id.depth_frag},normal:{uniforms:t2([ip.common,ip.bumpmap,ip.normalmap,ip.displacementmap,{opacity:{value:1}}]),vertexShader:id.meshnormal_vert,fragmentShader:id.meshnormal_frag},sprite:{uniforms:t2([ip.sprite,ip.fog]),vertexShader:id.sprite_vert,fragmentShader:id.sprite_frag},background:{uniforms:{uvTransform:{value:new I},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:id.background_vert,fragmentShader:id.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:id.backgroundCube_vert,fragmentShader:id.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:id.cube_vert,fragmentShader:id.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:id.equirect_vert,fragmentShader:id.equirect_frag},distanceRGBA:{uniforms:t2([ip.common,ip.displacementmap,{referencePosition:{value:new ea},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:id.distanceRGBA_vert,fragmentShader:id.distanceRGBA_frag},shadow:{uniforms:t2([ip.lights,ip.fog,{color:{value:new tp(0)},opacity:{value:1}}]),vertexShader:id.shadow_vert,fragmentShader:id.shadow_frag}};im.physical={uniforms:t2([im.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new I},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new I},clearcoatNormalScale:{value:new P(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new I},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new I},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new I},sheen:{value:0},sheenColor:{value:new tp(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new I},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new I},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new I},transmissionSamplerSize:{value:new P},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new I},attenuationDistance:{value:0},attenuationColor:{value:new tp(0)},specularColor:{value:new tp(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new I},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new I},anisotropyVector:{value:new P},anisotropyMap:{value:null},anisotropyMapTransform:{value:new I}}]),vertexShader:id.meshphysical_vert,fragmentShader:id.meshphysical_frag};let ig={r:0,b:0,g:0};function iv(e,t,i,n,r,a,s){let o,l;let c=new tp(0),h=!0===a?0:1,u=null,d=0,p=null;function m(t,i){t.getRGB(ig,t3(e)),n.buffers.color.setClear(ig.r,ig.g,ig.b,i,s)}return{getClearColor:function(){return c},setClearColor:function(e,t=1){c.set(e),m(c,h=t)},getClearAlpha:function(){return h},setClearAlpha:function(e){m(c,h=e)},render:function(a,g){let v=!1,y=!0===g.isScene?g.background:null;y&&y.isTexture&&(y=(g.backgroundBlurriness>0?i:t).get(y)),null===y?m(c,h):y&&y.isColor&&(m(y,1),v=!0);let x=e.xr.getEnvironmentBlendMode();"additive"===x?n.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===x&&n.buffers.color.setClear(0,0,0,0,s),(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||306===y.mapping)?(void 0===l&&((l=new tZ(new t0(1,1,1),new t5({name:"BackgroundCubeMaterial",uniforms:t1(im.backgroundCube.uniforms),vertexShader:im.backgroundCube.vertexShader,fragmentShader:im.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=y,l.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,l.material.toneMapped=W.getTransfer(y.colorSpace)!==f,(u!==y||d!==y.version||p!==e.toneMapping)&&(l.material.needsUpdate=!0,u=y,d=y.version,p=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null)):y&&y.isTexture&&(void 0===o&&((o=new tZ(new iu(2,2),new t5({name:"BackgroundMaterial",uniforms:t1(im.background.uniforms),vertexShader:im.background.vertexShader,fragmentShader:im.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=y,o.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,o.material.toneMapped=W.getTransfer(y.colorSpace)!==f,!0===y.matrixAutoUpdate&&y.updateMatrix(),o.material.uniforms.uvTransform.value.copy(y.matrix),(u!==y||d!==y.version||p!==e.toneMapping)&&(o.material.needsUpdate=!0,u=y,d=y.version,p=e.toneMapping),o.layers.enableAll(),a.unshift(o,o.geometry,o.material,0,0,null))}}}function iy(e,t,i,n){let r=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=n.isWebGL2?null:t.get("OES_vertex_array_object"),s=n.isWebGL2||null!==a,o={},l=p(null),c=l,h=!1;function u(t){return n.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){return n.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){let t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function f(){let e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,r){let a=c.newAttributes,s=c.enabledAttributes,o=c.attributeDivisors;a[i]=1,0===s[i]&&(e.enableVertexAttribArray(i),s[i]=1),o[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function v(){let t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function y(t,i,n,r,a,s,o){!0===o?e.vertexAttribIPointer(t,i,n,a,s):e.vertexAttribPointer(t,i,n,r,a,s)}function x(){_(),h=!0,c!==l&&u((c=l).object)}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,x,_){let A=!1;if(s){let t=function(t,i,r){let s=!0===r.wireframe,l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[s];return void 0===h&&(h=p(n.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[s]=h),h}(x,d,l);c!==t&&u((c=t).object),(A=function(e,t,i,n){let r=c.attributes,a=t.attributes,s=0,o=i.getAttributes();for(let t in o)if(o[t].location>=0){let i=r[t],n=a[t];if(void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor)),void 0===i||i.attribute!==n||n&&i.data!==n.data)return!0;s++}return c.attributesNum!==s||c.index!==n}(r,x,d,_))&&function(e,t,i,n){let r={},a=t.attributes,s=0,o=i.getAttributes();for(let t in o)if(o[t].location>=0){let i=a[t];void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor));let n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[t]=n,s++}c.attributes=r,c.attributesNum=s,c.index=n}(r,x,d,_)}else{let e=!0===l.wireframe;(c.geometry!==x.id||c.program!==d.id||c.wireframe!==e)&&(c.geometry=x.id,c.program=d.id,c.wireframe=e,A=!0)}null!==_&&i.update(_,e.ELEMENT_ARRAY_BUFFER),(A||h)&&(h=!1,function(r,a,s,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();let l=o.attributes,c=s.getAttributes(),h=a.defaultAttributeValues;for(let t in c){let a=c[t];if(a.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){let t=s.normalized,l=s.itemSize,c=i.get(s);if(void 0===c)continue;let h=c.buffer,u=c.type,d=c.bytesPerElement,p=!0===n.isWebGL2&&(u===e.INT||u===e.UNSIGNED_INT||1013===s.gpuType);if(s.isInterleavedBufferAttribute){let i=s.data,n=i.stride,c=s.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)g(a.location+e,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,u,t,n*d,(c+l/a.locationSize*e)*d,p)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,u,t,l*d,l/a.locationSize*e*d,p)}}else if(void 0!==h){let i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(a.location,i);break;case 3:e.vertexAttrib3fv(a.location,i);break;case 4:e.vertexAttrib4fv(a.location,i);break;default:e.vertexAttrib1fv(a.location,i)}}}}v()}(r,l,d,x),null!==_&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(_).buffer))},reset:x,resetDefaultState:_,dispose:function(){for(let e in x(),o){let t=o[e];for(let e in t){let i=t[e];for(let e in i)d(i[e].object),delete i[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;let t=o[e.id];for(let e in t){let i=t[e];for(let e in i)d(i[e].object),delete i[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(let t in o){let i=o[t];if(void 0===i[e.id])continue;let n=i[e.id];for(let e in n)d(n[e].object),delete n[e];delete i[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function ix(e,t,i,n){let r;let a=n.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r,1)},this.renderInstances=function(n,s,o){let l,c;if(0!==o){if(a)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[c](r,n,s,o),i.update(s,r,o)}},this.renderMultiDraw=function(e,n,a){if(0===a)return;let s=t.get("WEBGL_multi_draw");if(null===s)for(let t=0;t<a;t++)this.render(e[t],n[t]);else{s.multiDrawArraysWEBGL(r,e,0,n,0,a);let t=0;for(let e=0;e<a;e++)t+=n[e];i.update(t,r,1)}}}function i_(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name,s=void 0!==i.precision?i.precision:"highp",o=r(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);let l=a||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=u>0,x=a||t.has("OES_texture_float"),_=a?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:_}}function iA(e){let t=this,i=null,n=0,r=!1,a=!1,s=new ia,o=new I,l={value:null,needsUpdate:!1};function c(e,i,n,r){let a=null!==e?e.length:0,c=null;if(0!==a){if(c=l.value,!0!==r||null===c){let t=n+4*a,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==a;++t,i+=4)s.copy(e[t]).applyMatrix4(r,o),s.normal.toArray(c,i),c[i+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let i=0!==e.length||t||0!==n||r;return r=t,n=e.length,i},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){i=c(e,t,0)},this.setState=function(s,o,h){let u=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(r&&null!==u&&0!==u.length&&(!a||p)){let e=a?0:n,t=4*e,r=f.clippingState||null;l.value=r,r=c(u,o,t,h);for(let e=0;e!==t;++e)r[e]=i[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}else a?c(null):(l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0)}}function ib(e){let t=new WeakMap;function i(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){let a=r.mapping;if(303===a||304===a){if(t.has(r))return i(t.get(r).texture,r.mapping);{let a=r.image;if(!a||!(a.height>0))return null;{let s=new ie(a.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",n),i(s.texture,r.mapping)}}}}return r},dispose:function(){t=new WeakMap}}}class iS extends t6{constructor(e=-1,t=1,i=1,n=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,a=i+e,s=n+t,o=n-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,a=r+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}let iw=[.125,.215,.35,.446,.526,.582],iM=new iS,iE=new tp,iC=null,iT=0,iR=0,iP=(1+Math.sqrt(5))/2,iI=1/iP,iL=[new ea(1,1,1),new ea(-1,1,1),new ea(1,1,-1),new ea(-1,1,-1),new ea(0,iP,iI),new ea(0,iP,-iI),new ea(iI,0,iP),new ea(-iI,0,iP),new ea(iP,iI,0),new ea(-iP,iI,0)];class iD{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){iC=this._renderer.getRenderTarget(),iT=this._renderer.getActiveCubeFace(),iR=this._renderer.getActiveMipmapLevel(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=iU(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=iN(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(iC,iT,iR),e.scissorTest=!1,iO(e,0,0,e.width,e.height)}_fromTexture(e,t){301===e.mapping||302===e.mapping?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),iC=this._renderer.getRenderTarget(),iT=this._renderer.getActiveCubeFace(),iR=this._renderer.getActiveMipmapLevel();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,colorSpace:h,depthBuffer:!1},n=iB(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){var r;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=iB(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let t=[],i=[],n=[],r=e,a=e-4+1+iw.length;for(let s=0;s<a;s++){let a=Math.pow(2,r);i.push(a);let o=1/a;s>e-4?o=iw[s-e+4-1]:0===s&&(o=0),n.push(o);let l=1/(a-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=new Float32Array(108),p=new Float32Array(72),f=new Float32Array(36);for(let e=0;e<6;e++){let t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];d.set(n,18*e),p.set(u,12*e);let r=[e,e,e,e,e,e];f.set(r,6*e)}let m=new tB;m.setAttribute("position",new tS(d,3)),m.setAttribute("uv",new tS(p,2)),m.setAttribute("faceIndex",new tS(f,1)),t.push(m),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=(r=n,new t5({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new ea(0,1,0)}},vertexShader:iF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:0,depthTest:!1,depthWrite:!1}))}return n}_compileMaterial(e){let t=new tZ(this._lodPlanes[0],e);this._renderer.compile(t,iM)}_sceneToCubeUV(e,t,i,n){let r=new t8(90,1,t,i),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(iE),o.toneMapping=0,o.autoClear=!1;let h=new tv({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new tZ(new t0,h),d=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(iE),d=!0);for(let t=0;t<6;t++){let i=t%3;0===i?(r.up.set(0,a[t],0),r.lookAt(s[t],0,0)):1===i?(r.up.set(0,0,a[t]),r.lookAt(0,s[t],0)):(r.up.set(0,a[t],0),r.lookAt(0,0,s[t]));let l=this._cubeSize;iO(n,i*l,t>2?l:0,l,l),o.setRenderTarget(n),d&&o.render(u,r),o.render(e,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,n=301===e.mapping||302===e.mapping;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=iU()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=iN());let r=n?this._cubemapMaterial:this._equirectMaterial,a=new tZ(this._lodPlanes[0],r);r.uniforms.envMap.value=e;let s=this._cubeSize;iO(t,0,0,3*s,2*s),i.setRenderTarget(t),i.render(a,iM)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){let i=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),n=iL[(t-1)%iL.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,r){let a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,n,"latitudinal",r),this._halfBlur(a,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,a,s){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let c=new tZ(this._lodPlanes[n],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);let m=[],g=0;for(let e=0;e<20;++e){let t=e/p,i=Math.exp(-t*t/2);m.push(i),0===e?g+=i:e<f&&(g+=2*i)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===a,s&&(h.poleAxis.value=s);let{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-i;let y=this._sizeLods[n],x=4*(this._cubeSize-y);iO(t,3*y*(n>v-4?n-v+4:0),x,3*y,2*y),o.setRenderTarget(t),o.render(c,iM)}}function iB(e,t,i){let n=new et(e,t,i);return n.texture.mapping=306,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function iO(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function iN(){return new t5({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:iF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function iU(){return new t5({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:iF(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function iF(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ik(e){let t=new WeakMap,i=null;function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){let a=r.mapping,s=303===a||304===a,o=301===a||302===a;if(s||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=t.get(r);return null===i&&(i=new iD(e)),n=s?i.fromEquirectangular(r,n):i.fromCubemap(r,n),t.set(r,n),n.texture}if(t.has(r))return t.get(r).texture;{let a=r.image;if(!(s&&a&&a.height>0||o&&a&&function(e){let t=0;for(let i=0;i<6;i++)void 0!==e[i]&&t++;return 6===t}(a)))return null;{null===i&&(i=new iD(e));let a=s?i.fromEquirectangular(r):i.fromCubemap(r);return t.set(r,a),r.addEventListener("dispose",n),a.texture}}}}return r},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function iz(e){let t={};function i(i){let n;if(void 0!==t[i])return t[i];switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?(i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance")):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){let t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function iH(e,t,i,n){let r={},a=new WeakMap;function s(e){let o=e.target;for(let e in null!==o.index&&t.remove(o.index),o.attributes)t.remove(o.attributes[e]);for(let e in o.morphAttributes){let i=o.morphAttributes[e];for(let e=0,n=i.length;e<n;e++)t.remove(i[e])}o.removeEventListener("dispose",s),delete r[o.id];let l=a.get(o);l&&(t.remove(l),a.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(e){let i=[],n=e.index,r=e.attributes.position,s=0;if(null!==n){let e=n.array;s=n.version;for(let t=0,n=e.length;t<n;t+=3){let n=e[t+0],r=e[t+1],a=e[t+2];i.push(n,r,r,a,a,n)}}else{if(void 0===r)return;let e=r.array;s=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){let e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}let o=new(D(i)?tM:tw)(i,1);o.version=s;let l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,i.memory.geometries++),t},update:function(i){let n=i.attributes;for(let i in n)t.update(n[i],e.ARRAY_BUFFER);let r=i.morphAttributes;for(let i in r){let n=r[i];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){let t=a.get(e);if(t){let i=e.index;null!==i&&t.version<i.version&&o(e)}else o(e);return a.get(e)}}}function iV(e,t,i,n){let r,a,s;let o=n.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,a,t*s),i.update(n,r,1)},this.renderInstances=function(n,l,c){let h,u;if(0!==c){if(o)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[u](r,l,a,n*s,c),i.update(l,r,c)}},this.renderMultiDraw=function(e,n,o){if(0===o)return;let l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<o;t++)this.render(e[t]/s,n[t]);else{l.multiDrawElementsWEBGL(r,n,0,a,e,0,o);let t=0;for(let e=0;e<o;e++)t+=n[e];i.update(t,r,1)}}}function iG(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(i,n,r){switch(t.calls++,n){case e.TRIANGLES:t.triangles+=i/3*r;break;case e.LINES:t.lines+=i/2*r;break;case e.LINE_STRIP:t.lines+=r*(i-1);break;case e.LINE_LOOP:t.lines+=r*i;break;case e.POINTS:t.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function iW(e,t){return e[0]-t[0]}function ij(e,t){return Math.abs(t[1])-Math.abs(e[1])}function iq(e,t,i){let n={},r=new Float32Array(8),a=new WeakMap,s=new $,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,c,h){let u=l.morphTargetInfluences;if(!0===t.isWebGL2){let n=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==n?n.length:0,o=a.get(c);if(void 0===o||o.count!==r){void 0!==o&&o.texture.dispose();let e=void 0!==c.morphAttributes.position,i=void 0!==c.morphAttributes.normal,n=void 0!==c.morphAttributes.color,l=c.morphAttributes.position||[],h=c.morphAttributes.normal||[],u=c.morphAttributes.color||[],d=0;!0===e&&(d=1),!0===i&&(d=2),!0===n&&(d=3);let p=c.attributes.position.count*d,f=1;p>t.maxTextureSize&&(f=Math.ceil(p/t.maxTextureSize),p=t.maxTextureSize);let m=new Float32Array(p*f*4*r),g=new ei(m,p,f,r);g.type=1015,g.needsUpdate=!0;let v=4*d;for(let t=0;t<r;t++){let r=l[t],a=h[t],o=u[t],c=p*f*4*t;for(let t=0;t<r.count;t++){let l=t*v;!0===e&&(s.fromBufferAttribute(r,t),m[c+l+0]=s.x,m[c+l+1]=s.y,m[c+l+2]=s.z,m[c+l+3]=0),!0===i&&(s.fromBufferAttribute(a,t),m[c+l+4]=s.x,m[c+l+5]=s.y,m[c+l+6]=s.z,m[c+l+7]=0),!0===n&&(s.fromBufferAttribute(o,t),m[c+l+8]=s.x,m[c+l+9]=s.y,m[c+l+10]=s.z,m[c+l+11]=4===o.itemSize?s.w:1)}}o={count:r,texture:g,size:new P(p,f)},a.set(c,o),c.addEventListener("dispose",function e(){g.dispose(),a.delete(c),c.removeEventListener("dispose",e)})}let l=0;for(let e=0;e<u.length;e++)l+=u[e];let d=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",d),h.getUniforms().setValue(e,"morphTargetInfluences",u),h.getUniforms().setValue(e,"morphTargetsTexture",o.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",o.size)}else{let t=void 0===u?0:u.length,i=n[c.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];n[c.id]=i}for(let e=0;e<t;e++){let t=i[e];t[0]=e,t[1]=u[e]}i.sort(ij);for(let e=0;e<8;e++)e<t&&i[e][1]?(o[e][0]=i[e][0],o[e][1]=i[e][1]):(o[e][0]=Number.MAX_SAFE_INTEGER,o[e][1]=0);o.sort(iW);let a=c.morphAttributes.position,s=c.morphAttributes.normal,l=0;for(let e=0;e<8;e++){let t=o[e],i=t[0],n=t[1];i!==Number.MAX_SAFE_INTEGER&&n?(a&&c.getAttribute("morphTarget"+e)!==a[i]&&c.setAttribute("morphTarget"+e,a[i]),s&&c.getAttribute("morphNormal"+e)!==s[i]&&c.setAttribute("morphNormal"+e,s[i]),r[e]=n,l+=n):(a&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),s&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),r[e]=0)}let d=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",d),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function iX(e,t,i,n){let r=new WeakMap;function a(e){let t=e.target;t.removeEventListener("dispose",a),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(s){let o=n.render.frame,l=s.geometry,c=t.get(s,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),r.get(s)!==o&&(i.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&i.update(s.instanceColor,e.ARRAY_BUFFER),r.set(s,o))),s.isSkinnedMesh){let e=s.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}class iY extends Z{constructor(e,t,i,n,r,a,s,o,l,c){if(1026!==(c=void 0!==c?c:1026)&&1027!==c)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&1026===c&&(i=1014),void 0===i&&1027===c&&(i=1020),super(null,n,r,a,s,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==o?o:1003,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}let iK=new Z,iQ=new iY(1,1);iQ.compareFunction=515;let iJ=new ei,iZ=new en,i$=new t7,i0=[],i1=[],i2=new Float32Array(16),i3=new Float32Array(9),i4=new Float32Array(4);function i5(e,t,i){let n=e[0];if(n<=0||n>0)return e;let r=t*i,a=i0[r];if(void 0===a&&(a=new Float32Array(r),i0[r]=a),0!==t){n.toArray(a,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(a,r)}return a}function i6(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function i8(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function i9(e,t){let i=i1[t];void 0===i&&(i=new Int32Array(t),i1[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function i7(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function ne(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(i6(i,t))return;e.uniform2fv(this.addr,t),i8(i,t)}}function nt(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(i6(i,t))return;e.uniform3fv(this.addr,t),i8(i,t)}}function ni(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(i6(i,t))return;e.uniform4fv(this.addr,t),i8(i,t)}}function nn(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(i6(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),i8(i,t)}else{if(i6(i,n))return;i4.set(n),e.uniformMatrix2fv(this.addr,!1,i4),i8(i,n)}}function nr(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(i6(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),i8(i,t)}else{if(i6(i,n))return;i3.set(n),e.uniformMatrix3fv(this.addr,!1,i3),i8(i,n)}}function na(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(i6(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),i8(i,t)}else{if(i6(i,n))return;i2.set(n),e.uniformMatrix4fv(this.addr,!1,i2),i8(i,n)}}function ns(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function no(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(i6(i,t))return;e.uniform2iv(this.addr,t),i8(i,t)}}function nl(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(i6(i,t))return;e.uniform3iv(this.addr,t),i8(i,t)}}function nc(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(i6(i,t))return;e.uniform4iv(this.addr,t),i8(i,t)}}function nh(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function nu(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(i6(i,t))return;e.uniform2uiv(this.addr,t),i8(i,t)}}function nd(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(i6(i,t))return;e.uniform3uiv(this.addr,t),i8(i,t)}}function np(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(i6(i,t))return;e.uniform4uiv(this.addr,t),i8(i,t)}}function nf(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r);let a=this.type===e.SAMPLER_2D_SHADOW?iQ:iK;i.setTexture2D(t||a,r)}function nm(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||iZ,r)}function ng(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||i$,r)}function nv(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||iJ,r)}function ny(e,t){e.uniform1fv(this.addr,t)}function nx(e,t){let i=i5(t,this.size,2);e.uniform2fv(this.addr,i)}function n_(e,t){let i=i5(t,this.size,3);e.uniform3fv(this.addr,i)}function nA(e,t){let i=i5(t,this.size,4);e.uniform4fv(this.addr,i)}function nb(e,t){let i=i5(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function nS(e,t){let i=i5(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function nw(e,t){let i=i5(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function nM(e,t){e.uniform1iv(this.addr,t)}function nE(e,t){e.uniform2iv(this.addr,t)}function nC(e,t){e.uniform3iv(this.addr,t)}function nT(e,t){e.uniform4iv(this.addr,t)}function nR(e,t){e.uniform1uiv(this.addr,t)}function nP(e,t){e.uniform2uiv(this.addr,t)}function nI(e,t){e.uniform3uiv(this.addr,t)}function nL(e,t){e.uniform4uiv(this.addr,t)}function nD(e,t,i){let n=this.cache,r=t.length,a=i9(i,r);i6(n,a)||(e.uniform1iv(this.addr,a),i8(n,a));for(let e=0;e!==r;++e)i.setTexture2D(t[e]||iK,a[e])}function nB(e,t,i){let n=this.cache,r=t.length,a=i9(i,r);i6(n,a)||(e.uniform1iv(this.addr,a),i8(n,a));for(let e=0;e!==r;++e)i.setTexture3D(t[e]||iZ,a[e])}function nO(e,t,i){let n=this.cache,r=t.length,a=i9(i,r);i6(n,a)||(e.uniform1iv(this.addr,a),i8(n,a));for(let e=0;e!==r;++e)i.setTextureCube(t[e]||i$,a[e])}function nN(e,t,i){let n=this.cache,r=t.length,a=i9(i,r);i6(n,a)||(e.uniform1iv(this.addr,a),i8(n,a));for(let e=0;e!==r;++e)i.setTexture2DArray(t[e]||iJ,a[e])}class nU{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return i7;case 35664:return ne;case 35665:return nt;case 35666:return ni;case 35674:return nn;case 35675:return nr;case 35676:return na;case 5124:case 35670:return ns;case 35667:case 35671:return no;case 35668:case 35672:return nl;case 35669:case 35673:return nc;case 5125:return nh;case 36294:return nu;case 36295:return nd;case 36296:return np;case 35678:case 36198:case 36298:case 36306:case 35682:return nf;case 35679:case 36299:case 36307:return nm;case 35680:case 36300:case 36308:case 36293:return ng;case 36289:case 36303:case 36311:case 36292:return nv}}(t.type)}}class nF{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ny;case 35664:return nx;case 35665:return n_;case 35666:return nA;case 35674:return nb;case 35675:return nS;case 35676:return nw;case 5124:case 35670:return nM;case 35667:case 35671:return nE;case 35668:case 35672:return nC;case 35669:case 35673:return nT;case 5125:return nR;case 36294:return nP;case 36295:return nI;case 36296:return nL;case 35678:case 36198:case 36298:case 36306:case 35682:return nD;case 35679:case 36299:case 36307:return nB;case 35680:case 36300:case 36308:case 36293:return nO;case 36289:case 36303:case 36311:case 36292:return nN}}(t.type)}}class nk{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let n=this.seq;for(let r=0,a=n.length;r!==a;++r){let a=n[r];a.setValue(e,t[a.id],i)}}}let nz=/(\w+)(\])?(\[|\.)?/g;function nH(e,t){e.seq.push(t),e.map[t.id]=t}class nV{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){let i=e.getActiveUniform(t,n),r=e.getUniformLocation(t,i.name);!function(e,t,i){let n=e.name,r=n.length;for(nz.lastIndex=0;;){let a=nz.exec(n),s=nz.lastIndex,o=a[1],l="]"===a[2],c=a[3];if(l&&(o|=0),void 0===c||"["===c&&s+2===r){nH(i,void 0===c?new nU(o,e,t):new nF(o,e,t));break}{let e=i.map[o];void 0===e&&nH(i,e=new nk(o)),i=e}}}(i,r,this)}}setValue(e,t,i,n){let r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){let n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,a=t.length;r!==a;++r){let a=t[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}}static seqWithValue(e,t){let i=[];for(let n=0,r=e.length;n!==r;++n){let r=e[n];r.id in t&&i.push(r)}return i}}function nG(e,t,i){let n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}let nW=0;function nj(e,t,i){let n=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";let a=/ERROR: 0:(\d+)/.exec(r);if(!a)return r;{let n=parseInt(a[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){let i=e.split("\n"),n=[],r=Math.max(t-6,0),a=Math.min(t+6,i.length);for(let e=r;e<a;e++){let r=e+1;n.push(`${r===t?">":" "} ${r}: ${i[e]}`)}return n.join("\n")}(e.getShaderSource(t),n)}}function nq(e){return""!==e}function nX(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function nY(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}let nK=/^[ \t]*#include +<([\w\d./]+)>/gm;function nQ(e){return e.replace(nK,nZ)}let nJ=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function nZ(e,t){let i=id[t];if(void 0===i){let e=nJ.get(t);if(void 0!==e)i=id[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e);else throw Error("Can not resolve #include <"+t+">")}return nQ(i)}let n$=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function n0(e){return e.replace(n$,n1)}function n1(e,t,i,n){let r="";for(let e=parseInt(t);e<parseInt(i);e++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function n2(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function n3(e,t,i,n){let r,a,s,o,l,p;let f=e.getContext(),v=i.defines,y=i.vertexShader,x=i.fragmentShader,_=(l="SHADOWMAP_TYPE_BASIC",1===i.shadowMapType?l="SHADOWMAP_TYPE_PCF":2===i.shadowMapType?l="SHADOWMAP_TYPE_PCF_SOFT":3===i.shadowMapType&&(l="SHADOWMAP_TYPE_VSM"),l),A=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),b=(p="ENVMAP_MODE_REFLECTION",i.envMap&&302===i.envMapMode&&(p="ENVMAP_MODE_REFRACTION"),p),S=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),w=function(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let i=Math.log2(t)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:1/t,maxMip:i}}(i),M=i.isWebGL2?"":[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||"physical"===i.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(nq).join("\n"),E=[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(nq).join("\n"),C=function(e){let t=[];for(let i in e){let n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(v),T=f.createProgram(),R=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((r=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,C].filter(nq).join("\n")).length>0&&(r+="\n"),(a=[M,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,C].filter(nq).join("\n")).length>0&&(a+="\n")):(r=[n2(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,C,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+b:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+_:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(nq).join("\n"),a=[M,n2(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,C,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+A:"",i.envMap?"#define "+b:"",i.envMap?"#define "+S:"",w?"#define CUBEUV_TEXEL_WIDTH "+w.texelWidth:"",w?"#define CUBEUV_TEXEL_HEIGHT "+w.texelHeight:"",w?"#define CUBEUV_MAX_MIP "+w.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+_:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?id.tonemapping_pars_fragment:"",0!==i.toneMapping?function(e,t){let i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 6:i="AgX";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",id.colorspace_pars_fragment,function(e,t){let i=function(e){let t;let i=W.getPrimaries(W.workingColorSpace),n=W.getPrimaries(e);switch(i===n?t="":"p3"===i&&n===m?t="LinearDisplayP3ToLinearSRGB":i===m&&"p3"===n&&(t="LinearSRGBToLinearDisplayP3"),e){case h:case d:return[t,"LinearTransferOETF"];case c:case u:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[t,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(nq).join("\n")),y=nY(y=nX(y=nQ(y),i),i),x=nY(x=nX(x=nQ(x),i),i),y=n0(y),x=n0(x),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(R="#version 300 es\n",r=[E,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["precision mediump sampler2DArray;","#define varying in",i.glslVersion===g?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===g?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);let P=R+r+y,I=R+a+x,L=nG(f,f.VERTEX_SHADER,P),D=nG(f,f.FRAGMENT_SHADER,I);function B(t){if(e.debug.checkShaderErrors){let i=f.getProgramInfoLog(T).trim(),n=f.getShaderInfoLog(L).trim(),s=f.getShaderInfoLog(D).trim(),o=!0,l=!0;if(!1===f.getProgramParameter(T,f.LINK_STATUS)){if(o=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(f,T,L,D);else{let e=nj(f,L,"vertex"),t=nj(f,D,"fragment");console.error("THREE.WebGLProgram: Shader Error "+f.getError()+" - VALIDATE_STATUS "+f.getProgramParameter(T,f.VALIDATE_STATUS)+"\n\nProgram Info Log: "+i+"\n"+e+"\n"+t)}}else""!==i?console.warn("THREE.WebGLProgram: Program Info Log:",i):(""===n||""===s)&&(l=!1);l&&(t.diagnostics={runnable:o,programLog:i,vertexShader:{log:n,prefix:r},fragmentShader:{log:s,prefix:a}})}f.deleteShader(L),f.deleteShader(D),s=new nV(f,T),o=function(e,t){let i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){let n=e.getActiveAttrib(t,r),a=n.name,s=1;n.type===e.FLOAT_MAT2&&(s=2),n.type===e.FLOAT_MAT3&&(s=3),n.type===e.FLOAT_MAT4&&(s=4),i[a]={type:n.type,location:e.getAttribLocation(t,a),locationSize:s}}return i}(f,T)}f.attachShader(T,L),f.attachShader(T,D),void 0!==i.index0AttributeName?f.bindAttribLocation(T,0,i.index0AttributeName):!0===i.morphTargets&&f.bindAttribLocation(T,0,"position"),f.linkProgram(T),this.getUniforms=function(){return void 0===s&&B(this),s},this.getAttributes=function(){return void 0===o&&B(this),o};let O=!1===i.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===O&&(O=f.getProgramParameter(T,37297)),O},this.destroy=function(){n.releaseStatesOfProgram(this),f.deleteProgram(T),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=nW++,this.cacheKey=t,this.usedTimes=1,this.program=T,this.vertexShader=L,this.fragmentShader=D,this}let n4=0;class n5{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return!1===a.has(n)&&(a.add(n),n.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(e){for(let t of this.materialCache.get(e))t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return void 0===i&&(i=new n6(e),t.set(e,i)),i}}class n6{constructor(e){this.id=n4++,this.code=e,this.usedTimes=0}}function n8(e,t,i,n,r,a,s){let o=new eq,l=new n5,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,p=r.vertexTextures,m=r.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(a,o,c,y,x){let _,A,b,S;let w=y.fog,M=x.geometry,E=a.isMeshStandardMaterial?y.environment:null,C=(a.isMeshStandardMaterial?i:t).get(a.envMap||E),T=C&&306===C.mapping?C.image.height:null,R=g[a.type];null!==a.precision&&(m=r.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",m,"instead.");let P=M.morphAttributes.position||M.morphAttributes.normal||M.morphAttributes.color,I=void 0!==P?P.length:0,L=0;if(void 0!==M.morphAttributes.position&&(L=1),void 0!==M.morphAttributes.normal&&(L=2),void 0!==M.morphAttributes.color&&(L=3),R){let e=im[R];_=e.vertexShader,A=e.fragmentShader}else _=a.vertexShader,A=a.fragmentShader,l.update(a),b=l.getVertexShaderID(a),S=l.getFragmentShaderID(a);let D=e.getRenderTarget(),B=!0===x.isInstancedMesh,O=!0===x.isBatchedMesh,N=!!a.map,U=!!a.matcap,F=!!C,k=!!a.aoMap,z=!!a.lightMap,H=!!a.bumpMap,V=!!a.normalMap,G=!!a.displacementMap,j=!!a.emissiveMap,q=!!a.metalnessMap,X=!!a.roughnessMap,Y=a.anisotropy>0,K=a.clearcoat>0,Q=a.iridescence>0,J=a.sheen>0,Z=a.transmission>0,$=Y&&!!a.anisotropyMap,ee=K&&!!a.clearcoatMap,et=K&&!!a.clearcoatNormalMap,ei=K&&!!a.clearcoatRoughnessMap,en=Q&&!!a.iridescenceMap,er=Q&&!!a.iridescenceThicknessMap,ea=J&&!!a.sheenColorMap,es=J&&!!a.sheenRoughnessMap,eo=!!a.specularMap,el=!!a.specularColorMap,ec=!!a.specularIntensityMap,eh=Z&&!!a.transmissionMap,eu=Z&&!!a.thicknessMap,ed=!!a.gradientMap,ep=!!a.alphaMap,ef=a.alphaTest>0,em=!!a.alphaHash,eg=!!a.extensions,ev=!!M.attributes.uv1,ey=!!M.attributes.uv2,ex=!!M.attributes.uv3,e_=0;return a.toneMapped&&(null===D||!0===D.isXRRenderTarget)&&(e_=e.toneMapping),{isWebGL2:u,shaderID:R,shaderType:a.type,shaderName:a.name,vertexShader:_,fragmentShader:A,defines:a.defines,customVertexShaderID:b,customFragmentShaderID:S,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:m,batching:O,instancing:B,instancingColor:B&&null!==x.instanceColor,supportsVertexTextures:p,outputColorSpace:null===D?e.outputColorSpace:!0===D.isXRRenderTarget?D.texture.colorSpace:h,map:N,matcap:U,envMap:F,envMapMode:F&&C.mapping,envMapCubeUVHeight:T,aoMap:k,lightMap:z,bumpMap:H,normalMap:V,displacementMap:p&&G,emissiveMap:j,normalMapObjectSpace:V&&1===a.normalMapType,normalMapTangentSpace:V&&0===a.normalMapType,metalnessMap:q,roughnessMap:X,anisotropy:Y,anisotropyMap:$,clearcoat:K,clearcoatMap:ee,clearcoatNormalMap:et,clearcoatRoughnessMap:ei,iridescence:Q,iridescenceMap:en,iridescenceThicknessMap:er,sheen:J,sheenColorMap:ea,sheenRoughnessMap:es,specularMap:eo,specularColorMap:el,specularIntensityMap:ec,transmission:Z,transmissionMap:eh,thicknessMap:eu,gradientMap:ed,opaque:!1===a.transparent&&1===a.blending,alphaMap:ep,alphaTest:ef,alphaHash:em,combine:a.combine,mapUv:N&&v(a.map.channel),aoMapUv:k&&v(a.aoMap.channel),lightMapUv:z&&v(a.lightMap.channel),bumpMapUv:H&&v(a.bumpMap.channel),normalMapUv:V&&v(a.normalMap.channel),displacementMapUv:G&&v(a.displacementMap.channel),emissiveMapUv:j&&v(a.emissiveMap.channel),metalnessMapUv:q&&v(a.metalnessMap.channel),roughnessMapUv:X&&v(a.roughnessMap.channel),anisotropyMapUv:$&&v(a.anisotropyMap.channel),clearcoatMapUv:ee&&v(a.clearcoatMap.channel),clearcoatNormalMapUv:et&&v(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ei&&v(a.clearcoatRoughnessMap.channel),iridescenceMapUv:en&&v(a.iridescenceMap.channel),iridescenceThicknessMapUv:er&&v(a.iridescenceThicknessMap.channel),sheenColorMapUv:ea&&v(a.sheenColorMap.channel),sheenRoughnessMapUv:es&&v(a.sheenRoughnessMap.channel),specularMapUv:eo&&v(a.specularMap.channel),specularColorMapUv:el&&v(a.specularColorMap.channel),specularIntensityMapUv:ec&&v(a.specularIntensityMap.channel),transmissionMapUv:eh&&v(a.transmissionMap.channel),thicknessMapUv:eu&&v(a.thicknessMap.channel),alphaMapUv:ep&&v(a.alphaMap.channel),vertexTangents:!!M.attributes.tangent&&(V||Y),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!M.attributes.color&&4===M.attributes.color.itemSize,vertexUv1s:ev,vertexUv2s:ey,vertexUv3s:ex,pointsUvs:!0===x.isPoints&&!!M.attributes.uv&&(N||ep),fog:!!w,useFog:!0===a.fog,fogExp2:w&&w.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==M.morphAttributes.position,morphNormals:void 0!==M.morphAttributes.normal,morphColors:void 0!==M.morphAttributes.color,morphTargetsCount:I,morphTextureStride:L,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:e_,useLegacyLights:e._useLegacyLights,decodeVideoTexture:N&&!0===a.map.isVideoTexture&&W.getTransfer(a.map.colorSpace)===f,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:eg&&!0===a.extensions.derivatives,extensionFragDepth:eg&&!0===a.extensions.fragDepth,extensionDrawBuffers:eg&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:eg&&!0===a.extensions.shaderTextureLOD,extensionClipCullDistance:eg&&a.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var i,n,r,a;let s=[];if(t.shaderID?s.push(t.shaderID):(s.push(t.customVertexShaderID),s.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)s.push(e),s.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(i=s,n=t,i.push(n.precision),i.push(n.outputColorSpace),i.push(n.envMapMode),i.push(n.envMapCubeUVHeight),i.push(n.mapUv),i.push(n.alphaMapUv),i.push(n.lightMapUv),i.push(n.aoMapUv),i.push(n.bumpMapUv),i.push(n.normalMapUv),i.push(n.displacementMapUv),i.push(n.emissiveMapUv),i.push(n.metalnessMapUv),i.push(n.roughnessMapUv),i.push(n.anisotropyMapUv),i.push(n.clearcoatMapUv),i.push(n.clearcoatNormalMapUv),i.push(n.clearcoatRoughnessMapUv),i.push(n.iridescenceMapUv),i.push(n.iridescenceThicknessMapUv),i.push(n.sheenColorMapUv),i.push(n.sheenRoughnessMapUv),i.push(n.specularMapUv),i.push(n.specularColorMapUv),i.push(n.specularIntensityMapUv),i.push(n.transmissionMapUv),i.push(n.thicknessMapUv),i.push(n.combine),i.push(n.fogExp2),i.push(n.sizeAttenuation),i.push(n.morphTargetsCount),i.push(n.morphAttributeCount),i.push(n.numDirLights),i.push(n.numPointLights),i.push(n.numSpotLights),i.push(n.numSpotLightMaps),i.push(n.numHemiLights),i.push(n.numRectAreaLights),i.push(n.numDirLightShadows),i.push(n.numPointLightShadows),i.push(n.numSpotLightShadows),i.push(n.numSpotLightShadowsWithMaps),i.push(n.numLightProbes),i.push(n.shadowMapType),i.push(n.toneMapping),i.push(n.numClippingPlanes),i.push(n.numClipIntersection),i.push(n.depthPacking),r=s,a=t,o.disableAll(),a.isWebGL2&&o.enable(0),a.supportsVertexTextures&&o.enable(1),a.instancing&&o.enable(2),a.instancingColor&&o.enable(3),a.matcap&&o.enable(4),a.envMap&&o.enable(5),a.normalMapObjectSpace&&o.enable(6),a.normalMapTangentSpace&&o.enable(7),a.clearcoat&&o.enable(8),a.iridescence&&o.enable(9),a.alphaTest&&o.enable(10),a.vertexColors&&o.enable(11),a.vertexAlphas&&o.enable(12),a.vertexUv1s&&o.enable(13),a.vertexUv2s&&o.enable(14),a.vertexUv3s&&o.enable(15),a.vertexTangents&&o.enable(16),a.anisotropy&&o.enable(17),a.alphaHash&&o.enable(18),a.batching&&o.enable(19),r.push(o.mask),o.disableAll(),a.fog&&o.enable(0),a.useFog&&o.enable(1),a.flatShading&&o.enable(2),a.logarithmicDepthBuffer&&o.enable(3),a.skinning&&o.enable(4),a.morphTargets&&o.enable(5),a.morphNormals&&o.enable(6),a.morphColors&&o.enable(7),a.premultipliedAlpha&&o.enable(8),a.shadowMapEnabled&&o.enable(9),a.useLegacyLights&&o.enable(10),a.doubleSided&&o.enable(11),a.flipSided&&o.enable(12),a.useDepthPacking&&o.enable(13),a.dithering&&o.enable(14),a.transmission&&o.enable(15),a.sheen&&o.enable(16),a.opaque&&o.enable(17),a.pointsUvs&&o.enable(18),a.decodeVideoTexture&&o.enable(19),r.push(o.mask),s.push(e.outputColorSpace)),s.push(t.customProgramCacheKey),s.join()},getUniforms:function(e){let t;let i=g[e.type];if(i){let e=im[i];t=t4.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,i){let n;for(let e=0,t=c.length;e<t;e++){let t=c[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new n3(e,i,t,a),c.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){let t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function n9(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function n7(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function re(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function rt(){let e=[],t=0,i=[],n=[],r=[];function a(i,n,r,a,s,o){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:a,renderOrder:i.renderOrder,z:s,group:o},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=a,l.renderOrder=i.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,s,o,l,c){let h=a(e,t,s,o,l,c);s.transmission>0?n.push(h):!0===s.transparent?r.push(h):i.push(h)},unshift:function(e,t,s,o,l,c){let h=a(e,t,s,o,l,c);s.transmission>0?n.unshift(h):!0===s.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=t,n=e.length;i<n;i++){let t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||n7),n.length>1&&n.sort(t||re),r.length>1&&r.sort(t||re)}}}function ri(){let e=new WeakMap;return{get:function(t,i){let n;let r=e.get(t);return void 0===r?(n=new rt,e.set(t,[n])):i>=r.length?(n=new rt,r.push(n)):n=r[i],n},dispose:function(){e=new WeakMap}}}function rn(){let e={};return{get:function(t){let i;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":i={direction:new ea,color:new tp};break;case"SpotLight":i={position:new ea,direction:new ea,color:new tp,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ea,color:new tp,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ea,skyColor:new tp,groundColor:new tp};break;case"RectAreaLight":i={color:new tp,position:new ea,halfWidth:new ea,halfHeight:new ea}}return e[t.id]=i,i}}}let rr=0;function ra(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function rs(e,t){let i=new rn,n=function(){let e={};return{get:function(t){let i;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new P};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new P,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new ea);let a=new ea,s=new eO,o=new eO;return{setup:function(a,s){let o=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,x=0,_=0;a.sort(ra);let A=!0===s?Math.PI:1;for(let e=0,t=a.length;e<t;e++){let t=a[e],s=t.color,b=t.intensity,S=t.distance,w=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=s.r*b*A,l+=s.g*b*A,c+=s.b*b*A;else if(t.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],b);_++}else if(t.isDirectionalLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=w,r.directionalShadowMatrix[h]=t.shadow.matrix,m++}r.directional[h]=e,h++}else if(t.isSpotLight){let e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(b*A),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;let a=t.shadow;if(t.map&&(r.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&x++),r.spotLightMatrix[d]=a.matrix,t.castShadow){let e=n.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=w,v++}d++}else if(t.isRectAreaLight){let e=i.get(t);e.color.copy(s).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=w,r.pointShadowMatrix[u]=t.shadow.matrix,g++}r.point[u]=e,u++}else if(t.isHemisphereLight){let e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(b*A),e.groundColor.copy(t.groundColor).multiplyScalar(b*A),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2?!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ip.LTC_FLOAT_1,r.rectAreaLTC2=ip.LTC_FLOAT_2):(r.rectAreaLTC1=ip.LTC_HALF_1,r.rectAreaLTC2=ip.LTC_HALF_2):!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ip.LTC_FLOAT_1,r.rectAreaLTC2=ip.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=ip.LTC_HALF_1,r.rectAreaLTC2=ip.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;let b=r.hash;(b.directionalLength!==h||b.pointLength!==u||b.spotLength!==d||b.rectAreaLength!==p||b.hemiLength!==f||b.numDirectionalShadows!==m||b.numPointShadows!==g||b.numSpotShadows!==v||b.numSpotMaps!==y||b.numLightProbes!==_)&&(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-x,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=x,r.numLightProbes=_,b.directionalLength=h,b.pointLength=u,b.spotLength=d,b.rectAreaLength=p,b.hemiLength=f,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=v,b.numSpotMaps=y,b.numLightProbes=_,r.version=rr++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0,u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){let d=e[t];if(d.isDirectionalLight){let e=r.directional[i];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),i++}else if(d.isSpotLight){let e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){let e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),o.identity(),s.copy(d.matrixWorld),s.premultiply(u),o.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){let e=r.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){let e=r.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),h++}}},state:r}}function ro(e,t){let i=new rs(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function rl(e,t){let i=new WeakMap;return{get:function(n,r=0){let a;let s=i.get(n);return void 0===s?(a=new ro(e,t),i.set(n,[a])):r>=s.length?(a=new ro(e,t),s.push(a)):a=s[r],a},dispose:function(){i=new WeakMap}}}class rc extends tg{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class rh extends tg{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function ru(e,t,i){let n=new il,r=new P,a=new P,s=new $,o=new rc({depthPacking:3201}),l=new rh,c={},h=i.maxTextureSize,u={0:1,1:0,2:2},d=new t5({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new P},radius:{value:4}},vertexShader:"void main() {\n	gl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new tB;f.setAttribute("position",new tS(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new tZ(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let v=this.type;function y(t,i,n,r){let a=null,s=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===n.isPointLight?l:o,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){let e=a.uuid,t=i.uuid,n=c[e];void 0===n&&(n={},c[e]=n);let r=n[t];void 0===r&&(r=a.clone(),n[t]=r,i.addEventListener("dispose",x)),a=r}return a.visible=i.visible,a.wireframe=i.wireframe,3===r?a.side=null!==i.shadowSide?i.shadowSide:i.side:a.side=null!==i.shadowSide?i.shadowSide:u[i.side],a.alphaMap=i.alphaMap,a.alphaTest=i.alphaTest,a.map=i.map,a.clipShadows=i.clipShadows,a.clippingPlanes=i.clippingPlanes,a.clipIntersection=i.clipIntersection,a.displacementMap=i.displacementMap,a.displacementScale=i.displacementScale,a.displacementBias=i.displacementBias,a.wireframeLinewidth=i.wireframeLinewidth,a.linewidth=i.linewidth,!0===n.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=n),a}function x(e){for(let t in e.target.removeEventListener("dispose",x),c){let i=c[t],n=e.target.uuid;n in i&&(i[n].dispose(),delete i[n])}}this.render=function(i,o,l){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===i.length)return;let c=e.getRenderTarget(),u=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),x=e.state;x.setBlending(0),x.buffers.color.setClear(1,1,1,1),x.buffers.depth.setTest(!0),x.setScissorTest(!1);let _=3!==v&&3===this.type,A=3===v&&3!==this.type;for(let c=0,u=i.length;c<u;c++){let u=i[c],f=u.shadow;if(void 0===f){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===f.autoUpdate&&!1===f.needsUpdate)continue;r.copy(f.mapSize);let g=f.getFrameExtents();if(r.multiply(g),a.copy(f.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(a.x=Math.floor(h/g.x),r.x=a.x*g.x,f.mapSize.x=a.x),r.y>h&&(a.y=Math.floor(h/g.y),r.y=a.y*g.y,f.mapSize.y=a.y)),null===f.map||!0===_||!0===A){let e=3!==this.type?{minFilter:1003,magFilter:1003}:{};null!==f.map&&f.map.dispose(),f.map=new et(r.x,r.y,e),f.map.texture.name=u.name+".shadowMap",f.camera.updateProjectionMatrix()}e.setRenderTarget(f.map),e.clear();let v=f.getViewportCount();for(let i=0;i<v;i++){let r=f.getViewport(i);s.set(a.x*r.x,a.y*r.y,a.x*r.z,a.y*r.w),x.viewport(s),f.updateMatrices(u,i),n=f.getFrustum(),function i(r,a,s,o,l){if(!1===r.visible)return;if(r.layers.test(a.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&3===l)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,r.matrixWorld);let i=t.update(r),n=r.material;if(Array.isArray(n)){let t=i.groups;for(let c=0,h=t.length;c<h;c++){let h=t[c],u=n[h.materialIndex];if(u&&u.visible){let t=y(r,u,o,l);r.onBeforeShadow(e,r,a,s,i,t,h),e.renderBufferDirect(s,null,i,t,r,h),r.onAfterShadow(e,r,a,s,i,t,h)}}}else if(n.visible){let t=y(r,n,o,l);r.onBeforeShadow(e,r,a,s,i,t,null),e.renderBufferDirect(s,null,i,t,r,null),r.onAfterShadow(e,r,a,s,i,t,null)}}let c=r.children;for(let e=0,t=c.length;e<t;e++)i(c[e],a,s,o,l)}(o,l,f.camera,u,this.type)}!0!==f.isPointLightShadow&&3===this.type&&function(i,n){let a=t.update(m);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new et(r.x,r.y)),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,a,d,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,a,p,m,null)}(f,l),f.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(c,u,f)}}function rd(e,t,i){let n=i.isWebGL2,r=new function(){let t=!1,i=new $,n=null,r=new $(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,a,s,o){!0===o&&(t*=s,n*=s,a*=s),i.set(t,n,a,s),!1===r.equals(i)&&(e.clearColor(t,n,a,s),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(t){t?V(e.DEPTH_TEST):G(e.DEPTH_TEST)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},s=new function(){let t=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(i){t||(i?V(e.STENCIL_TEST):G(e.STENCIL_TEST))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,s){(n!==t||r!==i||a!==s)&&(e.stencilFunc(t,i,s),n=t,r=i,a=s)},setOp:function(t,i,n){(s!==t||o!==i||l!==n)&&(e.stencilOp(t,i,n),s=t,o=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,c=null}}},o=new WeakMap,l=new WeakMap,c={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,x=null,_=null,A=null,b=new tp(0,0,0),S=0,w=!1,M=null,E=null,C=null,T=null,R=null,P=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),I=!1,L=0,D=e.getParameter(e.VERSION);-1!==D.indexOf("WebGL")?I=parseFloat(/^WebGL (\d)/.exec(D)[1])>=1:-1!==D.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(D)[1])>=2);let B=null,O={},N=e.getParameter(e.SCISSOR_BOX),U=e.getParameter(e.VIEWPORT),F=new $().fromArray(N),k=new $().fromArray(U);function z(t,i,r,a){let s=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<r;o++)n&&(t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY)?e.texImage3D(i,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(i+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return o}let H={};function V(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function G(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}H[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),H[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(H[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),H[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),a.setClear(1),s.setClear(0),V(e.DEPTH_TEST),a.setFunc(3),X(!1),Y(1),V(e.CULL_FACE),q(0);let W={100:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(n)W[103]=e.MIN,W[104]=e.MAX;else{let e=t.get("EXT_blend_minmax");null!==e&&(W[103]=e.MIN_EXT,W[104]=e.MAX_EXT)}let j={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,204:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,205:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA,211:e.CONSTANT_COLOR,212:e.ONE_MINUS_CONSTANT_COLOR,213:e.CONSTANT_ALPHA,214:e.ONE_MINUS_CONSTANT_ALPHA};function q(t,i,n,r,a,s,o,l,c,h){if(0===t){!0===f&&(G(e.BLEND),f=!1);return}if(!1===f&&(V(e.BLEND),f=!0),5!==t){if(t!==m||h!==w){if((100!==g||100!==x)&&(e.blendEquation(e.FUNC_ADD),g=100,x=100),h)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,_=null,A=null,b.set(0,0,0),S=0,m=t,w=h}return}a=a||i,s=s||n,o=o||r,(i!==g||a!==x)&&(e.blendEquationSeparate(W[i],W[a]),g=i,x=a),(n!==v||r!==y||s!==_||o!==A)&&(e.blendFuncSeparate(j[n],j[r],j[s],j[o]),v=n,y=r,_=s,A=o),(!1===l.equals(b)||c!==S)&&(e.blendColor(l.r,l.g,l.b,c),b.copy(l),S=c),m=t,w=!1}function X(t){M!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),M=t)}function Y(t){0!==t?(V(e.CULL_FACE),t!==E&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):G(e.CULL_FACE),E=t}function K(t,i,n){t?(V(e.POLYGON_OFFSET_FILL),(T!==i||R!==n)&&(e.polygonOffset(i,n),T=i,R=n)):G(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:a,stencil:s},enable:V,disable:G,bindFramebuffer:function(t,i){return h[t]!==i&&(e.bindFramebuffer(t,i),h[t]=i,n&&(t===e.DRAW_FRAMEBUFFER&&(h[e.FRAMEBUFFER]=i),t===e.FRAMEBUFFER&&(h[e.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,r){let a=d,s=!1;if(n){if(void 0===(a=u.get(r))&&(a=[],u.set(r,a)),n.isWebGLMultipleRenderTargets){let t=n.texture;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let i=0,n=t.length;i<n;i++)a[i]=e.COLOR_ATTACHMENT0+i;a.length=t.length,s=!0}}else a[0]!==e.COLOR_ATTACHMENT0&&(a[0]=e.COLOR_ATTACHMENT0,s=!0)}else a[0]!==e.BACK&&(a[0]=e.BACK,s=!0);s&&(i.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:q,setMaterial:function(t,i){2===t.side?G(e.CULL_FACE):V(e.CULL_FACE);let n=1===t.side;i&&(n=!n),X(n),1===t.blending&&!1===t.transparent?q(0):q(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),r.setMask(t.colorWrite);let o=t.stencilWrite;s.setTest(o),o&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),K(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?V(e.SAMPLE_ALPHA_TO_COVERAGE):G(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:X,setCullFace:Y,setLineWidth:function(t){t!==C&&(I&&e.lineWidth(t),C=t)},setPolygonOffset:K,setScissorTest:function(t){t?V(e.SCISSOR_TEST):G(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+P-1),B!==t&&(e.activeTexture(t),B=t)},bindTexture:function(t,i,n){void 0===n&&(n=null===B?e.TEXTURE0+P-1:B);let r=O[n];void 0===r&&(r={type:void 0,texture:void 0},O[n]=r),(r.type!==t||r.texture!==i)&&(B!==n&&(e.activeTexture(n),B=n),e.bindTexture(t,i||H[t]),r.type=t,r.texture=i)},unbindTexture:function(){let t=O[B];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,i){let n=l.get(i);void 0===n&&(n=new WeakMap,l.set(i,n));let r=n.get(t);void 0===r&&(r=e.getUniformBlockIndex(i,t.name),n.set(t,r))},uniformBlockBinding:function(t,i){let n=l.get(i).get(t);o.get(i)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),o.set(i,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===F.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),F.copy(t))},viewport:function(t){!1===k.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),k.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(0xffffffff),e.stencilFunc(e.ALWAYS,0,0xffffffff),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===n&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},B=null,O={},h={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,x=null,_=null,A=null,b=new tp(0,0,0),S=0,w=!1,M=null,E=null,C=null,T=null,R=null,F.set(0,0,e.canvas.width,e.canvas.height),k.set(0,0,e.canvas.width,e.canvas.height),r.reset(),a.reset(),s.reset()}}}function rp(e,t,i,n,r,a,s){let o;let l=r.isWebGL2,c=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,u="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),d=new WeakMap,m=new WeakMap,g=!1;try{g="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return g?new OffscreenCanvas(e,t):N("canvas")}function y(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let n=t?C:Math.floor,a=n(r*e.width),s=n(r*e.height);void 0===o&&(o=v(a,s));let l=i?v(a,s):o;return l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),l}"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}function x(e){return E(e.width)&&E(e.height)}function _(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function A(t){e.generateMipmap(t)}function b(i,n,r,a,s=!1){if(!1===l)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;if(n===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),n===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.R8UI),r===e.UNSIGNED_SHORT&&(o=e.R16UI),r===e.UNSIGNED_INT&&(o=e.R32UI),r===e.BYTE&&(o=e.R8I),r===e.SHORT&&(o=e.R16I),r===e.INT&&(o=e.R32I)),n===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),n===e.RGBA){let t=s?p:W.getTransfer(a);r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=t===f?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return(o===e.R16F||o===e.R32F||o===e.RG16F||o===e.RG32F||o===e.RGBA16F||o===e.RGBA32F)&&t.get("EXT_color_buffer_float"),o}function S(e,t,i){return!0===_(e,i)||e.isFramebufferTexture&&1003!==e.minFilter&&1006!==e.minFilter?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function w(t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function M(e){let t=e.target;t.removeEventListener("dispose",M),function(e){let t=n.get(e);if(void 0===t.__webglInit)return;let i=e.source,r=m.get(i);if(r){let n=r[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&R(e),0===Object.keys(r).length&&m.delete(i)}n.remove(e)}(t),t.isVideoTexture&&d.delete(t)}function T(t){let i=t.target;i.removeEventListener("dispose",T),function(t){let i=t.texture,r=n.get(t),a=n.get(i);if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(r.__webglFramebuffer[t]))for(let i=0;i<r.__webglFramebuffer[t].length;i++)e.deleteFramebuffer(r.__webglFramebuffer[t][i]);else e.deleteFramebuffer(r.__webglFramebuffer[t]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=i.length;t<r;t++){let r=n.get(i[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),s.memory.textures--),n.remove(i[t])}n.remove(i),n.remove(t)}(i)}function R(t){let i=n.get(t);e.deleteTexture(i.__webglTexture);let r=t.source,a=m.get(r);delete a[i.__cacheKey],s.memory.textures--}let P=0;function I(t,r){let a=n.get(t);if(t.isVideoTexture&&function(e){let t=s.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){let e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{F(a,t,r);return}}i.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+r)}let L={1e3:e.REPEAT,1001:e.CLAMP_TO_EDGE,1002:e.MIRRORED_REPEAT},D={1003:e.NEAREST,1004:e.NEAREST_MIPMAP_NEAREST,1005:e.NEAREST_MIPMAP_LINEAR,1006:e.LINEAR,1007:e.LINEAR_MIPMAP_NEAREST,1008:e.LINEAR_MIPMAP_LINEAR},B={512:e.NEVER,519:e.ALWAYS,513:e.LESS,515:e.LEQUAL,514:e.EQUAL,518:e.GEQUAL,516:e.GREATER,517:e.NOTEQUAL};function O(i,a,s){if(s?(e.texParameteri(i,e.TEXTURE_WRAP_S,L[a.wrapS]),e.texParameteri(i,e.TEXTURE_WRAP_T,L[a.wrapT]),(i===e.TEXTURE_3D||i===e.TEXTURE_2D_ARRAY)&&e.texParameteri(i,e.TEXTURE_WRAP_R,L[a.wrapR]),e.texParameteri(i,e.TEXTURE_MAG_FILTER,D[a.magFilter]),e.texParameteri(i,e.TEXTURE_MIN_FILTER,D[a.minFilter])):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(i===e.TEXTURE_3D||i===e.TEXTURE_2D_ARRAY)&&e.texParameteri(i,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),(1001!==a.wrapS||1001!==a.wrapT)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,e.TEXTURE_MAG_FILTER,w(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,w(a.minFilter)),1003!==a.minFilter&&1006!==a.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(i,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(i,e.TEXTURE_COMPARE_FUNC,B[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){let s=t.get("EXT_texture_filter_anisotropic");1003!==a.magFilter&&(1005===a.minFilter||1008===a.minFilter)&&(1015!==a.type||!1!==t.has("OES_texture_float_linear"))&&(!1!==l||1016!==a.type||!1!==t.has("OES_texture_half_float_linear"))&&(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function U(t,i){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",M));let r=i.source,a=m.get(r);void 0===a&&(a={},m.set(r,a));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(i);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,n=!0),a[o].usedTimes++;let r=a[t.__cacheKey];void 0!==r&&(a[t.__cacheKey].usedTimes--,0===r.usedTimes&&R(i)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return n}function F(t,s,o){let c=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(c=e.TEXTURE_3D);let h=U(t,s),u=s.source;i.bindTexture(c,t.__webglTexture,e.TEXTURE0+o);let d=n.get(u);if(u.version!==d.__version||!0===h){let t;i.activeTexture(e.TEXTURE0+o);let n=W.getPrimaries(W.workingColorSpace),p=""===s.colorSpace?null:W.getPrimaries(s.colorSpace),f=""===s.colorSpace||n===p?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);let m=!l&&(1001!==s.wrapS||1001!==s.wrapT||1003!==s.minFilter&&1006!==s.minFilter)&&!1===x(s.image),g=y(s.image,m,!1,r.maxTextureSize),v=x(g=j(s,g))||l,w=a.convert(s.format,s.colorSpace),M=a.convert(s.type),E=b(s.internalFormat,w,M,s.colorSpace,s.isVideoTexture);O(c,s,v);let C=s.mipmaps,T=l&&!0!==s.isVideoTexture&&36196!==E,R=void 0===d.__version||!0===h,P=S(s,g,v);if(s.isDepthTexture)E=e.DEPTH_COMPONENT,l?E=1015===s.type?e.DEPTH_COMPONENT32F:1014===s.type?e.DEPTH_COMPONENT24:1020===s.type?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:1015===s.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===s.format&&E===e.DEPTH_COMPONENT&&1012!==s.type&&1014!==s.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=1014,M=a.convert(s.type)),1027===s.format&&E===e.DEPTH_COMPONENT&&(E=e.DEPTH_STENCIL,1020!==s.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=1020,M=a.convert(s.type))),R&&(T?i.texStorage2D(e.TEXTURE_2D,1,E,g.width,g.height):i.texImage2D(e.TEXTURE_2D,0,E,g.width,g.height,0,w,M,null));else if(s.isDataTexture){if(C.length>0&&v){T&&R&&i.texStorage2D(e.TEXTURE_2D,P,E,C[0].width,C[0].height);for(let n=0,r=C.length;n<r;n++)t=C[n],T?i.texSubImage2D(e.TEXTURE_2D,n,0,0,t.width,t.height,w,M,t.data):i.texImage2D(e.TEXTURE_2D,n,E,t.width,t.height,0,w,M,t.data);s.generateMipmaps=!1}else T?(R&&i.texStorage2D(e.TEXTURE_2D,P,E,g.width,g.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,g.width,g.height,w,M,g.data)):i.texImage2D(e.TEXTURE_2D,0,E,g.width,g.height,0,w,M,g.data)}else if(s.isCompressedTexture){if(s.isCompressedArrayTexture){T&&R&&i.texStorage3D(e.TEXTURE_2D_ARRAY,P,E,C[0].width,C[0].height,g.depth);for(let n=0,r=C.length;n<r;n++)t=C[n],1023!==s.format?null!==w?T?i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,n,0,0,0,t.width,t.height,g.depth,w,t.data,0,0):i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,n,E,t.width,t.height,g.depth,0,t.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?i.texSubImage3D(e.TEXTURE_2D_ARRAY,n,0,0,0,t.width,t.height,g.depth,w,M,t.data):i.texImage3D(e.TEXTURE_2D_ARRAY,n,E,t.width,t.height,g.depth,0,w,M,t.data)}else{T&&R&&i.texStorage2D(e.TEXTURE_2D,P,E,C[0].width,C[0].height);for(let n=0,r=C.length;n<r;n++)t=C[n],1023!==s.format?null!==w?T?i.compressedTexSubImage2D(e.TEXTURE_2D,n,0,0,t.width,t.height,w,t.data):i.compressedTexImage2D(e.TEXTURE_2D,n,E,t.width,t.height,0,t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?i.texSubImage2D(e.TEXTURE_2D,n,0,0,t.width,t.height,w,M,t.data):i.texImage2D(e.TEXTURE_2D,n,E,t.width,t.height,0,w,M,t.data)}}else if(s.isDataArrayTexture)T?(R&&i.texStorage3D(e.TEXTURE_2D_ARRAY,P,E,g.width,g.height,g.depth),i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,g.width,g.height,g.depth,w,M,g.data)):i.texImage3D(e.TEXTURE_2D_ARRAY,0,E,g.width,g.height,g.depth,0,w,M,g.data);else if(s.isData3DTexture)T?(R&&i.texStorage3D(e.TEXTURE_3D,P,E,g.width,g.height,g.depth),i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,g.width,g.height,g.depth,w,M,g.data)):i.texImage3D(e.TEXTURE_3D,0,E,g.width,g.height,g.depth,0,w,M,g.data);else if(s.isFramebufferTexture){if(R){if(T)i.texStorage2D(e.TEXTURE_2D,P,E,g.width,g.height);else{let t=g.width,n=g.height;for(let r=0;r<P;r++)i.texImage2D(e.TEXTURE_2D,r,E,t,n,0,w,M,null),t>>=1,n>>=1}}}else if(C.length>0&&v){T&&R&&i.texStorage2D(e.TEXTURE_2D,P,E,C[0].width,C[0].height);for(let n=0,r=C.length;n<r;n++)t=C[n],T?i.texSubImage2D(e.TEXTURE_2D,n,0,0,w,M,t):i.texImage2D(e.TEXTURE_2D,n,E,w,M,t);s.generateMipmaps=!1}else T?(R&&i.texStorage2D(e.TEXTURE_2D,P,E,g.width,g.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,w,M,g)):i.texImage2D(e.TEXTURE_2D,0,E,w,M,g);_(s,v)&&A(c),d.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function k(t,r,s,o,l,h){let u=a.convert(s.format,s.colorSpace),d=a.convert(s.type),p=b(s.internalFormat,u,d,s.colorSpace);if(!n.get(r).__hasExternalTextures){let t=Math.max(1,r.width>>h),n=Math.max(1,r.height>>h);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?i.texImage3D(l,h,p,t,n,r.depth,0,u,d,null):i.texImage2D(l,h,p,t,n,0,u,d,null)}i.bindFramebuffer(e.FRAMEBUFFER,t),G(r)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,n.get(s).__webglTexture,0,V(r)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,n.get(s).__webglTexture,h),i.bindFramebuffer(e.FRAMEBUFFER,null)}function z(t,i,n){if(e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer){let r=!0===l?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(n||G(i)){let t=i.depthTexture;t&&t.isDepthTexture&&(1015===t.type?r=e.DEPTH_COMPONENT32F:1014===t.type&&(r=e.DEPTH_COMPONENT24));let n=V(i);G(i)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,n,r,i.width,i.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,n,r,i.width,i.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,i.width,i.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(i.depthBuffer&&i.stencilBuffer){let r=V(i);n&&!1===G(i)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,i.width,i.height):G(i)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{let t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<t.length;r++){let s=t[r],o=a.convert(s.format,s.colorSpace),l=a.convert(s.type),h=b(s.internalFormat,o,l,s.colorSpace),u=V(i);n&&!1===G(i)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,h,i.width,i.height):G(i)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,h,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,h,i.width,i.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function H(t){let r=n.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,t),!(r.depthTexture&&r.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),I(r.depthTexture,0);let a=n.get(r.depthTexture).__webglTexture,s=V(r);if(1026===r.depthTexture.format)G(r)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else if(1027===r.depthTexture.format)G(r)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0);else throw Error("Unknown depthTexture format")}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),z(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),z(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(e.FRAMEBUFFER,null)}function V(e){return Math.min(r.maxSamples,e.samples)}function G(e){let i=n.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function j(e,i){let n=e.colorSpace,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||1035===e.format||n!==h&&""!==n&&(W.getTransfer(n)===f?!1===l?!0===t.has("EXT_sRGB")&&1023===r?(e.format=1035,e.minFilter=1006,e.generateMipmaps=!1):i=X.sRGBToLinear(i):(1023!==r||1009!==a)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),i}this.allocateTextureUnit=function(){let e=P;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),P+=1,e},this.resetTextureUnits=function(){P=0},this.setTexture2D=I,this.setTexture2DArray=function(t,r){let a=n.get(t);if(t.version>0&&a.__version!==t.version){F(a,t,r);return}i.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){let a=n.get(t);if(t.version>0&&a.__version!==t.version){F(a,t,r);return}i.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,s){let o=n.get(t);if(t.version>0&&o.__version!==t.version){(function(t,s,o){if(6!==s.image.length)return;let c=U(t,s),h=s.source;i.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);let u=n.get(h);if(h.version!==u.__version||!0===c){let t;i.activeTexture(e.TEXTURE0+o);let n=W.getPrimaries(W.workingColorSpace),d=""===s.colorSpace?null:W.getPrimaries(s.colorSpace),p=""===s.colorSpace||n===d?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);let f=s.isCompressedTexture||s.image[0].isCompressedTexture,m=s.image[0]&&s.image[0].isDataTexture,g=[];for(let e=0;e<6;e++)f||m?g[e]=m?s.image[e].image:s.image[e]:g[e]=y(s.image[e],!1,!0,r.maxCubemapSize),g[e]=j(s,g[e]);let v=g[0],w=x(v)||l,M=a.convert(s.format,s.colorSpace),E=a.convert(s.type),C=b(s.internalFormat,M,E,s.colorSpace),T=l&&!0!==s.isVideoTexture,R=void 0===u.__version||!0===c,P=S(s,v,w);if(O(e.TEXTURE_CUBE_MAP,s,w),f){T&&R&&i.texStorage2D(e.TEXTURE_CUBE_MAP,P,C,v.width,v.height);for(let n=0;n<6;n++){t=g[n].mipmaps;for(let r=0;r<t.length;r++){let a=t[r];1023!==s.format?null!==M?T?i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,0,0,a.width,a.height,M,a.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,C,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,0,0,a.width,a.height,M,E,a.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,C,a.width,a.height,0,M,E,a.data)}}}else{t=s.mipmaps,T&&R&&(t.length>0&&P++,i.texStorage2D(e.TEXTURE_CUBE_MAP,P,C,g[0].width,g[0].height));for(let n=0;n<6;n++)if(m){T?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,0,0,g[n].width,g[n].height,M,E,g[n].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,C,g[n].width,g[n].height,0,M,E,g[n].data);for(let r=0;r<t.length;r++){let a=t[r].image[n].image;T?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,0,0,a.width,a.height,M,E,a.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,C,a.width,a.height,0,M,E,a.data)}}else{T?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,0,0,M,E,g[n]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,C,M,E,g[n]);for(let r=0;r<t.length;r++){let a=t[r];T?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,0,0,M,E,a.image[n]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,C,M,E,a.image[n])}}}_(s,w)&&A(e.TEXTURE_CUBE_MAP),u.__version=h.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version})(o,t,s);return}i.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,i,r){let a=n.get(t);void 0!==i&&k(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&H(t)},this.setupRenderTarget=function(t){let o=t.texture,c=n.get(t),h=n.get(o);t.addEventListener("dispose",T),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=o.version,s.memory.textures++);let u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=x(t)||l;if(u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(l&&o.mipmaps&&o.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let i=0;i<o.mipmaps.length;i++)c.__webglFramebuffer[t][i]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(l&&o.mipmaps&&o.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<o.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(d){if(r.drawBuffers){let i=t.texture;for(let t=0,r=i.length;t<r;t++){let r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.")}if(l&&t.samples>0&&!1===G(t)){let n=d?o:[o];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){let r=n[i];c.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[i]);let s=a.convert(r.format,r.colorSpace),o=a.convert(r.type),l=b(r.internalFormat,s,o,r.colorSpace,!0===t.isXRRenderTarget),h=V(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,h,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,c.__webglColorRenderbuffer[i])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),z(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){i.bindTexture(e.TEXTURE_CUBE_MAP,h.__webglTexture),O(e.TEXTURE_CUBE_MAP,o,p);for(let i=0;i<6;i++)if(l&&o.mipmaps&&o.mipmaps.length>0)for(let n=0;n<o.mipmaps.length;n++)k(c.__webglFramebuffer[i][n],t,o,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n);else k(c.__webglFramebuffer[i],t,o,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);_(o,p)&&A(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){let r=t.texture;for(let a=0,s=r.length;a<s;a++){let s=r[a],o=n.get(s);i.bindTexture(e.TEXTURE_2D,o.__webglTexture),O(e.TEXTURE_2D,s,p),k(c.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+a,e.TEXTURE_2D,0),_(s,p)&&A(e.TEXTURE_2D)}i.unbindTexture()}else{let n=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?n=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(n,h.__webglTexture),O(n,o,p),l&&o.mipmaps&&o.mipmaps.length>0)for(let i=0;i<o.mipmaps.length;i++)k(c.__webglFramebuffer[i],t,o,e.COLOR_ATTACHMENT0,n,i);else k(c.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0,n,0);_(o,p)&&A(n),i.unbindTexture()}t.depthBuffer&&H(t)},this.updateRenderTargetMipmap=function(t){let r=x(t)||l,a=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=a.length;s<o;s++){let o=a[s];if(_(o,r)){let r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=n.get(o).__webglTexture;i.bindTexture(r,a),A(r),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===G(t)){let r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,s=t.height,o=e.COLOR_BUFFER_BIT,l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=n.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<r.length;t++)i.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(e.COLOR_ATTACHMENT0+i),t.depthBuffer&&l.push(c);let p=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,h.__webglColorRenderbuffer[i]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),d){let t=n.get(r[i]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),u&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<r.length;t++){i.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,h.__webglColorRenderbuffer[t]);let a=n.get(r[t]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,h.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=H,this.setupFrameBufferTexture=k,this.useMultisampledRTT=G}function rf(e,t,i){let n=i.isWebGL2;return{convert:function(i,r=""){let a;let s=W.getTransfer(r);if(1009===i)return e.UNSIGNED_BYTE;if(1017===i)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return e.BYTE;if(1011===i)return e.SHORT;if(1012===i)return e.UNSIGNED_SHORT;if(1013===i)return e.INT;if(1014===i)return e.UNSIGNED_INT;if(1015===i)return e.FLOAT;if(1016===i)return n?e.HALF_FLOAT:null!==(a=t.get("OES_texture_half_float"))?a.HALF_FLOAT_OES:null;if(1021===i)return e.ALPHA;if(1023===i)return e.RGBA;if(1024===i)return e.LUMINANCE;if(1025===i)return e.LUMINANCE_ALPHA;if(1026===i)return e.DEPTH_COMPONENT;if(1027===i)return e.DEPTH_STENCIL;if(1035===i)return null!==(a=t.get("EXT_sRGB"))?a.SRGB_ALPHA_EXT:null;if(1028===i)return e.RED;if(1029===i)return e.RED_INTEGER;if(1030===i)return e.RG;if(1031===i)return e.RG_INTEGER;if(1033===i)return e.RGBA_INTEGER;if(33776===i||33777===i||33778===i||33779===i){if(s===f){if(null===(a=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(33776===i)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===i)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===i)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===i)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(a=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===i)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===i)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===i)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===i)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(35840===i||35841===i||35842===i||35843===i){if(null===(a=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===i)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return null!==(a=t.get("WEBGL_compressed_texture_etc1"))?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(null===(a=t.get("WEBGL_compressed_texture_etc")))return null;if(37492===i)return s===f?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(null===(a=t.get("WEBGL_compressed_texture_astc")))return null;if(37808===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return s===f?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===i||36494===i||36495===i){if(null===(a=t.get("EXT_texture_compression_bptc")))return null;if(36492===i)return s===f?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===i)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===i)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===i||36284===i||36285===i||36286===i){if(null===(a=t.get("EXT_texture_compression_rgtc")))return null;if(36492===i)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===i)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===i)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===i)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return 1020===i?n?e.UNSIGNED_INT_24_8:null!==(a=t.get("WEBGL_depth_texture"))?a.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[i]?e[i]:null}}}class rm extends t8{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class rg extends e6{constructor(){super(),this.isGroup=!0,this.type="Group"}}let rv={type:"move"};class ry{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new rg,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new rg,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ea,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ea),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new rg,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ea,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ea),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,a=null,s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){for(let n of(a=!0,e.hand.values())){let e=t.getJointPose(n,i),r=this._getHandJoint(l,n);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}let n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=n.position.distanceTo(r.position);l.inputState.pinching&&s>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,i))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1);null!==s&&(null===(n=t.getPose(e.targetRaySpace,i))&&null!==r&&(n=r),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(rv)))}return null!==s&&(s.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let i=new rg;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class rx extends v{constructor(e,t){super();let i=this,n=null,r=1,a=null,s="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],x=new P,_=null,b=new t8;b.layers.enable(1),b.viewport=new $;let S=new t8;S.layers.enable(2),S.viewport=new $;let w=[b,S],M=new rm;M.layers.enable(1),M.layers.enable(2);let E=null,C=null;function T(e){let t=y.indexOf(e.inputSource);if(-1===t)return;let i=v[t];void 0!==i&&(i.update(e.inputSource,e.frame,l||a),i.dispatchEvent({type:e.type,data:e.inputSource}))}function R(){n.removeEventListener("select",T),n.removeEventListener("selectstart",T),n.removeEventListener("selectend",T),n.removeEventListener("squeeze",T),n.removeEventListener("squeezestart",T),n.removeEventListener("squeezeend",T),n.removeEventListener("end",R),n.removeEventListener("inputsourceschange",I);for(let e=0;e<v.length;e++){let t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}E=null,C=null,e.setRenderTarget(m),d=null,u=null,h=null,n=null,g=null,N.stop(),i.isPresenting=!1,e.setPixelRatio(_),e.setSize(x.width,x.height,!1),i.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){let i=e.removed[t],n=y.indexOf(i);n>=0&&(y[n]=null,v[n].disconnect(i))}for(let t=0;t<e.added.length;t++){let i=e.added[t],n=y.indexOf(i);if(-1===n){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(i),n=e;break}if(null===y[e]){y[e]=i,n=e;break}}if(-1===n)break}let r=v[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new ry,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new ry,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new ry,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(c){if(null!==(n=c)){if(m=e.getRenderTarget(),n.addEventListener("select",T),n.addEventListener("selectstart",T),n.addEventListener("selectend",T),n.addEventListener("squeeze",T),n.addEventListener("squeezestart",T),n.addEventListener("squeezeend",T),n.addEventListener("end",R),n.addEventListener("inputsourceschange",I),!0!==f.xrCompatible&&await t.makeXRCompatible(),_=e.getPixelRatio(),e.getSize(x),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2){let i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),g=new et(d.framebufferWidth,d.framebufferHeight,{format:1023,type:1009,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let i=null,a=null,s=null;f.depth&&(s=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,i=f.stencil?1027:1026,a=f.stencil?1020:1014);let o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:r};u=(h=new XRWebGLBinding(n,t)).createProjectionLayer(o),n.updateRenderState({layers:[u]}),e.setPixelRatio(1),e.setSize(u.textureWidth,u.textureHeight,!1),g=new et(u.textureWidth,u.textureHeight,{format:1023,type:1009,depthTexture:new iY(u.textureWidth,u.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await n.requestReferenceSpace(s),N.setContext(n),N.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode};let L=new ea,D=new ea;function B(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){var t,i,r;if(null===n)return;M.near=S.near=b.near=e.near,M.far=S.far=b.far=e.far,(E!==M.near||C!==M.far)&&(n.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,C=M.far);let a=e.parent,s=M.cameras;B(M,a);for(let e=0;e<s.length;e++)B(s[e],a);2===s.length?function(e,t,i){L.setFromMatrixPosition(t.matrixWorld),D.setFromMatrixPosition(i.matrixWorld);let n=L.distanceTo(D),r=t.projectionMatrix.elements,a=i.projectionMatrix.elements,s=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(a[8]+1)/a[0],d=n/(-h+u),p=-(d*h);t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(p),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let f=s+d,m=o+d;e.projectionMatrix.makePerspective(s*h-p,s*u+(n-p),l*o/m*f,c*o/m*f,f,m),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(M,b,S):M.projectionMatrix.copy(b.projectionMatrix),t=e,i=M,null===(r=a)?t.matrix.copy(i.matrixWorld):(t.matrix.copy(r.matrixWorld),t.matrix.invert(),t.matrix.multiply(i.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(i.projectionMatrix),t.projectionMatrixInverse.copy(i.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*A*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(e){o=e,null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let O=null,N=new ic;N.setAnimationLoop(function(t,n){if(c=n.getViewerPose(l||a),p=n,null!==c){let t=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let i=!1;t.length!==M.cameras.length&&(M.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){let r=t[n],a=null;if(null!==d)a=d.getViewport(r);else{let t=h.getViewSubImage(u,r);a=t.viewport,0===n&&(e.setRenderTargetTextures(g,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=w[n];void 0===s&&((s=new t8).layers.enable(n),s.viewport=new $,w[n]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===n&&(M.matrix.copy(s.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===i&&M.cameras.push(s)}}for(let e=0;e<v.length;e++){let t=y[e],i=v[e];null!==t&&void 0!==i&&i.update(t,n,l||a)}O&&O(t,n),n.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:n}),p=null}),this.setAnimationLoop=function(e){O=e},this.dispose=function(){}}}function r_(e,t){function i(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map,i(r.map,n.mapTransform)),r.alphaMap&&(n.alphaMap.value=r.alphaMap,i(r.alphaMap,n.alphaMapTransform)),r.bumpMap&&(n.bumpMap.value=r.bumpMap,i(r.bumpMap,n.bumpMapTransform),n.bumpScale.value=r.bumpScale,1===r.side&&(n.bumpScale.value*=-1)),r.normalMap&&(n.normalMap.value=r.normalMap,i(r.normalMap,n.normalMapTransform),n.normalScale.value.copy(r.normalScale),1===r.side&&n.normalScale.value.negate()),r.displacementMap&&(n.displacementMap.value=r.displacementMap,i(r.displacementMap,n.displacementMapTransform),n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap,i(r.emissiveMap,n.emissiveMapTransform)),r.specularMap&&(n.specularMap.value=r.specularMap,i(r.specularMap,n.specularMapTransform)),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);let a=t.get(r).envMap;if(a&&(n.envMap.value=a,n.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;let t=!0===e._useLegacyLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*t,i(r.lightMap,n.lightMapTransform)}r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity,i(r.aoMap,n.aoMapTransform))}return{refreshFogUniforms:function(t,i){i.color.getRGB(t.fogColor.value,t3(e)),i.isFog?(t.fogNear.value=i.near,t.fogFar.value=i.far):i.isFogExp2&&(t.fogDensity.value=i.density)},refreshMaterialUniforms:function(e,r,a,s,o){var l,c,h,u,d,p,f,m,g,v,y,x,_,A,b,S,w,M,E,C,T;r.isMeshBasicMaterial?n(e,r):r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),l=e,(c=r).gradientMap&&(l.gradientMap.value=c.gradientMap)):r.isMeshPhongMaterial?(n(e,r),h=e,u=r,h.specular.value.copy(u.specular),h.shininess.value=Math.max(u.shininess,1e-4)):r.isMeshStandardMaterial?(n(e,r),d=e,p=r,d.metalness.value=p.metalness,p.metalnessMap&&(d.metalnessMap.value=p.metalnessMap,i(p.metalnessMap,d.metalnessMapTransform)),d.roughness.value=p.roughness,p.roughnessMap&&(d.roughnessMap.value=p.roughnessMap,i(p.roughnessMap,d.roughnessMapTransform)),t.get(p).envMap&&(d.envMapIntensity.value=p.envMapIntensity),r.isMeshPhysicalMaterial&&(f=e,m=r,g=o,f.ior.value=m.ior,m.sheen>0&&(f.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),f.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(f.sheenColorMap.value=m.sheenColorMap,i(m.sheenColorMap,f.sheenColorMapTransform)),m.sheenRoughnessMap&&(f.sheenRoughnessMap.value=m.sheenRoughnessMap,i(m.sheenRoughnessMap,f.sheenRoughnessMapTransform))),m.clearcoat>0&&(f.clearcoat.value=m.clearcoat,f.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(f.clearcoatMap.value=m.clearcoatMap,i(m.clearcoatMap,f.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,i(m.clearcoatRoughnessMap,f.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(f.clearcoatNormalMap.value=m.clearcoatNormalMap,i(m.clearcoatNormalMap,f.clearcoatNormalMapTransform),f.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),1===m.side&&f.clearcoatNormalScale.value.negate())),m.iridescence>0&&(f.iridescence.value=m.iridescence,f.iridescenceIOR.value=m.iridescenceIOR,f.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(f.iridescenceMap.value=m.iridescenceMap,i(m.iridescenceMap,f.iridescenceMapTransform)),m.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=m.iridescenceThicknessMap,i(m.iridescenceThicknessMap,f.iridescenceThicknessMapTransform))),m.transmission>0&&(f.transmission.value=m.transmission,f.transmissionSamplerMap.value=g.texture,f.transmissionSamplerSize.value.set(g.width,g.height),m.transmissionMap&&(f.transmissionMap.value=m.transmissionMap,i(m.transmissionMap,f.transmissionMapTransform)),f.thickness.value=m.thickness,m.thicknessMap&&(f.thicknessMap.value=m.thicknessMap,i(m.thicknessMap,f.thicknessMapTransform)),f.attenuationDistance.value=m.attenuationDistance,f.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(f.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(f.anisotropyMap.value=m.anisotropyMap,i(m.anisotropyMap,f.anisotropyMapTransform))),f.specularIntensity.value=m.specularIntensity,f.specularColor.value.copy(m.specularColor),m.specularColorMap&&(f.specularColorMap.value=m.specularColorMap,i(m.specularColorMap,f.specularColorMapTransform)),m.specularIntensityMap&&(f.specularIntensityMap.value=m.specularIntensityMap,i(m.specularIntensityMap,f.specularIntensityMapTransform)))):r.isMeshMatcapMaterial?(n(e,r),v=e,(y=r).matcap&&(v.matcap.value=y.matcap)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,i){let n=t.get(i).light;e.referencePosition.value.setFromMatrixPosition(n.matrixWorld),e.nearDistance.value=n.shadow.camera.near,e.farDistance.value=n.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(x=e,_=r,x.diffuse.value.copy(_.color),x.opacity.value=_.opacity,_.map&&(x.map.value=_.map,i(_.map,x.mapTransform)),r.isLineDashedMaterial&&(A=e,b=r,A.dashSize.value=b.dashSize,A.totalSize.value=b.dashSize+b.gapSize,A.scale.value=b.scale)):r.isPointsMaterial?(S=e,w=r,M=a,E=s,S.diffuse.value.copy(w.color),S.opacity.value=w.opacity,S.size.value=w.size*M,S.scale.value=.5*E,w.map&&(S.map.value=w.map,i(w.map,S.uvTransform)),w.alphaMap&&(S.alphaMap.value=w.alphaMap,i(w.alphaMap,S.alphaMapTransform)),w.alphaTest>0&&(S.alphaTest.value=w.alphaTest)):r.isSpriteMaterial?(C=e,T=r,C.diffuse.value.copy(T.color),C.opacity.value=T.opacity,C.rotation.value=T.rotation,T.map&&(C.map.value=T.map,i(T.map,C.mapTransform)),T.alphaMap&&(C.alphaMap.value=T.alphaMap,i(T.alphaMap,C.alphaMapTransform)),T.alphaTest>0&&(C.alphaTest.value=T.alphaTest)):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function rA(e,t,i,n){let r={},a={},s=[],o=i.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e){let t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){let i=t.target;i.removeEventListener("dispose",c);let n=s.indexOf(i.__bindingPointIndex);s.splice(n,1),e.deleteBuffer(r[i.id]),delete r[i.id],delete a[i.id]}return{bind:function(e,t){let i=t.program;n.uniformBlockBinding(e,i)},update:function(i,h){let u=r[i.id];void 0===u&&(function(e){let t=e.uniforms,i=0;for(let e=0,n=t.length;e<n;e++){let n=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=n.length;e<t;e++){let t=n[e],r=Array.isArray(t.value)?t.value:[t.value];for(let e=0,n=r.length;e<n;e++){let n=l(r[e]),a=i%16;0!==a&&16-a<n.boundary&&(i+=16-a),t.__data=new Float32Array(n.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=i,i+=n.storage}}}let n=i%16;n>0&&(i+=16-n),e.__size=i,e.__cache={}}(i),u=function(t){let i=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;let n=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,r,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,i,n),n}(i),r[i.id]=u,i.addEventListener("dispose",c));let d=h.program;n.updateUBOMapping(i,d);let p=t.render.frame;a[i.id]!==p&&(function(t){let i=r[t.id],n=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,i);for(let t=0,i=n.length;t<i;t++){let i=Array.isArray(n[t])?n[t]:[n[t]];for(let n=0,r=i.length;n<r;n++){let r=i[n];if(!0===function(e,t,i,n){let r=e.value,a=t+"_"+i;if(void 0===n[a])return"number"==typeof r||"boolean"==typeof r?n[a]=r:n[a]=r.clone(),!0;{let e=n[a];if("number"==typeof r||"boolean"==typeof r){if(e!==r)return n[a]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}(r,t,n,a)){let t=r.__offset,i=Array.isArray(r.value)?r.value:[r.value],n=0;for(let a=0;a<i.length;a++){let s=i[a],o=l(s);"number"==typeof s||"boolean"==typeof s?(r.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+n,r.__data)):s.isMatrix3?(r.__data[0]=s.elements[0],r.__data[1]=s.elements[1],r.__data[2]=s.elements[2],r.__data[3]=0,r.__data[4]=s.elements[3],r.__data[5]=s.elements[4],r.__data[6]=s.elements[5],r.__data[7]=0,r.__data[8]=s.elements[6],r.__data[9]=s.elements[7],r.__data[10]=s.elements[8],r.__data[11]=0):(s.toArray(r.__data,n),n+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(i),a[i.id]=p)},dispose:function(){for(let t in r)e.deleteBuffer(r[t]);s=[],r={},a={}}}}class rb{constructor(e={}){let t,i,n,r,a,s,o,l,u,d,p,f,m,g,v,y,x,_,A,b,S,w,M,E,T;let{canvas:R=U(),context:I=null,depth:L=!0,stencil:D=!0,alpha:B=!1,antialias:O=!1,premultipliedAlpha:N=!0,preserveDrawingBuffer:F=!1,powerPreference:k="default",failIfMajorPerformanceCaveat:z=!1}=e;this.isWebGLRenderer=!0,t=null!==I?I.getContextAttributes().alpha:B;let H=new Uint32Array(4),V=new Int32Array(4),G=null,W=null,j=[],q=[];this.domElement=R,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=c,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;let X=this,Y=!1,K=0,Q=0,J=null,Z=-1,ee=null,ei=new $,en=new $,er=null,es=new tp(0),eo=0,el=R.width,ec=R.height,eh=1,eu=null,ed=null,ep=new $(0,0,el,ec),ef=new $(0,0,el,ec),em=!1,eg=new il,ev=!1,ey=!1,ex=null,e_=new eO,eA=new P,eb=new ea,eS={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ew(){return null===J?eh:1}let eM=I;function eE(e,t){for(let i=0;i<e.length;i++){let n=e[i],r=R.getContext(n,t);if(null!==r)return r}return null}try{if("setAttribute"in R&&R.setAttribute("data-engine","three.js r160"),R.addEventListener("webglcontextlost",eR,!1),R.addEventListener("webglcontextrestored",eP,!1),R.addEventListener("webglcontextcreationerror",eI,!1),null===eM){let e=["webgl2","webgl","experimental-webgl"];if(!0===X.isWebGL1Renderer&&e.shift(),eM=eE(e,{alpha:!0,depth:L,stencil:D,antialias:O,premultipliedAlpha:N,preserveDrawingBuffer:F,powerPreference:k,failIfMajorPerformanceCaveat:z}),null===eM){if(eE(e))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}"undefined"!=typeof WebGLRenderingContext&&eM instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===eM.getShaderPrecisionFormat&&(eM.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function eC(){i=new iz(eM),n=new i_(eM,i,e),i.init(n),M=new rf(eM,i,n),r=new rd(eM,i,n),a=new iG(eM),s=new n9,o=new rp(eM,i,r,s,n,M,a),l=new ib(X),u=new ik(X),d=new ih(eM,n),E=new iy(eM,i,d,n),p=new iH(eM,d,a,E),f=new iX(eM,p,d,a),b=new iq(eM,n,o),x=new iA(s),m=new n8(X,l,u,i,n,E,x),g=new r_(X,s),v=new ri,y=new rl(i,n),A=new iv(X,l,u,r,f,t,N),_=new ru(X,f,n),T=new rA(eM,a,n,r),S=new ix(eM,i,a,n),w=new iV(eM,i,a,n),a.programs=m.programs,X.capabilities=n,X.extensions=i,X.properties=s,X.renderLists=v,X.shadowMap=_,X.state=r,X.info=a}eC();let eT=new rx(X,eM);function eR(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function eP(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1;let e=a.autoReset,t=_.enabled,i=_.autoUpdate,n=_.needsUpdate,r=_.type;eC(),a.autoReset=e,_.enabled=t,_.autoUpdate=i,_.needsUpdate=n,_.type=r}function eI(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function eL(e){var t;let i=e.target;i.removeEventListener("dispose",eL),function(e){let t=s.get(e).programs;void 0!==t&&(t.forEach(function(e){m.releaseProgram(e)}),e.isShaderMaterial&&m.releaseShaderCache(e))}(t=i),s.remove(t)}function eD(e,t,i){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,eV(e,t,i),e.side=0,e.needsUpdate=!0,eV(e,t,i),e.side=2):eV(e,t,i)}this.xr=eT,this.getContext=function(){return eM},this.getContextAttributes=function(){return eM.getContextAttributes()},this.forceContextLoss=function(){let e=i.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=i.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return eh},this.setPixelRatio=function(e){void 0!==e&&(eh=e,this.setSize(el,ec,!1))},this.getSize=function(e){return e.set(el,ec)},this.setSize=function(e,t,i=!0){if(eT.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}el=e,ec=t,R.width=Math.floor(e*eh),R.height=Math.floor(t*eh),!0===i&&(R.style.width=e+"px",R.style.height=t+"px"),this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(e){return e.set(el*eh,ec*eh).floor()},this.setDrawingBufferSize=function(e,t,i){el=e,ec=t,eh=i,R.width=Math.floor(e*i),R.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(ei)},this.getViewport=function(e){return e.copy(ep)},this.setViewport=function(e,t,i,n){e.isVector4?ep.set(e.x,e.y,e.z,e.w):ep.set(e,t,i,n),r.viewport(ei.copy(ep).multiplyScalar(eh).floor())},this.getScissor=function(e){return e.copy(ef)},this.setScissor=function(e,t,i,n){e.isVector4?ef.set(e.x,e.y,e.z,e.w):ef.set(e,t,i,n),r.scissor(en.copy(ef).multiplyScalar(eh).floor())},this.getScissorTest=function(){return em},this.setScissorTest=function(e){r.setScissorTest(em=e)},this.setOpaqueSort=function(e){eu=e},this.setTransparentSort=function(e){ed=e},this.getClearColor=function(e){return e.copy(A.getClearColor())},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(e=!0,t=!0,i=!0){let n=0;if(e){let e=!1;if(null!==J){let t=J.texture.format;e=1033===t||1031===t||1029===t}if(e){let e=J.texture.type,t=A.getClearColor(),i=A.getClearAlpha(),n=t.r,r=t.g,a=t.b;1009===e||1014===e||1012===e||1020===e||1017===e||1018===e?(H[0]=n,H[1]=r,H[2]=a,H[3]=i,eM.clearBufferuiv(eM.COLOR,0,H)):(V[0]=n,V[1]=r,V[2]=a,V[3]=i,eM.clearBufferiv(eM.COLOR,0,V))}else n|=eM.COLOR_BUFFER_BIT}t&&(n|=eM.DEPTH_BUFFER_BIT),i&&(n|=eM.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(0xffffffff)),eM.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){R.removeEventListener("webglcontextlost",eR,!1),R.removeEventListener("webglcontextrestored",eP,!1),R.removeEventListener("webglcontextcreationerror",eI,!1),v.dispose(),y.dispose(),s.dispose(),l.dispose(),u.dispose(),f.dispose(),E.dispose(),T.dispose(),m.dispose(),eT.dispose(),eT.removeEventListener("sessionstart",eN),eT.removeEventListener("sessionend",eU),ex&&(ex.dispose(),ex=null),eF.stop()},this.renderBufferDirect=function(e,t,i,a,c,f){let m;null===t&&(t=eS);let v=c.isMesh&&0>c.matrixWorld.determinant(),y=function(e,t,i,a,c){var d,p;!0!==t.isScene&&(t=eS),o.resetTextureUnits();let f=t.fog,m=a.isMeshStandardMaterial?t.environment:null,v=null===J?X.outputColorSpace:!0===J.isXRRenderTarget?J.texture.colorSpace:h,y=(a.isMeshStandardMaterial?u:l).get(a.envMap||m),_=!0===a.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,A=!!i.attributes.tangent&&(!!a.normalMap||a.anisotropy>0),S=!!i.morphAttributes.position,w=!!i.morphAttributes.normal,M=!!i.morphAttributes.color,E=0;a.toneMapped&&(null===J||!0===J.isXRRenderTarget)&&(E=X.toneMapping);let C=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,R=void 0!==C?C.length:0,P=s.get(a),I=W.state.lights;if(!0===ev&&(!0===ey||e!==ee)){let t=e===ee&&a.id===Z;x.setState(a,e,t)}let L=!1;a.version===P.__version?P.needsLights&&P.lightsStateVersion!==I.state.version?L=!0:P.outputColorSpace!==v?L=!0:c.isBatchedMesh&&!1===P.batching?L=!0:c.isBatchedMesh||!0!==P.batching?c.isInstancedMesh&&!1===P.instancing?L=!0:c.isInstancedMesh||!0!==P.instancing?c.isSkinnedMesh&&!1===P.skinning?L=!0:c.isSkinnedMesh||!0!==P.skinning?c.isInstancedMesh&&!0===P.instancingColor&&null===c.instanceColor?L=!0:c.isInstancedMesh&&!1===P.instancingColor&&null!==c.instanceColor?L=!0:P.envMap!==y?L=!0:!0===a.fog&&P.fog!==f?L=!0:void 0!==P.numClippingPlanes&&(P.numClippingPlanes!==x.numPlanes||P.numIntersection!==x.numIntersection)?L=!0:P.vertexAlphas!==_?L=!0:P.vertexTangents!==A?L=!0:P.morphTargets!==S?L=!0:P.morphNormals!==w?L=!0:P.morphColors!==M?L=!0:P.toneMapping!==E?L=!0:!0===n.isWebGL2&&P.morphTargetsCount!==R&&(L=!0):L=!0:L=!0:L=!0:(L=!0,P.__version=a.version);let D=P.currentProgram;!0===L&&(D=eV(a,t,c));let B=!1,O=!1,N=!1,U=D.getUniforms(),F=P.uniforms;if(r.useProgram(D.program)&&(B=!0,O=!0,N=!0),a.id!==Z&&(Z=a.id,O=!0),B||ee!==e){U.setValue(eM,"projectionMatrix",e.projectionMatrix),U.setValue(eM,"viewMatrix",e.matrixWorldInverse);let t=U.map.cameraPosition;void 0!==t&&t.setValue(eM,eb.setFromMatrixPosition(e.matrixWorld)),n.logarithmicDepthBuffer&&U.setValue(eM,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(a.isMeshPhongMaterial||a.isMeshToonMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||a.isMeshStandardMaterial||a.isShaderMaterial)&&U.setValue(eM,"isOrthographic",!0===e.isOrthographicCamera),ee!==e&&(ee=e,O=!0,N=!0)}if(c.isSkinnedMesh){U.setOptional(eM,c,"bindMatrix"),U.setOptional(eM,c,"bindMatrixInverse");let e=c.skeleton;e&&(n.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),U.setValue(eM,"boneTexture",e.boneTexture,o)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}c.isBatchedMesh&&(U.setOptional(eM,c,"batchingTexture"),U.setValue(eM,"batchingTexture",c._matricesTexture,o));let k=i.morphAttributes;if((void 0!==k.position||void 0!==k.normal||void 0!==k.color&&!0===n.isWebGL2)&&b.update(c,i,D),(O||P.receiveShadow!==c.receiveShadow)&&(P.receiveShadow=c.receiveShadow,U.setValue(eM,"receiveShadow",c.receiveShadow)),a.isMeshGouraudMaterial&&null!==a.envMap&&(F.envMap.value=y,F.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1),O&&(U.setValue(eM,"toneMappingExposure",X.toneMappingExposure),P.needsLights&&(d=F,p=N,d.ambientLightColor.needsUpdate=p,d.lightProbe.needsUpdate=p,d.directionalLights.needsUpdate=p,d.directionalLightShadows.needsUpdate=p,d.pointLights.needsUpdate=p,d.pointLightShadows.needsUpdate=p,d.spotLights.needsUpdate=p,d.spotLightShadows.needsUpdate=p,d.rectAreaLights.needsUpdate=p,d.hemisphereLights.needsUpdate=p),f&&!0===a.fog&&g.refreshFogUniforms(F,f),g.refreshMaterialUniforms(F,a,eh,ec,ex),nV.upload(eM,eG(P),F,o)),a.isShaderMaterial&&!0===a.uniformsNeedUpdate&&(nV.upload(eM,eG(P),F,o),a.uniformsNeedUpdate=!1),a.isSpriteMaterial&&U.setValue(eM,"center",c.center),U.setValue(eM,"modelViewMatrix",c.modelViewMatrix),U.setValue(eM,"normalMatrix",c.normalMatrix),U.setValue(eM,"modelMatrix",c.matrixWorld),a.isShaderMaterial||a.isRawShaderMaterial){let e=a.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if(n.isWebGL2){let i=e[t];T.update(i,D),T.bind(i,D)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return D}(e,t,i,a,c);r.setMaterial(a,v);let _=i.index,A=1;if(!0===a.wireframe){if(void 0===(_=p.getWireframeAttribute(i)))return;A=2}let M=i.drawRange,C=i.attributes.position,R=M.start*A,P=(M.start+M.count)*A;null!==f&&(R=Math.max(R,f.start*A),P=Math.min(P,(f.start+f.count)*A)),null!==_?(R=Math.max(R,0),P=Math.min(P,_.count)):null!=C&&(R=Math.max(R,0),P=Math.min(P,C.count));let I=P-R;if(I<0||I===1/0)return;E.setup(c,a,y,i,_);let L=S;if(null!==_&&(m=d.get(_),(L=w).setIndex(m)),c.isMesh)!0===a.wireframe?(r.setLineWidth(a.wireframeLinewidth*ew()),L.setMode(eM.LINES)):L.setMode(eM.TRIANGLES);else if(c.isLine){let e=a.linewidth;void 0===e&&(e=1),r.setLineWidth(e*ew()),c.isLineSegments?L.setMode(eM.LINES):c.isLineLoop?L.setMode(eM.LINE_LOOP):L.setMode(eM.LINE_STRIP)}else c.isPoints?L.setMode(eM.POINTS):c.isSprite&&L.setMode(eM.TRIANGLES);if(c.isBatchedMesh)L.renderMultiDraw(c._multiDrawStarts,c._multiDrawCounts,c._multiDrawCount);else if(c.isInstancedMesh)L.renderInstances(R,I,c.count);else if(i.isInstancedBufferGeometry){let e=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,t=Math.min(i.instanceCount,e);L.renderInstances(R,I,t)}else L.render(R,I)},this.compile=function(e,t,i=null){null===i&&(i=e),(W=y.get(i)).init(),q.push(W),i.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(W.pushLight(e),e.castShadow&&W.pushShadow(e))}),e!==i&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(W.pushLight(e),e.castShadow&&W.pushShadow(e))}),W.setupLights(X._useLegacyLights);let n=new Set;return e.traverse(function(e){let t=e.material;if(t){if(Array.isArray(t))for(let r=0;r<t.length;r++){let a=t[r];eD(a,i,e),n.add(a)}else eD(t,i,e),n.add(t)}}),q.pop(),W=null,n},this.compileAsync=function(e,t,n=null){let r=this.compile(e,t,n);return new Promise(t=>{function n(){if(r.forEach(function(e){s.get(e).currentProgram.isReady()&&r.delete(e)}),0===r.size){t(e);return}setTimeout(n,10)}null!==i.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let eB=null;function eN(){eF.stop()}function eU(){eF.start()}let eF=new ic;function ek(e,t,a,s){let l=e.opaque,c=e.transmissive,h=e.transparent;W.setupLightsView(a),!0===ev&&x.setGlobalState(X.clippingPlanes,a),c.length>0&&function(e,t,r,a){if(null!==(!0===r.isScene?r.overrideMaterial:null))return;let s=n.isWebGL2;null===ex&&(ex=new et(1,1,{generateMipmaps:!0,type:i.has("EXT_color_buffer_half_float")?1016:1009,minFilter:1008,samples:s?4:0})),X.getDrawingBufferSize(eA),s?ex.setSize(eA.x,eA.y):ex.setSize(C(eA.x),C(eA.y));let l=X.getRenderTarget();X.setRenderTarget(ex),X.getClearColor(es),(eo=X.getClearAlpha())<1&&X.setClearColor(0xffffff,.5),X.clear();let c=X.toneMapping;X.toneMapping=0,ez(e,r,a),o.updateMultisampleRenderTarget(ex),o.updateRenderTargetMipmap(ex);let h=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e],n=i.object,s=i.geometry,o=i.material,l=i.group;if(2===o.side&&n.layers.test(a.layers)){let e=o.side;o.side=1,o.needsUpdate=!0,eH(n,r,a,s,o,l),o.side=e,o.needsUpdate=!0,h=!0}}!0===h&&(o.updateMultisampleRenderTarget(ex),o.updateRenderTargetMipmap(ex)),X.setRenderTarget(l),X.setClearColor(es,eo),X.toneMapping=c}(l,c,t,a),s&&r.viewport(ei.copy(s)),l.length>0&&ez(l,t,a),c.length>0&&ez(c,t,a),h.length>0&&ez(h,t,a),r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),r.setPolygonOffset(!1)}function ez(e,t,i){let n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,a=e.length;r<a;r++){let a=e[r],s=a.object,o=a.geometry,l=null===n?a.material:n,c=a.group;s.layers.test(i.layers)&&eH(s,t,i,o,l,c)}}function eH(e,t,i,n,r,a){e.onBeforeRender(X,t,i,n,r,a),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(X,t,i,n,e,a),!0===r.transparent&&2===r.side&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,X.renderBufferDirect(i,t,n,r,e,a),r.side=0,r.needsUpdate=!0,X.renderBufferDirect(i,t,n,r,e,a),r.side=2):X.renderBufferDirect(i,t,n,r,e,a),e.onAfterRender(X,t,i,n,r,a)}function eV(e,t,i){var n;!0!==t.isScene&&(t=eS);let r=s.get(e),a=W.state.lights,o=W.state.shadowsArray,c=a.state.version,h=m.getParameters(e,a.state,o,t,i),d=m.getProgramCacheKey(h),p=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?u:l).get(e.envMap||r.environment),void 0===p&&(e.addEventListener("dispose",eL),p=new Map,r.programs=p);let f=p.get(d);if(void 0!==f){if(r.currentProgram===f&&r.lightsStateVersion===c)return eW(e,h),f}else h.uniforms=m.getUniforms(e),e.onBuild(i,h,X),e.onBeforeCompile(h,X),f=m.acquireProgram(h,d),p.set(d,f),r.uniforms=h.uniforms;let g=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(g.clippingPlanes=x.uniform),eW(e,h),r.needsLights=(n=e).isMeshLambertMaterial||n.isMeshToonMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.isShadowMaterial||n.isShaderMaterial&&!0===n.lights,r.lightsStateVersion=c,r.needsLights&&(g.ambientLightColor.value=a.state.ambient,g.lightProbe.value=a.state.probe,g.directionalLights.value=a.state.directional,g.directionalLightShadows.value=a.state.directionalShadow,g.spotLights.value=a.state.spot,g.spotLightShadows.value=a.state.spotShadow,g.rectAreaLights.value=a.state.rectArea,g.ltc_1.value=a.state.rectAreaLTC1,g.ltc_2.value=a.state.rectAreaLTC2,g.pointLights.value=a.state.point,g.pointLightShadows.value=a.state.pointShadow,g.hemisphereLights.value=a.state.hemi,g.directionalShadowMap.value=a.state.directionalShadowMap,g.directionalShadowMatrix.value=a.state.directionalShadowMatrix,g.spotShadowMap.value=a.state.spotShadowMap,g.spotLightMatrix.value=a.state.spotLightMatrix,g.spotLightMap.value=a.state.spotLightMap,g.pointShadowMap.value=a.state.pointShadowMap,g.pointShadowMatrix.value=a.state.pointShadowMatrix),r.currentProgram=f,r.uniformsList=null,f}function eG(e){if(null===e.uniformsList){let t=e.currentProgram.getUniforms();e.uniformsList=nV.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function eW(e,t){let i=s.get(e);i.outputColorSpace=t.outputColorSpace,i.batching=t.batching,i.instancing=t.instancing,i.instancingColor=t.instancingColor,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}eF.setAnimationLoop(function(e){eB&&eB(e)}),"undefined"!=typeof self&&eF.setContext(self),this.setAnimationLoop=function(e){eB=e,eT.setAnimationLoop(e),null===e?eF.stop():eF.start()},eT.addEventListener("sessionstart",eN),eT.addEventListener("sessionend",eU),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===Y)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===eT.enabled&&!0===eT.isPresenting&&(!0===eT.cameraAutoUpdate&&eT.updateCamera(t),t=eT.getCamera()),!0===e.isScene&&e.onBeforeRender(X,e,t,J),(W=y.get(e,q.length)).init(),q.push(W),e_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),eg.setFromProjectionMatrix(e_),ey=this.localClippingEnabled,ev=x.init(this.clippingPlanes,ey),(G=v.get(e,j.length)).init(),j.push(G),function e(t,i,n,r){if(!1===t.visible)return;if(t.layers.test(i.layers)){if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(i);else if(t.isLight)W.pushLight(t),t.castShadow&&W.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||eg.intersectsSprite(t)){r&&eb.setFromMatrixPosition(t.matrixWorld).applyMatrix4(e_);let e=f.update(t),i=t.material;i.visible&&G.push(t,e,i,n,eb.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||eg.intersectsObject(t))){let e=f.update(t),i=t.material;if(r&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),eb.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),eb.copy(e.boundingSphere.center)),eb.applyMatrix4(t.matrixWorld).applyMatrix4(e_)),Array.isArray(i)){let r=e.groups;for(let a=0,s=r.length;a<s;a++){let s=r[a],o=i[s.materialIndex];o&&o.visible&&G.push(t,e,o,n,eb.z,s)}}else i.visible&&G.push(t,e,i,n,eb.z,null)}}let a=t.children;for(let t=0,s=a.length;t<s;t++)e(a[t],i,n,r)}(e,t,0,X.sortObjects),G.finish(),!0===X.sortObjects&&G.sort(eu,ed),this.info.render.frame++,!0===ev&&x.beginShadows();let i=W.state.shadowsArray;if(_.render(i,e,t),!0===ev&&x.endShadows(),!0===this.info.autoReset&&this.info.reset(),A.render(G,e),W.setupLights(X._useLegacyLights),t.isArrayCamera){let i=t.cameras;for(let t=0,n=i.length;t<n;t++){let n=i[t];ek(G,e,n,n.viewport)}}else ek(G,e,t);null!==J&&(o.updateMultisampleRenderTarget(J),o.updateRenderTargetMipmap(J)),!0===e.isScene&&e.onAfterRender(X,e,t),E.resetDefaultState(),Z=-1,ee=null,q.pop(),W=q.length>0?q[q.length-1]:null,j.pop(),G=j.length>0?j[j.length-1]:null},this.getActiveCubeFace=function(){return K},this.getActiveMipmapLevel=function(){return Q},this.getRenderTarget=function(){return J},this.setRenderTargetTextures=function(e,t,n){s.get(e.texture).__webglTexture=t,s.get(e.depthTexture).__webglTexture=n;let r=s.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0!==i.has("WEBGL_multisampled_render_to_texture")||(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){let i=s.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,i=0){J=e,K=t,Q=i;let a=!0,l=null,c=!1,h=!1;if(e){let u=s.get(e);void 0!==u.__useDefaultFramebuffer?(r.bindFramebuffer(eM.FRAMEBUFFER,null),a=!1):void 0===u.__webglFramebuffer?o.setupRenderTarget(e):u.__hasExternalTextures&&o.rebindTextures(e,s.get(e.texture).__webglTexture,s.get(e.depthTexture).__webglTexture);let d=e.texture;(d.isData3DTexture||d.isDataArrayTexture||d.isCompressedArrayTexture)&&(h=!0);let p=s.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(l=Array.isArray(p[t])?p[t][i]:p[t],c=!0):l=n.isWebGL2&&e.samples>0&&!1===o.useMultisampledRTT(e)?s.get(e).__webglMultisampledFramebuffer:Array.isArray(p)?p[i]:p,ei.copy(e.viewport),en.copy(e.scissor),er=e.scissorTest}else ei.copy(ep).multiplyScalar(eh).floor(),en.copy(ef).multiplyScalar(eh).floor(),er=em;if(r.bindFramebuffer(eM.FRAMEBUFFER,l)&&n.drawBuffers&&a&&r.drawBuffers(e,l),r.viewport(ei),r.scissor(en),r.setScissorTest(er),c){let n=s.get(e.texture);eM.framebufferTexture2D(eM.FRAMEBUFFER,eM.COLOR_ATTACHMENT0,eM.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.__webglTexture,i)}else if(h){let n=s.get(e.texture);eM.framebufferTextureLayer(eM.FRAMEBUFFER,eM.COLOR_ATTACHMENT0,n.__webglTexture,i||0,t||0)}Z=-1},this.readRenderTargetPixels=function(e,t,a,o,l,c,h){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let u=s.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==h&&(u=u[h]),u){r.bindFramebuffer(eM.FRAMEBUFFER,u);try{let r=e.texture,s=r.format,h=r.type;if(1023!==s&&M.convert(s)!==eM.getParameter(eM.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let u=1016===h&&(i.has("EXT_color_buffer_half_float")||n.isWebGL2&&i.has("EXT_color_buffer_float"));if(1009!==h&&M.convert(h)!==eM.getParameter(eM.IMPLEMENTATION_COLOR_READ_TYPE)&&!(1015===h&&(n.isWebGL2||i.has("OES_texture_float")||i.has("WEBGL_color_buffer_float")))&&!u){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}t>=0&&t<=e.width-o&&a>=0&&a<=e.height-l&&eM.readPixels(t,a,o,l,M.convert(s),M.convert(h),c)}finally{let e=null!==J?s.get(J).__webglFramebuffer:null;r.bindFramebuffer(eM.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){let n=Math.pow(2,-i),a=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);o.setTexture2D(t,0),eM.copyTexSubImage2D(eM.TEXTURE_2D,i,0,0,e.x,e.y,a,s),r.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){let a=t.image.width,s=t.image.height,l=M.convert(i.format),c=M.convert(i.type);o.setTexture2D(i,0),eM.pixelStorei(eM.UNPACK_FLIP_Y_WEBGL,i.flipY),eM.pixelStorei(eM.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),eM.pixelStorei(eM.UNPACK_ALIGNMENT,i.unpackAlignment),t.isDataTexture?eM.texSubImage2D(eM.TEXTURE_2D,n,e.x,e.y,a,s,l,c,t.image.data):t.isCompressedTexture?eM.compressedTexSubImage2D(eM.TEXTURE_2D,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,l,t.mipmaps[0].data):eM.texSubImage2D(eM.TEXTURE_2D,n,e.x,e.y,l,c,t.image),0===n&&i.generateMipmaps&&eM.generateMipmap(eM.TEXTURE_2D),r.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,a=0){let s;if(X.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let l=e.max.x-e.min.x+1,c=e.max.y-e.min.y+1,h=e.max.z-e.min.z+1,u=M.convert(n.format),d=M.convert(n.type);if(n.isData3DTexture)o.setTexture3D(n,0),s=eM.TEXTURE_3D;else if(n.isDataArrayTexture||n.isCompressedArrayTexture)o.setTexture2DArray(n,0),s=eM.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}eM.pixelStorei(eM.UNPACK_FLIP_Y_WEBGL,n.flipY),eM.pixelStorei(eM.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),eM.pixelStorei(eM.UNPACK_ALIGNMENT,n.unpackAlignment);let p=eM.getParameter(eM.UNPACK_ROW_LENGTH),f=eM.getParameter(eM.UNPACK_IMAGE_HEIGHT),m=eM.getParameter(eM.UNPACK_SKIP_PIXELS),g=eM.getParameter(eM.UNPACK_SKIP_ROWS),v=eM.getParameter(eM.UNPACK_SKIP_IMAGES),y=i.isCompressedTexture?i.mipmaps[a]:i.image;eM.pixelStorei(eM.UNPACK_ROW_LENGTH,y.width),eM.pixelStorei(eM.UNPACK_IMAGE_HEIGHT,y.height),eM.pixelStorei(eM.UNPACK_SKIP_PIXELS,e.min.x),eM.pixelStorei(eM.UNPACK_SKIP_ROWS,e.min.y),eM.pixelStorei(eM.UNPACK_SKIP_IMAGES,e.min.z),i.isDataTexture||i.isData3DTexture?eM.texSubImage3D(s,a,t.x,t.y,t.z,l,c,h,u,d,y.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),eM.compressedTexSubImage3D(s,a,t.x,t.y,t.z,l,c,h,u,y.data)):eM.texSubImage3D(s,a,t.x,t.y,t.z,l,c,h,u,d,y),eM.pixelStorei(eM.UNPACK_ROW_LENGTH,p),eM.pixelStorei(eM.UNPACK_IMAGE_HEIGHT,f),eM.pixelStorei(eM.UNPACK_SKIP_PIXELS,m),eM.pixelStorei(eM.UNPACK_SKIP_ROWS,g),eM.pixelStorei(eM.UNPACK_SKIP_IMAGES,v),0===a&&n.generateMipmaps&&eM.generateMipmap(s),r.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?o.setTextureCube(e,0):e.isData3DTexture?o.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?o.setTexture2DArray(e,0):o.setTexture2D(e,0),r.unbindTexture()},this.resetState=function(){K=0,Q=0,J=null,r.reset(),E.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return 2e3}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let t=this.getContext();t.drawingBufferColorSpace=e===u?"display-p3":"srgb",t.unpackColorSpace=W.workingColorSpace===d?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===c?3001:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=3001===e?c:h}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class rS extends rb{}rS.prototype.isWebGL1Renderer=!0;class rw{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new tp(e),this.density=t}clone(){return new rw(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class rM{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new tp(e),this.near=t,this.far=i}clone(){return new rM(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class rE extends e6{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class rC{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=b()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=b()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=b()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let rT=new ea;class rR{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)rT.fromBufferAttribute(this,t),rT.applyMatrix4(e),this.setXYZ(t,rT.x,rT.y,rT.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)rT.fromBufferAttribute(this,t),rT.applyNormalMatrix(e),this.setXYZ(t,rT.x,rT.y,rT.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)rT.fromBufferAttribute(this,t),rT.transformDirection(e),this.setXYZ(t,rT.x,rT.y,rT.z);return this}setX(e,t){return this.normalized&&(t=R(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=R(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=R(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=R(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=T(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=T(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=T(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=T(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=R(t,this.array),i=R(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=R(t,this.array),i=R(i,this.array),n=R(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=R(t,this.array),i=R(i,this.array),n=R(n,this.array),r=R(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new rR(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new tS(new this.array.constructor(e),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}}class rP extends tg{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new tp(0xffffff),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let rI=new ea,rL=new ea,rD=new ea,rB=new P,rO=new P,rN=new eO,rU=new ea,rF=new ea,rk=new ea,rz=new P,rH=new P,rV=new P;class rG extends e6{constructor(e=new rP){if(super(),this.isSprite=!0,this.type="Sprite",void 0===n){n=new tB;let e=new rC(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);n.setIndex([0,1,2,0,2,3]),n.setAttribute("position",new rR(e,3,0,!1)),n.setAttribute("uv",new rR(e,2,3,!1))}this.geometry=n,this.material=e,this.center=new P(.5,.5)}raycast(e,t){let i,n;null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),rL.setFromMatrixScale(this.matrixWorld),rN.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),rD.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&rL.multiplyScalar(-rD.z);let r=this.material.rotation;0!==r&&(n=Math.cos(r),i=Math.sin(r));let a=this.center;rW(rU.set(-.5,-.5,0),rD,a,rL,i,n),rW(rF.set(.5,-.5,0),rD,a,rL,i,n),rW(rk.set(.5,.5,0),rD,a,rL,i,n),rz.set(0,0),rH.set(1,0),rV.set(1,1);let s=e.ray.intersectTriangle(rU,rF,rk,!1,rI);if(null===s&&(rW(rF.set(-.5,.5,0),rD,a,rL,i,n),rH.set(0,1),null===(s=e.ray.intersectTriangle(rU,rk,rF,!1,rI))))return;let o=e.ray.origin.distanceTo(rI);o<e.near||o>e.far||t.push({distance:o,point:rI.clone(),uv:tl.getInterpolation(rI,rU,rF,rk,rz,rH,rV,new P),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function rW(e,t,i,n,r,a){rB.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(rO.x=a*rB.x-r*rB.y,rO.y=r*rB.x+a*rB.y):rO.copy(rB),e.copy(t),e.x+=rO.x,e.y+=rO.y,e.applyMatrix4(rN)}let rj=new ea,rq=new ea;class rX extends e6{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let e=0,i=t.length;e<i;e++){let i=t[e];this.addLevel(i.object.clone(),i.distance,i.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){let n;t=Math.abs(t);let r=this.levels;for(n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n;i++){let n=t[i].distance;if(t[i].object.visible&&(n-=n*t[i].hysteresis),e<n)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){rj.setFromMatrixPosition(this.matrixWorld);let i=e.ray.origin.distanceTo(rj);this.getObjectForDistance(i).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){let i,n;rj.setFromMatrixPosition(e.matrixWorld),rq.setFromMatrixPosition(this.matrixWorld);let r=rj.distanceTo(rq)/e.zoom;for(i=1,t[0].object.visible=!0,n=t.length;i<n;i++){let e=t[i].distance;if(t[i].object.visible&&(e-=e*t[i].hysteresis),r>=e)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<n;i++)t[i].object.visible=!1}}toJSON(e){let t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];let i=this.levels;for(let e=0,n=i.length;e<n;e++){let n=i[e];t.object.levels.push({object:n.object.uuid,distance:n.distance,hysteresis:n.hysteresis})}return t}}let rY=new ea,rK=new $,rQ=new $,rJ=new ea,rZ=new eO,r$=new ea,r0=new eE,r1=new eO,r2=new eB;class r3 extends tZ{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=o,this.bindMatrix=new eO,this.bindMatrixInverse=new eO,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new el),this.boundingBox.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,r$),this.boundingBox.expandByPoint(r$)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new eE),this.boundingSphere.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,r$),this.boundingSphere.expandByPoint(r$)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){let i=this.material,n=this.matrixWorld;if(void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),r0.copy(this.boundingSphere),r0.applyMatrix4(n),!1!==e.ray.intersectsSphere(r0))){if(r1.copy(n).invert(),r2.copy(e.ray).applyMatrix4(r1),null!==this.boundingBox&&!1===r2.intersectsBox(this.boundingBox))return;this._computeIntersections(e,t,r2)}}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new $,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);let n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===o?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===l?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){let i=this.skeleton,n=this.geometry;rK.fromBufferAttribute(n.attributes.skinIndex,e),rQ.fromBufferAttribute(n.attributes.skinWeight,e),rY.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){let n=rQ.getComponent(e);if(0!==n){let r=rK.getComponent(e);rZ.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(rJ.copy(rY).applyMatrix4(rZ),n)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class r4 extends e6{constructor(){super(),this.isBone=!0,this.type="Bone"}}class r5 extends Z{constructor(e=null,t=1,i=1,n,r,a,s,o,l=1003,c=1003,h,u){super(null,a,s,o,l,c,n,r,h,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let r6=new eO,r8=new eO;class r9{constructor(e=[],t=[]){this.uuid=b(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new eO)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new eO;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=e.length;n<r;n++){let r=e[n]?e[n].matrixWorld:r8;r6.multiplyMatrices(r,t[n]),r6.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new r9(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length),t=new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4);t.set(this.boneMatrices);let i=new r5(t,e,e,1023,1015);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let n=e.bones[i],r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new r4),this.bones.push(r),this.boneInverses.push(new eO().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){let r=t[n];e.bones.push(r.uuid);let a=i[n];e.boneInverses.push(a.toArray())}return e}}class r7 extends tS{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let ae=new eO,at=new eO,ai=[],an=new el,ar=new eO,aa=new tZ,as=new eE;class ao extends tZ{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new r7(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<i;e++)this.setMatrixAt(e,ar)}computeBoundingBox(){let e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new el),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,ae),an.copy(e.boundingBox).applyMatrix4(ae),this.boundingBox.union(an)}computeBoundingSphere(){let e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new eE),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,ae),as.copy(e.boundingSphere).applyMatrix4(ae),this.boundingSphere.union(as)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let i=this.matrixWorld,n=this.count;if(aa.geometry=this.geometry,aa.material=this.material,void 0!==aa.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),as.copy(this.boundingSphere),as.applyMatrix4(i),!1!==e.ray.intersectsSphere(as)))for(let r=0;r<n;r++){this.getMatrixAt(r,ae),at.multiplyMatrices(i,ae),aa.matrixWorld=at,aa.raycast(e,ai);for(let e=0,i=ai.length;e<i;e++){let i=ai[e];i.instanceId=r,i.object=this,t.push(i)}ai.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new r7(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function al(e,t){return e.z-t.z}function ac(e,t){return t.z-e.z}let ah="batchId",au=new eO,ad=new eO,ap=new eO,af=new eO,am=new il,ag=new el,av=new eE,ay=new ea,ax=new class{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){let i=this.pool,n=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1});let r=i[this.index];n.push(r),this.index++,r.start=e.start,r.count=e.count,r.z=t}reset(){this.list.length=0,this.index=0}},a_=new tZ,aA=[];class ab extends tZ{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,i=2*t,n){super(new tB,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount),t=new r5(new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4),e,e,1023,1015);this._matricesTexture=t}_initializeGeometry(e){let t=this.geometry,i=this._maxVertexCount,n=this._maxGeometryCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(let n in e.attributes){let r=e.getAttribute(n),{array:a,itemSize:s,normalized:o}=r,l=new a.constructor(i*s),c=new r.constructor(l,s,o);c.setUsage(r.usage),t.setAttribute(n,c)}if(null!==e.getIndex()){let e=i>65536?new Uint32Array(r):new Uint16Array(r);t.setIndex(new tS(e,1))}let a=n>65536?new Uint32Array(i):new Uint16Array(i);t.setAttribute(ah,new tS(a,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(ah))throw Error(`BatchedMesh: Geometry cannot use attribute "${ah}"`);let t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw Error('BatchedMesh: All geometries must consistently have "index".');for(let i in t.attributes){if(i===ah)continue;if(!e.hasAttribute(i))throw Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);let n=e.getAttribute(i),r=t.getAttribute(i);if(n.itemSize!==r.itemSize||n.normalized!==r.normalized)throw Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new el);let e=this._geometryCount,t=this.boundingBox,i=this._active;t.makeEmpty();for(let n=0;n<e;n++)!1!==i[n]&&(this.getMatrixAt(n,au),this.getBoundingBoxAt(n,ag).applyMatrix4(au),t.union(ag))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new eE);let e=this._geometryCount,t=this.boundingSphere,i=this._active;t.makeEmpty();for(let n=0;n<e;n++)!1!==i[n]&&(this.getMatrixAt(n,au),this.getBoundingSphereAt(n,av).applyMatrix4(au),t.union(av))}addGeometry(e,t=-1,i=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw Error("BatchedMesh: Maximum geometry count reached.");let n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1},r=null,a=this._reservedRanges,s=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(r=a[a.length-1]),-1===t?n.vertexCount=e.getAttribute("position").count:n.vertexCount=t,null===r?n.vertexStart=0:n.vertexStart=r.vertexStart+r.vertexCount;let l=e.getIndex(),c=null!==l;if(c&&(-1===i?n.indexCount=l.count:n.indexCount=i,null===r?n.indexStart=0:n.indexStart=r.indexStart+r.indexCount),-1!==n.indexStart&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let h=this._visibility,u=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data;h.push(!0),u.push(!0);let f=this._geometryCount;this._geometryCount++,ap.toArray(p,16*f),d.needsUpdate=!0,a.push(n),s.push({start:c?n.indexStart:n.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new el,sphereInitialized:!1,sphere:new eE});let m=this.geometry.getAttribute(ah);for(let e=0;e<n.vertexCount;e++)m.setX(n.vertexStart+e,f);return m.needsUpdate=!0,this.setGeometryAt(f,e),f}setGeometryAt(e,t){if(e>=this._geometryCount)throw Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);let i=this.geometry,n=null!==i.getIndex(),r=i.getIndex(),a=t.getIndex(),s=this._reservedRanges[e];if(n&&a.count>s.indexCount||t.attributes.position.count>s.vertexCount)throw Error("BatchedMesh: Reserved space not large enough for provided geometry.");let o=s.vertexStart,l=s.vertexCount;for(let e in i.attributes){if(e===ah)continue;let n=t.getAttribute(e),r=i.getAttribute(e);!function(e,t,i=0){let n=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){let r=e.count;for(let a=0;a<r;a++)for(let r=0;r<n;r++)t.setComponent(a+i,r,e.getComponent(a,r))}else t.array.set(e.array,i*n);t.needsUpdate=!0}(n,r,o);let a=n.itemSize;for(let e=n.count;e<l;e++){let t=o+e;for(let e=0;e<a;e++)r.setComponent(t,e,0)}r.needsUpdate=!0}if(n){let e=s.indexStart;for(let t=0;t<a.count;t++)r.setX(e+t,o+a.getX(t));for(let t=a.count,i=s.indexCount;t<i;t++)r.setX(e+t,o);r.needsUpdate=!0}let c=this._bounds[e];null!==t.boundingBox?(c.box.copy(t.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,null!==t.boundingSphere?(c.sphere.copy(t.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;let h=this._drawRanges[e],u=t.getAttribute("position");return h.count=n?a.count:u.count,this._visibilityChanged=!0,e}deleteGeometry(e){let t=this._active;return e>=t.length||!1===t[e]||(t[e]=!1,this._visibilityChanged=!0),this}getBoundingBoxAt(e,t){if(!1===this._active[e])return this;let i=this._bounds[e],n=i.box,r=this.geometry;if(!1===i.boxInitialized){n.makeEmpty();let t=r.index,a=r.attributes.position,s=this._drawRanges[e];for(let e=s.start,i=s.start+s.count;e<i;e++){let i=e;t&&(i=t.getX(i)),n.expandByPoint(ay.fromBufferAttribute(a,i))}i.boxInitialized=!0}return t.copy(n),t}getBoundingSphereAt(e,t){if(!1===this._active[e])return this;let i=this._bounds[e],n=i.sphere,r=this.geometry;if(!1===i.sphereInitialized){n.makeEmpty(),this.getBoundingBoxAt(e,ag),ag.getCenter(n.center);let t=r.index,a=r.attributes.position,s=this._drawRanges[e],o=0;for(let e=s.start,i=s.start+s.count;e<i;e++){let i=e;t&&(i=t.getX(i)),ay.fromBufferAttribute(a,i),o=Math.max(o,n.center.distanceToSquared(ay))}n.radius=Math.sqrt(o),i.sphereInitialized=!0}return t.copy(n),t}setMatrixAt(e,t){let i=this._active,n=this._matricesTexture,r=this._matricesTexture.image.data;return e>=this._geometryCount||!1===i[e]||(t.toArray(r,16*e),n.needsUpdate=!0),this}getMatrixAt(e,t){let i=this._active,n=this._matricesTexture.image.data;return e>=this._geometryCount||!1===i[e]?null:t.fromArray(n,16*e)}setVisibleAt(e,t){let i=this._visibility,n=this._active;return e>=this._geometryCount||!1===n[e]||i[e]===t||(i[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){let t=this._visibility,i=this._active;return!(e>=this._geometryCount)&&!1!==i[e]&&t[e]}raycast(e,t){let i=this._visibility,n=this._active,r=this._drawRanges,a=this._geometryCount,s=this.matrixWorld,o=this.geometry;a_.material=this.material,a_.geometry.index=o.index,a_.geometry.attributes=o.attributes,null===a_.geometry.boundingBox&&(a_.geometry.boundingBox=new el),null===a_.geometry.boundingSphere&&(a_.geometry.boundingSphere=new eE);for(let o=0;o<a;o++){if(!i[o]||!n[o])continue;let a=r[o];a_.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(o,a_.matrixWorld).premultiply(s),this.getBoundingBoxAt(o,a_.geometry.boundingBox),this.getBoundingSphereAt(o,a_.geometry.boundingSphere),a_.raycast(e,aA);for(let e=0,i=aA.length;e<i;e++){let i=aA[e];i.object=this,i.batchId=o,t.push(i)}aA.length=0}a_.material=null,a_.geometry.index=null,a_.geometry.attributes={},a_.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(e=>({...e})),this._reservedRanges=e._reservedRanges.map(e=>({...e})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,i,n,r){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;let a=n.getIndex(),s=null===a?1:a.array.BYTES_PER_ELEMENT,o=this._visibility,l=this._multiDrawStarts,c=this._multiDrawCounts,h=this._drawRanges,u=this.perObjectFrustumCulled;u&&(af.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),am.setFromProjectionMatrix(af,e.isWebGPURenderer?2001:2e3));let d=0;if(this.sortObjects){ad.copy(this.matrixWorld).invert(),ay.setFromMatrixPosition(i.matrixWorld).applyMatrix4(ad);for(let e=0,t=o.length;e<t;e++)if(o[e]){this.getMatrixAt(e,au),this.getBoundingSphereAt(e,av).applyMatrix4(au);let t=!1;if(u&&(t=!am.intersectsSphere(av)),!t){let t=ay.distanceTo(av.center);ax.push(h[e],t)}}let e=ax.list,t=this.customSort;null===t?e.sort(r.transparent?ac:al):t.call(this,e,i);for(let t=0,i=e.length;t<i;t++){let i=e[t];l[d]=i.start*s,c[d]=i.count,d++}ax.reset()}else for(let e=0,t=o.length;e<t;e++)if(o[e]){let t=!1;if(u&&(this.getMatrixAt(e,au),this.getBoundingSphereAt(e,av).applyMatrix4(au),t=!am.intersectsSphere(av)),!t){let t=h[e];l[d]=t.start*s,c[d]=t.count,d++}}this._multiDrawCount=d,this._visibilityChanged=!1}onBeforeShadow(e,t,i,n,r,a){this.onBeforeRender(e,null,n,r,a)}}class aS extends tg{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new tp(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let aw=new ea,aM=new ea,aE=new eO,aC=new eB,aT=new eE;class aR extends e6{constructor(e=new tB,t=new aS){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)aw.fromBufferAttribute(t,e-1),aM.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=aw.distanceTo(aM);e.setAttribute("lineDistance",new tE(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),aT.copy(i.boundingSphere),aT.applyMatrix4(n),aT.radius+=r,!1===e.ray.intersectsSphere(aT))return;aE.copy(n).invert(),aC.copy(e.ray).applyMatrix4(aE);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=new ea,c=new ea,h=new ea,u=new ea,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p){let i=Math.max(0,a.start),n=Math.min(p.count,a.start+a.count);for(let r=i,a=n-1;r<a;r+=d){let i=p.getX(r),n=p.getX(r+1);if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,n),aC.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let a=e.ray.origin.distanceTo(u);a<e.near||a>e.far||t.push({distance:a,point:h.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else{let i=Math.max(0,a.start),n=Math.min(f.count,a.start+a.count);for(let r=i,a=n-1;r<a;r+=d){if(l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,r+1),aC.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}let aP=new ea,aI=new ea;class aL extends aR{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)aP.fromBufferAttribute(t,e),aI.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+aP.distanceTo(aI);e.setAttribute("lineDistance",new tE(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class aD extends aR{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class aB extends tg{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new tp(0xffffff),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let aO=new eO,aN=new eB,aU=new eE,aF=new ea;class ak extends e6{constructor(e=new tB,t=new aB){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),aU.copy(i.boundingSphere),aU.applyMatrix4(n),aU.radius+=r,!1===e.ray.intersectsSphere(aU))return;aO.copy(n).invert(),aN.copy(e.ray).applyMatrix4(aO);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=i.index,c=i.attributes.position;if(null!==l){let i=Math.max(0,a.start),r=Math.min(l.count,a.start+a.count);for(let a=i;a<r;a++){let i=l.getX(a);aF.fromBufferAttribute(c,i),az(aF,i,o,n,e,t,this)}}else{let i=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let a=i;a<r;a++)aF.fromBufferAttribute(c,a),az(aF,a,o,n,e,t,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function az(e,t,i,n,r,a,s){let o=aN.distanceSqToPoint(e);if(o<i){let i=new ea;aN.closestPointToPoint(e,i),i.applyMatrix4(n);let l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:t,face:null,object:s})}}class aH extends Z{constructor(e,t,i,n,r,a,s,o,l,c,h,u){super(null,a,s,o,l,c,n,r,h,u),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class aV{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,n=this.getPoint(0),r=0;t.push(0);for(let a=1;a<=e;a++)t.push(r+=(i=this.getPoint(a/e)).distanceTo(n)),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i;let n=this.getLengths(),r=0,a=n.length;i=t||e*n[a-1];let s=0,o=a-1,l;for(;s<=o;)if((l=n[r=Math.floor(s+(o-s)/2)]-i)<0)s=r+1;else if(l>0)o=r-1;else{o=r;break}if(n[r=o]===i)return r/(a-1);let c=n[r],h=n[r+1];return(r+(i-c)/(h-c))/(a-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),a=this.getPoint(n),s=t||(r.isVector2?new P:new ea);return s.copy(a).sub(r).normalize(),s}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new ea,n=[],r=[],a=[],s=new ea,o=new eO;for(let t=0;t<=e;t++){let i=t/e;n[t]=this.getTangentAt(i,new ea)}r[0]=new ea,a[0]=new ea;let l=Number.MAX_VALUE,c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],s),a[0].crossVectors(n[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(n[t-1],n[t]),s.length()>Number.EPSILON){s.normalize();let e=Math.acos(S(n[t-1].dot(n[t]),-1,1));r[t].applyMatrix4(o.makeRotationAxis(s,e))}a[t].crossVectors(n[t],r[t])}if(!0===t){let t=Math.acos(S(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],t*i)),a[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class aG extends aV{constructor(e=0,t=0,i=1,n=1,r=0,a=2*Math.PI,s=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t){let i=t||new P,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0!==this.aClockwise||a||(r===n?r=-n:r-=n);let s=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class aW extends aG{constructor(e,t,i,n,r,a){super(e,t,i,i,n,r,a),this.isArcCurve=!0,this.type="ArcCurve"}}function aj(){let e=0,t=0,i=0,n=0;function r(r,a,s,o){e=r,t=s,i=-3*r+3*a-2*s-o,n=2*r-2*a+s+o}return{initCatmullRom:function(e,t,i,n,a){r(t,i,a*(i-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,a,s,o){let l=(t-e)/a-(i-e)/(a+s)+(i-t)/s,c=(i-t)/s-(n-t)/(s+o)+(n-i)/o;r(t,i,l*=s,c*=s)},calc:function(r){let a=r*r;return e+t*r+i*a+a*r*n}}}let aq=new ea,aX=new aj,aY=new aj,aK=new aj;class aQ extends aV{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new ea){let i,n;let r=this.points,a=r.length,s=(a-(this.closed?0:1))*e,o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/a)+1)*a:0===l&&o===a-1&&(o=a-2,l=1),this.closed||o>0?i=r[(o-1)%a]:(aq.subVectors(r[0],r[1]).add(r[0]),i=aq);let c=r[o%a],h=r[(o+1)%a];if(this.closed||o+2<a?n=r[(o+2)%a]:(aq.subVectors(r[a-1],r[a-2]).add(r[a-1]),n=aq),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(i.distanceToSquared(c),e),r=Math.pow(c.distanceToSquared(h),e),a=Math.pow(h.distanceToSquared(n),e);r<1e-4&&(r=1),t<1e-4&&(t=r),a<1e-4&&(a=r),aX.initNonuniformCatmullRom(i.x,c.x,h.x,n.x,t,r,a),aY.initNonuniformCatmullRom(i.y,c.y,h.y,n.y,t,r,a),aK.initNonuniformCatmullRom(i.z,c.z,h.z,n.z,t,r,a)}else"catmullrom"===this.curveType&&(aX.initCatmullRom(i.x,c.x,h.x,n.x,this.tension),aY.initCatmullRom(i.y,c.y,h.y,n.y,this.tension),aK.initCatmullRom(i.z,c.z,h.z,n.z,this.tension));return t.set(aX.calc(l),aY.calc(l),aK.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(new ea().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function aJ(e,t,i,n,r){let a=(n-t)*.5,s=(r-i)*.5,o=e*e;return e*o*(2*i-2*n+a+s)+(-3*i+3*n-2*a-s)*o+a*e+i}function aZ(e,t,i,n){return function(e,t){let i=1-e;return i*i*t}(e,t)+2*(1-e)*e*i+e*e*n}function a$(e,t,i,n,r){return function(e,t){let i=1-e;return i*i*i*t}(e,t)+function(e,t){let i=1-e;return 3*i*i*e*t}(e,i)+3*(1-e)*e*e*n+e*e*e*r}class a0 extends aV{constructor(e=new P,t=new P,i=new P,n=new P){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new P){let i=this.v0,n=this.v1,r=this.v2,a=this.v3;return t.set(a$(e,i.x,n.x,r.x,a.x),a$(e,i.y,n.y,r.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class a1 extends aV{constructor(e=new ea,t=new ea,i=new ea,n=new ea){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new ea){let i=this.v0,n=this.v1,r=this.v2,a=this.v3;return t.set(a$(e,i.x,n.x,r.x,a.x),a$(e,i.y,n.y,r.y,a.y),a$(e,i.z,n.z,r.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class a2 extends aV{constructor(e=new P,t=new P){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new P){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new P){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class a3 extends aV{constructor(e=new ea,t=new ea){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ea){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ea){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class a4 extends aV{constructor(e=new P,t=new P,i=new P){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new P){let i=this.v0,n=this.v1,r=this.v2;return t.set(aZ(e,i.x,n.x,r.x),aZ(e,i.y,n.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class a5 extends aV{constructor(e=new ea,t=new ea,i=new ea){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ea){let i=this.v0,n=this.v1,r=this.v2;return t.set(aZ(e,i.x,n.x,r.x),aZ(e,i.y,n.y,r.y),aZ(e,i.z,n.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class a6 extends aV{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new P){let i=this.points,n=(i.length-1)*e,r=Math.floor(n),a=n-r,s=i[0===r?r:r-1],o=i[r],l=i[r>i.length-2?i.length-1:r+1],c=i[r>i.length-3?i.length-1:r+2];return t.set(aJ(a,s.x,o.x,l.x,c.x),aJ(a,s.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(new P().fromArray(i))}return this}}var a8=Object.freeze({__proto__:null,ArcCurve:aW,CatmullRomCurve3:aQ,CubicBezierCurve:a0,CubicBezierCurve3:a1,EllipseCurve:aG,LineCurve:a2,LineCurve3:a3,QuadraticBezierCurve:a4,QuadraticBezierCurve3:a5,SplineCurve:a6});class a9 extends aV{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){let i=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new a8[i](t,e))}return this}getPoint(e,t){let i=e*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let e=n[r]-i,a=this.curves[r],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,n=this.curves.length;i<n;i++)e.push(t+=this.curves[i].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t;let i=[];for(let n=0,r=this.curves;n<r.length;n++){let a=r[n],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(s);for(let e=0;e<o.length;e++){let n=o[e];t&&t.equals(n)||(i.push(n),t=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(new a8[i.type]().fromJSON(i))}return this}}class a7 extends a9{constructor(e){super(),this.type="Path",this.currentPoint=new P,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new a2(this.currentPoint.clone(),new P(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){let r=new a4(this.currentPoint.clone(),new P(e,t),new P(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,a){let s=new a0(this.currentPoint.clone(),new P(e,t),new P(i,n),new P(r,a));return this.curves.push(s),this.currentPoint.set(r,a),this}splineThru(e){let t=new a6([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,a){let s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,i,n,r,a),this}absarc(e,t,i,n,r,a){return this.absellipse(e,t,i,i,n,r,a),this}ellipse(e,t,i,n,r,a,s,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,a,s,o),this}absellipse(e,t,i,n,r,a,s,o){let l=new aG(e,t,i,n,r,a,s,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class se extends tB{constructor(e=[new P(0,-.5),new P(.5,0),new P(0,.5)],t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=S(n,0,2*Math.PI);let r=[],a=[],s=[],o=[],l=[],c=1/t,h=new ea,u=new P,d=new ea,p=new ea,f=new ea,m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=t;r++){let d=i+r*c*n,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=e.length-1;i++){h.x=e[i].x*p,h.y=e[i].y,h.z=e[i].x*f,a.push(h.x,h.y,h.z),u.x=r/t,u.y=i/(e.length-1),s.push(u.x,u.y);let n=o[3*i+0]*p,c=o[3*i+1],d=o[3*i+0]*f;l.push(n,c,d)}}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){let n=t+i*e.length,a=n+e.length,s=n+e.length+1,o=n+1;r.push(n,a,o),r.push(s,o,a)}this.setIndex(r),this.setAttribute("position",new tE(a,3)),this.setAttribute("uv",new tE(s,2)),this.setAttribute("normal",new tE(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new se(e.points,e.segments,e.phiStart,e.phiLength)}}class st extends se{constructor(e=1,t=1,i=4,n=8){let r=new a7;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new st(e.radius,e.length,e.capSegments,e.radialSegments)}}class si extends tB{constructor(e=1,t=32,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);let r=[],a=[],s=[],o=[],l=new ea,c=new P;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=t;r++,h+=3){let u=i+r/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),a.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(a[h]/e+1)/2,c.y=(a[h+1]/e+1)/2,o.push(c.x,c.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new tE(a,3)),this.setAttribute("normal",new tE(s,3)),this.setAttribute("uv",new tE(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new si(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class sn extends tB{constructor(e=1,t=1,i=1,n=32,r=1,a=!1,s=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o};let l=this;n=Math.floor(n),r=Math.floor(r);let c=[],h=[],u=[],d=[],p=0,f=[],m=i/2,g=0;function v(i){let r=p,a=new P,f=new ea,v=0,y=!0===i?e:t,x=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),p++;let _=p;for(let e=0;e<=n;e++){let t=e/n*o+s,i=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*x,f.z=y*i,h.push(f.x,f.y,f.z),u.push(0,x,0),a.x=.5*i+.5,a.y=.5*r*x+.5,d.push(a.x,a.y),p++}for(let e=0;e<n;e++){let t=r+e,n=_+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}(function(){let a=new ea,v=new ea,y=0,x=(t-e)/i;for(let l=0;l<=r;l++){let c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=n;e++){let t=e/n,r=t*o+s,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*i+m,v.z=y*f,h.push(v.x,v.y,v.z),a.set(l,x,f).normalize(),u.push(a.x,a.y,a.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<n;e++)for(let t=0;t<r;t++){let i=f[t][e],n=f[t+1][e],r=f[t+1][e+1],a=f[t][e+1];c.push(i,n,a),c.push(n,r,a),y+=6}l.addGroup(g,y,0),g+=y})(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new tE(h,3)),this.setAttribute("normal",new tE(u,3)),this.setAttribute("uv",new tE(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class sr extends sn{constructor(e=1,t=1,i=32,n=1,r=!1,a=0,s=2*Math.PI){super(0,e,t,i,n,r,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}static fromJSON(e){return new sr(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class sa extends tB{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};let r=[],a=[];function s(e){r.push(e.x,e.y,e.z)}function o(t,i){let n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function l(e,t,i,n){n<0&&1===e.x&&(a[t]=e.x-1),0===i.x&&0===i.z&&(a[t]=n/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}(function(e){let i=new ea,n=new ea,r=new ea;for(let a=0;a<t.length;a+=3)o(t[a+0],i),o(t[a+1],n),o(t[a+2],r),function(e,t,i,n){let r=n+1,a=[];for(let n=0;n<=r;n++){a[n]=[];let s=e.clone().lerp(i,n/r),o=t.clone().lerp(i,n/r),l=r-n;for(let e=0;e<=l;e++)0===e&&n===r?a[n][e]=s:a[n][e]=s.clone().lerp(o,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){let i=Math.floor(t/2);t%2==0?(s(a[e][i+1]),s(a[e+1][i]),s(a[e][i])):(s(a[e][i+1]),s(a[e+1][i+1]),s(a[e+1][i]))}}(i,n,r,e)})(n),function(e){let t=new ea;for(let i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){let e=new ea;for(let i=0;i<r.length;i+=3){var t;e.x=r[i+0],e.y=r[i+1],e.z=r[i+2];let n=c(e)/2/Math.PI+.5,s=Math.atan2(-(t=e).y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5;a.push(n,1-s)}(function(){let e=new ea,t=new ea,i=new ea,n=new ea,s=new P,o=new P,h=new P;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),h.set(a[d+4],a[d+5]),n.copy(e).add(t).add(i).divideScalar(3);let p=c(n);l(s,d+0,e,p),l(o,d+2,t,p),l(h,d+4,i,p)}})(),function(){for(let e=0;e<a.length;e+=6){let t=a[e+0],i=a[e+2],n=a[e+4],r=Math.max(t,i,n),s=Math.min(t,i,n);r>.9&&s<.1&&(t<.2&&(a[e+0]+=1),i<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new tE(r,3)),this.setAttribute("normal",new tE(r.slice(),3)),this.setAttribute("uv",new tE(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sa(e.vertices,e.indices,e.radius,e.details)}}class ss extends sa{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ss(e.radius,e.detail)}}let so=new ea,sl=new ea,sc=new ea,sh=new tl;class su extends tB{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){let i=Math.cos(_*t),n=e.getIndex(),r=e.getAttribute("position"),a=n?n.count:r.count,s=[0,0,0],o=["a","b","c"],l=[,,,],c={},h=[];for(let e=0;e<a;e+=3){n?(s[0]=n.getX(e),s[1]=n.getX(e+1),s[2]=n.getX(e+2)):(s[0]=e,s[1]=e+1,s[2]=e+2);let{a:t,b:a,c:u}=sh;if(t.fromBufferAttribute(r,s[0]),a.fromBufferAttribute(r,s[1]),u.fromBufferAttribute(r,s[2]),sh.getNormal(sc),l[0]=`${Math.round(1e4*t.x)},${Math.round(1e4*t.y)},${Math.round(1e4*t.z)}`,l[1]=`${Math.round(1e4*a.x)},${Math.round(1e4*a.y)},${Math.round(1e4*a.z)}`,l[2]=`${Math.round(1e4*u.x)},${Math.round(1e4*u.y)},${Math.round(1e4*u.z)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let e=0;e<3;e++){let t=(e+1)%3,n=l[e],r=l[t],a=sh[o[e]],u=sh[o[t]],d=`${n}_${r}`,p=`${r}_${n}`;p in c&&c[p]?(sc.dot(c[p].normal)<=i&&(h.push(a.x,a.y,a.z),h.push(u.x,u.y,u.z)),c[p]=null):d in c||(c[d]={index0:s[e],index1:s[t],normal:sc.clone()})}}for(let e in c)if(c[e]){let{index0:t,index1:i}=c[e];so.fromBufferAttribute(r,t),sl.fromBufferAttribute(r,i),h.push(so.x,so.y,so.z),h.push(sl.x,sl.y,sl.z)}this.setAttribute("position",new tE(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class sd extends a7{constructor(e){super(e),this.uuid=b(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(new a7().fromJSON(i))}return this}}let sp=function(e,t,i=2){let n,r,a,s,o,l,c;let h=t&&t.length,u=h?t[0]*i:e.length,d=sf(e,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,i,n){let r,a,s,o,l;let c=[];for(r=0,a=t.length;r<a;r++)s=t[r]*n,o=r<a-1?t[r+1]*n:e.length,(l=sf(e,s,o,n,!1))===l.next&&(l.steiner=!0),c.push(function(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}(l));for(c.sort(sg),r=0;r<c.length;r++)i=function(e,t){let i=function(e,t){let i=t,n=-1/0,r,a=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){let e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=a&&e>n&&(n=e,r=i.x<i.next.x?i:i.next,e===a))return r}i=i.next}while(i!==t);if(!r)return null;let o=r,l=r.x,c=r.y,h=1/0,u;i=r;do{var d,p;a>=i.x&&i.x>=l&&a!==i.x&&sy(s<c?a:n,s,l,c,s<c?n:a,s,i.x,i.y)&&(u=Math.abs(s-i.y)/(a-i.x),sw(i,e)&&(u<h||u===h&&(i.x>r.x||i.x===r.x&&(d=r,p=i,0>sx(d.prev,d,p.prev)&&0>sx(p.next,d,d.next))))&&(r=i,h=u)),i=i.next}while(i!==o);return r}(e,t);if(!i)return t;let n=sM(i,e);return sm(n,n.next),sm(i,i.next)}(c[r],i);return i}(e,t,d,i)),e.length>80*i){n=a=e[0],r=s=e[1];for(let t=i;t<u;t+=i)o=e[t],l=e[t+1],o<n&&(n=o),l<r&&(r=l),o>a&&(a=o),l>s&&(s=l);c=0!==(c=Math.max(a-n,s-r))?32767/c:0}return function e(t,i,n,r,a,s,o){if(!t)return;!o&&s&&function(e,t,i,n){let r=e;do 0===r.z&&(r.z=sv(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,a,s,o,l,c=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,n=i,o=0,t=0;t<c&&(o++,n=n.nextZ);t++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(s>1)}(r)}(t,r,a,s);let l=t,c,h;for(;t.prev!==t.next;){if(c=t.prev,h=t.next,s?function(e,t,i,n){let r=e.prev,a=e.next;if(sx(r,e,a)>=0)return!1;let s=r.x,o=e.x,l=a.x,c=r.y,h=e.y,u=a.y,d=s<o?s<l?s:l:o<l?o:l,p=c<h?c<u?c:u:h<u?h:u,f=s>o?s>l?s:l:o>l?o:l,m=c>h?c>u?c:u:h>u?h:u,g=sv(d,p,t,i,n),v=sv(f,m,t,i,n),y=e.prevZ,x=e.nextZ;for(;y&&y.z>=g&&x&&x.z<=v;){if(y.x>=d&&y.x<=f&&y.y>=p&&y.y<=m&&y!==r&&y!==a&&sy(s,c,o,h,l,u,y.x,y.y)&&sx(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=d&&x.x<=f&&x.y>=p&&x.y<=m&&x!==r&&x!==a&&sy(s,c,o,h,l,u,x.x,x.y)&&sx(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=g;){if(y.x>=d&&y.x<=f&&y.y>=p&&y.y<=m&&y!==r&&y!==a&&sy(s,c,o,h,l,u,y.x,y.y)&&sx(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=d&&x.x<=f&&x.y>=p&&x.y<=m&&x!==r&&x!==a&&sy(s,c,o,h,l,u,x.x,x.y)&&sx(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}(t,r,a,s):function(e){let t=e.prev,i=e.next;if(sx(t,e,i)>=0)return!1;let n=t.x,r=e.x,a=i.x,s=t.y,o=e.y,l=i.y,c=n<r?n<a?n:a:r<a?r:a,h=s<o?s<l?s:l:o<l?o:l,u=n>r?n>a?n:a:r>a?r:a,d=s>o?s>l?s:l:o>l?o:l,p=i.next;for(;p!==t;){if(p.x>=c&&p.x<=u&&p.y>=h&&p.y<=d&&sy(n,s,r,o,a,l,p.x,p.y)&&sx(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}(t)){i.push(c.i/n|0),i.push(t.i/n|0),i.push(h.i/n|0),sC(t),t=h.next,l=h.next;continue}if((t=h)===l){o?1===o?e(t=function(e,t,i){let n=e;do{let r=n.prev,a=n.next.next;!s_(r,a)&&sA(r,n,n.next,a)&&sw(r,a)&&sw(a,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(a.i/i|0),sC(n),sC(n.next),n=e=a),n=n.next}while(n!==e);return sm(n)}(sm(t),i,n),i,n,r,a,s,2):2===o&&function(t,i,n,r,a,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){var l,c;if(o.i!==t.i&&(l=o,c=t,l.next.i!==c.i&&l.prev.i!==c.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&sA(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(l,c)&&(sw(l,c)&&sw(c,l)&&function(e,t){let i=e,n=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==e);return n}(l,c)&&(sx(l.prev,l,c.prev)||sx(l,c.prev,c))||s_(l,c)&&sx(l.prev,l,l.next)>0&&sx(c.prev,c,c.next)>0))){let l=sM(o,t);o=sm(o,o.next),l=sm(l,l.next),e(o,i,n,r,a,s,0),e(l,i,n,r,a,s,0);return}t=t.next}o=o.next}while(o!==t)}(t,i,n,r,a,s):e(sm(t),i,n,r,a,s,1);break}}}(d,p,i,n,r,c,0),p};function sf(e,t,i,n,r){let a,s;if(r===function(e,t,i,n){let r=0;for(let a=t,s=i-n;a<i;a+=n)r+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return r}(e,t,i,n)>0)for(a=t;a<i;a+=n)s=sE(a,e[a],e[a+1],s);else for(a=i-n;a>=t;a-=n)s=sE(a,e[a],e[a+1],s);return s&&s_(s,s.next)&&(sC(s),s=s.next),s}function sm(e,t){if(!e)return e;t||(t=e);let i=e,n;do if(n=!1,!i.steiner&&(s_(i,i.next)||0===sx(i.prev,i,i.next))){if(sC(i),(i=t=i.prev)===i.next)break;n=!0}else i=i.next;while(n||i!==t);return t}function sg(e,t){return e.x-t.x}function sv(e,t,i,n,r){return(e=((e=((e=((e=((e=(e-i)*r|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(t=((t=((t=((t=((t=(t-n)*r|0)|t<<8)&0xff00ff)|t<<4)&0xf0f0f0f)|t<<2)&0x33333333)|t<<1)&0x55555555)<<1}function sy(e,t,i,n,r,a,s,o){return(r-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(n-o)>=(i-s)*(t-o)&&(i-s)*(a-o)>=(r-s)*(n-o)}function sx(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function s_(e,t){return e.x===t.x&&e.y===t.y}function sA(e,t,i,n){let r=sS(sx(e,t,i)),a=sS(sx(e,t,n)),s=sS(sx(i,n,e)),o=sS(sx(i,n,t));return!!(r!==a&&s!==o||0===r&&sb(e,i,t)||0===a&&sb(e,n,t)||0===s&&sb(i,e,n)||0===o&&sb(i,t,n))}function sb(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function sS(e){return e>0?1:e<0?-1:0}function sw(e,t){return 0>sx(e.prev,e,e.next)?sx(e,t,e.next)>=0&&sx(e,e.prev,t)>=0:0>sx(e,t,e.prev)||0>sx(e,e.next,t)}function sM(e,t){let i=new sT(e.i,e.x,e.y),n=new sT(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function sE(e,t,i,n){let r=new sT(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function sC(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function sT(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class sR{static area(e){let t=e.length,i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return .5*i}static isClockWise(e){return 0>sR.area(e)}static triangulateShape(e,t){let i=[],n=[],r=[];sP(e),sI(i,e);let a=e.length;t.forEach(sP);for(let e=0;e<t.length;e++)n.push(a),a+=t[e].length,sI(i,t[e]);let s=sp(i,n);for(let e=0;e<s.length;e+=3)r.push(s.slice(e,e+3));return r}}function sP(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function sI(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class sL extends tB{constructor(e=new sd([new P(.5,.5),new P(-.5,.5),new P(-.5,-.5),new P(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let i=this,n=[],r=[];for(let a=0,s=e.length;a<s;a++)!function(e){let a,s,o,l;let c=[],h=void 0!==t.curveSegments?t.curveSegments:12,u=void 0!==t.steps?t.steps:1,d=void 0!==t.depth?t.depth:1,p=void 0===t.bevelEnabled||t.bevelEnabled,f=void 0!==t.bevelThickness?t.bevelThickness:.2,m=void 0!==t.bevelSize?t.bevelSize:f-.1,g=void 0!==t.bevelOffset?t.bevelOffset:0,v=void 0!==t.bevelSegments?t.bevelSegments:3,y=t.extrudePath,x=void 0!==t.UVGenerator?t.UVGenerator:sD,_,A=!1;y&&(_=y.getSpacedPoints(u),A=!0,p=!1,a=y.computeFrenetFrames(u,!1),s=new ea,o=new ea,l=new ea),p||(v=0,f=0,m=0,g=0);let b=e.extractPoints(h),S=b.shape,w=b.holes;if(!sR.isClockWise(S)){S=S.reverse();for(let e=0,t=w.length;e<t;e++){let t=w[e];sR.isClockWise(t)&&(w[e]=t.reverse())}}let M=sR.triangulateShape(S,w),E=S;for(let e=0,t=w.length;e<t;e++){let t=w[e];S=S.concat(t)}function C(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,i)}let T=S.length,R=M.length;function I(e,t,i){let n,r,a;let s=e.x-t.x,o=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=s*s+o*o;if(Math.abs(s*c-o*l)>Number.EPSILON){let u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=t.x-o/u,f=t.y+s/u,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(s*c-o*l),g=(n=p+s*m-e.x)*n+(r=f+o*m-e.y)*r;if(g<=2)return new P(n,r);a=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(n=-o,r=s,a=Math.sqrt(h)):(n=s,r=o,a=Math.sqrt(h/2))}return new P(n/a,r/a)}let L=[];for(let e=0,t=E.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),L[e]=I(E[e],E[i],E[n]);let D=[],B,O=L.concat();for(let e=0,t=w.length;e<t;e++){let t=w[e];B=[];for(let e=0,i=t.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),B[e]=I(t[e],t[n],t[r]);D.push(B),O=O.concat(B)}for(let e=0;e<v;e++){let t=e/v,i=f*Math.cos(t*Math.PI/2),n=m*Math.sin(t*Math.PI/2)+g;for(let e=0,t=E.length;e<t;e++){let t=C(E[e],L[e],n);F(t.x,t.y,-i)}for(let e=0,t=w.length;e<t;e++){let t=w[e];B=D[e];for(let e=0,r=t.length;e<r;e++){let r=C(t[e],B[e],n);F(r.x,r.y,-i)}}}let N=m+g;for(let e=0;e<T;e++){let t=p?C(S[e],O[e],N):S[e];A?(o.copy(a.normals[0]).multiplyScalar(t.x),s.copy(a.binormals[0]).multiplyScalar(t.y),l.copy(_[0]).add(o).add(s),F(l.x,l.y,l.z)):F(t.x,t.y,0)}for(let e=1;e<=u;e++)for(let t=0;t<T;t++){let i=p?C(S[t],O[t],N):S[t];A?(o.copy(a.normals[e]).multiplyScalar(i.x),s.copy(a.binormals[e]).multiplyScalar(i.y),l.copy(_[e]).add(o).add(s),F(l.x,l.y,l.z)):F(i.x,i.y,d/u*e)}for(let e=v-1;e>=0;e--){let t=e/v,i=f*Math.cos(t*Math.PI/2),n=m*Math.sin(t*Math.PI/2)+g;for(let e=0,t=E.length;e<t;e++){let t=C(E[e],L[e],n);F(t.x,t.y,d+i)}for(let e=0,t=w.length;e<t;e++){let t=w[e];B=D[e];for(let e=0,r=t.length;e<r;e++){let r=C(t[e],B[e],n);A?F(r.x,r.y+_[u-1].y,_[u-1].x+i):F(r.x,r.y,d+i)}}}function U(e,t){let r=e.length;for(;--r>=0;){let a=r,s=r-1;s<0&&(s=e.length-1);for(let e=0,r=u+2*v;e<r;e++){let r=T*e,o=T*(e+1);!function(e,t,r,a){z(e),z(t),z(a),z(t),z(r),z(a);let s=n.length/3,o=x.generateSideWallUV(i,n,s-6,s-3,s-2,s-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}(t+a+r,t+s+r,t+s+o,t+a+o)}}}function F(e,t,i){c.push(e),c.push(t),c.push(i)}function k(e,t,r){z(e),z(t),z(r);let a=n.length/3,s=x.generateTopUV(i,n,a-3,a-2,a-1);H(s[0]),H(s[1]),H(s[2])}function z(e){n.push(c[3*e+0]),n.push(c[3*e+1]),n.push(c[3*e+2])}function H(e){r.push(e.x),r.push(e.y)}(function(){let e=n.length/3;if(p){let e=0,t=0*T;for(let e=0;e<R;e++){let i=M[e];k(i[2]+t,i[1]+t,i[0]+t)}t=T*(u+2*v);for(let e=0;e<R;e++){let i=M[e];k(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<R;e++){let t=M[e];k(t[2],t[1],t[0])}for(let e=0;e<R;e++){let t=M[e];k(t[0]+T*u,t[1]+T*u,t[2]+T*u)}}i.addGroup(e,n.length/3-e,0)})(),function(){let e=n.length/3,t=0;U(E,0),t+=E.length;for(let e=0,i=w.length;e<i;e++){let i=w[e];U(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}(e[a]);this.setAttribute("position",new tE(n,3)),this.setAttribute("uv",new tE(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){let n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){let i=[];for(let n=0,r=e.shapes.length;n<r;n++){let r=t[e.shapes[n]];i.push(r)}let n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=new a8[n.type]().fromJSON(n)),new sL(i,e.options)}}let sD={generateTopUV:function(e,t,i,n,r){let a=t[3*i],s=t[3*i+1],o=t[3*n],l=t[3*n+1],c=t[3*r],h=t[3*r+1];return[new P(a,s),new P(o,l),new P(c,h)]},generateSideWallUV:function(e,t,i,n,r,a){let s=t[3*i],o=t[3*i+1],l=t[3*i+2],c=t[3*n],h=t[3*n+1],u=t[3*n+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(o-h)<Math.abs(s-c)?[new P(s,1-l),new P(c,1-u),new P(d,1-f),new P(m,1-v)]:[new P(o,1-l),new P(h,1-u),new P(p,1-f),new P(g,1-v)]}};class sB extends sa{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sB(e.radius,e.detail)}}class sO extends sa{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sO(e.radius,e.detail)}}class sN extends tB{constructor(e=.5,t=1,i=32,n=1,r=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},i=Math.max(3,i);let s=[],o=[],l=[],c=[],h=e,u=(t-e)/(n=Math.max(1,n)),d=new ea,p=new P;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){let n=r+e/i*a;d.x=h*Math.cos(n),d.y=h*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=u}for(let e=0;e<n;e++){let t=e*(i+1);for(let e=0;e<i;e++){let n=e+t,r=n+i+1,a=n+i+2,o=n+1;s.push(n,r,o),s.push(r,a,o)}}this.setIndex(s),this.setAttribute("position",new tE(o,3)),this.setAttribute("normal",new tE(l,3)),this.setAttribute("uv",new tE(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sN(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class sU extends tB{constructor(e=new sd([new P(0,.5),new P(-.5,-.5),new P(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let i=[],n=[],r=[],a=[],s=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,o,t),s+=o,o=0;function l(e){let s=n.length/3,l=e.extractPoints(t),c=l.shape,h=l.holes;!1===sR.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){let t=h[e];!0===sR.isClockWise(t)&&(h[e]=t.reverse())}let u=sR.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){let t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){let t=c[e];n.push(t.x,t.y,0),r.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){let t=u[e],n=t[0]+s,r=t[1]+s,a=t[2]+s;i.push(n,r,a),o+=3}}this.setIndex(i),this.setAttribute("position",new tE(n,3)),this.setAttribute("normal",new tE(r,3)),this.setAttribute("uv",new tE(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){let n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){let i=[];for(let n=0,r=e.shapes.length;n<r;n++){let r=t[e.shapes[n]];i.push(r)}return new sU(i,e.curveSegments)}}class sF extends tB{constructor(e=1,t=32,i=16,n=0,r=2*Math.PI,a=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(a+s,Math.PI),l=0,c=[],h=new ea,u=new ea,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){let g=[],v=d/i,y=0;0===d&&0===a?y=.5/t:d===i&&o===Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){let o=i/t;h.x=-e*Math.cos(n+o*r)*Math.sin(a+v*s),h.y=e*Math.cos(a+v*s),h.z=e*Math.sin(n+o*r)*Math.sin(a+v*s),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){let t=c[e][n+1],r=c[e][n],s=c[e+1][n],l=c[e+1][n+1];(0!==e||a>0)&&d.push(t,r,l),(e!==i-1||o<Math.PI)&&d.push(r,s,l)}this.setIndex(d),this.setAttribute("position",new tE(p,3)),this.setAttribute("normal",new tE(f,3)),this.setAttribute("uv",new tE(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sF(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class sk extends sa{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sk(e.radius,e.detail)}}class sz extends tB{constructor(e=1,t=.4,i=12,n=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);let a=[],s=[],o=[],l=[],c=new ea,h=new ea,u=new ea;for(let a=0;a<=i;a++)for(let d=0;d<=n;d++){let p=d/n*r,f=a/i*Math.PI*2;h.x=(e+t*Math.cos(f))*Math.cos(p),h.y=(e+t*Math.cos(f))*Math.sin(p),h.z=t*Math.sin(f),s.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(a/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){let i=(n+1)*e+t-1,r=(n+1)*(e-1)+t-1,s=(n+1)*(e-1)+t,o=(n+1)*e+t;a.push(i,r,o),a.push(r,s,o)}this.setIndex(a),this.setAttribute("position",new tE(s,3)),this.setAttribute("normal",new tE(o,3)),this.setAttribute("uv",new tE(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sz(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class sH extends tB{constructor(e=1,t=.4,i=64,n=8,r=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:a},i=Math.floor(i),n=Math.floor(n);let s=[],o=[],l=[],c=[],h=new ea,u=new ea,d=new ea,p=new ea,f=new ea,m=new ea,g=new ea;for(let s=0;s<=i;++s){let y=s/i*r*Math.PI*2;v(y,r,a,e,d),v(y+.01,r,a,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=n;++e){let r=e/n*Math.PI*2,a=-t*Math.cos(r),p=t*Math.sin(r);h.x=d.x+(a*g.x+p*f.x),h.y=d.y+(a*g.y+p*f.y),h.z=d.z+(a*g.z+p*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(s/i),c.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){let i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),a=(n+1)*e+t,o=(n+1)*(e-1)+t;s.push(i,r,o),s.push(r,a,o)}function v(e,t,i,n,r){let a=Math.cos(e),s=Math.sin(e),o=i/t*e,l=Math.cos(o);r.x=n*(2+l)*.5*a,r.y=n*(2+l)*s*.5,r.z=n*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new tE(o,3)),this.setAttribute("normal",new tE(l,3)),this.setAttribute("uv",new tE(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sH(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class sV extends tB{constructor(e=new a5(new ea(-1,-1,0),new ea(-1,1,0),new ea(1,1,0)),t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};let a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let s=new ea,o=new ea,l=new P,c=new ea,h=[],u=[],d=[],p=[];function f(r){c=e.getPointAt(r/t,c);let l=a.normals[r],d=a.binormals[r];for(let e=0;e<=n;e++){let t=e/n*Math.PI*2,r=Math.sin(t),a=-Math.cos(t);o.x=a*l.x+r*d.x,o.y=a*l.y+r*d.y,o.z=a*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),s.x=c.x+i*o.x,s.y=c.y+i*o.y,s.z=c.z+i*o.z,h.push(s.x,s.y,s.z)}}(function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){let i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),a=(n+1)*e+t,s=(n+1)*(e-1)+t;p.push(i,r,s),p.push(r,a,s)}}()})(),this.setIndex(p),this.setAttribute("position",new tE(h,3)),this.setAttribute("normal",new tE(u,3)),this.setAttribute("uv",new tE(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new sV(new a8[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class sG extends tB{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){let t=[],i=new Set,n=new ea,r=new ea;if(null!==e.index){let a=e.attributes.position,s=e.index,o=e.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){let l=o[e],c=l.start,h=l.count;for(let e=c,o=c+h;e<o;e+=3)for(let o=0;o<3;o++){let l=s.getX(e+o),c=s.getX(e+(o+1)%3);n.fromBufferAttribute(a,l),r.fromBufferAttribute(a,c),!0===sW(n,r,i)&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}}else{let a=e.attributes.position;for(let e=0,s=a.count/3;e<s;e++)for(let s=0;s<3;s++){let o=3*e+s,l=3*e+(s+1)%3;n.fromBufferAttribute(a,o),r.fromBufferAttribute(a,l),!0===sW(n,r,i)&&(t.push(n.x,n.y,n.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new tE(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function sW(e,t,i){let n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var sj=Object.freeze({__proto__:null,BoxGeometry:t0,CapsuleGeometry:st,CircleGeometry:si,ConeGeometry:sr,CylinderGeometry:sn,DodecahedronGeometry:ss,EdgesGeometry:su,ExtrudeGeometry:sL,IcosahedronGeometry:sB,LatheGeometry:se,OctahedronGeometry:sO,PlaneGeometry:iu,PolyhedronGeometry:sa,RingGeometry:sN,ShapeGeometry:sU,SphereGeometry:sF,TetrahedronGeometry:sk,TorusGeometry:sz,TorusKnotGeometry:sH,TubeGeometry:sV,WireframeGeometry:sG});class sq extends tg{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new tp(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class sX extends t5{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class sY extends tg{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new tp(0xffffff),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new P(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sK extends sY{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new P(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return S(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new tp(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new tp(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new tp(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class sQ extends tg{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new tp(0xffffff),this.specular=new tp(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new P(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sJ extends tg{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new tp(0xffffff),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new P(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class sZ extends tg{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new P(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class s$ extends tg{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new tp(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tp(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new P(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class s0 extends tg{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new tp(0xffffff),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new P(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class s1 extends aS{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function s2(e,t,i){return e&&(i||e.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function s3(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function s4(e){let t=e.length,i=Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort(function(t,i){return e[t]-e[i]}),i}function s5(e,t,i){let n=e.length,r=new e.constructor(n);for(let a=0,s=0;s!==n;++a){let n=i[a]*t;for(let i=0;i!==t;++i)r[s++]=e[n+i]}return r}function s6(e,t,i,n){let r=1,a=e[0];for(;void 0!==a&&void 0===a[n];)a=e[r++];if(void 0===a)return;let s=a[n];if(void 0!==s){if(Array.isArray(s))do void 0!==(s=a[n])&&(t.push(a.time),i.push.apply(i,s)),a=e[r++];while(void 0!==a);else if(void 0!==s.toArray)do void 0!==(s=a[n])&&(t.push(a.time),s.toArray(i,i.length)),a=e[r++];while(void 0!==a);else do void 0!==(s=a[n])&&(t.push(a.time),i.push(s)),a=e[r++];while(void 0!==a)}}class s8{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];t:{i:{let a;n:{r:if(!(e<n)){for(let a=i+2;;){if(void 0===n){if(e<r)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,e<(n=t[++i]))break i}a=t.length;break n}if(!(e>=r)){let s=t[1];e<s&&(i=2,r=s);for(let a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===a)break;if(n=r,e>=(r=t[--i-1]))break i}a=i,i=0;break n}break t}for(;i<a;){let n=i+a>>>1;e<t[n]?a=n:i=n+1}if(n=t[i],void 0===(r=t[i-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let e=0;e!==n;++e)t[e]=i[r+e];return t}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class s9 extends s8{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){let n=this.parameterPositions,r=e-2,a=e+1,s=n[r],o=n[a];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:r=e,s=2*t-i;break;case 2402:r=n.length-2,s=t+n[r]-n[r+1];break;default:r=e,s=i}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:a=e,o=2*i-t;break;case 2402:a=1,o=i+n[1]-n[0];break;default:a=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=a*c}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==s;++e)r[e]=g*a[c+e]+v*a[l+e]+y*a[o+e]+x*a[h+e];return r}}class s7 extends s8{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(i-t)/(n-t),h=1-c;for(let e=0;e!==s;++e)r[e]=a[l+e]*h+a[o+e]*c;return r}}class oe extends s8{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class ot{constructor(e,t,i,n){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=s2(t,this.TimeBufferType),this.values=s2(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let t;let i=e.constructor;if(i.toJSON!==this.toJSON)t=i.toJSON(e);else{t={name:e.name,times:s2(e.times,Array),values:s2(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new oe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new s7(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new s9(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){let i=this.times,n=i.length,r=0,a=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==a&&i[a]>t;)--a;if(++a,0!==r||a!==n){r>=a&&(r=(a=Math.max(a,1))-1);let e=this.getValueSize();this.times=i.slice(r,a),this.values=this.values.slice(r*e,a*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==r;t++){let n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==a&&a>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,a),e=!1;break}a=n}if(void 0!==n&&s3(n))for(let t=0,i=n.length;t!==i;++t){let i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=2302===this.getInterpolation(),r=e.length-1,a=1;for(let s=1;s<r;++s){let r=!1,o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0])){if(n)r=!0;else{let e=s*i,n=e-i,a=e+i;for(let s=0;s!==i;++s){let i=t[e+s];if(i!==t[n+s]||i!==t[a+s]){r=!0;break}}}}if(r){if(s!==a){e[a]=e[s];let n=s*i,r=a*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++a}}if(r>0){e[a]=e[r];for(let e=r*i,n=a*i,s=0;s!==i;++s)t[n+s]=t[e+s];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),i=new this.constructor(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}ot.prototype.TimeBufferType=Float32Array,ot.prototype.ValueBufferType=Float32Array,ot.prototype.DefaultInterpolation=2301;class oi extends ot{}oi.prototype.ValueTypeName="bool",oi.prototype.ValueBufferType=Array,oi.prototype.DefaultInterpolation=2300,oi.prototype.InterpolantFactoryMethodLinear=void 0,oi.prototype.InterpolantFactoryMethodSmooth=void 0;class on extends ot{}on.prototype.ValueTypeName="color";class or extends ot{}or.prototype.ValueTypeName="number";class oa extends s8{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(i-t)/(n-t),l=e*s;for(let e=l+s;l!==e;l+=4)er.slerpFlat(r,0,a,l-s,a,l,o);return r}}class os extends ot{InterpolantFactoryMethodLinear(e){return new oa(this.times,this.values,this.getValueSize(),e)}}os.prototype.ValueTypeName="quaternion",os.prototype.DefaultInterpolation=2301,os.prototype.InterpolantFactoryMethodSmooth=void 0;class oo extends ot{}oo.prototype.ValueTypeName="string",oo.prototype.ValueBufferType=Array,oo.prototype.DefaultInterpolation=2300,oo.prototype.InterpolantFactoryMethodLinear=void 0,oo.prototype.InterpolantFactoryMethodSmooth=void 0;class ol extends ot{}ol.prototype.ValueTypeName="vector";class oc{constructor(e,t=-1,i,n=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=b(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,r=i.length;e!==r;++e)t.push((function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return or;case"vector":case"vector2":case"vector3":case"vector4":return ol;case"color":return on;case"quaternion":return os;case"bool":case"boolean":return oi;case"string":return oo}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let t=[],i=[];s6(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)})(i[e]).scale(n));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(ot.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){let r=t.length,a=[];for(let e=0;e<r;e++){let s=[],o=[];s.push((e+r-1)%r,e,(e+1)%r),o.push(0,1,0);let l=s4(s);s=s5(s,1,l),o=s5(o,1,l),n||0!==s[0]||(s.push(r),o.push(o[0])),a.push(new or(".morphTargetInfluences["+t[e].name+"]",s,o).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){let i=e[t],a=i.name.match(r);if(a&&a.length>1){let e=a[1],t=n[e];t||(n[e]=t=[]),t.push(i)}}let a=[];for(let e in n)a.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(e,t,i,n,r){if(0!==i.length){let a=[],s=[];s6(i,a,s,n),0!==a.length&&r.push(new e(t,a,s))}},n=[],r=e.name||"default",a=e.fps||30,s=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let e=0;e<l.length;e++){let r=l[e].keys;if(r&&0!==r.length){if(r[0].morphTargets){let e;let t={};for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(let i in t){let t=[],a=[];for(let n=0;n!==r[e].morphTargets.length;++n){let n=r[e];t.push(n.time),a.push(n.morphTarget===i?1:0)}n.push(new or(".morphTargetInfluence["+i+"]",t,a))}o=t.length*a}else{let a=".bones["+t[e].name+"]";i(ol,a+".position",r,"pos",n),i(os,a+".quaternion",r,"rot",n),i(ol,a+".scale",r,"scl",n)}}}return 0===n.length?null:new this(r,o,n,s)}resetDuration(){let e=this.tracks,t=0;for(let i=0,n=e.length;i!==n;++i){let e=this.tracks[i];t=Math.max(t,e.times[e.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let oh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class ou{constructor(e,t,i){let n;let r=this,a=!1,s=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===a&&void 0!==r.onStart&&r.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,o),s===o&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return -1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){let i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}let od=new ou;class op{constructor(e){this.manager=void 0!==e?e:od,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}op.DEFAULT_MATERIAL_NAME="__DEFAULT";let of={};class om extends Error{constructor(e,t){super(e),this.response=t}}class og extends op{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=oh.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==of[e]){of[e].push({onLoad:t,onProgress:i,onError:n});return}of[e]=[],of[e].push({onLoad:t,onProgress:i,onError:n});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,o=this.responseType;fetch(a).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;let i=of[e],n=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=r?parseInt(r):0,s=0!==a,o=0;return new Response(new ReadableStream({start(e){(function t(){n.read().then(({done:n,value:r})=>{if(n)e.close();else{let n=new ProgressEvent("progress",{lengthComputable:s,loaded:o+=r.byteLength,total:a});for(let e=0,t=i.length;e<t;e++){let t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(r),t()}})})()}}))}throw new om(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>new DOMParser().parseFromString(e,s));case"json":return e.json();default:if(void 0===s)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(s),i=new TextDecoder(t&&t[1]?t[1].toLowerCase():void 0);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(t=>{oh.add(e,t);let i=of[e];delete of[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onLoad&&n.onLoad(t)}}).catch(t=>{let i=of[e];if(void 0===i)throw this.manager.itemError(e),t;delete of[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ov extends op{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,a=oh.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;let s=N("img");function o(){c(),oh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class oy extends e6{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new tp(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}class ox extends oy{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(e6.DEFAULT_UP),this.updateMatrix(),this.groundColor=new tp(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}let o_=new eO,oA=new ea,ob=new ea;class oS{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new P(512,512),this.map=null,this.mapPass=null,this.matrix=new eO,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new il,this._frameExtents=new P(1,1),this._viewportCount=1,this._viewports=[new $(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;oA.setFromMatrixPosition(e.matrixWorld),t.position.copy(oA),ob.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ob),t.updateMatrixWorld(),o_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o_),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(o_)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ow extends oS{constructor(){super(new t8(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=2*A*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class oM extends oy{constructor(e,t,i=0,n=Math.PI/3,r=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(e6.DEFAULT_UP),this.updateMatrix(),this.target=new e6,this.distance=i,this.angle=n,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new ow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let oE=new eO,oC=new ea,oT=new ea;class oR extends oS{constructor(){super(new t8(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new P(4,2),this._viewportCount=6,this._viewports=[new $(2,1,1,1),new $(0,1,1,1),new $(3,1,1,1),new $(1,1,1,1),new $(3,0,1,1),new $(1,0,1,1)],this._cubeDirections=[new ea(1,0,0),new ea(-1,0,0),new ea(0,0,1),new ea(0,0,-1),new ea(0,1,0),new ea(0,-1,0)],this._cubeUps=[new ea(0,1,0),new ea(0,1,0),new ea(0,1,0),new ea(0,1,0),new ea(0,0,1),new ea(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),oC.setFromMatrixPosition(e.matrixWorld),i.position.copy(oC),oT.copy(i.position),oT.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(oT),i.updateMatrixWorld(),n.makeTranslation(-oC.x,-oC.y,-oC.z),oE.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oE)}}class oP extends oy{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new oR}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class oI extends oS{constructor(){super(new iS(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class oL extends oy{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(e6.DEFAULT_UP),this.updateMatrix(),this.target=new e6,this.shadow=new oI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class oD extends oy{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class oB extends oy{constructor(e,t,i=10,n=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class oO{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ea)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let i=e.x,n=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*n),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*i),t.addScaledVector(a[4],i*n*1.092548),t.addScaledVector(a[5],n*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],i*r*1.092548),t.addScaledVector(a[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){let i=e.x,n=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*n),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*i),t.addScaledVector(a[4],.858086*i*n),t.addScaledVector(a[5],.858086*n*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*i*r),t.addScaledVector(a[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){let i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){let i=e.x,n=e.y,r=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*r,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*i*r,t[8]=.546274*(i*i-n*n)}}class oN extends oy{constructor(e=new oO,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class oU extends op{constructor(e){super(e),this.textures={}}load(e,t,i,n){let r=this,a=new og(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},i,n)}parse(e){let t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}let n=oU.createMaterialFromType(e.type);if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=e.sheen),void 0!==e.sheenColor&&(n.sheenColor=new tp().setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(n.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.specularIntensity&&(n.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(n.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(n.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.thickness&&(n.thickness=e.thickness),void 0!==e.attenuationDistance&&(n.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(n.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(n.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(n.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(n.depthFunc=e.depthFunc),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(n.blendSrc=e.blendSrc),void 0!==e.blendDst&&(n.blendDst=e.blendDst),void 0!==e.blendEquation&&(n.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(n.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(n.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(n.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==n.blendColor&&n.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(n.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),void 0!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(n.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(let t in e.uniforms){let r=e.uniforms[t];switch(n.uniforms[t]={},r.type){case"t":n.uniforms[t].value=i(r.value);break;case"c":n.uniforms[t].value=new tp().setHex(r.value);break;case"v2":n.uniforms[t].value=new P().fromArray(r.value);break;case"v3":n.uniforms[t].value=new ea().fromArray(r.value);break;case"v4":n.uniforms[t].value=new $().fromArray(r.value);break;case"m3":n.uniforms[t].value=new I().fromArray(r.value);break;case"m4":n.uniforms[t].value=new eO().fromArray(r.value);break;default:n.uniforms[t].value=r.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(n.glslVersion=e.glslVersion),void 0!==e.extensions)for(let t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(n.lights=e.lights),void 0!==e.clipping&&(n.clipping=e.clipping),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=new P().fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(n.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(n.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=new P().fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(n.iridescenceMap=i(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(n.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(n.thicknessMap=i(e.thicknessMap)),void 0!==e.anisotropyMap&&(n.anisotropyMap=i(e.anisotropyMap)),void 0!==e.sheenColorMap&&(n.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(n.sheenRoughnessMap=i(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new({ShadowMaterial:sq,SpriteMaterial:rP,RawShaderMaterial:sX,ShaderMaterial:t5,PointsMaterial:aB,MeshPhysicalMaterial:sK,MeshStandardMaterial:sY,MeshPhongMaterial:sQ,MeshToonMaterial:sJ,MeshNormalMaterial:sZ,MeshLambertMaterial:s$,MeshDepthMaterial:rc,MeshDistanceMaterial:rh,MeshBasicMaterial:tv,MeshMatcapMaterial:s0,LineDashedMaterial:s1,LineBasicMaterial:aS,Material:tg})[e]}}class oF{static decodeText(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return -1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:t+e}}class ok extends tB{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class oz extends op{constructor(e){super(e)}load(e,t,i,n){let r=this,a=new og(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},i,n)}parse(e){let t={},i={};function n(e,n){if(void 0!==t[n])return t[n];let r=e.interleavedBuffers[n],a=function(e,t){if(void 0!==i[t])return i[t];let n=new Uint32Array(e.arrayBuffers[t]).buffer;return i[t]=n,n}(e,r.buffer),s=new rC(O(r.type,a),r.stride);return s.uuid=r.uuid,t[n]=s,s}let r=e.isInstancedBufferGeometry?new ok:new tB,a=e.data.index;if(void 0!==a){let e=O(a.type,a.array);r.setIndex(new tS(e,1))}let s=e.data.attributes;for(let t in s){let i;let a=s[t];if(a.isInterleavedBufferAttribute)i=new rR(n(e.data,a.data),a.itemSize,a.offset,a.normalized);else{let e=O(a.type,a.array);i=new(a.isInstancedBufferAttribute?r7:tS)(e,a.itemSize,a.normalized)}void 0!==a.name&&(i.name=a.name),void 0!==a.usage&&i.setUsage(a.usage),r.setAttribute(t,i)}let o=e.data.morphAttributes;if(o)for(let t in o){let i=o[t],a=[];for(let t=0,r=i.length;t<r;t++){let r;let s=i[t];r=s.isInterleavedBufferAttribute?new rR(n(e.data,s.data),s.itemSize,s.offset,s.normalized):new tS(O(s.type,s.array),s.itemSize,s.normalized),void 0!==s.name&&(r.name=s.name),a.push(r)}r.morphAttributes[t]=a}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);let l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){let t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}let c=e.data.boundingSphere;if(void 0!==c){let e=new ea;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new eE(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}let oH={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306},oV={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},oG={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};class oW{static getContext(){return void 0===r&&(r=new(window.AudioContext||window.webkitAudioContext)),r}static setContext(e){r=e}}let oj=new eO,oq=new eO,oX=new eO;class oY{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=oK(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=oK();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function oK(){return("undefined"==typeof performance?Date:performance).now()}let oQ=new ea,oJ=new er,oZ=new ea,o$=new ea;class o0 extends e6{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}let o1=new ea,o2=new er,o3=new ea,o4=new ea;class o5{constructor(e,t,i){let n,r,a;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,n=this.valueSize,r=e*n+n,a=this.cumulativeWeight;if(0===a){for(let e=0;e!==n;++e)i[r+e]=i[e];a=t}else{a+=t;let e=t/a;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=a}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}a>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(i[e]!==i[e+t]){s.setValue(i,n);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i;e!==n;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)e[t+n]=e[i+n]}_slerp(e,t,i,n){er.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){let a=this._workIndex*r;er.multiplyQuaternionsFlat(e,a,e,t,e,i),er.slerpFlat(e,t,e,t,e,a,n)}_lerp(e,t,i,n,r){let a=1-n;for(let s=0;s!==r;++s){let r=t+s;e[r]=e[r]*a+e[i+s]*n}}_lerpAdditive(e,t,i,n,r){for(let a=0;a!==r;++a){let r=t+a;e[r]=e[r]+e[i+a]*n}}}let o6="\\[\\]\\.:\\/",o8=RegExp("["+o6+"]","g"),o9="[^"+o6+"]",o7="[^"+o6.replace("\\.","")+"]",le=/((?:WC+[\/:])*)/.source.replace("WC",o9),lt=/(WCOD+)?/.source.replace("WCOD",o7),li=RegExp("^"+le+lt+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",o9)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",o9)+"$"),ln=["material","materials","bones","map"];class lr{constructor(e,t,i){this.path=t,this.parsedPath=i||lr.parseTrackName(t),this.node=lr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new lr.Composite(e,t,i):new lr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(o8,"")}static parseTrackName(e){let t=li.exec(e);if(null===t)throw Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let e=i.nodeName.substring(n+1);-1!==ln.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){let i=function(e){for(let n=0;n<e.length;n++){let r=e[n];if(r.name===t||r.uuid===t)return r;let a=i(r.children);if(a)return a}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=lr.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(void 0===e[i]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(void 0!==n){if(void 0===e[n]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[n]}}let a=e[n];if(void 0===a){console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lr.Composite=class{constructor(e,t,i){let n=i||lr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},lr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},lr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},lr.prototype.GetterByBindingType=[lr.prototype._getValue_direct,lr.prototype._getValue_array,lr.prototype._getValue_arrayElement,lr.prototype._getValue_toArray],lr.prototype.SetterByBindingTypeAndVersioning=[[lr.prototype._setValue_direct,lr.prototype._setValue_direct_setNeedsUpdate,lr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_array,lr.prototype._setValue_array_setNeedsUpdate,lr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_arrayElement,lr.prototype._setValue_arrayElement_setNeedsUpdate,lr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_fromArray,lr.prototype._setValue_fromArray_setNeedsUpdate,lr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class la{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;let r=t.tracks,a=r.length,s=Array(a),o={endingStart:2400,endingEnd:2400};for(let e=0;e!==a;++e){let t=r[e].createInterpolant(null);s[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let i=this._clip.duration,n=e._clip.duration;e.warp(1,n/i,t),this.warp(i/n,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let n=this._mixer,r=n.time,a=this.timeScale,s=this._timeScaleInterpolant;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);let o=s.parameterPositions,l=s.sampleValues;return o[0]=r,o[1]=r+i,l[0]=e/a,l[1]=t/a,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled){this._updateWeight(e);return}let r=this._startTime;if(null!==r){let n=(e-r)*i;n<0||0===i?t=0:(this._startTime=null,t=i*n)}t*=this._updateTimeScale(e);let a=this._updateTime(t),s=this._updateWeight(e);if(s>0){let e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(a),t[i].accumulateAdditive(s);else for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(a),t[i].accumulate(n,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(null!==i){let n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,n=this.time+e,r=this._loopCount,a=2202===i;if(0===e)return -1===r?n:a&&(1&r)==1?t-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));a:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break a}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),n>=t||n<0){let i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);let s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){let t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(a&&(1&r)==1)return t-n}return n}_setEndings(e,t,i){let n=this._interpolantSettings;i?(n.endingStart=2401,n.endingEnd=2401):(e?n.endingStart=this.zeroSlopeAtStart?2401:2400:n.endingStart=2402,t?n.endingEnd=this.zeroSlopeAtEnd?2401:2400:n.endingEnd=2402)}_scheduleFading(e,t,i){let n=this._mixer,r=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);let s=a.parameterPositions,o=a.sampleValues;return s[0]=r,o[0]=t,s[1]=r+e,o[1]=i,this}}let ls=new Float32Array(1);class lo{constructor(e){this.value=e}clone(){return new lo(void 0===this.value.clone?this.value:this.value.clone())}}let ll=0;function lc(e,t){return e.distance-t.distance}function lh(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){let n=e.children;for(let e=0,r=n.length;e<r;e++)lh(n[e],t,i,!0)}}let lu=new P,ld=new ea,lp=new ea,lf=new ea,lm=new ea,lg=new eO,lv=new eO,ly=new ea,lx=new tp,l_=new tp,lA=new ea,lb=new ea,lS=new ea,lw=new ea,lM=new t6;function lE(e,t,i,n,r,a,s){lw.set(r,a,s).unproject(n);let o=t[e];if(void 0!==o){let e=i.getAttribute("position");for(let t=0,i=o.length;t<i;t++)e.setXYZ(o[t],lw.x,lw.y,lw.z)}}let lC=new el,lT=new ea;"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"160"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="160"),t.ACESFilmicToneMapping=4,t.AddEquation=100,t.AddOperation=2,t.AdditiveAnimationBlendMode=2501,t.AdditiveBlending=2,t.AgXToneMapping=6,t.AlphaFormat=1021,t.AlwaysCompare=519,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=oD,t.AnimationAction=la,t.AnimationClip=oc,t.AnimationLoader=class extends op{constructor(e){super(e)}load(e,t,i,n){let r=this,a=new og(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(i){try{t(r.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),r.manager.itemError(e)}},i,n)}parse(e){let t=[];for(let i=0;i<e.length;i++){let n=oc.parse(e[i]);t.push(n)}return t}},t.AnimationMixer=class extends v{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,a=e._propertyBindings,s=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];void 0===c&&(c={},l[o]=c);for(let e=0;e!==r;++e){let r=n[e],l=r.name,h=c[l];if(void 0!==h)++h.referenceCount,a[e]=h;else{if(void 0!==(h=a[e])){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}let n=t&&t._propertyBindings[e].binding.parsedPath;h=new o5(lr.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),a[e]=h}s[e].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){let n=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{let t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,a=this._actionsByClip,s=a[r],o=s.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let h=s.actionByRoot,u=(e._localRoot||this._root).uuid;delete h[u],0===o.length&&delete a[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){let n=this._bindingsByRootAndName,r=this._bindings,a=n[t];void 0===a&&(a={},n[t]=a),a[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,a=this._bindingsByRootAndName,s=a[n],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[r],0===Object.keys(s).length&&delete a[n]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new s7(new Float32Array(2),new Float32Array(2),1,ls)).__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){let n=t||this._root,r=n.uuid,a="string"==typeof e?oc.findByName(n,e):e,s=null!==a?a.uuid:e,o=this._actionsByClip[s],l=null;if(void 0===i&&(i=null!==a?a.blendMode:2500),void 0!==o){let e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;let c=new la(this,a,t,i);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(e,t){let i=t||this._root,n=i.uuid,r="string"==typeof e?oc.findByName(i,e):e,a=r?r.uuid:e,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[n]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1;for(let s=0;s!==i;++s)t[s]._update(n,e,r,a);let s=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)s[e].apply(a);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){let e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){let n=e[i];this._deactivateAction(n);let r=n._cacheIndex,a=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,a._cacheIndex=r,t[r]=a,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let e in i){let n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}let n=this._bindingsByRootAndName[t];if(void 0!==n)for(let e in n){let t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){let i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},t.AnimationObjectGroup=class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=b(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,a=r.length,s,o=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){let h=arguments[c],u=h.uuid,d=t[u];if(void 0===d){d=o++,t[u]=d,e.push(h);for(let e=0;e!==a;++e)r[e].push(new lr(h,i[e],n[e]))}else if(d<l){s=e[d];let o=--l,c=e[o];t[c.uuid]=d,e[d]=c,t[u]=o,e[o]=h;for(let e=0;e!==a;++e){let t=r[e],a=t[o],s=t[d];t[d]=a,void 0===s&&(s=new lr(h,i[e],n[e])),t[o]=s}}else e[d]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){let e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length,r=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){let s=arguments[a],o=s.uuid,l=t[o];if(void 0!==l&&l>=r){let a=r++,c=e[a];t[c.uuid]=l,e[l]=c,t[o]=a,e[a]=s;for(let e=0;e!==n;++e){let t=i[e],n=t[a],r=t[l];t[l]=n,t[a]=r}}}this.nCachedObjects_=r}uncache(){let e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length,r=this.nCachedObjects_,a=e.length;for(let s=0,o=arguments.length;s!==o;++s){let o=arguments[s],l=o.uuid,c=t[l];if(void 0!==c){if(delete t[l],c<r){let s=--r,o=e[s],l=--a,h=e[l];t[o.uuid]=c,e[c]=o,t[h.uuid]=s,e[s]=h,e.pop();for(let e=0;e!==n;++e){let t=i[e],n=t[s],r=t[l];t[c]=n,t[s]=r,t.pop()}}else{let r=--a,s=e[r];r>0&&(t[s.uuid]=c),e[c]=s,e.pop();for(let e=0;e!==n;++e){let t=i[e];t[c]=t[r],t.pop()}}}}this.nCachedObjects_=r}subscribe_(e,t){let i=this._bindingsIndicesByPath,n=i[e],r=this._bindings;if(void 0!==n)return r[n];let a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=Array(l);n=r.length,i[e]=n,a.push(e),s.push(t),r.push(h);for(let i=c,n=o.length;i!==n;++i){let n=o[i];h[i]=new lr(n,e,t)}return h}unsubscribe_(e){let t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){let n=this._paths,r=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];t[e[s]]=i,a[i]=o,a.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}},t.AnimationUtils={convertArray:s2,isTypedArray:s3,getKeyframeOrder:s4,sortedArray:s5,flattenJSON:s6,subclip:function(e,t,i,n,r=30){let a=e.clone();a.name=t;let s=[];for(let e=0;e<a.tracks.length;++e){let t=a.tracks[e],o=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){let a=t.times[e]*r;if(!(a<i)&&!(a>=n)){l.push(t.times[e]);for(let i=0;i<o;++i)c.push(t.values[e*o+i])}}0!==l.length&&(t.times=s2(l,t.times.constructor),t.values=s2(c,t.values.constructor),s.push(t))}a.tracks=s;let o=1/0;for(let e=0;e<a.tracks.length;++e)o>a.tracks[e].times[0]&&(o=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*o);return a.resetDuration(),a},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);let r=i.tracks.length,a=t/n;for(let t=0;t<r;++t){let n;let r=i.tracks[t],s=r.ValueTypeName;if("bool"===s||"string"===s)continue;let o=e.tracks.find(function(e){return e.name===r.name&&e.ValueTypeName===s});if(void 0===o)continue;let l=0,c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);let h=0,u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let d=r.times.length-1;if(a<=r.times[0]){let e=l,t=c-l;n=r.values.slice(e,t)}else if(a>=r.times[d]){let e=d*c+l,t=e+c-l;n=r.values.slice(e,t)}else{let e=r.createInterpolant(),t=l,i=c-l;e.evaluate(a),n=e.resultBuffer.slice(t,i)}"quaternion"===s&&new er().fromArray(n).normalize().conjugate().toArray(n);let p=o.times.length;for(let e=0;e<p;++e){let t=e*u+h;if("quaternion"===s)er.multiplyQuaternionsFlat(o.values,t,n,0,o.values,t);else{let e=u-2*h;for(let i=0;i<e;++i)o.values[t+i]-=n[i]}}}return e.blendMode=2501,e}},t.ArcCurve=aW,t.ArrayCamera=rm,t.ArrowHelper=class extends e6{constructor(e=new ea(0,0,1),t=new ea(0,0,0),i=1,n=0xffff00,r=.2*i,o=.2*r){super(),this.type="ArrowHelper",void 0===a&&((a=new tB).setAttribute("position",new tE([0,0,0,0,1,0],3)),(s=new sn(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new aR(a,new aS({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new tZ(s,new tv({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{lT.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(lT,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},t.AttachedBindMode=o,t.Audio=o0,t.AudioAnalyser=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}},t.AudioContext=oW,t.AudioListener=class extends e6{constructor(){super(),this.type="AudioListener",this.context=oW.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new oY}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(oQ,oJ,oZ),o$.set(0,0,-1).applyQuaternion(oJ),t.positionX){let e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(oQ.x,e),t.positionY.linearRampToValueAtTime(oQ.y,e),t.positionZ.linearRampToValueAtTime(oQ.z,e),t.forwardX.linearRampToValueAtTime(o$.x,e),t.forwardY.linearRampToValueAtTime(o$.y,e),t.forwardZ.linearRampToValueAtTime(o$.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(oQ.x,oQ.y,oQ.z),t.setOrientation(o$.x,o$.y,o$.z,i.x,i.y,i.z)}},t.AudioLoader=class extends op{constructor(e){super(e)}load(e,t,i,n){let r=this,a=new og(this.manager);function s(t){n?n(t):console.error(t),r.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(e){try{let i=e.slice(0);oW.getContext().decodeAudioData(i,function(e){t(e)}).catch(s)}catch(e){s(e)}},i,n)}},t.AxesHelper=class extends aL{constructor(e=1){let t=new tB;t.setAttribute("position",new tE([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],3)),t.setAttribute("color",new tE([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(t,new aS({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){let n=new tp,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BatchedMesh=ab,t.Bone=r4,t.BooleanKeyframeTrack=oi,t.Box2=class{constructor(e=new P(Infinity,Infinity),t=new P(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=lu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,lu).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},t.Box3=el,t.Box3Helper=class extends aL{constructor(e,t=0xffff00){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new tB;n.setIndex(new tS(i,1)),n.setAttribute("position",new tE([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new aS({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BoxGeometry=t0,t.BoxHelper=class extends aL{constructor(e,t=0xffff00){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new tB;r.setIndex(new tS(i,1)),r.setAttribute("position",new tS(n,3)),super(r,new aS({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&lC.setFromObject(this.object),lC.isEmpty())return;let t=lC.min,i=lC.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BufferAttribute=tS,t.BufferGeometry=tB,t.BufferGeometryLoader=oz,t.ByteType=1010,t.Cache=oh,t.Camera=t6,t.CameraHelper=class extends aL{constructor(e){let t=new tB,i=new aS({color:0xffffff,vertexColors:!0,toneMapped:!1}),n=[],r=[],a={};function s(e,t){o(e),o(t)}function o(e){n.push(0,0,0),r.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new tE(n,3)),t.setAttribute("color",new tE(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();let l=new tp(0xffaa00),c=new tp(0xff0000),h=new tp(43775),u=new tp(0xffffff),d=new tp(3355443);this.setColors(l,c,h,u,d)}setColors(e,t,i,n,r){let a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,n.r,n.g,n.b),a.setXYZ(39,n.r,n.g,n.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;lM.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),lE("c",t,e,lM,0,0,-1),lE("t",t,e,lM,0,0,1),lE("n1",t,e,lM,-1,-1,-1),lE("n2",t,e,lM,1,-1,-1),lE("n3",t,e,lM,-1,1,-1),lE("n4",t,e,lM,1,1,-1),lE("f1",t,e,lM,-1,-1,1),lE("f2",t,e,lM,1,-1,1),lE("f3",t,e,lM,-1,1,1),lE("f4",t,e,lM,1,1,1),lE("u1",t,e,lM,.7,1.1,-1),lE("u2",t,e,lM,-.7,1.1,-1),lE("u3",t,e,lM,0,2,-1),lE("cf1",t,e,lM,-1,0,1),lE("cf2",t,e,lM,1,0,1),lE("cf3",t,e,lM,0,-1,1),lE("cf4",t,e,lM,0,1,1),lE("cn1",t,e,lM,-1,0,-1),lE("cn2",t,e,lM,1,0,-1),lE("cn3",t,e,lM,0,-1,-1),lE("cn4",t,e,lM,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},t.CanvasTexture=class extends Z{constructor(e,t,i,n,r,a,s,o,l){super(e,t,i,n,r,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},t.CapsuleGeometry=st,t.CatmullRomCurve3=aQ,t.CineonToneMapping=3,t.CircleGeometry=si,t.ClampToEdgeWrapping=1001,t.Clock=oY,t.Color=tp,t.ColorKeyframeTrack=on,t.ColorManagement=W,t.CompressedArrayTexture=class extends aH{constructor(e,t,i,n,r,a){super(e,t,i,r,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=1001}},t.CompressedCubeTexture=class extends aH{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,301),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},t.CompressedTexture=aH,t.CompressedTextureLoader=class extends op{constructor(e){super(e)}load(e,t,i,n){let r=this,a=[],s=new aH,o=new og(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;if(Array.isArray(e))for(let c=0,h=e.length;c<h;++c)!function(c){o.load(e[c],function(e){let i=r.parse(e,!0);a[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(l+=1)&&(1===i.mipmapCount&&(s.minFilter=1006),s.image=a,s.format=i.format,s.needsUpdate=!0,t&&t(s))},i,n)}(c);else o.load(e,function(e){let i=r.parse(e,!0);if(i.isCubemap){let e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)a[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),a[t].format=i.format,a[t].width=i.width,a[t].height=i.height}s.image=a}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=1006),s.format=i.format,s.needsUpdate=!0,t&&t(s)},i,n);return s}},t.ConeGeometry=sr,t.ConstantAlphaFactor=213,t.ConstantColorFactor=211,t.CubeCamera=t9,t.CubeReflectionMapping=301,t.CubeRefractionMapping=302,t.CubeTexture=t7,t.CubeTextureLoader=class extends op{constructor(e){super(e)}load(e,t,i,n){let r=new t7;r.colorSpace=c;let a=new ov(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;for(let i=0;i<e.length;++i)!function(i){a.load(e[i],function(e){r.images[i]=e,6==++s&&(r.needsUpdate=!0,t&&t(r))},void 0,n)}(i);return r}},t.CubeUVReflectionMapping=306,t.CubicBezierCurve=a0,t.CubicBezierCurve3=a1,t.CubicInterpolant=s9,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=aV,t.CurvePath=a9,t.CustomBlending=5,t.CustomToneMapping=5,t.CylinderGeometry=sn,t.Cylindrical=class{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}},t.Data3DTexture=en,t.DataArrayTexture=ei,t.DataTexture=r5,t.DataTextureLoader=class extends op{constructor(e){super(e)}load(e,t,i,n){let r=this,a=new r5,s=new og(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(e,function(e){let i;try{i=r.parse(e)}catch(e){if(void 0!==n)n(e);else{console.error(e);return}}void 0!==i.image?a.image=i.image:void 0!==i.data&&(a.image.width=i.width,a.image.height=i.height,a.image.data=i.data),a.wrapS=void 0!==i.wrapS?i.wrapS:1001,a.wrapT=void 0!==i.wrapT?i.wrapT:1001,a.magFilter=void 0!==i.magFilter?i.magFilter:1006,a.minFilter=void 0!==i.minFilter?i.minFilter:1006,a.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.colorSpace?a.colorSpace=i.colorSpace:void 0!==i.encoding&&(a.encoding=i.encoding),void 0!==i.flipY&&(a.flipY=i.flipY),void 0!==i.format&&(a.format=i.format),void 0!==i.type&&(a.type=i.type),void 0!==i.mipmaps&&(a.mipmaps=i.mipmaps,a.minFilter=1008),1===i.mipmapCount&&(a.minFilter=1006),void 0!==i.generateMipmaps&&(a.generateMipmaps=i.generateMipmaps),a.needsUpdate=!0,t&&t(a,i)},i,n),a}},t.DataUtils={toHalfFloat:tx,fromHalfFloat:t_},t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=od,t.DepthFormat=1026,t.DepthStencilFormat=1027,t.DepthTexture=iY,t.DetachedBindMode=l,t.DirectionalLight=oL,t.DirectionalLightHelper=class extends e6{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===t&&(t=1);let n=new tB;n.setAttribute("position",new tE([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new aS({fog:!1,toneMapped:!1});this.lightPlane=new aR(n,r),this.add(this.lightPlane),(n=new tB).setAttribute("position",new tE([0,0,0,0,0,1],3)),this.targetLine=new aR(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),lA.setFromMatrixPosition(this.light.matrixWorld),lb.setFromMatrixPosition(this.light.target.matrixWorld),lS.subVectors(lb,lA),this.lightPlane.lookAt(lb),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(lb),this.targetLine.scale.z=lS.length()}},t.DiscreteInterpolant=oe,t.DisplayP3ColorSpace=u,t.DodecahedronGeometry=ss,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=su,t.EllipseCurve=aG,t.EqualCompare=514,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=303,t.EquirectangularRefractionMapping=304,t.Euler=ej,t.EventDispatcher=v,t.ExtrudeGeometry=sL,t.FileLoader=og,t.Float16BufferAttribute=class extends tS{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=t_(this.array[e*this.itemSize]);return this.normalized&&(t=T(t,this.array)),t}setX(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize]=tx(t),this}getY(e){let t=t_(this.array[e*this.itemSize+1]);return this.normalized&&(t=T(t,this.array)),t}setY(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize+1]=tx(t),this}getZ(e){let t=t_(this.array[e*this.itemSize+2]);return this.normalized&&(t=T(t,this.array)),t}setZ(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize+2]=tx(t),this}getW(e){let t=t_(this.array[e*this.itemSize+3]);return this.normalized&&(t=T(t,this.array)),t}setW(e,t){return this.normalized&&(t=R(t,this.array)),this.array[e*this.itemSize+3]=tx(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=R(t,this.array),i=R(i,this.array)),this.array[e+0]=tx(t),this.array[e+1]=tx(i),this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=R(t,this.array),i=R(i,this.array),n=R(n,this.array)),this.array[e+0]=tx(t),this.array[e+1]=tx(i),this.array[e+2]=tx(n),this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=R(t,this.array),i=R(i,this.array),n=R(n,this.array),r=R(r,this.array)),this.array[e+0]=tx(t),this.array[e+1]=tx(i),this.array[e+2]=tx(n),this.array[e+3]=tx(r),this}},t.Float32BufferAttribute=tE,t.Float64BufferAttribute=class extends tS{constructor(e,t,i){super(new Float64Array(e),t,i)}},t.FloatType=1015,t.Fog=rM,t.FogExp2=rw,t.FramebufferTexture=class extends Z{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=1003,this.minFilter=1003,this.generateMipmaps=!1,this.needsUpdate=!0}},t.FrontSide=0,t.Frustum=il,t.GLBufferAttribute=class{constructor(e,t,i,n,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},t.GLSL1="100",t.GLSL3=g,t.GreaterCompare=516,t.GreaterDepth=6,t.GreaterEqualCompare=518,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=class extends aL{constructor(e=10,t=10,i=4473924,n=8947848){i=new tp(i),n=new tp(n);let r=t/2,a=e/t,s=e/2,o=[],l=[];for(let e=0,c=0,h=-s;e<=t;e++,h+=a){o.push(-s,0,h,s,0,h),o.push(h,0,-s,h,0,s);let t=e===r?i:n;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}let c=new tB;c.setAttribute("position",new tE(o,3)),c.setAttribute("color",new tE(l,3)),super(c,new aS({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},t.Group=rg,t.HalfFloatType=1016,t.HemisphereLight=ox,t.HemisphereLightHelper=class extends e6{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";let n=new sO(t);n.rotateY(.5*Math.PI),this.material=new tv({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);let r=new Float32Array(3*n.getAttribute("position").count);n.setAttribute("color",new tS(r,3)),this.add(new tZ(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{let t=e.geometry.getAttribute("color");lx.copy(this.light.color),l_.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){let n=e<i/2?lx:l_;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(ly.setFromMatrixPosition(this.light.matrixWorld).negate())}},t.IcosahedronGeometry=sB,t.ImageBitmapLoader=class extends op{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,a=oh.get(e);if(void 0!==a){if(r.manager.itemStart(e),a.then){a.then(i=>{t&&t(i),r.manager.itemEnd(e)}).catch(e=>{n&&n(e)});return}return setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a}let s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;let o=fetch(e,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(i){return oh.add(e,i),t&&t(i),r.manager.itemEnd(e),i}).catch(function(t){n&&n(t),oh.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});oh.add(e,o),r.manager.itemStart(e)}},t.ImageLoader=ov,t.ImageUtils=X,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=r7,t.InstancedBufferGeometry=ok,t.InstancedInterleavedBuffer=class extends rC{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}},t.InstancedMesh=ao,t.Int16BufferAttribute=class extends tS{constructor(e,t,i){super(new Int16Array(e),t,i)}},t.Int32BufferAttribute=class extends tS{constructor(e,t,i){super(new Int32Array(e),t,i)}},t.Int8BufferAttribute=class extends tS{constructor(e,t,i){super(new Int8Array(e),t,i)}},t.IntType=1013,t.InterleavedBuffer=rC,t.InterleavedBufferAttribute=rR,t.Interpolant=s8,t.InterpolateDiscrete=2300,t.InterpolateLinear=2301,t.InterpolateSmooth=2302,t.InvertStencilOp=5386,t.KeepStencilOp=7680,t.KeyframeTrack=ot,t.LOD=rX,t.LatheGeometry=se,t.Layers=eq,t.LessCompare=513,t.LessDepth=2,t.LessEqualCompare=515,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=oy,t.LightProbe=oN,t.Line=aR,t.Line3=class{constructor(e=new ea,t=new ea){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){ld.subVectors(e,this.start),lp.subVectors(this.end,this.start);let i=lp.dot(lp),n=lp.dot(ld)/i;return t&&(n=S(n,0,1)),n}closestPointToPoint(e,t,i){let n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},t.LineBasicMaterial=aS,t.LineCurve=a2,t.LineCurve3=a3,t.LineDashedMaterial=s1,t.LineLoop=aD,t.LineSegments=aL,t.LinearDisplayP3ColorSpace=d,t.LinearEncoding=3e3,t.LinearFilter=1006,t.LinearInterpolant=s7,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=1008,t.LinearMipmapNearestFilter=1007,t.LinearSRGBColorSpace=h,t.LinearToneMapping=1,t.LinearTransfer=p,t.Loader=op,t.LoaderUtils=oF,t.LoadingManager=ou,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=tg,t.MaterialLoader=oU,t.MathUtils={DEG2RAD:_,RAD2DEG:A,generateUUID:b,clamp:S,euclideanModulo:w,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:M,damp:function(e,t,i,n){return M(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs(w(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(x=e);let t=x+=0x6d2b79f5;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/0x100000000},degToRad:function(e){return e*_},radToDeg:function(e){return e*A},isPowerOfTwo:E,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:C,setQuaternionFromProperEuler:function(e,t,i,n,r){let a=Math.cos,s=Math.sin,o=a(i/2),l=s(i/2),c=a((t+n)/2),h=s((t+n)/2),u=a((t-n)/2),d=s((t-n)/2),p=a((n-t)/2),f=s((n-t)/2);switch(r){case"XYX":e.set(o*h,l*u,l*d,o*c);break;case"YZY":e.set(l*d,o*h,l*u,o*c);break;case"ZXZ":e.set(l*u,l*d,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:R,denormalize:T},t.Matrix3=I,t.Matrix4=eO,t.MaxEquation=104,t.Mesh=tZ,t.MeshBasicMaterial=tv,t.MeshDepthMaterial=rc,t.MeshDistanceMaterial=rh,t.MeshLambertMaterial=s$,t.MeshMatcapMaterial=s0,t.MeshNormalMaterial=sZ,t.MeshPhongMaterial=sQ,t.MeshPhysicalMaterial=sK,t.MeshStandardMaterial=sY,t.MeshToonMaterial=sJ,t.MinEquation=103,t.MirroredRepeatWrapping=1002,t.MixOperation=1,t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=1003,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=1005,t.NearestMipmapNearestFilter=1004,t.NeverCompare=512,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColorSpace="",t.NoToneMapping=0,t.NormalAnimationBlendMode=2500,t.NormalBlending=1,t.NotEqualCompare=517,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=or,t.Object3D=e6,t.ObjectLoader=class extends op{constructor(e){super(e)}load(e,t,i,n){let r=this,a=""===this.path?oF.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;let s=new og(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(i){let a=null;try{a=JSON.parse(i)}catch(t){void 0!==n&&n(t),console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message);return}let s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase()){void 0!==n&&n(Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(a,t)},i,n)}async loadAsync(e,t){let i=""===this.path?oF.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;let n=new og(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);let r=JSON.parse(await n.loadAsync(e,t)),a=r.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(r)}parse(e,t){let i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),a=this.parseImages(e.images,function(){void 0!==t&&t(l)}),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,r,o,s,i),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(let t in a)if(a[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){let t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),r=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,a),o=this.parseObject(e.object,n,s,a,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(e){let t={};if(void 0!==e)for(let i=0,n=e.length;i<n;i++){let n=new sd().fromJSON(e[i]);t[n.uuid]=n}return t}parseSkeletons(e,t){let i={},n={};if(t.traverse(function(e){e.isBone&&(n[e.uuid]=e)}),void 0!==e)for(let t=0,r=e.length;t<r;t++){let r=new r9().fromJSON(e[t],n);i[r.uuid]=r}return i}parseGeometries(e,t){let i={};if(void 0!==e){let n=new oz;for(let r=0,a=e.length;r<a;r++){let a;let s=e[r];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(s);break;default:s.type in sj?a=sj[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}}return i}parseMaterials(e,t){let i={},n={};if(void 0!==e){let r=new oU;r.setTextures(t);for(let t=0,a=e.length;t<a;t++){let a=e[t];void 0===i[a.uuid]&&(i[a.uuid]=r.parse(a)),n[a.uuid]=i[a.uuid]}}return n}parseAnimations(e){let t={};if(void 0!==e)for(let i=0;i<e.length;i++){let n=e[i],r=oc.parse(n);t[r.uuid]=r}return t}parseImages(e,t){let i;let n=this,r={};function a(e){if("string"==typeof e){var t;return t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e,n.manager.itemStart(t),i.load(t,function(){n.manager.itemEnd(t)},void 0,function(){n.manager.itemError(t),n.manager.itemEnd(t)})}return e.data?{data:O(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(i=new ov(new ou(t))).setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){let i=e[t],n=i.url;if(Array.isArray(n)){let e=[];for(let t=0,i=n.length;t<i;t++){let i=a(n[t]);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new r5(i.data,i.width,i.height)))}r[i.uuid]=new K(e)}else{let e=a(i.url);r[i.uuid]=new K(e)}}}return r}async parseImagesAsync(e){let t;let i=this,n={};async function r(e){if("string"==typeof e){let n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e;return await t.loadAsync(n)}return e.data?{data:O(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){(t=new ov(this.manager)).setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){let i=e[t],a=i.url;if(Array.isArray(a)){let e=[];for(let t=0,i=a.length;t<i;t++){let i=a[t],n=await r(i);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new r5(n.data,n.width,n.height)))}n[i.uuid]=new K(e)}else{let e=await r(i.url);n[i.uuid]=new K(e)}}}return n}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}let n={};if(void 0!==e)for(let r=0,a=e.length;r<a;r++){let a;let s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);let o=t[s.image],l=o.data;Array.isArray(l)?(a=new t7,6===l.length&&(a.needsUpdate=!0)):(a=l&&l.data?new r5:new Z,l&&(a.needsUpdate=!0)),a.source=o,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,oH)),void 0!==s.channel&&(a.channel=s.channel),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],oV),a.wrapT=i(s.wrap[1],oV)),void 0!==s.format&&(a.format=s.format),void 0!==s.internalFormat&&(a.internalFormat=s.internalFormat),void 0!==s.type&&(a.type=s.type),void 0!==s.colorSpace&&(a.colorSpace=s.colorSpace),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,oG)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,oG)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.generateMipmaps&&(a.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(a.compareFunction=s.compareFunction),void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n}parseObject(e,t,i,n,r){let a,s,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(i[r])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}function h(e){return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),n[e]}switch(e.type){case"Scene":a=new rE,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new tp(e.background):a.background=h(e.background)),void 0!==e.environment&&(a.environment=h(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new rM(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new rw(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":a=new t8(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new iS(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new oD(e.color,e.intensity);break;case"DirectionalLight":a=new oL(e.color,e.intensity);break;case"PointLight":a=new oP(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new oB(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new oM(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new ox(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new oN().fromJSON(e);break;case"SkinnedMesh":a=new r3(s=l(e.geometry),o=c(e.material)),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":a=new tZ(s=l(e.geometry),o=c(e.material));break;case"InstancedMesh":s=l(e.geometry),o=c(e.material);let u=e.count,d=e.instanceMatrix,p=e.instanceColor;(a=new ao(s,o,u)).instanceMatrix=new r7(new Float32Array(d.array),16),void 0!==p&&(a.instanceColor=new r7(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":s=l(e.geometry),o=c(e.material),(a=new ab(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,o)).geometry=s,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(e=>{let t=new el;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);let i=new eE;return i.radius=e.sphereRadius,i.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:i}}),a._maxGeometryCount=e.maxGeometryCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=h(e.matricesTexture.uuid);break;case"LOD":a=new rX;break;case"Line":a=new aR(l(e.geometry),c(e.material));break;case"LineLoop":a=new aD(l(e.geometry),c(e.material));break;case"LineSegments":a=new aL(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new ak(l(e.geometry),c(e.material));break;case"Sprite":a=new rG(c(e.material));break;case"Group":a=new rg;break;case"Bone":a=new r4;break;default:a=new e6}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){let s=e.children;for(let e=0;e<s.length;e++)a.add(this.parseObject(s[e],t,i,n,r))}if(void 0!==e.animations){let t=e.animations;for(let e=0;e<t.length;e++){let i=t[e];a.animations.push(r[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);let t=e.levels;for(let e=0;e<t.length;e++){let i=t[e],n=a.getObjectByProperty("uuid",i.object);void 0!==n&&a.addLevel(n,i.distance,i.hysteresis)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){let i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}})}},t.ObjectSpaceNormalMap=1,t.OctahedronGeometry=sO,t.OneFactor=201,t.OneMinusConstantAlphaFactor=214,t.OneMinusConstantColorFactor=212,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=iS,t.P3Primaries="p3",t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=iD,t.Path=a7,t.PerspectiveCamera=t8,t.Plane=ia,t.PlaneGeometry=iu,t.PlaneHelper=class extends aR{constructor(e,t=1,i=0xffff00){let n=new tB;n.setAttribute("position",new tE([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere(),super(n,new aS({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;let r=new tB;r.setAttribute("position",new tE([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new tZ(r,new tv({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},t.PointLight=oP,t.PointLightHelper=class extends tZ{constructor(e,t,i){super(new sF(t,4,2),new tv({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},t.Points=ak,t.PointsMaterial=aB,t.PolarGridHelper=class extends aL{constructor(e=10,t=16,i=8,n=64,r=4473924,a=8947848){r=new tp(r),a=new tp(a);let s=[],o=[];if(t>1)for(let i=0;i<t;i++){let n=i/t*(2*Math.PI),l=Math.sin(n)*e,c=Math.cos(n)*e;s.push(0,0,0),s.push(l,0,c);let h=1&i?r:a;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let t=0;t<i;t++){let l=1&t?r:a,c=e-e/i*t;for(let e=0;e<n;e++){let t=e/n*(2*Math.PI),i=Math.sin(t)*c,r=Math.cos(t)*c;s.push(i,0,r),o.push(l.r,l.g,l.b),i=Math.sin(t=(e+1)/n*(2*Math.PI))*c,r=Math.cos(t)*c,s.push(i,0,r),o.push(l.r,l.g,l.b)}}let l=new tB;l.setAttribute("position",new tE(s,3)),l.setAttribute("color",new tE(o,3)),super(l,new aS({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},t.PolyhedronGeometry=sa,t.PositionalAudio=class extends o0{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(o1,o2,o3),o4.set(0,0,1).applyQuaternion(o2);let t=this.panner;if(t.positionX){let e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(o1.x,e),t.positionY.linearRampToValueAtTime(o1.y,e),t.positionZ.linearRampToValueAtTime(o1.z,e),t.orientationX.linearRampToValueAtTime(o4.x,e),t.orientationY.linearRampToValueAtTime(o4.y,e),t.orientationZ.linearRampToValueAtTime(o4.z,e)}else t.setPosition(o1.x,o1.y,o1.z),t.setOrientation(o4.x,o4.y,o4.z)}},t.PropertyBinding=lr,t.PropertyMixer=o5,t.QuadraticBezierCurve=a4,t.QuadraticBezierCurve3=a5,t.Quaternion=er,t.QuaternionKeyframeTrack=os,t.QuaternionLinearInterpolant=oa,t.RED_GREEN_RGTC2_Format=36285,t.RED_RGTC1_Format=36283,t.REVISION="160",t.RGBADepthPacking=3201,t.RGBAFormat=1023,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_BPTC_Format=36492,t.RGBA_ETC2_EAC_Format=37496,t.RGBA_PVRTC_2BPPV1_Format=35843,t.RGBA_PVRTC_4BPPV1_Format=35842,t.RGBA_S3TC_DXT1_Format=33777,t.RGBA_S3TC_DXT3_Format=33778,t.RGBA_S3TC_DXT5_Format=33779,t.RGB_BPTC_SIGNED_Format=36494,t.RGB_BPTC_UNSIGNED_Format=36495,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=37492,t.RGB_PVRTC_2BPPV1_Format=35841,t.RGB_PVRTC_4BPPV1_Format=35840,t.RGB_S3TC_DXT1_Format=33776,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=sX,t.Ray=eB,t.Raycaster=class{constructor(e,t,i=0,n=1/0){this.ray=new eB(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new eq,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return lh(e,this,i,t),i.sort(lc),i}intersectObjects(e,t=!0,i=[]){for(let n=0,r=e.length;n<r;n++)lh(e[n],this,i,t);return i.sort(lc),i}},t.Rec709Primaries=m,t.RectAreaLight=oB,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RenderTarget=ee,t.RepeatWrapping=1e3,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingGeometry=sN,t.SIGNED_RED_GREEN_RGTC2_Format=36286,t.SIGNED_RED_RGTC1_Format=36284,t.SRGBColorSpace=c,t.SRGBTransfer=f,t.Scene=rE,t.ShaderChunk=id,t.ShaderLib=im,t.ShaderMaterial=t5,t.ShadowMaterial=sq,t.Shape=sd,t.ShapeGeometry=sU,t.ShapePath=class{constructor(){this.type="ShapePath",this.color=new tp,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new a7,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,a){return this.currentPath.bezierCurveTo(e,t,i,n,r,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){let t,i,n,r,a;let s=sR.isClockWise,o=this.subPaths;if(0===o.length)return[];let l=[];if(1===o.length)return i=o[0],(n=new sd).curves=i.curves,l.push(n),l;let c=!s(o[0].getPoints());c=e?!c:c;let h=[],u=[],d=[],p=0;u[0]=void 0,d[p]=[];for(let n=0,a=o.length;n<a;n++)t=s(r=(i=o[n]).getPoints()),(t=e?!t:t)?(!c&&u[p]&&p++,u[p]={s:new sd,p:r},u[p].s.curves=i.curves,c&&p++,d[p]=[]):d[p].push({h:i,p:r[0]});if(!u[0])return function(e){let t=[];for(let i=0,n=e.length;i<n;i++){let n=e[i],r=new sd;r.curves=n.curves,t.push(r)}return t}(o);if(u.length>1){let e=!1,t=0;for(let e=0,t=u.length;e<t;e++)h[e]=[];for(let i=0,n=u.length;i<n;i++){let n=d[i];for(let r=0;r<n.length;r++){let a=n[r],s=!0;for(let n=0;n<u.length;n++)(function(e,t){let i=t.length,n=!1;for(let r=i-1,a=0;a<i;r=a++){let i=t[r],s=t[a],o=s.x-i.x,l=s.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[a],o=-o,s=t[r],l=-l),e.y<i.y||e.y>s.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{let t=l*(e.x-i.x)-o*(e.y-i.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==i.y)continue;if(s.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=s.x)return!0}}return n})(a.p,u[n].p)&&(i!==n&&t++,s?(s=!1,h[n].push(a)):e=!0);s&&h[i].push(a)}}t>0&&!1===e&&(d=h)}for(let e=0,t=u.length;e<t;e++){n=u[e].s,l.push(n),a=d[e];for(let e=0,t=a.length;e<t;e++)n.holes.push(a[e].h)}return l}},t.ShapeUtils=sR,t.ShortType=1011,t.Skeleton=r9,t.SkeletonHelper=class extends aL{constructor(e){let t=function e(t){let i=[];!0===t.isBone&&i.push(t);for(let n=0;n<t.children.length;n++)i.push.apply(i,e(t.children[n]));return i}(e),i=new tB,n=[],r=[],a=new tp(0,0,1),s=new tp(0,1,0);for(let e=0;e<t.length;e++){let i=t[e];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(a.r,a.g,a.b),r.push(s.r,s.g,s.b))}i.setAttribute("position",new tE(n,3)),i.setAttribute("color",new tE(r,3)),super(i,new aS({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,i=this.geometry,n=i.getAttribute("position");lv.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){let r=t[e];r.parent&&r.parent.isBone&&(lg.multiplyMatrices(lv,r.matrixWorld),lm.setFromMatrixPosition(lg),n.setXYZ(i,lm.x,lm.y,lm.z),lg.multiplyMatrices(lv,r.parent.matrixWorld),lm.setFromMatrixPosition(lg),n.setXYZ(i+1,lm.x,lm.y,lm.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}},t.SkinnedMesh=r3,t.Source=K,t.Sphere=eE,t.SphereGeometry=sF,t.Spherical=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(S(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},t.SphericalHarmonics3=oO,t.SplineCurve=a6,t.SpotLight=oM,t.SpotLightHelper=class extends e6{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new tB,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1;e<32;e++,t++){let i=e/32*Math.PI*2,r=t/32*Math.PI*2;n.push(Math.cos(i),Math.sin(i),1,Math.cos(r),Math.sin(r),1)}i.setAttribute("position",new tE(n,3));let r=new aS({fog:!1,toneMapped:!1});this.cone=new aL(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),lf.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(lf),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},t.Sprite=rG,t.SpriteMaterial=rP,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=35044,t.StaticReadUsage=35045,t.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new t8,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new t8,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){let i,n;t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,oX.copy(e.projectionMatrix);let r=t.eyeSep/2,a=r*t.near/t.focus,s=t.near*Math.tan(_*t.fov*.5)/t.zoom;oq.elements[12]=-r,oj.elements[12]=r,i=-s*t.aspect+a,n=s*t.aspect+a,oX.elements[0]=2*t.near/(n-i),oX.elements[8]=(n+i)/(n-i),this.cameraL.projectionMatrix.copy(oX),i=-s*t.aspect-a,n=s*t.aspect-a,oX.elements[0]=2*t.near/(n-i),oX.elements[8]=(n+i)/(n-i),this.cameraR.projectionMatrix.copy(oX)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(oq),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(oj)}},t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=oo,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronGeometry=sk,t.Texture=Z,t.TextureLoader=class extends op{constructor(e){super(e)}load(e,t,i,n){let r=new Z,a=new ov(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},i,n),r}},t.TorusGeometry=sz,t.TorusKnotGeometry=sH,t.Triangle=tl,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeGeometry=sV,t.TwoPassDoubleSide=2,t.UVMapping=300,t.Uint16BufferAttribute=tw,t.Uint32BufferAttribute=tM,t.Uint8BufferAttribute=class extends tS{constructor(e,t,i){super(new Uint8Array(e),t,i)}},t.Uint8ClampedBufferAttribute=class extends tS{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}},t.Uniform=lo,t.UniformsGroup=class extends v{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:ll++}),this.name="",this.usage=35044,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){let t=this.uniforms.indexOf(e);return -1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;let t=e.uniforms;this.uniforms.length=0;for(let e=0,i=t.length;e<i;e++){let i=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0;e<i.length;e++)this.uniforms.push(i[e].clone())}return this}clone(){return new this.constructor().copy(this)}},t.UniformsLib=ip,t.UniformsUtils=t4,t.UnsignedByteType=1009,t.UnsignedInt248Type=1020,t.UnsignedIntType=1014,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShortType=1012,t.VSMShadowMap=3,t.Vector2=P,t.Vector3=ea,t.Vector4=$,t.VectorKeyframeTrack=ol,t.VideoTexture=class extends Z{constructor(e,t,i,n,r,a,s,o,l){super(e,t,i,n,r,a,s,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1;let c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)})}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},t.WebGL1Renderer=rS,t.WebGL3DRenderTarget=class extends et{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new en(null,e,t,i),this.texture.isRenderTargetTexture=!0}},t.WebGLArrayRenderTarget=class extends et{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new ei(null,e,t,i),this.texture.isRenderTargetTexture=!0}},t.WebGLCoordinateSystem=2e3,t.WebGLCubeRenderTarget=ie,t.WebGLMultipleRenderTargets=class extends et{constructor(e=1,t=1,i=1,n={}){super(e,t,n),this.isWebGLMultipleRenderTargets=!0;let r=this.texture;this.texture=[];for(let e=0;e<i;e++)this.texture[e]=r.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},t.WebGLRenderTarget=et,t.WebGLRenderer=rb,t.WebGLUtils=rf,t.WebGPUCoordinateSystem=2001,t.WireframeGeometry=sG,t.WrapAroundEnding=2402,t.ZeroCurvatureEnding=2400,t.ZeroFactor=200,t.ZeroSlopeEnding=2401,t.ZeroStencilOp=0,t._SRGBAFormat=1035,t.createCanvasElement=U,t.sRGBEncoding=3001},8204:function(e,t,i){"use strict";let n,r,a,s,o,l,c,h,u;i.r(t),i.d(t,{AbortablePromise:()=>p,DropInViewer:()=>t8,KSplatLoader:()=>tp,LoaderUtils:()=>tg,LogLevel:()=>tQ,OrbitControls:()=>tS,PlayCanvasCompressedPlyParser:()=>J,PlyLoader:()=>tt,PlyParser:()=>e3,RenderMode:()=>t5,SceneFormat:()=>tf,SceneRevealMode:()=>tK,SplatBuffer:()=>z,SplatBufferGenerator:()=>e5,SplatLoader:()=>td,SplatParser:()=>th,SplatPartitioner:()=>e4,SplatRenderMode:()=>tN,SpzLoader:()=>tc,Viewer:()=>t6,WebXRMode:()=>t2});var d=i(1795);class p{static idGen=0;constructor(e,t){let i,n;this.promise=new Promise((e,t)=>{i=e,n=t});let r=i.bind(this),a=n.bind(this);e(((...e)=>{r(...e)}).bind(this),(e=>{a(e)}).bind(this)),this.abortHandler=t,this.id=p.idGen++}then(e){return new p((t,i)=>{this.promise=this.promise.then((...i)=>{let n=e(...i);n instanceof Promise||n instanceof p?n.then((...e)=>{t(...e)}):t(n)}).catch(e=>{i(e)})},this.abortHandler)}catch(e){return new p(t=>{this.promise=this.promise.then((...e)=>{t(...e)}).catch(e)},this.abortHandler)}abort(e){this.abortHandler&&this.abortHandler(e)}}class f extends Error{constructor(e){super(e)}}new Int32Array(new Float32Array(1).buffer);let m=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),g=function(e,t,i=!0,n){let r=new AbortController,a=r.signal,s=!1,o=!1,l=(e,i,n,r)=>{t&&!o&&(t(e,i,n,r),100===e&&(o=!0))};return new p((t,r)=>{let o={signal:a};n&&(o.headers=n),fetch(e,o).then(async e=>{if(!e.ok){let t=await e.text();r(Error(`Fetch failed: ${e.status} ${e.statusText} ${t}`));return}let n=e.body.getReader(),a=0,o=e.headers.get("Content-Length"),c=o?parseInt(o):void 0,h=[];for(;!s;)try{let e,r;let{value:s,done:o}=await n.read();if(o){if(l(100,"100%",s,c),i){let e=new Blob(h).arrayBuffer();t(e)}else t();break}a+=s.length,void 0!==c&&(e=a/c*100,r=`${e.toFixed(2)}%`),i&&h.push(s),l(e,r,s,c)}catch(e){r(e);return}}).catch(e=>{r(new f(e))})},e=>{r.abort(e),s=!0})},v=function(e,t,i){return Math.max(Math.min(e,i),t)},y=function(){return performance.now()/1e3},x=e=>{if(e.geometry&&(e.geometry.dispose(),e.geometry=null),e.material&&(e.material.dispose(),e.material=null),e.children)for(let t of e.children)x(t)},_=(e,t)=>new Promise(i=>{window.setTimeout(()=>{i(e?e():void 0)},t?1:50)}),A=(e=0)=>{let t=0;if(1===e)t=9;else if(2===e)t=24;else if(3===e)t=45;else if(e>3)throw Error("getSphericalHarmonicsComponentCountForDegree() -> Invalid spherical harmonics degree");return t},b=()=>{let e,t;return{promise:new Promise((i,n)=>{e=i,t=n}),resolve:e,reject:t}},S=e=>{let t,i;return e||(e=()=>{}),{promise:new p((e,n)=>{t=e,i=n},e),resolve:t,reject:i}};class w{constructor(e,t,i){this.major=e,this.minor=t,this.patch=i}toString(){return`${this.major}_${this.minor}_${this.patch}`}}function M(){let e=navigator.userAgent;return e.indexOf("iPhone")>0||e.indexOf("iPad")>0}function E(){if(!M())return null;{let e=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);return new w(parseInt(e[1]||0,10),parseInt(e[2]||0,10),parseInt(e[3]||0,10))}}class C{static OFFSET={X:0,Y:1,Z:2,SCALE0:3,SCALE1:4,SCALE2:5,ROTATION0:6,ROTATION1:7,ROTATION2:8,ROTATION3:9,FDC0:10,FDC1:11,FDC2:12,OPACITY:13,FRC0:14,FRC1:15,FRC2:16,FRC3:17,FRC4:18,FRC5:19,FRC6:20,FRC7:21,FRC8:22,FRC9:23,FRC10:24,FRC11:25,FRC12:26,FRC13:27,FRC14:28,FRC15:29,FRC16:30,FRC17:31,FRC18:32,FRC19:33,FRC20:34,FRC21:35,FRC22:36,FRC23:37};constructor(e=0){this.sphericalHarmonicsDegree=e,this.sphericalHarmonicsCount=A(this.sphericalHarmonicsDegree),this.componentCount=this.sphericalHarmonicsCount+14,this.defaultSphericalHarmonics=Array(this.sphericalHarmonicsCount).fill(0),this.splats=[],this.splatCount=0}static createSplat(e=0){let t=[0,0,0,1,1,1,1,0,0,0,0,0,0,0],i=A(e);for(let e=0;e<i;e++)t.push(0);return t}addSplat(e){this.splats.push(e),this.splatCount++}getSplat(e){return this.splats[e]}addDefaultSplat(){let e=C.createSplat(this.sphericalHarmonicsDegree);return this.addSplat(e),e}addSplatFromComonents(e,t,i,n,r,a,s,o,l,c,h,u,d,p,...f){let m=[e,t,i,n,r,a,s,o,l,c,h,u,d,p,...this.defaultSphericalHarmonics];for(let e=0;e<f.length&&e<this.sphericalHarmonicsCount;e++)m[e]=f[e];return this.addSplat(m),m}addSplatFromArray(e,t){let i=e.splats[t],n=C.createSplat(this.sphericalHarmonicsDegree);for(let e=0;e<this.componentCount&&e<i.length;e++)n[e]=i[e];this.addSplat(n)}}class T{static DefaultSplatSortDistanceMapPrecision=16;static MemoryPageSize=65536;static BytesPerFloat=4;static BytesPerInt=4;static MaxScenes=32;static ProgressiveLoadSectionSize=262144;static ProgressiveLoadSectionDelayDuration=15;static SphericalHarmonics8BitCompressionRange=3}let R=T.SphericalHarmonics8BitCompressionRange/2,P=d.A5E.toHalfFloat.bind(d.A5E),I=d.A5E.fromHalfFloat.bind(d.A5E),L=(e,t,i=!1,n,r)=>0===t?e:1!==t&&(2!==t||i)?2===t?B(e,n,r):void 0:d.A5E.fromHalfFloat(e),D=(e,t,i)=>{e=v(e,t,i);let n=i-t;return v(Math.floor((e-t)/n*255),0,255)},B=(e,t,i)=>e/255*(i-t)+t,O=(e,t,i)=>D(I(e,t,i)),N=(e,t,i)=>P(B(e,t,i)),U=(e,t,i,n=!1)=>0===i?e.getFloat32(4*t,!0):1!==i&&(2!==i||n)?e.getUint8(t,!0):e.getUint16(2*t,!0),F=function(){let e=e=>e;return function(t,i,n,r=!1){if(i===n)return t;let a=e;return 2===i&&r?1===n?a=N:0==n&&(a=B):2===i||1===i?0===n?a=I:2==n&&(a=r?O:e):0===i&&(1===n?a=P:2==n&&(a=r?D:P)),a(t)}}(),k=(e,t,i,n,r=0)=>{let a=new Uint8Array(e,t),s=new Uint8Array(i,n);for(let e=0;e<r;e++)s[e]=a[e]};class z{static CurrentMajorVersion=0;static CurrentMinorVersion=1;static CenterComponentCount=3;static ScaleComponentCount=3;static RotationComponentCount=4;static ColorComponentCount=4;static CovarianceComponentCount=6;static SplatScaleOffsetFloat=3;static SplatRotationOffsetFloat=6;static CompressionLevels={0:{BytesPerCenter:12,BytesPerScale:12,BytesPerRotation:16,BytesPerColor:4,ScaleOffsetBytes:12,RotationffsetBytes:24,ColorOffsetBytes:40,SphericalHarmonicsOffsetBytes:44,ScaleRange:1,BytesPerSphericalHarmonicsComponent:4,SphericalHarmonicsOffsetFloat:11,SphericalHarmonicsDegrees:{0:{BytesPerSplat:44},1:{BytesPerSplat:80},2:{BytesPerSplat:140}}},1:{BytesPerCenter:6,BytesPerScale:6,BytesPerRotation:8,BytesPerColor:4,ScaleOffsetBytes:6,RotationffsetBytes:12,ColorOffsetBytes:20,SphericalHarmonicsOffsetBytes:24,ScaleRange:32767,BytesPerSphericalHarmonicsComponent:2,SphericalHarmonicsOffsetFloat:12,SphericalHarmonicsDegrees:{0:{BytesPerSplat:24},1:{BytesPerSplat:42},2:{BytesPerSplat:72}}},2:{BytesPerCenter:6,BytesPerScale:6,BytesPerRotation:8,BytesPerColor:4,ScaleOffsetBytes:6,RotationffsetBytes:12,ColorOffsetBytes:20,SphericalHarmonicsOffsetBytes:24,ScaleRange:32767,BytesPerSphericalHarmonicsComponent:1,SphericalHarmonicsOffsetFloat:12,SphericalHarmonicsDegrees:{0:{BytesPerSplat:24},1:{BytesPerSplat:33},2:{BytesPerSplat:48}}}};static CovarianceSizeFloats=6;static HeaderSizeBytes=4096;static SectionHeaderSizeBytes=1024;static BucketStorageSizeBytes=12;static BucketStorageSizeFloats=3;static BucketBlockSize=5;static BucketSize=256;constructor(e,t=!0){this.constructFromBuffer(e,t)}getSplatCount(){return this.splatCount}getMaxSplatCount(){return this.maxSplatCount}getMinSphericalHarmonicsDegree(){let e=0;for(let t=0;t<this.sections.length;t++){let i=this.sections[t];(0===t||i.sphericalHarmonicsDegree<e)&&(e=i.sphericalHarmonicsDegree)}return e}getBucketIndex(e,t){let i;let n=e.fullBucketCount*e.bucketSize;if(t<n)i=Math.floor(t/e.bucketSize);else{let r=n;i=e.fullBucketCount;let a=0;for(;r<e.splatCount;){let n=e.partiallyFilledBucketLengths[a];if(t>=r&&t<r+n)break;r+=n,i++,a++}}return i}getSplatCenter(e,t,i){let n=this.globalSplatIndexToSectionMap[e],r=this.sections[n],a=e-r.splatCountOffset,s=r.bytesPerSplat*a,o=new DataView(this.bufferData,r.dataBase+s),l=U(o,0,this.compressionLevel),c=U(o,1,this.compressionLevel),h=U(o,2,this.compressionLevel);if(this.compressionLevel>=1){let e=this.getBucketIndex(r,a)*z.BucketStorageSizeFloats,i=r.compressionScaleFactor,n=r.compressionScaleRange;t.x=(l-n)*i+r.bucketArray[e],t.y=(c-n)*i+r.bucketArray[e+1],t.z=(h-n)*i+r.bucketArray[e+2]}else t.x=l,t.y=c,t.z=h;i&&t.applyMatrix4(i)}getSplatScaleAndRotation=(function(){let e=new d.yGw,t=new d.yGw,i=new d.yGw,n=new d.Pa4,r=new d.Pa4,a=new d._fP;return function(s,o,l,c,h){let u=this.globalSplatIndexToSectionMap[s],d=this.sections[u],p=s-d.splatCountOffset,f=d.bytesPerSplat*p+z.CompressionLevels[this.compressionLevel].ScaleOffsetBytes,m=new DataView(this.bufferData,d.dataBase+f);r.set(L(U(m,0,this.compressionLevel),this.compressionLevel),L(U(m,1,this.compressionLevel),this.compressionLevel),L(U(m,2,this.compressionLevel),this.compressionLevel)),h&&(void 0!==h.x&&(r.x=h.x),void 0!==h.y&&(r.y=h.y),void 0!==h.z&&(r.z=h.z)),a.set(L(U(m,4,this.compressionLevel),this.compressionLevel),L(U(m,5,this.compressionLevel),this.compressionLevel),L(U(m,6,this.compressionLevel),this.compressionLevel),L(U(m,3,this.compressionLevel),this.compressionLevel)),c?(e.makeScale(r.x,r.y,r.z),t.makeRotationFromQuaternion(a),i.copy(e).multiply(t).multiply(c),i.decompose(n,l,o)):(o.copy(r),l.copy(a))}})();getSplatColor(e,t){let i=this.globalSplatIndexToSectionMap[e],n=this.sections[i],r=e-n.splatCountOffset,a=n.bytesPerSplat*r+z.CompressionLevels[this.compressionLevel].ColorOffsetBytes,s=new Uint8Array(this.bufferData,n.dataBase+a,4);t.set(s[0],s[1],s[2],s[3])}fillSplatCenterArray(e,t,i,n,r){let a=this.splatCount;i=i||0,n=n||a-1,void 0===r&&(r=i);let s=new d.Pa4;for(let a=i;a<=n;a++){let n=this.globalSplatIndexToSectionMap[a],o=this.sections[n],l=a-o.splatCountOffset,c=(a-i+r)*z.CenterComponentCount,h=o.bytesPerSplat*l,u=new DataView(this.bufferData,o.dataBase+h),d=U(u,0,this.compressionLevel),p=U(u,1,this.compressionLevel),f=U(u,2,this.compressionLevel);if(this.compressionLevel>=1){let e=this.getBucketIndex(o,l)*z.BucketStorageSizeFloats,t=o.compressionScaleFactor,i=o.compressionScaleRange;s.x=(d-i)*t+o.bucketArray[e],s.y=(p-i)*t+o.bucketArray[e+1],s.z=(f-i)*t+o.bucketArray[e+2]}else s.x=d,s.y=p,s.z=f;t&&s.applyMatrix4(t),e[c]=s.x,e[c+1]=s.y,e[c+2]=s.z}}fillSplatScaleRotationArray=(function(){let e=new d.yGw,t=new d.yGw,i=new d.yGw,n=new d.Pa4,r=new d._fP,a=new d.Pa4,s=e=>{let t=e.w<0?-1:1;e.x*=t,e.y*=t,e.z*=t,e.w*=t};return function(o,l,c,h,u,d,p,f){let m=this.splatCount;h=h||0,u=u||m-1,void 0===d&&(d=h);let g=(e,t)=>(void 0===t&&(t=this.compressionLevel),F(e,t,p));for(let p=h;p<=u;p++){let u=this.globalSplatIndexToSectionMap[p],m=this.sections[u],v=p-m.splatCountOffset,y=m.bytesPerSplat*v+z.CompressionLevels[this.compressionLevel].ScaleOffsetBytes,x=(p-h+d)*z.ScaleComponentCount,_=(p-h+d)*z.RotationComponentCount,A=new DataView(this.bufferData,m.dataBase+y),b=f&&void 0!==f.x?f.x:U(A,0,this.compressionLevel),S=f&&void 0!==f.y?f.y:U(A,1,this.compressionLevel),w=f&&void 0!==f.z?f.z:U(A,2,this.compressionLevel),M=U(A,3,this.compressionLevel),E=U(A,4,this.compressionLevel),C=U(A,5,this.compressionLevel),T=U(A,6,this.compressionLevel);n.set(L(b,this.compressionLevel),L(S,this.compressionLevel),L(w,this.compressionLevel)),r.set(L(E,this.compressionLevel),L(C,this.compressionLevel),L(T,this.compressionLevel),L(M,this.compressionLevel)).normalize(),c&&(a.set(0,0,0),e.makeScale(n.x,n.y,n.z),t.makeRotationFromQuaternion(r),i.identity().premultiply(e).premultiply(t),i.premultiply(c),i.decompose(a,r,n),r.normalize()),s(r),o&&(o[x]=g(n.x,0),o[x+1]=g(n.y,0),o[x+2]=g(n.z,0)),l&&(l[_]=g(r.x,0),l[_+1]=g(r.y,0),l[_+2]=g(r.z,0),l[_+3]=g(r.w,0))}}})();static computeCovariance=(function(){let e=new d.yGw,t=new d.Vkp,i=new d.Vkp,n=new d.Vkp,r=new d.Vkp,a=new d.Vkp,s=new d.Vkp;return function(o,l,c,h,u=0,d){e.makeScale(o.x,o.y,o.z),t.setFromMatrix4(e),e.makeRotationFromQuaternion(l),i.setFromMatrix4(e),n.copy(i).multiply(t),r.copy(n).transpose().premultiply(n),c&&(a.setFromMatrix4(c),s.copy(a).transpose(),r.multiply(s),r.premultiply(a)),d>=1?(h[u]=P(r.elements[0]),h[u+1]=P(r.elements[3]),h[u+2]=P(r.elements[6]),h[u+3]=P(r.elements[4]),h[u+4]=P(r.elements[7]),h[u+5]=P(r.elements[8])):(h[u]=r.elements[0],h[u+1]=r.elements[3],h[u+2]=r.elements[6],h[u+3]=r.elements[4],h[u+4]=r.elements[7],h[u+5]=r.elements[8])}})();fillSplatCovarianceArray(e,t,i,n,r,a){let s=this.splatCount,o=new d.Pa4,l=new d._fP;i=i||0,n=n||s-1,void 0===r&&(r=i);for(let s=i;s<=n;s++){let n=this.globalSplatIndexToSectionMap[s],c=this.sections[n],h=s-c.splatCountOffset,u=(s-i+r)*z.CovarianceComponentCount,d=c.bytesPerSplat*h+z.CompressionLevels[this.compressionLevel].ScaleOffsetBytes,p=new DataView(this.bufferData,c.dataBase+d);o.set(L(U(p,0,this.compressionLevel),this.compressionLevel),L(U(p,1,this.compressionLevel),this.compressionLevel),L(U(p,2,this.compressionLevel),this.compressionLevel)),l.set(L(U(p,4,this.compressionLevel),this.compressionLevel),L(U(p,5,this.compressionLevel),this.compressionLevel),L(U(p,6,this.compressionLevel),this.compressionLevel),L(U(p,3,this.compressionLevel),this.compressionLevel)),z.computeCovariance(o,l,t,e,u,a)}}fillSplatColorArray(e,t,i,n,r){let a=this.splatCount;i=i||0,n=n||a-1,void 0===r&&(r=i);for(let a=i;a<=n;a++){let n=this.globalSplatIndexToSectionMap[a],s=this.sections[n],o=a-s.splatCountOffset,l=(a-i+r)*z.ColorComponentCount,c=s.bytesPerSplat*o+z.CompressionLevels[this.compressionLevel].ColorOffsetBytes,h=new Uint8Array(this.bufferData,s.dataBase+c),u=h[3];u=u>=t?u:0,e[l]=h[0],e[l+1]=h[1],e[l+2]=h[2],e[l+3]=u}}fillSphericalHarmonicsArray=(function(){let e=[];for(let t=0;t<15;t++)e[t]=new d.Pa4;let t=new d.Vkp,i=new d.yGw,n=new d.Pa4,r=new d.Pa4,a=new d._fP,s=[],o=[],l=[],c=[],h=[],u=[],p=[],f=[],m=[],g=[],v=[],y=[],x=[],_=[],b=[],S=[],w=[],M=[],E=e=>e,C=(e,t,i,n)=>{e[0]=t,e[1]=i,e[2]=n},T=(e,t,i,n,r)=>{e[0]=U(t,n,r,!0),e[1]=U(t,n+i,r,!0),e[2]=U(t,n+i+i,r,!0)},R=(e,t)=>{t[0]=e[0],t[1]=e[1],t[2]=e[2]},B=(e,t,i,n)=>{t[i]=n(e[0]),t[i+1]=n(e[1]),t[i+2]=n(e[2])},N=(e,t,i,n,r)=>(t[0]=L(e[0],i,!0,n,r),t[1]=L(e[1],i,!0,n,r),t[2]=L(e[2],i,!0,n,r),t);return function(e,d,L,U,F,k,H){let V=this.splatCount;U=U||0,F=F||V-1,void 0===k&&(k=U),L&&d>=1&&(i.copy(L),i.decompose(n,a,r),a.normalize(),i.makeRotationFromQuaternion(a),t.setFromMatrix4(i),C(s,t.elements[4],-t.elements[7],t.elements[1]),C(o,-t.elements[5],t.elements[8],-t.elements[2]),C(l,t.elements[3],-t.elements[6],t.elements[0]));let G=e=>O(e,this.minSphericalHarmonicsCoeff,this.maxSphericalHarmonicsCoeff),W=e=>D(e,this.minSphericalHarmonicsCoeff,this.maxSphericalHarmonicsCoeff);for(let t=U;t<=F;t++){let i=this.globalSplatIndexToSectionMap[t],n=this.sections[i],r=A(d=Math.min(d,n.sphericalHarmonicsDegree)),a=t-n.splatCountOffset,C=n.bytesPerSplat*a+z.CompressionLevels[this.compressionLevel].SphericalHarmonicsOffsetBytes,D=new DataView(this.bufferData,n.dataBase+C),O=(t-U+k)*r,F=L?0:this.compressionLevel,V=E;F!==H&&(1===F?0===H?V=I:2==H&&(V=G):0===F&&(1===H?V=P:2==H&&(V=W)));let j=this.minSphericalHarmonicsCoeff,q=this.maxSphericalHarmonicsCoeff;d>=1&&(T(m,D,3,0,this.compressionLevel),T(g,D,3,1,this.compressionLevel),T(v,D,3,2,this.compressionLevel),L?(N(m,m,this.compressionLevel,j,q),N(g,g,this.compressionLevel,j,q),N(v,v,this.compressionLevel,j,q),z.rotateSphericalHarmonics3(m,g,v,s,o,l,_,b,S)):(R(m,_),R(g,b),R(v,S)),B(_,e,O,V),B(b,e,O+3,V),B(S,e,O+6,V),d>=2&&(T(m,D,5,9,this.compressionLevel),T(g,D,5,10,this.compressionLevel),T(v,D,5,11,this.compressionLevel),T(y,D,5,12,this.compressionLevel),T(x,D,5,13,this.compressionLevel),L?(N(m,m,this.compressionLevel,j,q),N(g,g,this.compressionLevel,j,q),N(v,v,this.compressionLevel,j,q),N(y,y,this.compressionLevel,j,q),N(x,x,this.compressionLevel,j,q),z.rotateSphericalHarmonics5(m,g,v,y,x,s,o,l,c,h,u,p,f,_,b,S,w,M)):(R(m,_),R(g,b),R(v,S),R(y,w),R(x,M)),B(_,e,O+9,V),B(b,e,O+12,V),B(S,e,O+15,V),B(w,e,O+18,V),B(M,e,O+21,V)))}}})();static dot3=(e,t,i,n,r)=>{r[0]=r[1]=r[2]=0;let a=n[0],s=n[1],o=n[2];z.addInto3(e[0]*a,e[1]*a,e[2]*a,r),z.addInto3(t[0]*s,t[1]*s,t[2]*s,r),z.addInto3(i[0]*o,i[1]*o,i[2]*o,r)};static addInto3=(e,t,i,n)=>{n[0]=n[0]+e,n[1]=n[1]+t,n[2]=n[2]+i};static dot5=(e,t,i,n,r,a,s)=>{s[0]=s[1]=s[2]=0;let o=a[0],l=a[1],c=a[2],h=a[3],u=a[4];z.addInto3(e[0]*o,e[1]*o,e[2]*o,s),z.addInto3(t[0]*l,t[1]*l,t[2]*l,s),z.addInto3(i[0]*c,i[1]*c,i[2]*c,s),z.addInto3(n[0]*h,n[1]*h,n[2]*h,s),z.addInto3(r[0]*u,r[1]*u,r[2]*u,s)};static rotateSphericalHarmonics3=(e,t,i,n,r,a,s,o,l)=>{z.dot3(e,t,i,n,s),z.dot3(e,t,i,r,o),z.dot3(e,t,i,a,l)};static rotateSphericalHarmonics5=(e,t,i,n,r,a,s,o,l,c,h,u,d,p,f,m,g,v)=>{let y=Math.sqrt(.25),x=Math.sqrt(.75),_=Math.sqrt(1/3),A=Math.sqrt(4/3),b=Math.sqrt(1/12);l[0]=y*(o[2]*a[0]+o[0]*a[2]+(a[2]*o[0]+a[0]*o[2])),l[1]=o[1]*a[0]+a[1]*o[0],l[2]=x*(o[1]*a[1]+a[1]*o[1]),l[3]=o[1]*a[2]+a[1]*o[2],l[4]=y*(o[2]*a[2]-o[0]*a[0]+(a[2]*o[2]-a[0]*o[0])),z.dot5(e,t,i,n,r,l,p),c[0]=y*(s[2]*a[0]+s[0]*a[2]+(a[2]*s[0]+a[0]*s[2])),c[1]=s[1]*a[0]+a[1]*s[0],c[2]=x*(s[1]*a[1]+a[1]*s[1]),c[3]=s[1]*a[2]+a[1]*s[2],c[4]=y*(s[2]*a[2]-s[0]*a[0]+(a[2]*s[2]-a[0]*s[0])),z.dot5(e,t,i,n,r,c,f),h[0]=_*(s[2]*s[0]+s[0]*s[2])+-b*(o[2]*o[0]+o[0]*o[2]+(a[2]*a[0]+a[0]*a[2])),h[1]=A*s[1]*s[0]+-_*(o[1]*o[0]+a[1]*a[0]),h[2]=s[1]*s[1]+-y*(o[1]*o[1]+a[1]*a[1]),h[3]=A*s[1]*s[2]+-_*(o[1]*o[2]+a[1]*a[2]),h[4]=_*(s[2]*s[2]-s[0]*s[0])+-b*(o[2]*o[2]-o[0]*o[0]+(a[2]*a[2]-a[0]*a[0])),z.dot5(e,t,i,n,r,h,m),u[0]=y*(s[2]*o[0]+s[0]*o[2]+(o[2]*s[0]+o[0]*s[2])),u[1]=s[1]*o[0]+o[1]*s[0],u[2]=x*(s[1]*o[1]+o[1]*s[1]),u[3]=s[1]*o[2]+o[1]*s[2],u[4]=y*(s[2]*o[2]-s[0]*o[0]+(o[2]*s[2]-o[0]*s[0])),z.dot5(e,t,i,n,r,u,g),d[0]=y*(o[2]*o[0]+o[0]*o[2]-(a[2]*a[0]+a[0]*a[2])),d[1]=o[1]*o[0]-a[1]*a[0],d[2]=x*(o[1]*o[1]-a[1]*a[1]),d[3]=o[1]*o[2]-a[1]*a[2],d[4]=y*(o[2]*o[2]-o[0]*o[0]-(a[2]*a[2]-a[0]*a[0])),z.dot5(e,t,i,n,r,d,v)};static parseHeader(e){let t=new Uint8Array(e,0,z.HeaderSizeBytes),i=new Uint16Array(e,0,z.HeaderSizeBytes/2),n=new Uint32Array(e,0,z.HeaderSizeBytes/4),r=new Float32Array(e,0,z.HeaderSizeBytes/4),a=t[0],s=t[1],o=n[1],l=n[2],c=n[3],h=n[4],u=i[10],p=new d.Pa4(r[6],r[7],r[8]);return{versionMajor:a,versionMinor:s,maxSectionCount:o,sectionCount:l,maxSplatCount:c,splatCount:h,compressionLevel:u,sceneCenter:p,minSphericalHarmonicsCoeff:r[9]||-R,maxSphericalHarmonicsCoeff:r[10]||R}}static writeHeaderCountsToBuffer(e,t,i){let n=new Uint32Array(i,0,z.HeaderSizeBytes/4);n[2]=e,n[4]=t}static writeHeaderToBuffer(e,t){let i=new Uint8Array(t,0,z.HeaderSizeBytes),n=new Uint16Array(t,0,z.HeaderSizeBytes/2),r=new Uint32Array(t,0,z.HeaderSizeBytes/4),a=new Float32Array(t,0,z.HeaderSizeBytes/4);i[0]=e.versionMajor,i[1]=e.versionMinor,i[2]=0,i[3]=0,r[1]=e.maxSectionCount,r[2]=e.sectionCount,r[3]=e.maxSplatCount,r[4]=e.splatCount,n[10]=e.compressionLevel,a[6]=e.sceneCenter.x,a[7]=e.sceneCenter.y,a[8]=e.sceneCenter.z,a[9]=e.minSphericalHarmonicsCoeff||-R,a[10]=e.maxSphericalHarmonicsCoeff||R}static parseSectionHeaders(e,t,i=0,n){let r=e.compressionLevel,a=e.maxSectionCount,s=new Uint16Array(t,i,a*z.SectionHeaderSizeBytes/2),o=new Uint32Array(t,i,a*z.SectionHeaderSizeBytes/4),l=new Float32Array(t,i,a*z.SectionHeaderSizeBytes/4),c=[],h=0,u=0,d=0,p=z.HeaderSizeBytes+e.maxSectionCount*z.SectionHeaderSizeBytes,f=0;for(let e=0;e<a;e++){let t=o[d+1],i=o[d+2],a=o[d+3],m=l[d+4],g=m/2,v=s[u+10],y=o[d+6]||z.CompressionLevels[r].ScaleRange,x=o[d+8],_=o[d+9],A=4*_,b=v*a+A,S=s[u+20],{bytesPerSplat:w}=z.calculateComponentStorage(r,S),M=w*t,E=M+b,C={bytesPerSplat:w,splatCountOffset:f,splatCount:n?t:0,maxSplatCount:t,bucketSize:i,bucketCount:a,bucketBlockSize:m,halfBucketBlockSize:g,bucketStorageSizeBytes:v,bucketsStorageSizeBytes:b,splatDataStorageSizeBytes:M,storageSizeBytes:E,compressionScaleRange:y,compressionScaleFactor:g/y,base:p,bucketsBase:p+A,dataBase:p+b,fullBucketCount:x,partiallyFilledBucketCount:_,sphericalHarmonicsDegree:S};c[e]=C,p+=E,h+=z.SectionHeaderSizeBytes,u=h/2,d=h/4,f+=t}return c}static writeSectionHeaderToBuffer(e,t,i,n=0){let r=new Uint16Array(i,n,z.SectionHeaderSizeBytes/2),a=new Uint32Array(i,n,z.SectionHeaderSizeBytes/4),s=new Float32Array(i,n,z.SectionHeaderSizeBytes/4);a[0]=e.splatCount,a[1]=e.maxSplatCount,a[2]=t>=1?e.bucketSize:0,a[3]=t>=1?e.bucketCount:0,s[4]=t>=1?e.bucketBlockSize:0,r[10]=t>=1?z.BucketStorageSizeBytes:0,a[6]=t>=1?e.compressionScaleRange:0,a[7]=e.storageSizeBytes,a[8]=t>=1?e.fullBucketCount:0,a[9]=t>=1?e.partiallyFilledBucketCount:0,r[20]=e.sphericalHarmonicsDegree}static writeSectionHeaderSplatCountToBuffer(e,t,i=0){new Uint32Array(t,i,z.SectionHeaderSizeBytes/4)[0]=e}constructFromBuffer(e,t){this.bufferData=e,this.globalSplatIndexToLocalSplatIndexMap=[],this.globalSplatIndexToSectionMap=[];let i=z.parseHeader(this.bufferData);this.versionMajor=i.versionMajor,this.versionMinor=i.versionMinor,this.maxSectionCount=i.maxSectionCount,this.sectionCount=t?i.maxSectionCount:0,this.maxSplatCount=i.maxSplatCount,this.splatCount=t?i.maxSplatCount:0,this.compressionLevel=i.compressionLevel,this.sceneCenter=new d.Pa4().copy(i.sceneCenter),this.minSphericalHarmonicsCoeff=i.minSphericalHarmonicsCoeff,this.maxSphericalHarmonicsCoeff=i.maxSphericalHarmonicsCoeff,this.sections=z.parseSectionHeaders(i,this.bufferData,z.HeaderSizeBytes,t),this.linkBufferArrays(),this.buildMaps()}static calculateComponentStorage(e,t){let i=z.CompressionLevels[e].BytesPerCenter,n=z.CompressionLevels[e].BytesPerScale,r=z.CompressionLevels[e].BytesPerRotation,a=z.CompressionLevels[e].BytesPerColor,s=A(t),o=z.CompressionLevels[e].BytesPerSphericalHarmonicsComponent*s;return{bytesPerCenter:i,bytesPerScale:n,bytesPerRotation:r,bytesPerColor:a,sphericalHarmonicsComponentsPerSplat:s,sphericalHarmonicsBytesPerSplat:o,bytesPerSplat:i+n+r+a+o}}linkBufferArrays(){for(let e=0;e<this.maxSectionCount;e++){let t=this.sections[e];t.bucketArray=new Float32Array(this.bufferData,t.bucketsBase,t.bucketCount*z.BucketStorageSizeFloats),t.partiallyFilledBucketCount>0&&(t.partiallyFilledBucketLengths=new Uint32Array(this.bufferData,t.base,t.partiallyFilledBucketCount))}}buildMaps(){let e=0;for(let t=0;t<this.maxSectionCount;t++){let i=this.sections[t];for(let n=0;n<i.maxSplatCount;n++){let i=e+n;this.globalSplatIndexToLocalSplatIndexMap[i]=n,this.globalSplatIndexToSectionMap[i]=t}e+=i.maxSplatCount}}updateLoadedCounts(e,t){z.writeHeaderCountsToBuffer(e,t,this.bufferData),this.sectionCount=e,this.splatCount=t}updateSectionLoadedCounts(e,t){let i=z.HeaderSizeBytes+z.SectionHeaderSizeBytes*e;z.writeSectionHeaderSplatCountToBuffer(t,this.bufferData,i),this.sections[e].splatCount=t}static writeSplatDataToSectionBuffer=(function(){let e=new ArrayBuffer(12),t=new ArrayBuffer(12),i=new ArrayBuffer(16),n=new ArrayBuffer(4),r=new ArrayBuffer(256),a=new d._fP,s=new d.Pa4,o=new d.Pa4,{X:l,Y:c,Z:h,SCALE0:u,SCALE1:p,SCALE2:f,ROTATION0:m,ROTATION1:g,ROTATION2:y,ROTATION3:x,FDC0:_,FDC1:b,FDC2:S,OPACITY:w,FRC0:M,FRC9:E}=C.OFFSET,T=(e,t,i)=>v(e=Math.round(e*t)+i,0,2*i+1);return function(d,v,C,I,L,B,O,N,U=-R,F=R){let H=A(L),V=z.CompressionLevels[I].BytesPerCenter,G=z.CompressionLevels[I].BytesPerScale,W=z.CompressionLevels[I].BytesPerRotation,j=z.CompressionLevels[I].BytesPerColor,q=C+V,X=q+G,Y=X+W,K=Y+j;if(void 0!==d[m]?(a.set(d[m],d[g],d[y],d[x]),a.normalize()):a.set(1,0,0,0),void 0!==d[u]?s.set(d[u]||0,d[p]||0,d[f]||0):s.set(0,0,0),0===I){let e=new Float32Array(v,C,z.CenterComponentCount),t=new Float32Array(v,X,z.RotationComponentCount),i=new Float32Array(v,q,z.ScaleComponentCount);if(t.set([a.x,a.y,a.z,a.w]),i.set([s.x,s.y,s.z]),e.set([d[l],d[c],d[h]]),L>0){let e=new Float32Array(v,K,H);if(L>=1){for(let t=0;t<9;t++)e[t]=d[M+t]||0;if(L>=2)for(let t=0;t<15;t++)e[t+9]=d[E+t]||0}}}else{let n=new Uint16Array(e,0,z.CenterComponentCount),u=new Uint16Array(i,0,z.RotationComponentCount),p=new Uint16Array(t,0,z.ScaleComponentCount);if(u.set([P(a.x),P(a.y),P(a.z),P(a.w)]),p.set([P(s.x),P(s.y),P(s.z)]),o.set(d[l],d[c],d[h]).sub(B),o.x=T(o.x,O,N),o.y=T(o.y,O,N),o.z=T(o.z,O,N),n.set([o.x,o.y,o.z]),L>0){let e=1===I?Uint16Array:Uint8Array,t=1===I?2:1,i=new e(r,0,H);if(L>=1){for(let e=0;e<9;e++){let t=d[M+e]||0;i[e]=1===I?P(t):D(t,U,F)}let e=9*t;if(k(i.buffer,0,v,K,e),L>=2){for(let e=0;e<15;e++){let t=d[E+e]||0;i[e+9]=1===I?P(t):D(t,U,F)}k(i.buffer,e,v,K+e,15*t)}}}k(n.buffer,0,v,C,6),k(p.buffer,0,v,q,6),k(u.buffer,0,v,X,8)}let Q=new Uint8ClampedArray(n,0,4);Q.set([d[_]||0,d[b]||0,d[S]||0]),Q[3]=d[w]||0,k(Q.buffer,0,v,Y,4)}})();static generateFromUncompressedSplatArrays(e,t,i,n,r,a,s=[]){let o,l,c=0;for(let t=0;t<e.length;t++)c=Math.max(e[t].sphericalHarmonicsDegree,c);for(let t=0;t<e.length;t++){let i=e[t];for(let e=0;e<i.splats.length;e++){let t=i.splats[e];for(let e=C.OFFSET.FRC0;e<C.OFFSET.FRC23&&e<t.length;e++)(!o||t[e]<o)&&(o=t[e]),(!l||t[e]>l)&&(l=t[e])}}o=o||-R,l=l||R;let{bytesPerSplat:h}=z.calculateComponentStorage(i,c),u=z.CompressionLevels[i].ScaleRange,p=[],f=[],m=0;for(let n=0;n<e.length;n++){let g=e[n],v=new C(c);for(let e=0;e<g.splatCount;e++){let i=g.splats[e];(i[C.OFFSET.OPACITY]||0)>=t&&v.addSplat(i)}let y=s[n]||{},x=(y.blockSizeFactor||1)*(r||z.BucketBlockSize),_=Math.ceil((y.bucketSizeFactor||1)*(a||z.BucketSize)),A=z.computeBucketsForUncompressedSplatArray(v,x,_),b=A.fullBuckets.length,S=A.partiallyFullBuckets.map(e=>e.splats.length),w=S.length,M=[...A.fullBuckets,...A.partiallyFullBuckets],E=v.splats.length*h,T=4*w,R=i>=1?M.length*z.BucketStorageSizeBytes+T:0,P=E+R,I=new ArrayBuffer(P),L=u/(.5*x),D=new d.Pa4,B=0;for(let e=0;e<M.length;e++){let t=M[e];D.fromArray(t.center);for(let e=0;e<t.splats.length;e++){let n=t.splats[e],r=v.splats[n],a=R+B*h;z.writeSplatDataToSectionBuffer(r,I,a,i,c,D,L,u,o,l),B++}}if(m+=B,i>=1){let e=new Uint32Array(I,0,4*S.length);for(let t=0;t<S.length;t++)e[t]=S[t];let t=new Float32Array(I,T,M.length*z.BucketStorageSizeFloats);for(let e=0;e<M.length;e++){let i=M[e],n=3*e;t[n]=i.center[0],t[n+1]=i.center[1],t[n+2]=i.center[2]}}p.push(I);let O=new ArrayBuffer(z.SectionHeaderSizeBytes);z.writeSectionHeaderToBuffer({maxSplatCount:B,splatCount:B,bucketSize:_,bucketCount:M.length,bucketBlockSize:x,compressionScaleRange:u,storageSizeBytes:P,fullBucketCount:b,partiallyFilledBucketCount:w,sphericalHarmonicsDegree:c},i,O,0),f.push(O)}let g=0;for(let e of p)g+=e.byteLength;let v=new ArrayBuffer(z.HeaderSizeBytes+z.SectionHeaderSizeBytes*p.length+g);z.writeHeaderToBuffer({versionMajor:0,versionMinor:1,maxSectionCount:p.length,sectionCount:p.length,maxSplatCount:m,splatCount:m,compressionLevel:i,sceneCenter:n,minSphericalHarmonicsCoeff:o,maxSphericalHarmonicsCoeff:l},v);let y=z.HeaderSizeBytes;for(let e of f)new Uint8Array(v,y,z.SectionHeaderSizeBytes).set(new Uint8Array(e)),y+=z.SectionHeaderSizeBytes;for(let e of p)new Uint8Array(v,y,e.byteLength).set(new Uint8Array(e)),y+=e.byteLength;return new z(v)}static computeBucketsForUncompressedSplatArray(e,t,i){let n=e.splatCount,r=t/2,a=new d.Pa4,s=new d.Pa4;for(let t=0;t<n;t++){let i=e.splats[t],n=[i[C.OFFSET.X],i[C.OFFSET.Y],i[C.OFFSET.Z]];(0===t||n[0]<a.x)&&(a.x=n[0]),(0===t||n[0]>s.x)&&(s.x=n[0]),(0===t||n[1]<a.y)&&(a.y=n[1]),(0===t||n[1]>s.y)&&(s.y=n[1]),(0===t||n[2]<a.z)&&(a.z=n[2]),(0===t||n[2]>s.z)&&(s.z=n[2])}let o=new d.Pa4().copy(s).sub(a),l=Math.ceil(o.y/t),c=Math.ceil(o.z/t),h=new d.Pa4,u=[],p={};for(let s=0;s<n;s++){let n=e.splats[s],o=[n[C.OFFSET.X],n[C.OFFSET.Y],n[C.OFFSET.Z]],d=Math.floor((o[0]-a.x)/t),f=Math.floor((o[1]-a.y)/t),m=Math.floor((o[2]-a.z)/t);h.x=d*t+a.x+r,h.y=f*t+a.y+r,h.z=m*t+a.z+r;let g=l*c*d+f*c+m,v=p[g];v||(p[g]=v={splats:[],center:h.toArray()}),v.splats.push(s),v.splats.length>=i&&(u.push(v),p[g]=null)}let f=[];for(let e in p)if(p.hasOwnProperty(e)){let t=p[e];t&&f.push(t)}return{fullBuckets:u,partiallyFullBuckets:f}}static preallocateUncompressed(e,t){let i=z.CompressionLevels[0].SphericalHarmonicsDegrees[t],n=z.HeaderSizeBytes+z.SectionHeaderSizeBytes,r=new ArrayBuffer(n+i.BytesPerSplat*e);return z.writeHeaderToBuffer({versionMajor:z.CurrentMajorVersion,versionMinor:z.CurrentMinorVersion,maxSectionCount:1,sectionCount:1,maxSplatCount:e,splatCount:e,compressionLevel:0,sceneCenter:new d.Pa4},r),z.writeSectionHeaderToBuffer({maxSplatCount:e,splatCount:e,bucketSize:0,bucketCount:0,bucketBlockSize:0,compressionScaleRange:0,storageSizeBytes:0,fullBucketCount:0,partiallyFilledBucketCount:0,sphericalHarmonicsDegree:t},0,r,z.HeaderSizeBytes),{splatBuffer:new z(r,!0),splatBufferDataOffsetBytes:n}}}let H=new Uint8Array([112,108,121,10]),V=new Uint8Array([10,101,110,100,95,104,101,97,100,101,114,10]),G="end_header",W=new Map([["char",Int8Array],["uchar",Uint8Array],["short",Int16Array],["ushort",Uint16Array],["int",Int32Array],["uint",Uint32Array],["float",Float32Array],["double",Float64Array]]),j=(e,t)=>{let i=(1<<t)-1;return(e&i)/i},q=(e,t)=>{e.x=j(t>>>21,11),e.y=j(t>>>11,10),e.z=j(t,11)},X=(e,t)=>{e.x=j(t>>>24,8),e.y=j(t>>>16,8),e.z=j(t>>>8,8),e.w=j(t,8)},Y=(e,t)=>{let i=1/(.5*Math.sqrt(2)),n=(j(t>>>20,10)-.5)*i,r=(j(t>>>10,10)-.5)*i,a=(j(t,10)-.5)*i,s=Math.sqrt(1-(n*n+r*r+a*a));switch(t>>>30){case 0:e.set(s,n,r,a);break;case 1:e.set(n,s,r,a);break;case 2:e.set(n,r,s,a);break;case 3:e.set(n,r,a,s)}},K=(e,t,i)=>e*(1-i)+t*i,Q=(e,t)=>e.properties.find(e=>e.name===t&&e.storage)?.storage;class J{static decodeHeaderText(e){let t,i,n,r;let a=e.split("\n").filter(e=>!e.startsWith("comment ")),s=0,o=!1;for(let e=1;e<a.length;++e){let l=a[e].split(" ");switch(l[0]){case"format":if("binary_little_endian"!==l[1])throw Error("Unsupported ply format");break;case"element":"chunk"===(t={name:l[1],count:parseInt(l[2],10),properties:[],storageSizeBytes:0}).name?i=t:"vertex"===t.name?n=t:"sh"===t.name&&(r=t);break;case"property":{if(!W.has(l[1]))throw Error(`Unrecognized property data type '${l[1]}' in ply header`);let e=W.get(l[1]),i=e.BYTES_PER_ELEMENT*t.count;"vertex"===t.name&&(s+=e.BYTES_PER_ELEMENT),t.properties.push({type:l[1],name:l[2],storage:null,byteSize:e.BYTES_PER_ELEMENT,storageSizeByes:i}),t.storageSizeBytes+=i;break}case G:o=!0;break;default:throw Error(`Unrecognized header value '${l[0]}' in ply header`)}if(o)break}let l=0,c=0;return r&&(c=r.properties.length,r.properties.length>=45?l=3:r.properties.length>=24?l=2:r.properties.length>=9&&(l=1)),{chunkElement:i,vertexElement:n,shElement:r,bytesPerSplat:s,headerSizeBytes:e.indexOf(G)+G.length+1,sphericalHarmonicsDegree:l,sphericalHarmonicsPerSplat:c}}static decodeHeader(e){let t;let i=new Uint8Array(e);if(i.length>=H.length&&!((e,t)=>{if(e.length<t.length)return!1;for(let i=0;i<t.length;++i)if(e[i]!==t[i])return!1;return!0})(i,H))throw Error("Invalid PLY header");if(-1===(t=((e,t)=>{let i,n;let r=e.length-t.length;for(i=0;i<=r;++i){for(n=0;n<t.length&&e[i+n]===t[n];++n);if(n===t.length)return i}return -1})(i,V)))throw Error("End of PLY header not found");let n=new TextDecoder("ascii").decode(i.slice(0,t)),{chunkElement:r,vertexElement:a,shElement:s,sphericalHarmonicsDegree:o,sphericalHarmonicsPerSplat:l,bytesPerSplat:c}=J.decodeHeaderText(n);return{headerSizeBytes:t+V.length,bytesPerSplat:c,chunkElement:r,vertexElement:a,shElement:s,sphericalHarmonicsDegree:o,sphericalHarmonicsPerSplat:l}}static readElementData(e,t,i,n,r,a=null){let s=t instanceof DataView?t:new DataView(t);n=n||0,r=r||e.count-1;for(let t=n;t<=r;++t)for(let n=0;n<e.properties.length;++n){let r=e.properties[n],o=W.get(r.type),l=o.BYTES_PER_ELEMENT*e.count;if((!r.storage||r.storage.byteLength<l)&&(!a||a(r.name))&&(r.storage=new o(e.count)),r.storage)switch(r.type){case"char":r.storage[t]=s.getInt8(i);break;case"uchar":r.storage[t]=s.getUint8(i);break;case"short":r.storage[t]=s.getInt16(i,!0);break;case"ushort":r.storage[t]=s.getUint16(i,!0);break;case"int":r.storage[t]=s.getInt32(i,!0);break;case"uint":r.storage[t]=s.getUint32(i,!0);break;case"float":r.storage[t]=s.getFloat32(i,!0);break;case"double":r.storage[t]=s.getFloat64(i,!0)}i+=r.byteSize}return i}static readPly(e,t=null){let i=J.decodeHeader(e),n=J.readElementData(i.chunkElement,e,i.headerSizeBytes,null,null,t);return n=J.readElementData(i.vertexElement,e,n,null,null,t),J.readElementData(i.shElement,e,n,null,null,t),{chunkElement:i.chunkElement,vertexElement:i.vertexElement,shElement:i.shElement,sphericalHarmonicsDegree:i.sphericalHarmonicsDegree,sphericalHarmonicsPerSplat:i.sphericalHarmonicsPerSplat}}static getElementStorageArrays(e,t,i){let n={};if(t){let i=Q(e,"min_r"),r=Q(e,"min_g"),a=Q(e,"min_b"),s=Q(e,"max_r"),o=Q(e,"max_g"),l=Q(e,"max_b"),c=Q(e,"min_x"),h=Q(e,"min_y"),u=Q(e,"min_z"),d=Q(e,"max_x"),p=Q(e,"max_y"),f=Q(e,"max_z"),m=Q(e,"min_scale_x"),g=Q(e,"min_scale_y"),v=Q(e,"min_scale_z"),y=Q(e,"max_scale_x"),x=Q(e,"max_scale_y"),_=Q(e,"max_scale_z"),A=Q(t,"packed_position"),b=Q(t,"packed_rotation"),S=Q(t,"packed_scale"),w=Q(t,"packed_color");n.colorExtremes={minR:i,maxR:s,minG:r,maxG:o,minB:a,maxB:l},n.positionExtremes={minX:c,maxX:d,minY:h,maxY:p,minZ:u,maxZ:f},n.scaleExtremes={minScaleX:m,maxScaleX:y,minScaleY:g,maxScaleY:x,minScaleZ:v,maxScaleZ:_},n.position=A,n.rotation=b,n.scale=S,n.color=w}if(i){let e={};for(let t=0;t<45;t++){let n=`f_rest_${t}`,r=Q(i,n);if(r)e[n]=r;else break}n.sh=e}return n}static decompressBaseSplat=(function(){let e=new d.Pa4,t=new d._fP,i=new d.Pa4,n=new d.Ltg,r=C.OFFSET;return function(a,s,o,l,c,h,u,d,p,f){f=f||C.createSplat();let m=Math.floor((s+a)/256);return q(e,o[a]),Y(t,u[a]),q(i,c[a]),X(n,p[a]),f[r.X]=K(l.minX[m],l.maxX[m],e.x),f[r.Y]=K(l.minY[m],l.maxY[m],e.y),f[r.Z]=K(l.minZ[m],l.maxZ[m],e.z),f[r.ROTATION0]=t.x,f[r.ROTATION1]=t.y,f[r.ROTATION2]=t.z,f[r.ROTATION3]=t.w,f[r.SCALE0]=Math.exp(K(h.minScaleX[m],h.maxScaleX[m],i.x)),f[r.SCALE1]=Math.exp(K(h.minScaleY[m],h.maxScaleY[m],i.y)),f[r.SCALE2]=Math.exp(K(h.minScaleZ[m],h.maxScaleZ[m],i.z)),d.minR&&d.maxR?f[r.FDC0]=v(Math.round(255*K(d.minR[m],d.maxR[m],n.x)),0,255):f[r.FDC0]=v(Math.floor(255*n.x),0,255),d.minG&&d.maxG?f[r.FDC1]=v(Math.round(255*K(d.minG[m],d.maxG[m],n.y)),0,255):f[r.FDC1]=v(Math.floor(255*n.y),0,255),d.minB&&d.maxB?f[r.FDC2]=v(Math.round(255*K(d.minB[m],d.maxB[m],n.z)),0,255):f[r.FDC2]=v(Math.floor(255*n.z),0,255),f[r.OPACITY]=v(Math.floor(255*n.w),0,255),f}})();static decompressSphericalHarmonics=(function(){let e=[0,3,8,15],t=[0,1,2,9,10,11,12,13,24,25,26,27,28,29,30,3,4,5,14,15,16,17,18,31,32,33,34,35,36,37,6,7,8,19,20,21,22,23,38,39,40,41,42,43,44];return function(i,n,r,a,s){s=s||C.createSplat();let o=e[r],l=e[a];for(let e=0;e<3;++e)for(let r=0;r<15;++r){let a=t[15*e+r];r<o&&r<l&&(s[C.OFFSET.FRC0+a]=n[e*l+r][i]*(8/255)-4)}return s}})();static parseToUncompressedSplatBufferSection(e,t,i,n,r,a,s,o,l=null){J.readElementData(t,a,0,i,n,l);let c=z.CompressionLevels[0].SphericalHarmonicsDegrees[0].BytesPerSplat,{positionExtremes:h,scaleExtremes:u,colorExtremes:d,position:p,rotation:f,scale:m,color:g}=J.getElementStorageArrays(e,t),v=C.createSplat();for(let e=i;e<=n;++e){J.decompressBaseSplat(e,r,p,h,m,u,f,d,g,v);let t=e*c+o;z.writeSplatDataToSectionBuffer(v,s,t,0,0)}}static parseToUncompressedSplatArraySection(e,t,i,n,r,a,s,o=null){J.readElementData(t,a,0,i,n,o);let{positionExtremes:l,scaleExtremes:c,colorExtremes:h,position:u,rotation:d,scale:p,color:f}=J.getElementStorageArrays(e,t);for(let e=i;e<=n;++e){let t=C.createSplat();J.decompressBaseSplat(e,r,u,l,p,c,d,h,f,t),s.addSplat(t)}}static parseSphericalHarmonicsToUncompressedSplatArraySection(e,t,i,n,r,a,s,o,l,c=null){J.readElementData(t,r,a,i,n,c);let{sh:h}=J.getElementStorageArrays(e,void 0,t),u=Object.values(h);for(let e=i;e<=n;++e)J.decompressSphericalHarmonics(e,u,s,o,l.splats[e])}static parseToUncompressedSplatArray(e,t){let i;let{chunkElement:n,vertexElement:r,shElement:a,sphericalHarmonicsDegree:s}=J.readPly(e),o=new C(t=Math.min(t,s)),{positionExtremes:l,scaleExtremes:c,colorExtremes:h,position:u,rotation:d,scale:p,color:f}=J.getElementStorageArrays(n,r);if(t>0){let{sh:e}=J.getElementStorageArrays(n,void 0,a);i=Object.values(e)}for(let e=0;e<r.count;++e){o.addDefaultSplat();let n=o.getSplat(o.splatCount-1);J.decompressBaseSplat(e,0,u,l,p,c,d,h,f,n),t>0&&J.decompressSphericalHarmonics(e,i,t,s,n)}return o}static parseToUncompressedSplatBuffer(e,t){let i;let{chunkElement:n,vertexElement:r,shElement:a,sphericalHarmonicsDegree:s}=J.readPly(e);t=Math.min(t,s);let{splatBuffer:o,splatBufferDataOffsetBytes:l}=z.preallocateUncompressed(r.count,t),{positionExtremes:c,scaleExtremes:h,colorExtremes:u,position:d,rotation:p,scale:f,color:m}=J.getElementStorageArrays(n,r);if(t>0){let{sh:e}=J.getElementStorageArrays(n,void 0,a);i=Object.values(e)}let g=z.CompressionLevels[0].SphericalHarmonicsDegrees[t].BytesPerSplat,v=C.createSplat(t);for(let e=0;e<r.count;++e){J.decompressBaseSplat(e,0,d,c,f,h,p,u,m,v),t>0&&J.decompressSphericalHarmonics(e,i,t,s,v);let n=e*g+l;z.writeSplatDataToSectionBuffer(v,o.bufferData,n,0,t)}return o}}let Z={INRIAV1:0,INRIAV2:1,PlayCanvasCompressed:2},[$,ee,et,ei,en,er,ea]=[0,1,2,3,4,5,6],es={double:$,int:ee,uint:et,float:ei,short:en,ushort:er,uchar:ea},eo={[$]:8,[ee]:4,[et]:4,[ei]:4,[en]:2,[er]:2,[ea]:1};class el{static HeaderEndToken="end_header";static decodeSectionHeader(e,t,i=0){let n=[],r=!1,a=-1,s=0,o=!1,l=null,c=[],h=[],u=[],d=[],p={};for(let f=i;f<e.length;f++){let m=e[f].trim();if(m.startsWith("element")){if(r){a--;break}{r=!0,i=f,a=f;let e=m.split(" "),t=0;for(let i of e){let e=i.trim();e.length>0&&(2==++t?l=e:3===t&&(s=parseInt(e)))}}}else if(m.startsWith("property")){let e=m.match(/(\w+)\s+(\w+)\s+(\w+)/);if(e){let i=e[2],n=e[3];u.push(n);let r=t[n];p[n]=i;let a=es[i];void 0!==r&&(d.push(n),c.push(r),h[r]=a)}}if(m===el.HeaderEndToken){o=!0;break}r&&(n.push(m),a++)}let f=[],m=0;for(let e of u){let i=p[e];if(p.hasOwnProperty(e)){let i=t[e];void 0!==i&&(f[i]=m)}m+=eo[es[i]]}let g=el.decodeSphericalHarmonicsFromSectionHeader(u,t);return{headerLines:n,headerStartLine:i,headerEndLine:a,fieldTypes:h,fieldIds:c,fieldOffsets:f,bytesPerVertex:m,vertexCount:s,dataSizeBytes:m*s,endOfHeader:o,sectionName:l,sphericalHarmonicsDegree:g.degree,sphericalHarmonicsCoefficientsPerChannel:g.coefficientsPerChannel,sphericalHarmonicsDegree1Fields:g.degree1Fields,sphericalHarmonicsDegree2Fields:g.degree2Fields}}static decodeSphericalHarmonicsFromSectionHeader(e,t){let i=0,n=0;for(let t of e)t.startsWith("f_rest")&&i++;let r=0;(n=i/3)>=3&&(r=1),n>=8&&(r=2);let a=[],s=[];for(let e=0;e<3;e++){if(r>=1)for(let i=0;i<3;i++)a.push(t["f_rest_"+(i+n*e)]);if(r>=2)for(let i=0;i<5;i++)s.push(t["f_rest_"+(i+n*e+3)])}return{degree:r,coefficientsPerChannel:n,degree1Fields:a,degree2Fields:s}}static getHeaderSectionNames(e){let t=[];for(let i of e)if(i.startsWith("element")){let e=i.split(" "),n=0;for(let i of e){let e=i.trim();e.length>0&&2==++n&&t.push(e)}}return t}static checkTextForEndHeader(e){return!!e.includes(el.HeaderEndToken)}static checkBufferForEndHeader(e,t,i,n){let r=new Uint8Array(e,Math.max(0,t-i),i),a=n.decode(r);return el.checkTextForEndHeader(a)}static extractHeaderFromBufferToText(e){let t=new TextDecoder,i=0,n="";for(;;){if(i+100>=e.byteLength)throw Error("End of file reached while searching for end of header");let r=new Uint8Array(e,i,100);if(n+=t.decode(r),i+=100,el.checkBufferForEndHeader(e,i,200,t))break}return n}static readHeaderFromBuffer(e){let t=new TextDecoder,i=0,n="";for(;;){if(i+100>=e.byteLength)throw Error("End of file reached while searching for end of header");let r=new Uint8Array(e,i,100);if(n+=t.decode(r),i+=100,el.checkBufferForEndHeader(e,i,200,t))break}return n}static convertHeaderTextToLines(e){let t=e.split("\n"),i=[];for(let e=0;e<t.length;e++){let n=t[e].trim();if(i.push(n),n===el.HeaderEndToken)break}return i}static determineHeaderFormatFromHeaderText(e){let t=el.convertHeaderTextToLines(e),i=Z.INRIAV1;for(let e=0;e<t.length;e++){let n=t[e].trim();if(n.startsWith("element chunk")||n.match(/[A-Za-z]*packed_[A-Za-z]*/))i=Z.PlayCanvasCompressed;else if(n.startsWith("element codebook_centers"))i=Z.INRIAV2;else if(n===el.HeaderEndToken)break}return i}static determineHeaderFormatFromPlyBuffer(e){let t=el.extractHeaderFromBufferToText(e);return el.determineHeaderFormatFromHeaderText(t)}static readVertex(e,t,i,n,r,a,s=!0){let o=i*t.bytesPerVertex+n,l=t.fieldOffsets,c=t.fieldTypes;for(let t of r){let i=c[t];i===ei?a[t]=e.getFloat32(o+l[t],!0):i===en?a[t]=e.getInt16(o+l[t],!0):i===er?a[t]=e.getUint16(o+l[t],!0):i===ee?a[t]=e.getInt32(o+l[t],!0):i===et?a[t]=e.getUint32(o+l[t],!0):i===ea&&(s?a[t]=e.getUint8(o+l[t])/255:a[t]=e.getUint8(o+l[t]))}}}let ec=["scale_0","scale_1","scale_2","rot_0","rot_1","rot_2","rot_3","x","y","z","f_dc_0","f_dc_1","f_dc_2","opacity","red","green","blue","f_rest_0"],[eh,eu,ed,ep,ef,em,eg,ev,ey,ex,e_,eA,eb,eS,ew,eM,eE,eC]=ec.map((e,t)=>t);class eT{static decodeHeaderLines(e){let t=0;e.forEach(e=>{e.includes("f_rest_")&&t++});let i=0;t>=45?i=45:t>=24?i=24:t>=9&&(i=9);let n=[...ec,...Array.from(Array(Math.max(i-1,0))).map((e,t)=>`f_rest_${t+1}`)],r=n.map((e,t)=>t),a=r.reduce((e,t)=>(e[n[t]]=t,e),{}),s=el.decodeSectionHeader(e,a,0);return s.splatCount=s.vertexCount,s.bytesPerSplat=s.bytesPerVertex,s.fieldsToReadIndexes=r,s}static decodeHeaderText(e){let t=el.convertHeaderTextToLines(e),i=eT.decodeHeaderLines(t);return i.headerText=e,i.headerSizeBytes=e.indexOf(el.HeaderEndToken)+el.HeaderEndToken.length+1,i}static decodeHeaderFromBuffer(e){let t=el.readHeaderFromBuffer(e);return eT.decodeHeaderText(t)}static findSplatData(e,t){return new DataView(e,t.headerSizeBytes)}static parseToUncompressedSplatBufferSection(e,t,i,n,r,a,s,o=0){o=Math.min(o,e.sphericalHarmonicsDegree);let l=z.CompressionLevels[0].SphericalHarmonicsDegrees[o].BytesPerSplat;for(let c=t;c<=i;c++){let t=eT.parseToUncompressedSplat(n,c,e,r,o),i=c*l+s;z.writeSplatDataToSectionBuffer(t,a,i,0,o)}}static parseToUncompressedSplatArraySection(e,t,i,n,r,a,s=0){s=Math.min(s,e.sphericalHarmonicsDegree);for(let o=t;o<=i;o++){let t=eT.parseToUncompressedSplat(n,o,e,r,s);a.addSplat(t)}}static decodeSectionSplatData(e,t,i,n,r=!0){if(n=Math.min(n,i.sphericalHarmonicsDegree),r){let r=new C(n);for(let a=0;a<t;a++){let t=eT.parseToUncompressedSplat(e,a,i,0,n);r.addSplat(t)}return r}{let{splatBuffer:r,splatBufferDataOffsetBytes:a}=z.preallocateUncompressed(t,n);return eT.parseToUncompressedSplatBufferSection(i,0,t-1,e,0,r.bufferData,a,n),r}}static parseToUncompressedSplat=(function(){let e=[],t=new d._fP,i=C.OFFSET.X,n=C.OFFSET.Y,r=C.OFFSET.Z,a=C.OFFSET.SCALE0,s=C.OFFSET.SCALE1,o=C.OFFSET.SCALE2,l=C.OFFSET.ROTATION0,c=C.OFFSET.ROTATION1,h=C.OFFSET.ROTATION2,u=C.OFFSET.ROTATION3,p=C.OFFSET.FDC0,f=C.OFFSET.FDC1,m=C.OFFSET.FDC2,g=C.OFFSET.OPACITY,y=[];for(let e=0;e<45;e++)y[e]=C.OFFSET.FRC0+e;return function(d,x,_,A=0,b=0){b=Math.min(b,_.sphericalHarmonicsDegree),eT.readSplat(d,_,x,A,e);let S=C.createSplat(b);if(void 0!==e[eh]?(S[a]=Math.exp(e[eh]),S[s]=Math.exp(e[eu]),S[o]=Math.exp(e[ed])):(S[a]=.01,S[s]=.01,S[o]=.01),void 0!==e[e_]?(S[p]=(.5+.28209479177387814*e[e_])*255,S[f]=(.5+.28209479177387814*e[eA])*255,S[m]=(.5+.28209479177387814*e[eb])*255):void 0!==e[ew]?(S[p]=255*e[ew],S[f]=255*e[eM],S[m]=255*e[eE]):(S[p]=0,S[f]=0,S[m]=0),void 0!==e[eS]&&(S[g]=1/(1+Math.exp(-e[eS]))*255),S[p]=v(Math.floor(S[p]),0,255),S[f]=v(Math.floor(S[f]),0,255),S[m]=v(Math.floor(S[m]),0,255),S[g]=v(Math.floor(S[g]),0,255),b>=1&&void 0!==e[eC]){for(let t=0;t<9;t++)S[y[t]]=e[_.sphericalHarmonicsDegree1Fields[t]];if(b>=2)for(let t=0;t<15;t++)S[y[9+t]]=e[_.sphericalHarmonicsDegree2Fields[t]]}return t.set(e[ep],e[ef],e[em],e[eg]),t.normalize(),S[l]=t.x,S[c]=t.y,S[h]=t.z,S[u]=t.w,S[i]=e[ev],S[n]=e[ey],S[r]=e[ex],S}})();static readSplat(e,t,i,n,r){return el.readVertex(e,t,i,n,t.fieldsToReadIndexes,r,!0)}static parseToUncompressedSplatArray(e,t=0){let{header:i,splatCount:n,splatData:r}=eR(e);return eT.decodeSectionSplatData(r,n,i,t,!0)}static parseToUncompressedSplatBuffer(e,t=0){let{header:i,splatCount:n,splatData:r}=eR(e);return eT.decodeSectionSplatData(r,n,i,t,!1)}}function eR(e){let t=eT.decodeHeaderFromBuffer(e),i=t.splatCount,n=eT.findSplatData(e,t);return{header:t,splatCount:i,splatData:n}}let eP=["features_dc","features_rest_0","features_rest_1","features_rest_2","features_rest_3","features_rest_4","features_rest_5","features_rest_6","features_rest_7","features_rest_8","features_rest_9","features_rest_10","features_rest_11","features_rest_12","features_rest_13","features_rest_14","opacity","scaling","rotation_re","rotation_im"],eI=eP.map((e,t)=>t),[eL,eD,eB,eO,eN,eU,eF]=[0,1,4,16,17,18,19],ek=["scale_0","scale_1","scale_2","rot_0","rot_1","rot_2","rot_3","x","y","z","f_dc_0","f_dc_1","f_dc_2","opacity","red","green","blue","f_rest_0","f_rest_1","f_rest_2","f_rest_3","f_rest_4","f_rest_5","f_rest_6","f_rest_7","f_rest_8","f_rest_9","f_rest_10","f_rest_11","f_rest_12","f_rest_13","f_rest_14","f_rest_15","f_rest_16","f_rest_17","f_rest_18","f_rest_19","f_rest_20","f_rest_21","f_rest_22","f_rest_23","f_rest_24","f_rest_25","f_rest_26","f_rest_27","f_rest_28","f_rest_29","f_rest_30","f_rest_31","f_rest_32","f_rest_33","f_rest_34","f_rest_35","f_rest_36","f_rest_37","f_rest_38","f_rest_39","f_rest_40","f_rest_41","f_rest_42","f_rest_43","f_rest_44","f_rest_45"],ez=ek.map((e,t)=>t),[eH,eV,eG,eW,ej,eq,eX,eY,eK,eQ,eJ,eZ,e$,e0]=ez,e1=e=>{let t=(31744&e)>>10,i=1023&e;return(e>>15?-1:1)*(t?31===t?i?NaN:1/0:Math.pow(2,t-15)*(1+i/1024):i/1024*6103515625e-14)};class e2{static decodeSectionHeadersFromHeaderLines(e){let t;let i=ez.reduce((e,t)=>(e[ek[t]]=t,e),{}),n=eI.reduce((e,t)=>(e[eP[t]]=t,e),{}),r=el.getHeaderSectionNames(e);for(let e=0;e<r.length;e++)"codebook_centers"===r[e]&&(t=e);let a=0,s=!1,o=[],l=0;for(;!s;){let r;s=(r=l===t?el.decodeSectionHeader(e,n,a):el.decodeSectionHeader(e,i,a)).endOfHeader,a=r.headerEndLine+1,s||(r.splatCount=r.vertexCount,r.bytesPerSplat=r.bytesPerVertex),o.push(r),l++}return o}static decodeSectionHeadersFromHeaderText(e){let t=el.convertHeaderTextToLines(e);return e2.decodeSectionHeadersFromHeaderLines(t)}static getSplatCountFromSectionHeaders(e){let t=0;for(let i of e)"codebook_centers"!==i.sectionName&&(t+=i.vertexCount);return t}static decodeHeaderFromHeaderText(e){let t=e.indexOf(el.HeaderEndToken)+el.HeaderEndToken.length+1,i=e2.decodeSectionHeadersFromHeaderText(e),n=e2.getSplatCountFromSectionHeaders(i);return{headerSizeBytes:t,sectionHeaders:i,splatCount:n}}static decodeHeaderFromBuffer(e){let t=el.readHeaderFromBuffer(e);return e2.decodeHeaderFromHeaderText(t)}static findVertexData(e,t,i){let n=t.headerSizeBytes;for(let e=0;e<i&&e<t.sectionHeaders.length;e++)n+=t.sectionHeaders[e].dataSizeBytes;return new DataView(e,n,t.sectionHeaders[i].dataSizeBytes)}static decodeCodeBook(e,t){let i=[],n=[];for(let r=0;r<t.vertexCount;r++)for(let a of(el.readVertex(e,t,r,0,eI,i),eI)){let e=eI[a],t=n[e];t||(n[e]=t=[]),t.push(i[a])}for(let e=0;e<n.length;e++){let t=n[e];for(let i=0;i<t.length;i++){let n=e1(t[i]);e===eO?t[i]=Math.round(1/(1+Math.exp(-n))*255):e===eL?t[i]=Math.round((.5+.28209479177387814*n)*255):e===eN?t[i]=Math.exp(n):t[i]=n}}return n}static decodeSectionSplatData(e,t,i,n,r){let a=new C(r=Math.min(r,i.sphericalHarmonicsDegree));for(let s=0;s<t;s++){let t=e2.parseToUncompressedSplat(e,s,i,n,0,r);a.addSplat(t)}return a}static parseToUncompressedSplat=(function(){let e=[],t=new d._fP,i=C.OFFSET.X,n=C.OFFSET.Y,r=C.OFFSET.Z,a=C.OFFSET.SCALE0,s=C.OFFSET.SCALE1,o=C.OFFSET.SCALE2,l=C.OFFSET.ROTATION0,c=C.OFFSET.ROTATION1,h=C.OFFSET.ROTATION2,u=C.OFFSET.ROTATION3,p=C.OFFSET.FDC0,f=C.OFFSET.FDC1,m=C.OFFSET.FDC2,g=C.OFFSET.OPACITY,y=[];for(let e=0;e<45;e++)y[e]=C.OFFSET.FRC0+e;return function(d,x,_,A,b=0,S=0){S=Math.min(S,_.sphericalHarmonicsDegree),e2.readSplat(d,_,x,b,e);let w=C.createSplat(S);if(void 0!==e[eH]?(w[a]=A[eN][e[eH]],w[s]=A[eN][e[eV]],w[o]=A[eN][e[eG]]):(w[a]=.01,w[s]=.01,w[o]=.01),void 0!==e[eJ]?(w[p]=A[eL][e[eJ]],w[f]=A[eL][e[eZ]],w[m]=A[eL][e[e$]]):void 0!==e[eJ]?(w[p]=255*e[eJ],w[f]=255*e[eZ],w[m]=255*e[e$]):(w[p]=0,w[f]=0,w[m]=0),void 0!==e[e0]&&(w[g]=A[eO][e[e0]]),w[p]=v(Math.floor(w[p]),0,255),w[f]=v(Math.floor(w[f]),0,255),w[m]=v(Math.floor(w[m]),0,255),w[g]=v(Math.floor(w[g]),0,255),S>=1&&_.sphericalHarmonicsDegree>=1){for(let t=0;t<9;t++){let i=A[eD+t%3];w[y[t]]=i[e[_.sphericalHarmonicsDegree1Fields[t]]]}if(S>=2&&_.sphericalHarmonicsDegree>=2)for(let t=0;t<15;t++){let i=A[eB+t%5];w[y[9+t]]=i[e[_.sphericalHarmonicsDegree2Fields[t]]]}}let M=A[eU][e[eW]],E=A[eF][e[ej]],T=A[eF][e[eq]],R=A[eF][e[eX]];return t.set(M,E,T,R),t.normalize(),w[l]=t.x,w[c]=t.y,w[h]=t.z,w[u]=t.w,w[i]=e1(e[eY]),w[n]=e1(e[eK]),w[r]=e1(e[eQ]),w}})();static readSplat(e,t,i,n,r){return el.readVertex(e,t,i,n,ez,r,!1)}static parseToUncompressedSplatArray(e,t=0){let i;let n=[],r=e2.decodeHeaderFromBuffer(e,t);for(let t=0;t<r.sectionHeaders.length;t++){let n=r.sectionHeaders[t];if("codebook_centers"===n.sectionName){let a=e2.findVertexData(e,r,t);i=e2.decodeCodeBook(a,n)}}for(let a=0;a<r.sectionHeaders.length;a++){let s=r.sectionHeaders[a];if("codebook_centers"!==s.sectionName){let o=s.vertexCount,l=e2.findVertexData(e,r,a),c=e2.decodeSectionSplatData(l,o,s,i,t);n.push(c)}}let a=new C(t);for(let e of n)for(let t of e.splats)a.addSplat(t);return a}}class e3{static parseToUncompressedSplatArray(e,t=0){let i=el.determineHeaderFormatFromPlyBuffer(e);return i===Z.PlayCanvasCompressed?J.parseToUncompressedSplatArray(e,t):i===Z.INRIAV1?eT.parseToUncompressedSplatArray(e,t):i===Z.INRIAV2?e2.parseToUncompressedSplatArray(e,t):void 0}static parseToUncompressedSplatBuffer(e,t=0){let i=el.determineHeaderFormatFromPlyBuffer(e);if(i===Z.PlayCanvasCompressed)return J.parseToUncompressedSplatBuffer(e,t);if(i===Z.INRIAV1)return eT.parseToUncompressedSplatBuffer(e,t);if(i===Z.INRIAV2)throw Error("parseToUncompressedSplatBuffer() is not implemented for INRIA V2 PLY files")}}class e4{constructor(e,t,i,n){this.sectionCount=e,this.sectionFilters=t,this.groupingParameters=i,this.partitionGenerator=n}partitionUncompressedSplatArray(e){let t,i,n;if(this.partitionGenerator){let r=this.partitionGenerator(e);t=r.groupingParameters,i=r.sectionCount,n=r.sectionFilters}else t=this.groupingParameters,i=this.sectionCount,n=this.sectionFilters;let r=[];for(let t=0;t<i;t++){let i=new C(e.sphericalHarmonicsDegree),a=n[t];for(let t=0;t<e.splatCount;t++)a(t)&&i.addSplat(e.splats[t]);r.push(i)}return{splatArrays:r,parameters:t}}static getStandardPartitioner(e=0,t=new d.Pa4,i=z.BucketBlockSize,n=z.BucketSize){return new e4(void 0,void 0,void 0,r=>{let a=C.OFFSET.X,s=C.OFFSET.Y,o=C.OFFSET.Z;e<=0&&(e=r.splatCount);let l=new d.Pa4,c=e=>{e.x=.5*Math.floor(e.x/.5),e.y=.5*Math.floor(e.y/.5),e.z=.5*Math.floor(e.z/.5)};r.splats.forEach(e=>{l.set(e[a],e[s],e[o]).sub(t),c(l),e.centerDist=l.lengthSq()}),r.splats.sort((e,t)=>e.centerDist>t.centerDist?1:-1);let h=[],u=[];e=Math.min(r.splatCount,e);let p=Math.ceil(r.splatCount/e),f=0;for(let t=0;t<p;t++){let t=f;h.push(i=>i>=t&&i<t+e),u.push({blocksSize:i,bucketSize:n}),f+=e}return{sectionCount:h.length,sectionFilters:h,groupingParameters:u}})}}class e5{constructor(e,t,i,n,r,a,s){this.splatPartitioner=e,this.alphaRemovalThreshold=t,this.compressionLevel=i,this.sectionSize=n,this.sceneCenter=r?new d.Pa4().copy(r):void 0,this.blockSize=a,this.bucketSize=s}generateFromUncompressedSplatArray(e){let t=this.splatPartitioner.partitionUncompressedSplatArray(e);return z.generateFromUncompressedSplatArrays(t.splatArrays,this.alphaRemovalThreshold,this.compressionLevel,this.sceneCenter,this.blockSize,this.bucketSize,t.parameters)}static getStandardGenerator(e=1,t=1,i=0,n=new d.Pa4,r=z.BucketBlockSize,a=z.BucketSize){return new e5(e4.getStandardPartitioner(i,n,r,a),e,t,i,n,r,a)}}let e6={Downloading:0,Processing:1,Done:2};class e8 extends Error{constructor(e){super(e)}}let e9={ProgressiveToSplatBuffer:0,ProgressiveToSplatArray:1,DownloadBeforeProcessing:2};function e7(e,t){let i=0;for(let t of e)i+=t.sizeBytes;(!t||t.byteLength<i)&&(t=new ArrayBuffer(i));let n=0;for(let i of e)new Uint8Array(t,n,i.sizeBytes).set(i.data),n+=i.sizeBytes;return t}function te(e,t,i,n,r,a,s,o){return t?e5.getStandardGenerator(i,n,r,a,s,o).generateFromUncompressedSplatArray(e):z.generateFromUncompressedSplatArrays([e],i,0,new d.Pa4)}class tt{static loadFromURL(e,t,i,n,r,a,s=!0,o=0,l,c,h,u,p){let f,m,v,y,x,A,S;f=i||s?s?e9.ProgressiveToSplatArray:e9.ProgressiveToSplatBuffer:e9.DownloadBeforeProcessing;let w=T.ProgressiveLoadSectionSize,M=z.HeaderSizeBytes+z.SectionHeaderSizeBytes,E=0,R=0,P=0,I=!1,L=!1,D=!1,B=b(),O=0,N=0,U=0,F=0,k="",H=null,V=[],G=new TextDecoder;return t&&t(0,"0%",e6.Downloading),g(e,(e,i,r)=>{let a=e>=100;if(r&&(V.push({data:r,sizeBytes:r.byteLength,startBytes:U,endBytes:U+r.byteLength}),U+=r.byteLength),f===e9.DownloadBeforeProcessing)a&&B.resolve(V);else{if(I){if(m===Z.PlayCanvasCompressed&&!L){let e=H.headerSizeBytes+H.chunkElement.storageSizeBytes;(A=e7(V,A)).byteLength>=e&&(J.readElementData(H.chunkElement,A,H.headerSizeBytes),O=e,N=e,L=!0)}}else if(k+=G.decode(r),el.checkTextForEndHeader(k)){if((m=el.determineHeaderFormatFromHeaderText(k))===Z.INRIAV1)H=eT.decodeHeaderText(k),o=Math.min(o,H.sphericalHarmonicsDegree),E=H.splatCount,L=!0,F=H.headerSizeBytes+H.bytesPerSplat*E;else if(m===Z.PlayCanvasCompressed){if(H=J.decodeHeaderText(k),o=Math.min(o,H.sphericalHarmonicsDegree),f===e9.ProgressiveToSplatBuffer&&o>0)throw new e8("PlyLoader.loadFromURL() -> Selected PLY format has spherical harmonics data that cannot be progressively loaded.");E=H.vertexElement.count,F=H.headerSizeBytes+H.bytesPerSplat*E+H.chunkElement.storageSizeBytes}else{if(f===e9.ProgressiveToSplatBuffer)throw new e8("PlyLoader.loadFromURL() -> Selected PLY format cannot be progressively loaded.");f=e9.DownloadBeforeProcessing;return}f===e9.ProgressiveToSplatBuffer?(y=new ArrayBuffer(M+z.CompressionLevels[0].SphericalHarmonicsDegrees[o].BytesPerSplat*E),z.writeHeaderToBuffer({versionMajor:z.CurrentMajorVersion,versionMinor:z.CurrentMinorVersion,maxSectionCount:1,sectionCount:1,maxSplatCount:E,splatCount:0,compressionLevel:0,sceneCenter:new d.Pa4},y)):S=new C(o),O=H.headerSizeBytes,N=H.headerSizeBytes,I=!0}if(I&&L&&V.length>0&&(v=e7(V,v),U-O>w||U>=F&&!D||a)){let e=D?H.sphericalHarmonicsPerSplat:H.bytesPerSplat,t=Math.floor(((D?U:Math.min(F,U))-N)/e),i=t*e,n=U-N-i,r=N-V[0].startBytes,a=new DataView(v,r,i);if(D)m===Z.PlayCanvasCompressed&&f===e9.ProgressiveToSplatArray&&(J.parseSphericalHarmonicsToUncompressedSplatArraySection(H.chunkElement,H.shElement,P,P+t-1,a,0,o,H.sphericalHarmonicsDegree,S),P+=t);else{if(f===e9.ProgressiveToSplatBuffer){let e=z.CompressionLevels[0].SphericalHarmonicsDegrees[o],i=R*e.BytesPerSplat+M;m===Z.PlayCanvasCompressed?J.parseToUncompressedSplatBufferSection(H.chunkElement,H.vertexElement,0,t-1,R,a,y,i):eT.parseToUncompressedSplatBufferSection(H,0,t-1,a,0,y,i,o)}else m===Z.PlayCanvasCompressed?J.parseToUncompressedSplatArraySection(H.chunkElement,H.vertexElement,0,t-1,R,a,S):eT.parseToUncompressedSplatArraySection(H,0,t-1,a,0,S,o);R+=t,f===e9.ProgressiveToSplatBuffer&&(x||(z.writeSectionHeaderToBuffer({maxSplatCount:E,splatCount:R,bucketSize:0,bucketCount:0,bucketBlockSize:0,compressionScaleRange:0,storageSizeBytes:0,fullBucketCount:0,partiallyFilledBucketCount:0,sphericalHarmonicsDegree:o},0,y,z.HeaderSizeBytes),x=new z(y,!1)),x.updateLoadedCounts(1,R)),U>=F&&(D=!0)}if(0===n)V=[];else{let e=[],t=0;for(let i=V.length-1;i>=0;i--){let r=V[i];if(t+=r.sizeBytes,e.unshift(r),t>=n)break}V=e}O+=w,N+=i}n&&x&&n(x,a),a&&(f===e9.ProgressiveToSplatBuffer?B.resolve(x):B.resolve(S))}t&&t(e,i,e6.Downloading)},!1,l).then(()=>(t&&t(0,"0%",e6.Processing),B.promise.then(e=>(t&&t(100,"100%",e6.Done),f===e9.DownloadBeforeProcessing)?new Blob(V.map(e=>e.data)).arrayBuffer().then(e=>tt.loadFromFileData(e,r,a,s,o,c,h,u,p)):f===e9.ProgressiveToSplatBuffer?e:_(()=>te(e,s,r,a,c,h,u,p)))))}static loadFromFileData(e,t,i,n,r=0,a,s,o,l){return n?_(()=>e3.parseToUncompressedSplatArray(e,r)).then(e=>te(e,n,t,i,a,s,o,l)):_(()=>e3.parseToUncompressedSplatBuffer(e,r))}}let ti=e=>new ReadableStream({async start(t){t.enqueue(e),t.close()}});async function tn(e){try{let t=ti(e);if(!t)throw Error("Failed to create stream from data");return await tr(t)}catch(e){throw console.error("Error decompressing gzipped data:",e),e}}async function tr(e){let t=new Response(e.pipeThrough(new DecompressionStream("gzip")));return new Uint8Array(await t.arrayBuffer())}function ta(e){switch(e){case 0:return 0;case 1:return 3;case 2:return 8;case 3:return 15;default:return console.error(`[SPZ: ERROR] Unsupported SH degree: ${e}`),0}}let ts=function(){let e=[],t=new d._fP,i=C.OFFSET.X,n=C.OFFSET.Y,r=C.OFFSET.Z,a=C.OFFSET.SCALE0,s=C.OFFSET.SCALE1,o=C.OFFSET.SCALE2,l=C.OFFSET.ROTATION0,c=C.OFFSET.ROTATION1,h=C.OFFSET.ROTATION2,u=C.OFFSET.ROTATION3,p=C.OFFSET.FDC0,f=C.OFFSET.FDC1,m=C.OFFSET.FDC2,g=C.OFFSET.OPACITY,y=[];for(let e=0;e<45;e++)y[e]=C.OFFSET.FRC0+e;let x=[ta(0),ta(1),ta(2),ta(3)],_=[0,1,2,9,10,11,12,13,24,25,26,27,28,29,30,3,4,5,14,15,16,17,18,31,32,33,34,35,36,37,6,7,8,19,20,21,22,23,38,39,40,41,42,43,44];return function(d,y,A){A=Math.min(y,A);let b=C.createSplat(A);void 0!==d.scale[0]?(b[a]=d.scale[0],b[s]=d.scale[1],b[o]=d.scale[2]):(b[a]=.01,b[s]=.01,b[o]=.01),void 0!==d.color[0]?(b[p]=d.color[0],b[f]=d.color[1],b[m]=d.color[2]):void 0!==e[RED]?(b[p]=255*e[RED],b[f]=255*e[GREEN],b[m]=255*e[BLUE]):(b[p]=0,b[f]=0,b[m]=0),void 0!==d.alpha&&(b[g]=d.alpha),b[p]=v(Math.floor(b[p]),0,255),b[f]=v(Math.floor(b[f]),0,255),b[m]=v(Math.floor(b[m]),0,255),b[g]=v(Math.floor(b[g]),0,255);let S=x[A],w=x[y];for(let e=0;e<3;++e)for(let t=0;t<15;++t){let i=_[15*e+t];t<S&&t<w&&(b[C.OFFSET.FRC0+i]=d.sh[e*w+t])}return t.set(d.rotation[3],d.rotation[0],d.rotation[1],d.rotation[2]),t.normalize(),b[l]=t.x,b[c]=t.y,b[h]=t.z,b[u]=t.w,b[i]=d.position[0],b[n]=d.position[1],b[r]=d.position[2],b}}();function to(e,t,i,n,r){let a;t=Math.min(t,e.shDegree);let s=e.numPoints,o=ta(e.shDegree),l=e.positions.length===6*s;if(e.positions.length!==3*s*(l?2:3)||e.scales.length!==3*s||e.rotations.length!==3*s||e.alphas.length!==s||e.colors.length!==3*s||e.sh.length!==s*o*3)return null;let c={position:[],scale:[],rotation:[],alpha:void 0,color:[],sh:[]};l&&(a=new Uint16Array(e.positions.buffer,e.positions.byteOffset,3*s));let h=1/(1<<e.fractionalBits),u=ta(e.shDegree);for(let o=0;o<s;o++){if(l)for(let e=0;e<3;e++)c.position[e]=function(e){let t=e>>10&31,i=1023&e,n=1==(e>>15&1)?-1:1;return 0===t?6103515625e-14*n*i/1024:31===t?0!==i?NaN:1/0*n:n*Math.pow(2,t-15)*(1+i/1024)}(a[3*o+e]);else for(let t=0;t<3;t++){let i=9*o+3*t,n=e.positions[i];n|=e.positions[i+1]<<8,n|=e.positions[i+2]<<16,n|=8388608&n?0xff000000:0,c.position[t]=n*h}for(let t=0;t<3;t++)c.scale[t]=Math.exp(e.scales[3*o+t]/16-10);let s=e.rotations.subarray(3*o,3*o+3),d=[s[0]/127.5-1,s[1]/127.5-1,s[2]/127.5-1];c.rotation[0]=d[0],c.rotation[1]=d[1],c.rotation[2]=d[2];let p=d[0]*d[0]+d[1]*d[1]+d[2]*d[2];c.rotation[3]=Math.sqrt(Math.max(0,1-p)),c.alpha=Math.floor(e.alphas[o]);for(let t=0;t<3;t++)c.color[t]=Math.floor(((e.colors[3*o+t]/255-.5)/.15*.28209479177387814+.5)*255);for(let t=0;t<3;t++)for(let i=0;i<u;i++)c.sh[t*u+i]=(e.sh[3*u*o+3*i+t]-128)/128;let f=ts(c,e.shDegree,t);if(i){let e=o*z.CompressionLevels[0].SphericalHarmonicsDegrees[t].BytesPerSplat+r;z.writeSplatDataToSectionBuffer(f,n,e,0,t)}else n.addSplat(f)}}async function tl(e){try{let t=await tn(e);return function(e){let t=new DataView(e),i=0,n={magic:t.getUint32(i,!0),version:t.getUint32(i+4,!0),numPoints:t.getUint32(i+8,!0),shDegree:t.getUint8(i+12),fractionalBits:t.getUint8(i+13),flags:t.getUint8(i+14),reserved:t.getUint8(i+15)};if(i+=16,0x5053474e!==n.magic)return console.error("[SPZ ERROR] deserializePackedGaussians: header not found"),null;if(n.version<1||n.version>2)return console.error(`[SPZ ERROR] deserializePackedGaussians: version not supported: ${n.version}`),null;if(n.numPoints>1e7)return console.error(`[SPZ ERROR] deserializePackedGaussians: Too many points: ${n.numPoints}`),null;if(n.shDegree>3)return console.error(`[SPZ ERROR] deserializePackedGaussians: Unsupported SH degree: ${n.shDegree}`),null;let r=n.numPoints,a=ta(n.shDegree),s=1===n.version,o={numPoints:r,shDegree:n.shDegree,fractionalBits:n.fractionalBits,antialiased:(1&n.flags)!=0,positions:new Uint8Array(3*r*(s?2:3)),scales:new Uint8Array(3*r),rotations:new Uint8Array(3*r),alphas:new Uint8Array(r),colors:new Uint8Array(3*r),sh:new Uint8Array(r*a*3)};try{let t=new Uint8Array(e),n=o.positions.length,r=i;if(o.positions.set(t.slice(r,r+n)),r+=n,o.alphas.set(t.slice(r,r+o.alphas.length)),r+=o.alphas.length,o.colors.set(t.slice(r,r+o.colors.length)),r+=o.colors.length,o.scales.set(t.slice(r,r+o.scales.length)),r+=o.scales.length,o.rotations.set(t.slice(r,r+o.rotations.length)),r+=o.rotations.length,o.sh.set(t.slice(r,r+o.sh.length)),r+o.sh.length!==e.byteLength)return console.error("[SPZ ERROR] deserializePackedGaussians: incorrect buffer size"),null}catch(e){return console.error("[SPZ ERROR] deserializePackedGaussians: read error",e),null}return o}(t.buffer)}catch(e){return console.error("[SPZ ERROR] loadSpzPacked: decompression error",e),null}}class tc{static loadFromURL(e,t,i,n,r=!0,a=0,s,o,l,c,h){return t&&t(0,"0%",e6.Downloading),g(e,t,!0,s).then(e=>(t&&t(0,"0%",e6.Processing),tc.loadFromFileData(e,i,n,r,a,o,l,c,h)))}static async loadFromFileData(e,t,i,n,r=0,a,s,o,l){await _();let c=await tl(e),h=new C(r=Math.min(c.shDegree,r));if(n)return to(c,r,!1,h,0),e5.getStandardGenerator(t,i,a,s,o,l).generateFromUncompressedSplatArray(h);{let{splatBuffer:e,splatBufferDataOffsetBytes:t}=z.preallocateUncompressed(c.numPoints,r);return to(c,r,!0,e.bufferData,t),e}}}class th{static RowSizeBytes=32;static CenterSizeBytes=12;static ScaleSizeBytes=12;static RotationSizeBytes=4;static ColorSizeBytes=4;static parseToUncompressedSplatBufferSection(e,t,i,n,r,a){let s=z.CompressionLevels[0].BytesPerCenter,o=z.CompressionLevels[0].BytesPerScale,l=z.CompressionLevels[0].BytesPerRotation,c=z.CompressionLevels[0].SphericalHarmonicsDegrees[0].BytesPerSplat;for(let h=e;h<=t;h++){let e=h*th.RowSizeBytes+n,t=new Float32Array(i,e,3),u=new Float32Array(i,e+th.CenterSizeBytes,3),p=new Uint8Array(i,e+th.CenterSizeBytes+th.ScaleSizeBytes,4),f=new Uint8Array(i,e+th.CenterSizeBytes+th.ScaleSizeBytes+th.RotationSizeBytes,4),m=new d._fP((f[1]-128)/128,(f[2]-128)/128,(f[3]-128)/128,(f[0]-128)/128);m.normalize();let g=h*c+a,v=new Float32Array(r,g,3),y=new Float32Array(r,g+s,3),x=new Float32Array(r,g+s+o,4),_=new Uint8Array(r,g+s+o+l,4);v[0]=t[0],v[1]=t[1],v[2]=t[2],y[0]=u[0],y[1]=u[1],y[2]=u[2],x[0]=m.w,x[1]=m.x,x[2]=m.y,x[3]=m.z,_[0]=p[0],_[1]=p[1],_[2]=p[2],_[3]=p[3]}}static parseToUncompressedSplatArraySection(e,t,i,n,r){for(let a=e;a<=t;a++){let e=a*th.RowSizeBytes+n,t=new Float32Array(i,e,3),s=new Float32Array(i,e+th.CenterSizeBytes,3),o=new Uint8Array(i,e+th.CenterSizeBytes+th.ScaleSizeBytes,4),l=new Uint8Array(i,e+th.CenterSizeBytes+th.ScaleSizeBytes+th.RotationSizeBytes,4),c=new d._fP((l[1]-128)/128,(l[2]-128)/128,(l[3]-128)/128,(l[0]-128)/128);c.normalize(),r.addSplatFromComonents(t[0],t[1],t[2],s[0],s[1],s[2],c.w,c.x,c.y,c.z,o[0],o[1],o[2],o[3])}}static parseStandardSplatToUncompressedSplatArray(e){let t=e.byteLength/th.RowSizeBytes,i=new C;for(let n=0;n<t;n++){let t=n*th.RowSizeBytes,r=new Float32Array(e,t,3),a=new Float32Array(e,t+th.CenterSizeBytes,3),s=new Uint8Array(e,t+th.CenterSizeBytes+th.ScaleSizeBytes,4),o=new Uint8Array(e,t+th.CenterSizeBytes+th.ScaleSizeBytes+th.ColorSizeBytes,4),l=new d._fP((o[1]-128)/128,(o[2]-128)/128,(o[3]-128)/128,(o[0]-128)/128);l.normalize(),i.addSplatFromComonents(r[0],r[1],r[2],a[0],a[1],a[2],l.w,l.x,l.y,l.z,s[0],s[1],s[2],s[3])}return i}}function tu(e,t,i,n,r,a,s,o){return t?e5.getStandardGenerator(i,n,r,a,s,o).generateFromUncompressedSplatArray(e):z.generateFromUncompressedSplatArrays([e],i,0,new d.Pa4)}class td{static loadFromURL(e,t,i,n,r,a,s=!0,o,l,c,h,u){let p,f,m,v,y=i?e9.ProgressiveToSplatBuffer:e9.ProgressiveToSplatArray;s&&(y=e9.ProgressiveToSplatArray);let x=z.HeaderSizeBytes+z.SectionHeaderSizeBytes,A=T.ProgressiveLoadSectionSize,S=0,w=0,M=b(),E=0,R=0,P=[];return t&&t(0,"0%",e6.Downloading),g(e,(e,r,a,s)=>{let o=e>=100;if(a&&P.push(a),y===e9.DownloadBeforeProcessing){o&&M.resolve(P);return}if(!s){if(i)throw new e8("Cannon directly load .splat because no file size info is available.");y=e9.DownloadBeforeProcessing;return}if(!p){S=s/th.RowSizeBytes,p=new ArrayBuffer(s);let e=x+z.CompressionLevels[0].SphericalHarmonicsDegrees[0].BytesPerSplat*S;y===e9.ProgressiveToSplatBuffer?(f=new ArrayBuffer(e),z.writeHeaderToBuffer({versionMajor:z.CurrentMajorVersion,versionMinor:z.CurrentMinorVersion,maxSectionCount:1,sectionCount:1,maxSplatCount:S,splatCount:w,compressionLevel:0,sceneCenter:new d.Pa4},f)):v=new C(0)}if(a){new Uint8Array(p,R,a.byteLength).set(new Uint8Array(a));let e=(R+=a.byteLength)-E;if(e>A||o){let t=(o?e:A)/th.RowSizeBytes,i=w+t;y===e9.ProgressiveToSplatBuffer?th.parseToUncompressedSplatBufferSection(w,i-1,p,0,f,x):th.parseToUncompressedSplatArraySection(w,i-1,p,0,v),w=i,y===e9.ProgressiveToSplatBuffer&&(m||(z.writeSectionHeaderToBuffer({maxSplatCount:S,splatCount:w,bucketSize:0,bucketCount:0,bucketBlockSize:0,compressionScaleRange:0,storageSizeBytes:0,fullBucketCount:0,partiallyFilledBucketCount:0},0,f,z.HeaderSizeBytes),m=new z(f,!1)),m.updateLoadedCounts(1,w),n&&n(m,o)),E+=A}}o&&(y===e9.ProgressiveToSplatBuffer?M.resolve(m):M.resolve(v)),t&&t(e,r,e6.Downloading)},!1,o).then(()=>(t&&t(0,"0%",e6.Processing),M.promise.then(e=>(t&&t(100,"100%",e6.Done),y===e9.DownloadBeforeProcessing)?new Blob(P).arrayBuffer().then(e=>td.loadFromFileData(e,r,a,s,l,c,h,u)):y===e9.ProgressiveToSplatBuffer?e:_(()=>tu(e,s,r,a,l,c,h,u)))))}static loadFromFileData(e,t,i,n,r,a,s,o){return _(()=>tu(th.parseStandardSplatToUncompressedSplatArray(e),n,t,i,r,a,s,o))}}class tp{static checkVersion(e){let t=z.CurrentMajorVersion,i=z.CurrentMinorVersion,n=z.parseHeader(e);if(n.versionMajor===t&&n.versionMinor>=i||n.versionMajor>t)return!0;throw Error(`KSplat version not supported: v${n.versionMajor}.${n.versionMinor}. Minimum required: v${t}.${i}`)}static loadFromURL(e,t,i,n,r){let a,s,o,l,c;let h=!1,u=!1,d=[],p=!1,f=!1,m=0,v=0,y=0,x=!1,_=!1,A=!1,S=[],w=b(),M=()=>{h||u||!(m>=z.HeaderSizeBytes)||(u=!0,new Blob(S).arrayBuffer().then(e=>{new Uint8Array(o=new ArrayBuffer(z.HeaderSizeBytes)).set(new Uint8Array(e,0,z.HeaderSizeBytes)),tp.checkVersion(o),u=!1,h=!0,l=z.parseHeader(o),window.setTimeout(()=>{R()},1)}))},E=0,C=()=>{0===E&&(E++,window.setTimeout(()=>{E--,P()},1))},R=()=>{!f&&!p&&h&&m>=z.HeaderSizeBytes+z.SectionHeaderSizeBytes*l.maxSectionCount&&(f=!0,new Blob(S).arrayBuffer().then(e=>{f=!1,p=!0,new Uint8Array(c=new ArrayBuffer(l.maxSectionCount*z.SectionHeaderSizeBytes)).set(new Uint8Array(e,z.HeaderSizeBytes,l.maxSectionCount*z.SectionHeaderSizeBytes)),d=z.parseSectionHeaders(l,c,0,!1);let t=0;for(let e=0;e<l.maxSectionCount;e++)t+=d[e].storageSizeBytes;let i=z.HeaderSizeBytes+l.maxSectionCount*z.SectionHeaderSizeBytes+t;if(!a){a=new ArrayBuffer(i);let e=0;for(let t=0;t<S.length;t++){let i=S[t];new Uint8Array(a,e,i.byteLength).set(new Uint8Array(i)),e+=i.byteLength}}y=z.HeaderSizeBytes+z.SectionHeaderSizeBytes*l.maxSectionCount;for(let e=0;e<=d.length&&e<l.maxSectionCount;e++)y+=d[e].storageSizeBytes;C()}))},P=()=>{!A&&(A=!0,window.setTimeout(()=>{if(A=!1,p&&!_&&(x=m>=y,m-v>T.ProgressiveLoadSectionSize||x)){v+=T.ProgressiveLoadSectionSize,_=v>=y,s||(s=new z(a,!1));let e=z.HeaderSizeBytes+z.SectionHeaderSizeBytes*l.maxSectionCount,i=0,r=0,o=0;for(let t=0;t<l.maxSectionCount;t++){let n=d[t],a=e+(i+4*n.partiallyFilledBucketCount+n.bucketStorageSizeBytes*n.bucketCount);if(v>=a){r++;let e=Math.floor((v-a)/z.CompressionLevels[l.compressionLevel].SphericalHarmonicsDegrees[n.sphericalHarmonicsDegree].BytesPerSplat);o+=e=Math.min(e,n.maxSplatCount),s.updateLoadedCounts(r,o),s.updateSectionLoadedCounts(t,e)}else break;i+=n.storageSizeBytes}n(s,_);let c=v/y*100,h=c.toFixed(2)+"%";t&&t(c,h,e6.Downloading),_?w.resolve(s):P()}},T.ProgressiveLoadSectionDelayDuration))};return g(e,(e,n,r)=>{r&&(S.push(r),a&&new Uint8Array(a,m,r.byteLength).set(new Uint8Array(r)),m+=r.byteLength),i?(M(),R(),P()):t&&t(e,n,e6.Downloading)},!i,r).then(e=>(t&&t(0,"0%",e6.Processing),(i?w.promise:tp.loadFromFileData(e)).then(e=>(t&&t(100,"100%",e6.Done),e))))}static loadFromFileData(e){return _(()=>(tp.checkVersion(e),new z(e)))}static downloadFile=function(e,t){let i=new Blob([e.bufferData],{type:"application/octet-stream"});n||(n=document.createElement("a"),document.body.appendChild(n)),n.download=t,n.href=URL.createObjectURL(i),n.click()}}let tf={Splat:0,KSplat:1,Ply:2,Spz:3},tm=e=>e.endsWith(".ply")?tf.Ply:e.endsWith(".splat")?tf.Splat:e.endsWith(".ksplat")?tf.KSplat:e.endsWith(".spz")?tf.Spz:null;var tg=Object.freeze({__proto__:null,sceneFormatFromPath:tm});let tv={type:"change"},ty={type:"start"},tx={type:"end"},t_=new d.zHn,tA=new d.JOQ,tb=Math.cos(70*d.M8C.DEG2RAD);class tS extends d.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new d.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"KeyA",UP:"KeyW",RIGHT:"KeyD",BOTTOM:"KeyS"},this.mouseButtons={LEFT:d.RsA.ROTATE,MIDDLE:d.RsA.DOLLY,RIGHT:d.RsA.PAN},this.touches={ONE:d.QmN.ROTATE,TWO:d.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",X),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",X),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,this.clearDampedRotation(),this.clearDampedPan(),i.object.updateProjectionMatrix(),i.dispatchEvent(tv),i.update(),r=n.NONE},this.clearDampedRotation=function(){o.theta=0,o.phi=0},this.clearDampedPan=function(){c.set(0,0,0)},this.update=function(){let t=new d.Pa4,h=new d._fP().setFromUnitVectors(e.up,new d.Pa4(0,1,0)),u=h.clone().invert(),p=new d.Pa4,f=new d._fP,m=new d.Pa4,g=2*Math.PI;return function(){h.setFromUnitVectors(e.up,new d.Pa4(0,1,0)),u.copy(h).invert();let v=i.object.position;t.copy(v).sub(i.target),t.applyQuaternion(h),s.setFromVector3(t),i.autoRotate&&r===n.NONE&&E(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(s.theta+=o.theta*i.dampingFactor,s.phi+=o.phi*i.dampingFactor):(s.theta+=o.theta,s.phi+=o.phi);let y=i.minAzimuthAngle,x=i.maxAzimuthAngle;isFinite(y)&&isFinite(x)&&(y<-Math.PI?y+=g:y>Math.PI&&(y-=g),x<-Math.PI?x+=g:x>Math.PI&&(x-=g),y<=x?s.theta=Math.max(y,Math.min(x,s.theta)):s.theta=s.theta>(y+x)/2?Math.max(y,s.theta):Math.min(x,s.theta)),s.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,s.phi)),s.makeSafe(),!0===i.enableDamping?i.target.addScaledVector(c,i.dampingFactor):i.target.add(c),i.zoomToCursor&&b||i.object.isOrthographicCamera?s.radius=B(s.radius):s.radius=B(s.radius*l),t.setFromSpherical(s),t.applyQuaternion(u),v.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(o.theta*=1-i.dampingFactor,o.phi*=1-i.dampingFactor,c.multiplyScalar(1-i.dampingFactor)):(o.set(0,0,0),c.set(0,0,0));let S=!1;if(i.zoomToCursor&&b){let n=null;if(i.object.isPerspectiveCamera){let e=t.length();n=B(e*l);let r=e-n;i.object.position.addScaledVector(_,r),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){let e=new d.Pa4(A.x,A.y,0);e.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),S=!0;let r=new d.Pa4(A.x,A.y,0);r.unproject(i.object),i.object.position.sub(r).add(e),i.object.updateMatrixWorld(),n=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;null!==n&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(n).add(i.object.position):(t_.origin.copy(i.object.position),t_.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(t_.direction))<tb?e.lookAt(i.target):(tA.setFromNormalAndCoplanarPoint(i.object.up,i.target),t_.intersectPlane(tA,i.target))))}else i.object.isOrthographicCamera&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),S=!0);return l=1,b=!1,!!(S||p.distanceToSquared(i.object.position)>a||8*(1-f.dot(i.object.quaternion))>a||m.distanceToSquared(i.target)>0)&&(i.dispatchEvent(tv),p.copy(i.object.position),f.copy(i.object.quaternion),m.copy(i.target),S=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Y),i.domElement.removeEventListener("pointerdown",G),i.domElement.removeEventListener("pointercancel",j),i.domElement.removeEventListener("wheel",q),i.domElement.removeEventListener("pointermove",W),i.domElement.removeEventListener("pointerup",j),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",X),i._domElementKeyEvents=null)};let i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},r=n.NONE,a=1e-6,s=new d.$V,o=new d.$V,l=1,c=new d.Pa4,h=new d.FM8,u=new d.FM8,p=new d.FM8,f=new d.FM8,m=new d.FM8,g=new d.FM8,v=new d.FM8,y=new d.FM8,x=new d.FM8,_=new d.Pa4,A=new d.FM8,b=!1,S=[],w={};function M(){return Math.pow(.95,i.zoomSpeed)}function E(e){o.theta-=e}function C(e){o.phi-=e}let T=function(){let e=new d.Pa4;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),c.add(e)}}(),R=function(){let e=new d.Pa4;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),c.add(e)}}(),P=function(){let e=new d.Pa4;return function(t,n){let r=i.domElement;if(i.object.isPerspectiveCamera){let a=i.object.position;e.copy(a).sub(i.target);let s=e.length();T(2*t*(s*=Math.tan(i.object.fov/2*Math.PI/180))/r.clientHeight,i.object.matrix),R(2*n*s/r.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(T(t*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),R(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function I(e){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(e){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function D(t){if(!i.zoomToCursor)return;b=!0;let n=i.domElement.getBoundingClientRect(),r=t.clientX-n.left,a=t.clientY-n.top,s=n.width,o=n.height;A.x=r/s*2-1,A.y=-(a/o*2)+1,_.set(A.x,A.y,1).unproject(e).sub(e.position).normalize()}function B(e){return Math.max(i.minDistance,Math.min(i.maxDistance,e))}function O(e){h.set(e.clientX,e.clientY)}function N(e){f.set(e.clientX,e.clientY)}function U(){if(1===S.length)h.set(S[0].pageX,S[0].pageY);else{let e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);h.set(e,t)}}function F(){if(1===S.length)f.set(S[0].pageX,S[0].pageY);else{let e=.5*(S[0].pageX+S[1].pageX),t=.5*(S[0].pageY+S[1].pageY);f.set(e,t)}}function k(){let e=S[0].pageX-S[1].pageX,t=S[0].pageY-S[1].pageY,i=Math.sqrt(e*e+t*t);v.set(0,i)}function z(e){if(1==S.length)u.set(e.pageX,e.pageY);else{let t=Q(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);u.set(i,n)}p.subVectors(u,h).multiplyScalar(i.rotateSpeed);let t=i.domElement;E(2*Math.PI*p.x/t.clientHeight),C(2*Math.PI*p.y/t.clientHeight),h.copy(u)}function H(e){if(1===S.length)m.set(e.pageX,e.pageY);else{let t=Q(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);m.set(i,n)}g.subVectors(m,f).multiplyScalar(i.panSpeed),P(g.x,g.y),f.copy(m)}function V(e){let t=Q(e),n=e.pageX-t.x,r=e.pageY-t.y,a=Math.sqrt(n*n+r*r);y.set(0,a),x.set(0,Math.pow(y.y/v.y,i.zoomSpeed)),I(x.y),v.copy(y)}function G(e){var t;!1!==i.enabled&&(0===S.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",W),i.domElement.addEventListener("pointerup",j)),t=e,S.push(t),"touch"===e.pointerType?function(e){switch(K(e),S.length){case 1:switch(i.touches.ONE){case d.QmN.ROTATE:if(!1===i.enableRotate)return;U(),r=n.TOUCH_ROTATE;break;case d.QmN.PAN:if(!1===i.enablePan)return;F(),r=n.TOUCH_PAN;break;default:r=n.NONE}break;case 2:switch(i.touches.TWO){case d.QmN.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&k(),i.enablePan&&F(),r=n.TOUCH_DOLLY_PAN;break;case d.QmN.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&k(),i.enableRotate&&U(),r=n.TOUCH_DOLLY_ROTATE;break;default:r=n.NONE}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(ty)}(e):function(e){let t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case d.RsA.DOLLY:if(!1===i.enableZoom)return;D(e),v.set(e.clientX,e.clientY),r=n.DOLLY;break;case d.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;N(e),r=n.PAN}else{if(!1===i.enableRotate)return;O(e),r=n.ROTATE}break;case d.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;O(e),r=n.ROTATE}else{if(!1===i.enablePan)return;N(e),r=n.PAN}break;default:r=n.NONE}r!==n.NONE&&i.dispatchEvent(ty)}(e))}function W(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(K(e),r){case n.TOUCH_ROTATE:if(!1===i.enableRotate)return;z(e),i.update();break;case n.TOUCH_PAN:if(!1===i.enablePan)return;H(e),i.update();break;case n.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&V(e),i.enablePan&&H(e),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&V(e),i.enableRotate&&z(e),i.update();break;default:r=n.NONE}}(e):function(e){switch(r){case n.ROTATE:if(!1===i.enableRotate)return;!function(e){u.set(e.clientX,e.clientY),p.subVectors(u,h).multiplyScalar(i.rotateSpeed);let t=i.domElement;E(2*Math.PI*p.x/t.clientHeight),C(2*Math.PI*p.y/t.clientHeight),h.copy(u),i.update()}(e);break;case n.DOLLY:if(!1===i.enableZoom)return;y.set(e.clientX,e.clientY),x.subVectors(y,v),x.y>0?I(M()):x.y<0&&L(M()),v.copy(y),i.update();break;case n.PAN:if(!1===i.enablePan)return;m.set(e.clientX,e.clientY),g.subVectors(m,f).multiplyScalar(i.panSpeed),P(g.x,g.y),f.copy(m),i.update()}}(e))}function j(e){(function(e){delete w[e.pointerId];for(let t=0;t<S.length;t++)if(S[t].pointerId==e.pointerId){S.splice(t,1);return}})(e),0===S.length&&(i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",W),i.domElement.removeEventListener("pointerup",j)),i.dispatchEvent(tx),r=n.NONE}function q(e){if(!1!==i.enabled&&!1!==i.enableZoom&&r===n.NONE)e.preventDefault(),i.dispatchEvent(ty),D(e),e.deltaY<0?L(M()):e.deltaY>0&&I(M()),i.update(),i.dispatchEvent(tx)}function X(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?C(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?C(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?E(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?E(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):P(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function Y(e){!1!==i.enabled&&e.preventDefault()}function K(e){let t=w[e.pointerId];void 0===t&&(t=new d.FM8,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function Q(e){return w[(e.pointerId===S[0].pointerId?S[1]:S[0]).pointerId]}i.domElement.addEventListener("contextmenu",Y),i.domElement.addEventListener("pointerdown",G),i.domElement.addEventListener("pointercancel",j),i.domElement.addEventListener("wheel",q,{passive:!1}),this.update()}}let tw=(e,t,i,n,r)=>{let a=performance.now(),s="none"===e.style.display?0:parseFloat(e.style.opacity);isNaN(s)&&(s=1);let o=window.setInterval(()=>{let l;let c=Math.min((performance.now()-a)/n,1);c>.999&&(c=1),t?(l=(1-c)*s)<1e-4&&(l=0):l=(1-s)*c+s,l>0?(e.style.display=i,e.style.opacity=l):e.style.display="none",c>=1&&(r&&r(),window.clearInterval(o))},16);return o};class tM{static elementIDGen=0;constructor(e,t){this.taskIDGen=0,this.elementID=tM.elementIDGen++,this.tasks=[],this.message=e||"Loading...",this.container=t||document.body,this.spinnerContainerOuter=document.createElement("div"),this.spinnerContainerOuter.className=`spinnerOuterContainer${this.elementID}`,this.spinnerContainerOuter.style.display="none",this.spinnerContainerPrimary=document.createElement("div"),this.spinnerContainerPrimary.className=`spinnerContainerPrimary${this.elementID}`,this.spinnerPrimary=document.createElement("div"),this.spinnerPrimary.classList.add(`spinner${this.elementID}`,`spinnerPrimary${this.elementID}`),this.messageContainerPrimary=document.createElement("div"),this.messageContainerPrimary.classList.add(`messageContainer${this.elementID}`,`messageContainerPrimary${this.elementID}`),this.messageContainerPrimary.innerHTML=this.message,this.spinnerContainerMin=document.createElement("div"),this.spinnerContainerMin.className=`spinnerContainerMin${this.elementID}`,this.spinnerMin=document.createElement("div"),this.spinnerMin.classList.add(`spinner${this.elementID}`,`spinnerMin${this.elementID}`),this.messageContainerMin=document.createElement("div"),this.messageContainerMin.classList.add(`messageContainer${this.elementID}`,`messageContainerMin${this.elementID}`),this.messageContainerMin.innerHTML=this.message,this.spinnerContainerPrimary.appendChild(this.spinnerPrimary),this.spinnerContainerPrimary.appendChild(this.messageContainerPrimary),this.spinnerContainerOuter.appendChild(this.spinnerContainerPrimary),this.spinnerContainerMin.appendChild(this.spinnerMin),this.spinnerContainerMin.appendChild(this.messageContainerMin),this.spinnerContainerOuter.appendChild(this.spinnerContainerMin);let i=document.createElement("style");i.innerHTML=`

            .spinnerOuterContainer${this.elementID} {
                width: 100%;
                height: 100%;
                margin: 0;
                top: 0;
                left: 0;
                position: absolute;
                pointer-events: none;
            }

            .messageContainer${this.elementID} {
                height: 20px;
                font-family: arial;
                font-size: 12pt;
                color: #ffffff;
                text-align: center;
                vertical-align: middle;
            }

            .spinner${this.elementID} {
                padding: 15px;
                background: #07e8d6;
                z-index:99999;
            
                aspect-ratio: 1;
                border-radius: 50%;
                --_m: 
                    conic-gradient(#0000,#000),
                    linear-gradient(#000 0 0) content-box;
                -webkit-mask: var(--_m);
                    mask: var(--_m);
                -webkit-mask-composite: source-out;
                    mask-composite: subtract;
                box-sizing: border-box;
                animation: load 1s linear infinite;
            }

            .spinnerContainerPrimary${this.elementID} {
                z-index:99999;
                background-color: rgba(128, 128, 128, 0.75);
                border: #666666 1px solid;
                border-radius: 5px;
                padding-top: 20px;
                padding-bottom: 10px;
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-80px, -80px);
                width: 180px;
                pointer-events: auto;
            }

            .spinnerPrimary${this.elementID} {
                width: 120px;
                margin-left: 30px;
            }

            .messageContainerPrimary${this.elementID} {
                padding-top: 15px;
            }

            .spinnerContainerMin${this.elementID} {
                z-index:99999;
                background-color: rgba(128, 128, 128, 0.75);
                border: #666666 1px solid;
                border-radius: 5px;
                padding-top: 20px;
                padding-bottom: 15px;
                margin: 0;
                position: absolute;
                bottom: 50px;
                left: 50%;
                transform: translate(-50%, 0);
                display: flex;
                flex-direction: left;
                pointer-events: auto;
                min-width: 250px;
            }

            .messageContainerMin${this.elementID} {
                margin-right: 15px;
            }

            .spinnerMin${this.elementID} {
                width: 50px;
                height: 50px;
                margin-left: 15px;
                margin-right: 25px;
            }

            .messageContainerMin${this.elementID} {
                padding-top: 15px;
            }
            
            @keyframes load {
                to{transform: rotate(1turn)}
            }

        `,this.spinnerContainerOuter.appendChild(i),this.container.appendChild(this.spinnerContainerOuter),this.setMinimized(!1,!0),this.fadeTransitions=[]}addTask(e){let t={message:e,id:this.taskIDGen++};return this.tasks.push(t),this.update(),t.id}removeTask(e){let t=0;for(let i of this.tasks){if(i.id===e){this.tasks.splice(t,1);break}t++}this.update()}removeAllTasks(){this.tasks=[],this.update()}setMessageForTask(e,t){for(let i of this.tasks)if(i.id===e){i.message=t;break}this.update()}update(){this.tasks.length>0?(this.show(),this.setMessage(this.tasks[this.tasks.length-1].message)):this.hide()}show(){this.spinnerContainerOuter.style.display="block",this.visible=!0}hide(){this.spinnerContainerOuter.style.display="none",this.visible=!1}setContainer(e){this.container&&this.spinnerContainerOuter.parentElement===this.container&&this.container.removeChild(this.spinnerContainerOuter),e&&(this.container=e,this.container.appendChild(this.spinnerContainerOuter),this.spinnerContainerOuter.style.zIndex=this.container.style.zIndex+1)}setMinimized(e,t){let i=(e,t,i,n,r)=>{i?e.style.display=t?n:"none":this.fadeTransitions[r]=tw(e,!t,n,500,()=>{this.fadeTransitions[r]=null})};i(this.spinnerContainerPrimary,!e,t,"block",0),i(this.spinnerContainerMin,e,t,"flex",1),this.minimized=e}setMessage(e){this.messageContainerPrimary.innerHTML=e,this.messageContainerMin.innerHTML=e}}class tE{constructor(e){this.idGen=0,this.tasks=[],this.container=e||document.body,this.progressBarContainerOuter=document.createElement("div"),this.progressBarContainerOuter.className="progressBarOuterContainer",this.progressBarContainerOuter.style.display="none",this.progressBarBox=document.createElement("div"),this.progressBarBox.className="progressBarBox",this.progressBarBackground=document.createElement("div"),this.progressBarBackground.className="progressBarBackground",this.progressBar=document.createElement("div"),this.progressBar.className="progressBar",this.progressBarBackground.appendChild(this.progressBar),this.progressBarBox.appendChild(this.progressBarBackground),this.progressBarContainerOuter.appendChild(this.progressBarBox);let t=document.createElement("style");t.innerHTML=`

            .progressBarOuterContainer {
                width: 100%;
                height: 100%;
                margin: 0;
                top: 0;
                left: 0;
                position: absolute;
                pointer-events: none;
            }

            .progressBarBox {
                z-index:99999;
                padding: 7px 9px 5px 7px;
                background-color: rgba(190, 190, 190, 0.75);
                border: #555555 1px solid;
                border-radius: 15px;
                margin: 0;
                position: absolute;
                bottom: 50px;
                left: 50%;
                transform: translate(-50%, 0);
                width: 180px;
                height: 30px;
                pointer-events: auto;
            }

            .progressBarBackground {
                width: 100%;
                height: 25px;
                border-radius:10px;
                background-color: rgba(128, 128, 128, 0.75);
                border: #444444 1px solid;
                box-shadow: inset 0 0 10px #333333;
            }

            .progressBar {
                height: 25px;
                width: 0px;
                border-radius:10px;
                background-color: rgba(0, 200, 0, 0.75);
                box-shadow: inset 0 0 10px #003300;
            }

        `,this.progressBarContainerOuter.appendChild(t),this.container.appendChild(this.progressBarContainerOuter)}show(){this.progressBarContainerOuter.style.display="block"}hide(){this.progressBarContainerOuter.style.display="none"}setProgress(e){this.progressBar.style.width=e+"%"}setContainer(e){this.container&&this.progressBarContainerOuter.parentElement===this.container&&this.container.removeChild(this.progressBarContainerOuter),e&&(this.container=e,this.container.appendChild(this.progressBarContainerOuter),this.progressBarContainerOuter.style.zIndex=this.container.style.zIndex+1)}}class tC{constructor(e){this.container=e||document.body,this.infoCells={},this.infoPanelContainer=document.createElement("div");let t=document.createElement("style");t.innerHTML=`

            .infoPanel {
                width: 430px;
                padding: 10px;
                background-color: rgba(50, 50, 50, 0.85);
                border: #555555 2px solid;
                color: #dddddd;
                border-radius: 10px;
                z-index: 9999;
                font-family: arial;
                font-size: 11pt;
                text-align: left;
                margin: 0;
                top: 10px;
                left:10px;
                position: absolute;
                pointer-events: auto;
            }

            .info-panel-cell {
                margin-bottom: 5px;
                padding-bottom: 2px;
            }

            .label-cell {
                font-weight: bold;
                font-size: 12pt;
                width: 140px;
            }

        `,this.infoPanelContainer.append(t),this.infoPanel=document.createElement("div"),this.infoPanel.className="infoPanel";let i=document.createElement("div");for(let e of(i.style.display="table",[["Camera position","cameraPosition"],["Camera look-at","cameraLookAt"],["Camera up","cameraUp"],["Camera mode","orthographicCamera"],["Cursor position","cursorPosition"],["FPS","fps"],["Rendering:","renderSplatCount"],["Sort time","sortTime"],["Render window","renderWindow"],["Focal adjustment","focalAdjustment"],["Splat scale","splatScale"],["Point cloud mode","pointCloudMode"]])){let t=document.createElement("div");t.style.display="table-row",t.className="info-panel-row";let n=document.createElement("div");n.style.display="table-cell",n.innerHTML=`${e[0]}: `,n.classList.add("info-panel-cell","label-cell");let r=document.createElement("div");r.style.display="table-cell",r.style.width="10px",r.innerHTML=" ",r.className="info-panel-cell";let a=document.createElement("div");a.style.display="table-cell",a.innerHTML="",a.className="info-panel-cell",this.infoCells[e[1]]=a,t.appendChild(n),t.appendChild(r),t.appendChild(a),i.appendChild(t)}this.infoPanel.appendChild(i),this.infoPanelContainer.append(this.infoPanel),this.infoPanelContainer.style.display="none",this.container.appendChild(this.infoPanelContainer),this.visible=!1}update=function(e,t,i,n,r,a,s,o,l,c,h,u,d,p){let f=`${t.x.toFixed(5)}, ${t.y.toFixed(5)}, ${t.z.toFixed(5)}`;if(this.infoCells.cameraPosition.innerHTML!==f&&(this.infoCells.cameraPosition.innerHTML=f),i){let e=`${i.x.toFixed(5)}, ${i.y.toFixed(5)}, ${i.z.toFixed(5)}`;this.infoCells.cameraLookAt.innerHTML!==e&&(this.infoCells.cameraLookAt.innerHTML=e)}let m=`${n.x.toFixed(5)}, ${n.y.toFixed(5)}, ${n.z.toFixed(5)}`;if(this.infoCells.cameraUp.innerHTML!==m&&(this.infoCells.cameraUp.innerHTML=m),this.infoCells.orthographicCamera.innerHTML=r?"Orthographic":"Perspective",a){let e=`${a.x.toFixed(5)}, ${a.y.toFixed(5)}, ${a.z.toFixed(5)}`;this.infoCells.cursorPosition.innerHTML=e}else this.infoCells.cursorPosition.innerHTML="N/A";this.infoCells.fps.innerHTML=s,this.infoCells.renderWindow.innerHTML=`${e.x} x ${e.y}`,this.infoCells.renderSplatCount.innerHTML=`${l} splats out of ${o} (${c.toFixed(2)}%)`,this.infoCells.sortTime.innerHTML=`${h.toFixed(3)} ms`,this.infoCells.focalAdjustment.innerHTML=`${u.toFixed(3)}`,this.infoCells.splatScale.innerHTML=`${d.toFixed(3)}`,this.infoCells.pointCloudMode.innerHTML=`${p}`};setContainer(e){this.container&&this.infoPanelContainer.parentElement===this.container&&this.container.removeChild(this.infoPanelContainer),e&&(this.container=e,this.container.appendChild(this.infoPanelContainer),this.infoPanelContainer.style.zIndex=this.container.style.zIndex+1)}show(){this.infoPanelContainer.style.display="block",this.visible=!0}hide(){this.infoPanelContainer.style.display="none",this.visible=!1}}let tT=new d.Pa4;class tR extends d.Tme{constructor(e=new d.Pa4(0,0,1),t=new d.Pa4(0,0,0),i=1,n=.1,r=0xffff00,a=.2*i,s=.2*a){super(),this.type="ArrowHelper";let o=new d.fHI(n,n,i,32);o.translate(0,i/2,0);let l=new d.fHI(0,s,a,32);l.translate(0,i,0),this.position.copy(t),this.line=new d.Kj0(o,new d.vBJ({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new d.Kj0(l,new d.vBJ({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{tT.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(tT,t)}}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class tP{constructor(e){this.threeScene=e,this.splatRenderTarget=null,this.renderTargetCopyQuad=null,this.renderTargetCopyCamera=null,this.meshCursor=null,this.focusMarker=null,this.controlPlane=null,this.debugRoot=null,this.secondaryDebugRoot=null}updateSplatRenderTargetForRenderDimensions(e,t){this.destroySplatRendertarget(),this.splatRenderTarget=new d.dd2(e,t,{format:d.wk1,stencilBuffer:!1,depthBuffer:!0}),this.splatRenderTarget.depthTexture=new d.$YQ(e,t),this.splatRenderTarget.depthTexture.format=d.qkB,this.splatRenderTarget.depthTexture.type=d.JQ4}destroySplatRendertarget(){this.splatRenderTarget&&(this.splatRenderTarget=null)}setupRenderTargetCopyObjects(){let e=new d.jyz({vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = vec4( position.xy, 0.0, 1.0 );    
                }
            `,fragmentShader:`
                #include <common>
                #include <packing>
                varying vec2 vUv;
                uniform sampler2D sourceColorTexture;
                uniform sampler2D sourceDepthTexture;
                void main() {
                    vec4 color = texture2D(sourceColorTexture, vUv);
                    float fragDepth = texture2D(sourceDepthTexture, vUv).x;
                    gl_FragDepth = fragDepth;
                    gl_FragColor = vec4(color.rgb, color.a * 2.0);
              }
            `,uniforms:{sourceColorTexture:{type:"t",value:null},sourceDepthTexture:{type:"t",value:null}},depthWrite:!1,depthTest:!1,transparent:!0,blending:d.Xaj,blendSrc:d.k74,blendSrcAlpha:d.k74,blendDst:d.LgZ,blendDstAlpha:d.LgZ});e.extensions.fragDepth=!0,this.renderTargetCopyQuad=new d.Kj0(new d._12(2,2),e),this.renderTargetCopyCamera=new d.iKG(-1,1,1,-1,0,1)}destroyRenderTargetCopyObjects(){this.renderTargetCopyQuad&&(x(this.renderTargetCopyQuad),this.renderTargetCopyQuad=null)}setupMeshCursor(){if(!this.meshCursor){let e=new d.b_z(.5,1.5,32),t=new d.vBJ({color:0xffffff}),i=new d.Kj0(e,t);i.rotation.set(0,0,Math.PI),i.position.set(0,1,0);let n=new d.Kj0(e,t);n.position.set(0,-1,0);let r=new d.Kj0(e,t);r.rotation.set(0,0,Math.PI/2),r.position.set(1,0,0);let a=new d.Kj0(e,t);a.rotation.set(0,0,-Math.PI/2),a.position.set(-1,0,0),this.meshCursor=new d.Tme,this.meshCursor.add(i),this.meshCursor.add(n),this.meshCursor.add(r),this.meshCursor.add(a),this.meshCursor.scale.set(.1,.1,.1),this.threeScene.add(this.meshCursor),this.meshCursor.visible=!1}}destroyMeshCursor(){this.meshCursor&&(x(this.meshCursor),this.threeScene.remove(this.meshCursor),this.meshCursor=null)}setMeshCursorVisibility(e){this.meshCursor.visible=e}getMeschCursorVisibility(){return this.meshCursor.visible}setMeshCursorPosition(e){this.meshCursor.position.copy(e)}positionAndOrientMeshCursor(e,t){this.meshCursor.position.copy(e),this.meshCursor.up.copy(t.up),this.meshCursor.lookAt(t.position)}setupFocusMarker(){if(!this.focusMarker){let e=new d.xo$(.5,32,32),t=tP.buildFocusMarkerMaterial();t.depthTest=!1,t.depthWrite=!1,t.transparent=!0,this.focusMarker=new d.Kj0(e,t)}}destroyFocusMarker(){this.focusMarker&&(x(this.focusMarker),this.focusMarker=null)}updateFocusMarker=(function(){let e=new d.Pa4,t=new d.yGw,i=new d.Pa4;return function(n,r,a){t.copy(r.matrixWorld).invert(),e.copy(n).applyMatrix4(t),e.normalize().multiplyScalar(10),e.applyMatrix4(r.matrixWorld),i.copy(r.position).sub(n);let s=i.length();this.focusMarker.position.copy(n),this.focusMarker.scale.set(s,s,s),this.focusMarker.material.uniforms.realFocusPosition.value.copy(n),this.focusMarker.material.uniforms.viewport.value.copy(a),this.focusMarker.material.uniformsNeedUpdate=!0}})();setFocusMarkerVisibility(e){this.focusMarker.visible=e}setFocusMarkerOpacity(e){this.focusMarker.material.uniforms.opacity.value=e,this.focusMarker.material.uniformsNeedUpdate=!0}getFocusMarkerOpacity(){return this.focusMarker.material.uniforms.opacity.value}setupControlPlane(){if(!this.controlPlane){let e=new d._12(1,1);e.rotateX(-Math.PI/2);let t=new d.vBJ({color:0xffffff});t.transparent=!0,t.opacity=.6,t.depthTest=!1,t.depthWrite=!1,t.side=d.ehD;let i=new d.Kj0(e,t),n=new d.Pa4(0,1,0);n.normalize();let r=new tR(n,new d.Pa4(0,0,0),.5,.01,56576,.1,.03);this.controlPlane=new d.Tme,this.controlPlane.add(i),this.controlPlane.add(r)}}destroyControlPlane(){this.controlPlane&&(x(this.controlPlane),this.controlPlane=null)}setControlPlaneVisibility(e){this.controlPlane.visible=e}positionAndOrientControlPlane=(function(){let e=new d._fP,t=new d.Pa4(0,1,0);return function(i,n){e.setFromUnitVectors(t,n),this.controlPlane.position.copy(i),this.controlPlane.quaternion.copy(e)}})();addDebugMeshes(){this.debugRoot=this.createDebugMeshes(),this.secondaryDebugRoot=this.createSecondaryDebugMeshes(),this.threeScene.add(this.debugRoot),this.threeScene.add(this.secondaryDebugRoot)}destroyDebugMeshes(){for(let e of[this.debugRoot,this.secondaryDebugRoot])e&&(x(e),this.threeScene.remove(e));this.debugRoot=null,this.secondaryDebugRoot=null}createDebugMeshes(e){let t=new d.xo$(1,32,32),i=new d.Tme,n=(n,r)=>{let a=new d.Kj0(t,tP.buildDebugMaterial(n));a.renderOrder=e,i.add(a),a.position.fromArray(r)};return n(0xff0000,[-50,0,0]),n(0xff0000,[50,0,0]),n(65280,[0,0,-50]),n(65280,[0,0,50]),n(0xffaa00,[5,0,5]),i}createSecondaryDebugMeshes(e){let t=new d.DvJ(3,3,3),i=new d.Tme,n=n=>{let r=new d.Kj0(t,tP.buildDebugMaterial(0xbbbbbb));r.renderOrder=e,i.add(r),r.position.fromArray(n)};return n([-10,0,-10]),n([-10,0,10]),n([10,0,-10]),n([10,0,10]),i}static buildDebugMaterial(e){let t=`
            #include <common>
            varying float ndcDepth;

            void main() {
                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position.xyz, 1.0);
                ndcDepth = gl_Position.z / gl_Position.w;
                gl_Position.x = gl_Position.x / gl_Position.w;
                gl_Position.y = gl_Position.y / gl_Position.w;
                gl_Position.z = 0.0;
                gl_Position.w = 1.0;
    
            }
        `,i=`
            #include <common>
            uniform vec3 color;
            varying float ndcDepth;
            void main() {
                gl_FragDepth = (ndcDepth + 1.0) / 2.0;
                gl_FragColor = vec4(color.rgb, 0.0);
            }
        `,n={color:{type:"v3",value:new d.Ilk(e)}},r=new d.jyz({uniforms:n,vertexShader:t,fragmentShader:i,transparent:!1,depthTest:!0,depthWrite:!0,side:d.Wl3});return r.extensions.fragDepth=!0,r}static buildFocusMarkerMaterial(e){let t=`
            #include <common>

            uniform vec2 viewport;
            uniform vec3 realFocusPosition;

            varying vec4 ndcPosition;
            varying vec4 ndcCenter;
            varying vec4 ndcFocusPosition;

            void main() {
                float radius = 0.01;

                vec4 viewPosition = modelViewMatrix * vec4(position.xyz, 1.0);
                vec4 viewCenter = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);

                vec4 viewFocusPosition = modelViewMatrix * vec4(realFocusPosition, 1.0);

                ndcPosition = projectionMatrix * viewPosition;
                ndcPosition = ndcPosition * vec4(1.0 / ndcPosition.w);
                ndcCenter = projectionMatrix * viewCenter;
                ndcCenter = ndcCenter * vec4(1.0 / ndcCenter.w);

                ndcFocusPosition = projectionMatrix * viewFocusPosition;
                ndcFocusPosition = ndcFocusPosition * vec4(1.0 / ndcFocusPosition.w);

                gl_Position = projectionMatrix * viewPosition;

            }
        `,i=`
            #include <common>
            uniform vec3 color;
            uniform vec2 viewport;
            uniform float opacity;

            varying vec4 ndcPosition;
            varying vec4 ndcCenter;
            varying vec4 ndcFocusPosition;

            void main() {
                vec2 screenPosition = vec2(ndcPosition) * viewport;
                vec2 screenCenter = vec2(ndcCenter) * viewport;

                vec2 screenVec = screenPosition - screenCenter;

                float projectedRadius = length(screenVec);

                float lineWidth = 0.0005 * viewport.y;
                float aaRange = 0.0025 * viewport.y;
                float radius = 0.06 * viewport.y;
                float radDiff = abs(projectedRadius - radius) - lineWidth;
                float alpha = 1.0 - clamp(radDiff / 5.0, 0.0, 1.0); 

                gl_FragColor = vec4(color.rgb, alpha * opacity);
            }
        `,n={color:{type:"v3",value:new d.Ilk(e)},realFocusPosition:{type:"v3",value:new d.Pa4},viewport:{type:"v2",value:new d.FM8},opacity:{value:0}};return new d.jyz({uniforms:n,vertexShader:t,fragmentShader:i,transparent:!0,depthTest:!1,depthWrite:!1,side:d.Wl3})}dispose(){this.destroyMeshCursor(),this.destroyFocusMarker(),this.destroyDebugMeshes(),this.destroyControlPlane(),this.destroyRenderTargetCopyObjects(),this.destroySplatRendertarget()}}let tI=new d.Pa4(1,0,0),tL=new d.Pa4(0,1,0),tD=new d.Pa4(0,0,1);class tB{constructor(e=new d.Pa4,t=new d.Pa4){this.origin=new d.Pa4,this.direction=new d.Pa4,this.setParameters(e,t)}setParameters(e,t){this.origin.copy(e),this.direction.copy(t).normalize()}boxContainsPoint(e,t,i){return!(t.x<e.min.x-i)&&!(t.x>e.max.x+i)&&!(t.y<e.min.y-i)&&!(t.y>e.max.y+i)&&!(t.z<e.min.z-i)&&!(t.z>e.max.z+i)}intersectBox=(function(){let e=new d.Pa4,t=[],i=[],n=[];return function(r,a){if(i[0]=this.origin.x,i[1]=this.origin.y,i[2]=this.origin.z,n[0]=this.direction.x,n[1]=this.direction.y,n[2]=this.direction.z,this.boxContainsPoint(r,this.origin,1e-4))return a&&(a.origin.copy(this.origin),a.normal.set(0,0,0),a.distance=-1),!0;for(let s=0;s<3;s++){if(0==n[s])continue;let o=0==s?tI:1==s?tL:tD,l=n[s]<0?r.max:r.min,c=-Math.sign(n[s]);t[0]=0==s?l.x:1==s?l.y:l.z;let h=t[0]-i[s];if(h*c<0){let l=(s+1)%3,u=(s+2)%3;if(t[2]=n[l]/n[s]*h+i[l],t[1]=n[u]/n[s]*h+i[u],e.set(t[s],t[u],t[l]),this.boxContainsPoint(r,e,1e-4))return a&&(a.origin.copy(e),a.normal.copy(o).multiplyScalar(c),a.distance=e.sub(this.origin).length()),!0}}return!1}})();intersectSphere=(function(){let e=new d.Pa4;return function(t,i,n){e.copy(t).sub(this.origin);let r=e.dot(this.direction),a=e.dot(e)-r*r,s=i*i;if(a>s)return!1;let o=Math.sqrt(s-a),l=r-o,c=r+o;if(c<0)return!1;let h=l<0?c:l;return n&&(n.origin.copy(this.origin).addScaledVector(this.direction,h),n.normal.copy(n.origin).sub(t).normalize(),n.distance=h),!0}})()}class tO{constructor(){this.origin=new d.Pa4,this.normal=new d.Pa4,this.distance=0,this.splatIndex=0}set(e,t,i,n){this.origin.copy(e),this.normal.copy(t),this.distance=i,this.splatIndex=n}clone(){let e=new tO;return e.origin.copy(this.origin),e.normal.copy(this.normal),e.distance=this.distance,e.splatIndex=this.splatIndex,e}}let tN={ThreeD:0,TwoD:1};class tU{constructor(e,t,i=!1){this.ray=new tB(e,t),this.raycastAgainstTrueSplatEllipsoid=i}setFromCameraAndScreenPosition=(function(){let e=new d.FM8;return function(t,i,n){if(e.x=i.x/n.x*2-1,e.y=(n.y-i.y)/n.y*2-1,t.isPerspectiveCamera)this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t;else if(t.isOrthographicCamera)this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t;else throw Error("Raycaster::setFromCameraAndScreenPosition() -> Unsupported camera type")}})();intersectSplatMesh=(function(){let e=new d.yGw,t=new d.yGw,i=new d.yGw,n=new tB,r=new d.Pa4;return function(a,s=[]){let o=a.getSplatTree();if(o){for(let l=0;l<o.subTrees.length;l++){let c=o.subTrees[l];t.copy(a.matrixWorld),a.dynamicMode&&(a.getSceneTransform(l,i),t.multiply(i)),e.copy(t).invert(),n.origin.copy(this.ray.origin).applyMatrix4(e),n.direction.copy(this.ray.origin).add(this.ray.direction),n.direction.applyMatrix4(e).sub(n.origin).normalize();let h=[];c.rootNode&&this.castRayAtSplatTreeNode(n,o,c.rootNode,h),h.forEach(e=>{e.origin.applyMatrix4(t),e.normal.applyMatrix4(t).normalize(),e.distance=r.copy(e.origin).sub(this.ray.origin).length()}),s.push(...h)}return s.sort((e,t)=>e.distance>t.distance?1:-1),s}}})();castRayAtSplatTreeNode=(function(){let e=new d.Ltg,t=new d.Pa4,i=new d.Pa4,n=new d._fP,r=new tO,a=new d.Pa4(0,0,0),s=new d.yGw,o=new d.yGw,l=new d.yGw,c=new d.yGw,h=new d.yGw,u=new tB;return function(d,p,f,m=[]){if(d.intersectBox(f.boundingBox)){if(f.data&&f.data.indexes&&f.data.indexes.length>0)for(let g=0;g<f.data.indexes.length;g++){let v=f.data.indexes[g],y=p.splatMesh.getSceneIndexForSplat(v);if(p.splatMesh.getScene(y).visible){if(p.splatMesh.getSplatColor(v,e),p.splatMesh.getSplatCenter(v,t),p.splatMesh.getSplatScaleAndRotation(v,i,n),i.x<=1e-7||i.y<=1e-7||p.splatMesh.splatRenderMode===tN.ThreeD&&i.z<=1e-7)continue;if(this.raycastAgainstTrueSplatEllipsoid){o.makeScale(i.x,i.y,i.z),l.makeRotationFromQuaternion(n);let p=2*Math.log10(e.w);if(s.makeScale(p,p,p),h.copy(s).multiply(l).multiply(o),c.copy(h).invert(),u.origin.copy(d.origin).sub(t).applyMatrix4(c),u.direction.copy(d.origin).add(d.direction).sub(t),u.direction.applyMatrix4(c).sub(u.origin).normalize(),u.intersectSphere(a,1,r)){let e=r.clone();e.splatIndex=v,e.origin.applyMatrix4(h).add(t),m.push(e)}}else{let e=i.x+i.y,n=2;if(p.splatMesh.splatRenderMode===tN.ThreeD&&(e+=i.z,n=3),e/=n,d.intersectSphere(t,e,r)){let e=r.clone();e.splatIndex=v,m.push(e)}}}}if(f.children&&f.children.length>0)for(let e of f.children)this.castRayAtSplatTreeNode(d,p,e,m);return m}}})()}class tF{static buildVertexShaderBase(e=!1,t=!1,i=0,n=""){let r=`
        precision highp float;
        #include <common>

        attribute uint splatIndex;
        uniform highp usampler2D centersColorsTexture;
        uniform highp sampler2D sphericalHarmonicsTexture;
        uniform highp sampler2D sphericalHarmonicsTextureR;
        uniform highp sampler2D sphericalHarmonicsTextureG;
        uniform highp sampler2D sphericalHarmonicsTextureB;

        uniform highp usampler2D sceneIndexesTexture;
        uniform vec2 sceneIndexesTextureSize;
        uniform int sceneCount;
    `;return t&&(r+=`
            uniform float sceneOpacity[${T.MaxScenes}];
            uniform int sceneVisibility[${T.MaxScenes}];
        `),e&&(r+=`
            uniform highp mat4 transforms[${T.MaxScenes}];
        `),r+=`
        ${n}
        uniform vec2 focal;
        uniform float orthoZoom;
        uniform int orthographicMode;
        uniform int pointCloudModeEnabled;
        uniform float inverseFocalAdjustment;
        uniform vec2 viewport;
        uniform vec2 basisViewport;
        uniform vec2 centersColorsTextureSize;
        uniform int sphericalHarmonicsDegree;
        uniform vec2 sphericalHarmonicsTextureSize;
        uniform int sphericalHarmonics8BitMode;
        uniform int sphericalHarmonicsMultiTextureMode;
        uniform float visibleRegionRadius;
        uniform float visibleRegionFadeStartRadius;
        uniform float firstRenderTime;
        uniform float currentTime;
        uniform int fadeInComplete;
        uniform vec3 sceneCenter;
        uniform float splatScale;
        uniform float sphericalHarmonics8BitCompressionRangeMin[${T.MaxScenes}];
        uniform float sphericalHarmonics8BitCompressionRangeMax[${T.MaxScenes}];

        varying vec4 vColor;
        varying vec2 vUv;
        varying vec2 vPosition;

        mat3 quaternionToRotationMatrix(float x, float y, float z, float w) {
            float s = 1.0 / sqrt(w * w + x * x + y * y + z * z);
        
            return mat3(
                1. - 2. * (y * y + z * z),
                2. * (x * y + w * z),
                2. * (x * z - w * y),
                2. * (x * y - w * z),
                1. - 2. * (x * x + z * z),
                2. * (y * z + w * x),
                2. * (x * z + w * y),
                2. * (y * z - w * x),
                1. - 2. * (x * x + y * y)
            );
        }

        const float sqrt8 = sqrt(8.0);
        const float minAlpha = 1.0 / 255.0;

        const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
        const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
        const uvec4 shift4 = uvec4(0, 8, 16, 24);
        vec4 uintToRGBAVec (uint u) {
           uvec4 urgba = mask4 & u;
           urgba = urgba >> shift4;
           vec4 rgba = vec4(urgba) * encodeNorm4;
           return rgba;
        }

        vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
            vec2 samplerUV = vec2(0.0, 0.0);
            float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
            samplerUV.y = float(floor(d)) / dimensions.y;
            samplerUV.x = fract(d);
            return samplerUV;
        }

        vec2 getDataUVF(in uint sIndex, in float stride, in uint offset, in vec2 dimensions) {
            vec2 samplerUV = vec2(0.0, 0.0);
            float d = float(uint(float(sIndex) * stride) + offset) / dimensions.x;
            samplerUV.y = float(floor(d)) / dimensions.y;
            samplerUV.x = fract(d);
            return samplerUV;
        }

        const float SH_C1 = 0.4886025119029199f;
        const float[5] SH_C2 = float[](1.0925484, -1.0925484, 0.3153916, -1.0925484, 0.5462742);

        void main () {

            uint oddOffset = splatIndex & uint(0x00000001);
            uint doubleOddOffset = oddOffset * uint(2);
            bool isEven = oddOffset == uint(0);
            uint nearestEvenIndex = splatIndex - oddOffset;
            float fOddOffset = float(oddOffset);

            uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
            vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));

            uint sceneIndex = uint(0);
            if (sceneCount > 1) {
                sceneIndex = texture(sceneIndexesTexture, getDataUV(1, 0, sceneIndexesTextureSize)).r;
            }
            `,t&&(r+=`
                float splatOpacityFromScene = sceneOpacity[sceneIndex];
                int sceneVisible = sceneVisibility[sceneIndex];
                if (splatOpacityFromScene <= 0.01 || sceneVisible == 0) {
                    gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
                    return;
                }
            `),e?r+=`
                mat4 transform = transforms[sceneIndex];
                mat4 transformModelViewMatrix = viewMatrix * transform;
            `:r+="mat4 transformModelViewMatrix = modelViewMatrix;",r+=`
            float sh8BitCompressionRangeMinForScene = sphericalHarmonics8BitCompressionRangeMin[sceneIndex];
            float sh8BitCompressionRangeMaxForScene = sphericalHarmonics8BitCompressionRangeMax[sceneIndex];
            float sh8BitCompressionRangeForScene = sh8BitCompressionRangeMaxForScene - sh8BitCompressionRangeMinForScene;
            float sh8BitCompressionHalfRangeForScene = sh8BitCompressionRangeForScene / 2.0;
            vec3 vec8BitSHShift = vec3(sh8BitCompressionRangeMinForScene);

            vec4 viewCenter = transformModelViewMatrix * vec4(splatCenter, 1.0);

            vec4 clipCenter = projectionMatrix * viewCenter;

            float clip = 1.2 * clipCenter.w;
            if (clipCenter.z < -clip || clipCenter.x < -clip || clipCenter.x > clip || clipCenter.y < -clip || clipCenter.y > clip) {
                gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
                return;
            }

            vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

            vPosition = position.xy;
            vColor = uintToRGBAVec(sampledCenterColor.r);
        `,i>=1&&(r+=`   
            if (sphericalHarmonicsDegree >= 1) {
            `,e?r+=`
                    vec3 worldViewDir = normalize(splatCenter - vec3(inverse(transform) * vec4(cameraPosition, 1.0)));
                `:r+=`
                    vec3 worldViewDir = normalize(splatCenter - cameraPosition);
                `,r+=`
                vec3 sh1;
                vec3 sh2;
                vec3 sh3;
            `,i>=2&&(r+=`
                    vec3 sh4;
                    vec3 sh5;
                    vec3 sh6;
                    vec3 sh7;
                    vec3 sh8;
                `),1===i?r+=`
                    if (sphericalHarmonicsMultiTextureMode == 0) {
                        vec2 shUV = getDataUVF(nearestEvenIndex, 2.5, doubleOddOffset, sphericalHarmonicsTextureSize);
                        vec4 sampledSH0123 = texture(sphericalHarmonicsTexture, shUV);
                        shUV = getDataUVF(nearestEvenIndex, 2.5, doubleOddOffset + uint(1), sphericalHarmonicsTextureSize);
                        vec4 sampledSH4567 = texture(sphericalHarmonicsTexture, shUV);
                        shUV = getDataUVF(nearestEvenIndex, 2.5, doubleOddOffset + uint(2), sphericalHarmonicsTextureSize);
                        vec4 sampledSH891011 = texture(sphericalHarmonicsTexture, shUV);
                        sh1 = vec3(sampledSH0123.rgb) * (1.0 - fOddOffset) + vec3(sampledSH0123.ba, sampledSH4567.r) * fOddOffset;
                        sh2 = vec3(sampledSH0123.a, sampledSH4567.rg) * (1.0 - fOddOffset) + vec3(sampledSH4567.gba) * fOddOffset;
                        sh3 = vec3(sampledSH4567.ba, sampledSH891011.r) * (1.0 - fOddOffset) + vec3(sampledSH891011.rgb) * fOddOffset;
                    } else {
                        vec2 sampledSH01R = texture(sphericalHarmonicsTextureR, getDataUV(2, 0, sphericalHarmonicsTextureSize)).rg;
                        vec2 sampledSH23R = texture(sphericalHarmonicsTextureR, getDataUV(2, 1, sphericalHarmonicsTextureSize)).rg;
                        vec2 sampledSH01G = texture(sphericalHarmonicsTextureG, getDataUV(2, 0, sphericalHarmonicsTextureSize)).rg;
                        vec2 sampledSH23G = texture(sphericalHarmonicsTextureG, getDataUV(2, 1, sphericalHarmonicsTextureSize)).rg;
                        vec2 sampledSH01B = texture(sphericalHarmonicsTextureB, getDataUV(2, 0, sphericalHarmonicsTextureSize)).rg;
                        vec2 sampledSH23B = texture(sphericalHarmonicsTextureB, getDataUV(2, 1, sphericalHarmonicsTextureSize)).rg;
                        sh1 = vec3(sampledSH01R.rg, sampledSH23R.r);
                        sh2 = vec3(sampledSH01G.rg, sampledSH23G.r);
                        sh3 = vec3(sampledSH01B.rg, sampledSH23B.r);
                    }
                `:2===i&&(r+=`
                    vec4 sampledSH0123;
                    vec4 sampledSH4567;
                    vec4 sampledSH891011;

                    vec4 sampledSH0123R;
                    vec4 sampledSH0123G;
                    vec4 sampledSH0123B;

                    if (sphericalHarmonicsMultiTextureMode == 0) {
                        sampledSH0123 = texture(sphericalHarmonicsTexture, getDataUV(6, 0, sphericalHarmonicsTextureSize));
                        sampledSH4567 = texture(sphericalHarmonicsTexture, getDataUV(6, 1, sphericalHarmonicsTextureSize));
                        sampledSH891011 = texture(sphericalHarmonicsTexture, getDataUV(6, 2, sphericalHarmonicsTextureSize));
                        sh1 = sampledSH0123.rgb;
                        sh2 = vec3(sampledSH0123.a, sampledSH4567.rg);
                        sh3 = vec3(sampledSH4567.ba, sampledSH891011.r);
                    } else {
                        sampledSH0123R = texture(sphericalHarmonicsTextureR, getDataUV(2, 0, sphericalHarmonicsTextureSize));
                        sampledSH0123G = texture(sphericalHarmonicsTextureG, getDataUV(2, 0, sphericalHarmonicsTextureSize));
                        sampledSH0123B = texture(sphericalHarmonicsTextureB, getDataUV(2, 0, sphericalHarmonicsTextureSize));
                        sh1 = vec3(sampledSH0123R.rgb);
                        sh2 = vec3(sampledSH0123G.rgb);
                        sh3 = vec3(sampledSH0123B.rgb);
                    }
                `),r+=`
                    if (sphericalHarmonics8BitMode == 1) {
                        sh1 = sh1 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                        sh2 = sh2 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                        sh3 = sh3 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                    }
                    float x = worldViewDir.x;
                    float y = worldViewDir.y;
                    float z = worldViewDir.z;
                    vColor.rgb += SH_C1 * (-sh1 * y + sh2 * z - sh3 * x);
            `,i>=2&&(r+=`
                    if (sphericalHarmonicsDegree >= 2) {
                        float xx = x * x;
                        float yy = y * y;
                        float zz = z * z;
                        float xy = x * y;
                        float yz = y * z;
                        float xz = x * z;
                `,2===i&&(r+=`
                        if (sphericalHarmonicsMultiTextureMode == 0) {
                            vec4 sampledSH12131415 = texture(sphericalHarmonicsTexture, getDataUV(6, 3, sphericalHarmonicsTextureSize));
                            vec4 sampledSH16171819 = texture(sphericalHarmonicsTexture, getDataUV(6, 4, sphericalHarmonicsTextureSize));
                            vec4 sampledSH20212223 = texture(sphericalHarmonicsTexture, getDataUV(6, 5, sphericalHarmonicsTextureSize));
                            sh4 = sampledSH891011.gba;
                            sh5 = sampledSH12131415.rgb;
                            sh6 = vec3(sampledSH12131415.a, sampledSH16171819.rg);
                            sh7 = vec3(sampledSH16171819.ba, sampledSH20212223.r);
                            sh8 = sampledSH20212223.gba;
                        } else {
                            vec4 sampledSH4567R = texture(sphericalHarmonicsTextureR, getDataUV(2, 1, sphericalHarmonicsTextureSize));
                            vec4 sampledSH4567G = texture(sphericalHarmonicsTextureG, getDataUV(2, 1, sphericalHarmonicsTextureSize));
                            vec4 sampledSH4567B = texture(sphericalHarmonicsTextureB, getDataUV(2, 1, sphericalHarmonicsTextureSize));
                            sh4 = vec3(sampledSH0123R.a, sampledSH4567R.rg);
                            sh5 = vec3(sampledSH4567R.ba, sampledSH0123G.a);
                            sh6 = vec3(sampledSH4567G.rgb);
                            sh7 = vec3(sampledSH4567G.a, sampledSH0123B.a, sampledSH4567B.r);
                            sh8 = vec3(sampledSH4567B.gba);
                        }
                    `),r+=`
                        if (sphericalHarmonics8BitMode == 1) {
                            sh4 = sh4 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                            sh5 = sh5 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                            sh6 = sh6 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                            sh7 = sh7 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                            sh8 = sh8 * sh8BitCompressionRangeForScene + vec8BitSHShift;
                        }

                        vColor.rgb +=
                            (SH_C2[0] * xy) * sh4 +
                            (SH_C2[1] * yz) * sh5 +
                            (SH_C2[2] * (2.0 * zz - xx - yy)) * sh6 +
                            (SH_C2[3] * xz) * sh7 +
                            (SH_C2[4] * (xx - yy)) * sh8;
                    }
                `),r+=`

                vColor.rgb = clamp(vColor.rgb, vec3(0.), vec3(1.));

            }

            `),r}static getVertexShaderFadeIn(){return`
            if (fadeInComplete == 0) {
                float opacityAdjust = 1.0;
                float centerDist = length(splatCenter - sceneCenter);
                float renderTime = max(currentTime - firstRenderTime, 0.0);

                float fadeDistance = 0.75;
                float distanceLoadFadeInFactor = step(visibleRegionFadeStartRadius, centerDist);
                distanceLoadFadeInFactor = (1.0 - distanceLoadFadeInFactor) +
                                        (1.0 - clamp((centerDist - visibleRegionFadeStartRadius) / fadeDistance, 0.0, 1.0)) *
                                        distanceLoadFadeInFactor;
                opacityAdjust *= distanceLoadFadeInFactor;
                vColor.a *= opacityAdjust;
            }
        `}static getUniforms(e=!1,t=!1,i=0,n=1,r=!1){let a={sceneCenter:{type:"v3",value:new d.Pa4},fadeInComplete:{type:"i",value:0},orthographicMode:{type:"i",value:0},visibleRegionFadeStartRadius:{type:"f",value:0},visibleRegionRadius:{type:"f",value:0},currentTime:{type:"f",value:0},firstRenderTime:{type:"f",value:0},centersColorsTexture:{type:"t",value:null},sphericalHarmonicsTexture:{type:"t",value:null},sphericalHarmonicsTextureR:{type:"t",value:null},sphericalHarmonicsTextureG:{type:"t",value:null},sphericalHarmonicsTextureB:{type:"t",value:null},sphericalHarmonics8BitCompressionRangeMin:{type:"f",value:[]},sphericalHarmonics8BitCompressionRangeMax:{type:"f",value:[]},focal:{type:"v2",value:new d.FM8},orthoZoom:{type:"f",value:1},inverseFocalAdjustment:{type:"f",value:1},viewport:{type:"v2",value:new d.FM8},basisViewport:{type:"v2",value:new d.FM8},debugColor:{type:"v3",value:new d.Ilk},centersColorsTextureSize:{type:"v2",value:new d.FM8(1024,1024)},sphericalHarmonicsDegree:{type:"i",value:i},sphericalHarmonicsTextureSize:{type:"v2",value:new d.FM8(1024,1024)},sphericalHarmonics8BitMode:{type:"i",value:0},sphericalHarmonicsMultiTextureMode:{type:"i",value:0},splatScale:{type:"f",value:n},pointCloudModeEnabled:{type:"i",value:r?1:0},sceneIndexesTexture:{type:"t",value:null},sceneIndexesTextureSize:{type:"v2",value:new d.FM8(1024,1024)},sceneCount:{type:"i",value:1}};for(let e=0;e<T.MaxScenes;e++)a.sphericalHarmonics8BitCompressionRangeMin.value.push(-T.SphericalHarmonics8BitCompressionRange/2),a.sphericalHarmonics8BitCompressionRangeMax.value.push(T.SphericalHarmonics8BitCompressionRange/2);if(t){let e=[];for(let t=0;t<T.MaxScenes;t++)e.push(1);a.sceneOpacity={type:"f",value:e};let t=[];for(let e=0;e<T.MaxScenes;e++)t.push(1);a.sceneVisibility={type:"i",value:t}}if(e){let e=[];for(let t=0;t<T.MaxScenes;t++)e.push(new d.yGw);a.transforms={type:"mat4",value:e}}return a}}class tk{static build(e=!1,t=!1,i=!1,n=2048,r=1,a=!1,s=0,o=.3){let l=`
            uniform vec2 covariancesTextureSize;
            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D covariancesTextureHalfFloat;
            uniform int covariancesAreHalfFloat;

            void fromCovarianceHalfFloatV4(uvec4 val, out vec4 first, out vec4 second) {
                vec2 r = unpackHalf2x16(val.r);
                vec2 g = unpackHalf2x16(val.g);
                vec2 b = unpackHalf2x16(val.b);

                first = vec4(r.x, r.y, g.x, g.y);
                second = vec4(b.x, b.y, 0.0, 0.0);
            }
        `,c=tF.buildVertexShaderBase(e,t,s,l);c+=tk.buildVertexShaderProjection(i,t,n,o);let h=tk.buildFragmentShader(),u=tF.getUniforms(e,t,s,r,a);return u.covariancesTextureSize={type:"v2",value:new d.FM8(1024,1024)},u.covariancesTexture={type:"t",value:null},u.covariancesTextureHalfFloat={type:"t",value:null},u.covariancesAreHalfFloat={type:"i",value:0},new d.jyz({uniforms:u,vertexShader:c,fragmentShader:h,transparent:!0,alphaTest:1,blending:d.bdR,depthTest:!0,depthWrite:!1,side:d.ehD})}static buildVertexShaderProjection(e,t,i,n){let r=`

            vec4 sampledCovarianceA;
            vec4 sampledCovarianceB;
            vec3 cov3D_M11_M12_M13;
            vec3 cov3D_M22_M23_M33;
            if (covariancesAreHalfFloat == 0) {
                sampledCovarianceA = texture(covariancesTexture, getDataUVF(nearestEvenIndex, 1.5, oddOffset,
                                                                            covariancesTextureSize));
                sampledCovarianceB = texture(covariancesTexture, getDataUVF(nearestEvenIndex, 1.5, oddOffset + uint(1),
                                                                            covariancesTextureSize));

                cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rgb) * (1.0 - fOddOffset) +
                                    vec3(sampledCovarianceA.ba, sampledCovarianceB.r) * fOddOffset;
                cov3D_M22_M23_M33 = vec3(sampledCovarianceA.a, sampledCovarianceB.rg) * (1.0 - fOddOffset) +
                                    vec3(sampledCovarianceB.gba) * fOddOffset;
            } else {
                uvec4 sampledCovarianceU = texture(covariancesTextureHalfFloat, getDataUV(1, 0, covariancesTextureSize));
                fromCovarianceHalfFloatV4(sampledCovarianceU, sampledCovarianceA, sampledCovarianceB);
                cov3D_M11_M12_M13 = sampledCovarianceA.rgb;
                cov3D_M22_M23_M33 = vec3(sampledCovarianceA.a, sampledCovarianceB.rg);
            }
        
            // Construct the 3D covariance matrix
            mat3 Vrk = mat3(
                cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
            );

            mat3 J;
            if (orthographicMode == 1) {
                // Since the projection is linear, we don't need an approximation
                J = transpose(mat3(orthoZoom, 0.0, 0.0,
                                0.0, orthoZoom, 0.0,
                                0.0, 0.0, 0.0));
            } else {
                // Construct the Jacobian of the affine approximation of the projection matrix. It will be used to transform the
                // 3D covariance matrix instead of using the actual projection matrix because that transformation would
                // require a non-linear component (perspective division) which would yield a non-gaussian result.
                float s = 1.0 / (viewCenter.z * viewCenter.z);
                J = mat3(
                    focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
                    0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
                    0., 0., 0.
                );
            }

            // Concatenate the projection approximation with the model-view transformation
            mat3 W = transpose(mat3(transformModelViewMatrix));
            mat3 T = W * J;

            // Transform the 3D covariance matrix (Vrk) to compute the 2D covariance matrix
            mat3 cov2Dm = transpose(T) * Vrk * T;
            `;return e?r+=`
                float detOrig = cov2Dm[0][0] * cov2Dm[1][1] - cov2Dm[0][1] * cov2Dm[0][1];
                cov2Dm[0][0] += ${n};
                cov2Dm[1][1] += ${n};
                float detBlur = cov2Dm[0][0] * cov2Dm[1][1] - cov2Dm[0][1] * cov2Dm[0][1];
                vColor.a *= sqrt(max(detOrig / detBlur, 0.0));
                if (vColor.a < minAlpha) return;
            `:r+=`
                cov2Dm[0][0] += ${n};
                cov2Dm[1][1] += ${n};
            `,r+=`

            // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
            // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
            // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
            // need cov2Dm[1][0] because it is a symetric matrix.
            vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

            // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
            // so that we can determine the 2D basis for the splat. This is done using the method described
            // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
            // After calculating the eigen-values and eigen-vectors, we calculate the basis for rendering the splat
            // by normalizing the eigen-vectors and then multiplying them by (sqrt(8) * sqrt(eigen-value)), which is
            // equal to scaling them by sqrt(8) standard deviations.
            //
            // This is a different approach than in the original work at INRIA. In that work they compute the
            // max extents of the projected splat in screen space to form a screen-space aligned bounding rectangle
            // which forms the geometry that is actually rasterized. The dimensions of that bounding box are 3.0
            // times the square root of the maximum eigen-value, or 3 standard deviations. They then use the inverse
            // 2D covariance matrix (called 'conic') in the CUDA rendering thread to determine fragment opacity by
            // calculating the full gaussian: exp(-0.5 * (X - mean) * conic * (X - mean)) * splat opacity
            float a = cov2Dv.x;
            float d = cov2Dv.z;
            float b = cov2Dv.y;
            float D = a * d - b * b;
            float trace = a + d;
            float traceOver2 = 0.5 * trace;
            float term2 = sqrt(max(0.1f, traceOver2 * traceOver2 - D));
            float eigenValue1 = traceOver2 + term2;
            float eigenValue2 = traceOver2 - term2;

            if (pointCloudModeEnabled == 1) {
                eigenValue1 = eigenValue2 = 0.2;
            }

            if (eigenValue2 <= 0.0) return;

            vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
            // since the eigen vectors are orthogonal, we derive the second one from the first
            vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);

            // We use sqrt(8) standard deviations instead of 3 to eliminate more of the splat with a very low opacity.
            vec2 basisVector1 = eigenVector1 * splatScale * min(sqrt8 * sqrt(eigenValue1), ${parseInt(i)}.0);
            vec2 basisVector2 = eigenVector2 * splatScale * min(sqrt8 * sqrt(eigenValue2), ${parseInt(i)}.0);
            `,t&&(r+=`
                vColor.a *= splatOpacityFromScene;
            `),r+=`
            vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) *
                             basisViewport * 2.0 * inverseFocalAdjustment;

            vec4 quadPos = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            gl_Position = quadPos;

            // Scale the position data we send to the fragment shader
            vPosition *= sqrt8;
        `,r+=tF.getVertexShaderFadeIn(),r+="}"}static buildFragmentShader(){let e=`
            precision highp float;
            #include <common>
 
            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;
            varying vec2 vPosition;
        `;return e+`
            void main () {
                // Compute the positional squared distance from the center of the splat to the current fragment.
                float A = dot(vPosition, vPosition);
                // Since the positional data in vPosition has been scaled by sqrt(8), the squared result will be
                // scaled by a factor of 8. If the squared result is larger than 8, it means it is outside the ellipse
                // defined by the rectangle formed by vPosition. It also means it's farther
                // away than sqrt(8) standard deviations from the mean.
                if (A > 8.0) discard;
                vec3 color = vColor.rgb;

                // Since the rendered splat is scaled by sqrt(8), the inverse covariance matrix that is part of
                // the gaussian formula becomes the identity matrix. We're then left with (X - mean) * (X - mean),
                // and since 'mean' is zero, we have X * X, which is the same as A:
                float opacity = exp(-0.5 * A) * vColor.a;

                gl_FragColor = vec4(color.rgb, opacity);
            }
        `}}class tz{static build(e=!1,t=!1,i=1,n=!1,r=0){let a=`
            uniform vec2 scaleRotationsTextureSize;
            uniform highp sampler2D scaleRotationsTexture;
            varying mat3 vT;
            varying vec2 vQuadCenter;
            varying vec2 vFragCoord;
        `,s=tF.buildVertexShaderBase(e,t,r,a);s+=tz.buildVertexShaderProjection();let o=tz.buildFragmentShader(),l=tF.getUniforms(e,t,r,i,n);return l.scaleRotationsTexture={type:"t",value:null},l.scaleRotationsTextureSize={type:"v2",value:new d.FM8(1024,1024)},new d.jyz({uniforms:l,vertexShader:s,fragmentShader:o,transparent:!0,alphaTest:1,blending:d.bdR,depthTest:!0,depthWrite:!1,side:d.ehD})}static buildVertexShaderProjection(){let e=`

            vec4 scaleRotationA = texture(scaleRotationsTexture, getDataUVF(nearestEvenIndex, 1.5,
                                                                            oddOffset, scaleRotationsTextureSize));
            vec4 scaleRotationB = texture(scaleRotationsTexture, getDataUVF(nearestEvenIndex, 1.5,
                                                                            oddOffset + uint(1), scaleRotationsTextureSize));

            vec3 scaleRotation123 = vec3(scaleRotationA.rgb) * (1.0 - fOddOffset) +
                                    vec3(scaleRotationA.ba, scaleRotationB.r) * fOddOffset;
            vec3 scaleRotation456 = vec3(scaleRotationA.a, scaleRotationB.rg) * (1.0 - fOddOffset) +
                                    vec3(scaleRotationB.gba) * fOddOffset;

            float missingW = sqrt(1.0 - scaleRotation456.x * scaleRotation456.x - scaleRotation456.y *
                                    scaleRotation456.y - scaleRotation456.z * scaleRotation456.z);
            mat3 R = quaternionToRotationMatrix(scaleRotation456.r, scaleRotation456.g, scaleRotation456.b, missingW);
            mat3 S = mat3(scaleRotation123.r, 0.0, 0.0,
                            0.0, scaleRotation123.g, 0.0,
                            0.0, 0.0, scaleRotation123.b);
            
            mat3 L = R * S;

            mat3x4 splat2World = mat3x4(vec4(L[0], 0.0),
                                        vec4(L[1], 0.0),
                                        vec4(splatCenter.x, splatCenter.y, splatCenter.z, 1.0));

            mat4 world2ndc = transpose(projectionMatrix * transformModelViewMatrix);

            mat3x4 ndc2pix = mat3x4(vec4(viewport.x / 2.0, 0.0, 0.0, (viewport.x - 1.0) / 2.0),
                                    vec4(0.0, viewport.y / 2.0, 0.0, (viewport.y - 1.0) / 2.0),
                                    vec4(0.0, 0.0, 0.0, 1.0));

            mat3 T = transpose(splat2World) * world2ndc * ndc2pix;
            vec3 normal = vec3(viewMatrix * vec4(L[0][2], L[1][2], L[2][2], 0.0));
        `,t=`
            vec3 T0 = vec3(T[0][0], T[0][1], T[0][2]);
            vec3 T1 = vec3(T[1][0], T[1][1], T[1][2]);
            vec3 T3 = vec3(T[2][0], T[2][1], T[2][2]);

            vec3 tempPoint = vec3(1.0, 1.0, -1.0);
            float distance = (T3.x * T3.x * tempPoint.x) + (T3.y * T3.y * tempPoint.y) + (T3.z * T3.z * tempPoint.z);
            vec3 f = (1.0 / distance) * tempPoint;
            if (abs(distance) < 0.00001) return;

            float pointImageX = (T0.x * T3.x * f.x) + (T0.y * T3.y * f.y) + (T0.z * T3.z * f.z);
            float pointImageY = (T1.x * T3.x * f.x) + (T1.y * T3.y * f.y) + (T1.z * T3.z * f.z);
            vec2 pointImage = vec2(pointImageX, pointImageY);

            float tempX = (T0.x * T0.x * f.x) + (T0.y * T0.y * f.y) + (T0.z * T0.z * f.z);
            float tempY = (T1.x * T1.x * f.x) + (T1.y * T1.y * f.y) + (T1.z * T1.z * f.z);
            vec2 temp = vec2(tempX, tempY);

            vec2 halfExtend = pointImage * pointImage - temp;
            vec2 extent = sqrt(max(vec2(0.0001), halfExtend));
            float radius = max(extent.x, extent.y);

            vec2 ndcOffset = ((position.xy * radius * 3.0) * basisViewport * 2.0);

            vec4 quadPos = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            gl_Position = quadPos;

            vT = T;
            vQuadCenter = pointImage;
            vFragCoord = (quadPos.xy * 0.5 + 0.5) * viewport;
        `;return e+=`

                mat4 splat2World4 = mat4(vec4(L[0], 0.0),
                                        vec4(L[1], 0.0),
                                        vec4(L[2], 0.0),
                                        vec4(splatCenter.x, splatCenter.y, splatCenter.z, 1.0));

                mat4 Tt = transpose(transpose(splat2World4) * world2ndc);

                vec4 tempPoint1 = Tt * vec4(1.0, 0.0, 0.0, 1.0);
                tempPoint1 /= tempPoint1.w;

                vec4 tempPoint2 = Tt * vec4(0.0, 1.0, 0.0, 1.0);
                tempPoint2 /= tempPoint2.w;

                vec4 center = Tt * vec4(0.0, 0.0, 0.0, 1.0);
                center /= center.w;

                vec2 basisVector1 = tempPoint1.xy - center.xy;
                vec2 basisVector2 = tempPoint2.xy - center.xy;

                vec2 basisVector1Screen = basisVector1 * 0.5 * viewport;
                vec2 basisVector2Screen = basisVector2 * 0.5 * viewport;

                const float minPix = 1.;
                if (length(basisVector1Screen) < minPix || length(basisVector2Screen) < minPix) {
                    ${t}
                } else {
                    vec2 ndcOffset = vec2(position.x * basisVector1 + position.y * basisVector2) * 3.0 * inverseFocalAdjustment;
                    vec4 quadPos = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
                    gl_Position = quadPos;

                    vT = T;
                    vQuadCenter = center.xy;
                    vFragCoord = (quadPos.xy * 0.5 + 0.5) * viewport;
                }
            `,e+=tF.getVertexShaderFadeIn(),e+="}"}static buildFragmentShader(){return`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;
            varying vec2 vPosition;
            varying mat3 vT;
            varying vec2 vQuadCenter;
            varying vec2 vFragCoord;

            void main () {

                const float FilterInvSquare = 2.0;
                const float near_n = 0.2;
                const float T = 1.0;

                vec2 xy = vQuadCenter;
                vec3 Tu = vT[0];
                vec3 Tv = vT[1];
                vec3 Tw = vT[2];
                vec3 k = vFragCoord.x * Tw - Tu;
                vec3 l = vFragCoord.y * Tw - Tv;
                vec3 p = cross(k, l);
                if (p.z == 0.0) discard;
                vec2 s = vec2(p.x / p.z, p.y / p.z);
                float rho3d = (s.x * s.x + s.y * s.y); 
                vec2 d = vec2(xy.x - vFragCoord.x, xy.y - vFragCoord.y);
                float rho2d = FilterInvSquare * (d.x * d.x + d.y * d.y); 

                // compute intersection and depth
                float rho = min(rho3d, rho2d);
                float depth = (rho3d <= rho2d) ? (s.x * Tw.x + s.y * Tw.y) + Tw.z : Tw.z; 
                if (depth < near_n) discard;
                //  vec4 nor_o = collected_normal_opacity[j];
                //  float normal[3] = {nor_o.x, nor_o.y, nor_o.z};
                float opa = vColor.a;

                float power = -0.5f * rho;
                if (power > 0.0f) discard;

                // Eq. (2) from 3D Gaussian splatting paper.
                // Obtain alpha by multiplying with Gaussian opacity
                // and its exponential falloff from mean.
                // Avoid numerical instabilities (see paper appendix). 
                float alpha = min(0.99f, opa * exp(power));
                if (alpha < 1.0f / 255.0f) discard;
                float test_T = T * (1.0 - alpha);
                if (test_T < 0.0001)discard;

                float w = alpha * T;
                gl_FragColor = vec4(vColor.rgb, w);
            }
        `}}class tH{static build(e){let t=new d.u9r;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),n=new d.TlE(i,3);t.setAttribute("position",n),n.setXYZ(0,-1,-1,0),n.setXYZ(1,-1,1,0),n.setXYZ(2,1,1,0),n.setXYZ(3,1,-1,0),n.needsUpdate=!0;let r=new d.L5s().copy(t),a=new Uint32Array(e),s=new d.lb7(a,1,!1);return s.setUsage(d.dj0),r.setAttribute("splatIndex",s),r.instanceCount=0,r}}class tV extends d.Tme{constructor(e,t=new d.Pa4,i=new d._fP,n=new d.Pa4(1,1,1),r=1,a=1,s=!0){super(),this.splatBuffer=e,this.position.copy(t),this.quaternion.copy(i),this.scale.copy(n),this.transform=new d.yGw,this.minimumAlpha=r,this.opacity=a,this.visible=s}copyTransformData(e){this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.transform.copy(e.transform)}updateTransform(e){e?(this.matrixWorldAutoUpdate&&this.updateWorldMatrix(!0,!1),this.transform.copy(this.matrixWorld)):(this.matrixAutoUpdate&&this.updateMatrix(),this.transform.copy(this.matrix))}}class tG{static idGen=0;constructor(e,t,i,n){this.min=new d.Pa4().copy(e),this.max=new d.Pa4().copy(t),this.boundingBox=new d.ZzF(this.min,this.max),this.center=new d.Pa4().copy(this.max).sub(this.min).multiplyScalar(.5).add(this.min),this.depth=i,this.children=[],this.data=null,this.id=n||tG.idGen++}}class tW{constructor(e,t){this.maxDepth=e,this.maxCentersPerNode=t,this.sceneDimensions=new d.Pa4,this.sceneMin=new d.Pa4,this.sceneMax=new d.Pa4,this.rootNode=null,this.nodesWithIndexes=[],this.splatMesh=null}static convertWorkerSubTreeNode(e){let t=new tG(new d.Pa4().fromArray(e.min),new d.Pa4().fromArray(e.max),e.depth,e.id);if(e.data.indexes)for(let i of(t.data={indexes:[]},e.data.indexes))t.data.indexes.push(i);if(e.children)for(let i of e.children)t.children.push(tW.convertWorkerSubTreeNode(i));return t}static convertWorkerSubTree(e,t){let i=new tW(e.maxDepth,e.maxCentersPerNode);i.sceneMin=new d.Pa4().fromArray(e.sceneMin),i.sceneMax=new d.Pa4().fromArray(e.sceneMax),i.splatMesh=t,i.rootNode=tW.convertWorkerSubTreeNode(e.rootNode);let n=(e,t)=>{for(let i of(0===e.children.length&&t(e),e.children))n(i,t)};return i.nodesWithIndexes=[],n(i.rootNode,e=>{e.data&&e.data.indexes&&e.data.indexes.length>0&&i.nodesWithIndexes.push(e)}),i}}function tj(e){let t=0;class i{constructor(e,t){this.min=[e[0],e[1],e[2]],this.max=[t[0],t[1],t[2]]}containsPoint(e){return e[0]>=this.min[0]&&e[0]<=this.max[0]&&e[1]>=this.min[1]&&e[1]<=this.max[1]&&e[2]>=this.min[2]&&e[2]<=this.max[2]}}class n{constructor(e,t){this.maxDepth=e,this.maxCentersPerNode=t,this.sceneDimensions=[],this.sceneMin=[],this.sceneMax=[],this.rootNode=null,this.addedIndexes={},this.nodesWithIndexes=[],this.splatMesh=null,this.disposed=!1}}class r{constructor(e,i,n,r){this.min=[e[0],e[1],e[2]],this.max=[i[0],i[1],i[2]],this.center=[(i[0]-e[0])*.5+e[0],(i[1]-e[1])*.5+e[1],(i[2]-e[2])*.5+e[2]],this.depth=n,this.children=[],this.data=null,this.id=r||t++}}processSplatTreeNode=function(e,t,n,a){let s=t.data.indexes.length;if(s<e.maxCentersPerNode||t.depth>e.maxDepth){let i=[];for(let n=0;n<t.data.indexes.length;n++)e.addedIndexes[t.data.indexes[n]]||(i.push(t.data.indexes[n]),e.addedIndexes[t.data.indexes[n]]=!0);t.data.indexes=i,t.data.indexes.sort((e,t)=>e>t?1:-1),e.nodesWithIndexes.push(t);return}let o=[t.max[0]-t.min[0],t.max[1]-t.min[1],t.max[2]-t.min[2]],l=[.5*o[0],.5*o[1],.5*o[2]],c=[t.min[0]+l[0],t.min[1]+l[1],t.min[2]+l[2]],h=[new i([c[0]-l[0],c[1],c[2]-l[2]],[c[0],c[1]+l[1],c[2]]),new i([c[0],c[1],c[2]-l[2]],[c[0]+l[0],c[1]+l[1],c[2]]),new i([c[0],c[1],c[2]],[c[0]+l[0],c[1]+l[1],c[2]+l[2]]),new i([c[0]-l[0],c[1],c[2]],[c[0],c[1]+l[1],c[2]+l[2]]),new i([c[0]-l[0],c[1]-l[1],c[2]-l[2]],[c[0],c[1],c[2]]),new i([c[0],c[1]-l[1],c[2]-l[2]],[c[0]+l[0],c[1],c[2]]),new i([c[0],c[1]-l[1],c[2]],[c[0]+l[0],c[1],c[2]+l[2]]),new i([c[0]-l[0],c[1]-l[1],c[2]],[c[0],c[1],c[2]+l[2]])],u=[],d=[];for(let e=0;e<h.length;e++)u[e]=0,d[e]=[];let p=[0,0,0];for(let e=0;e<s;e++){let i=t.data.indexes[e],r=n[i];p[0]=a[r],p[1]=a[r+1],p[2]=a[r+2];for(let e=0;e<h.length;e++)h[e].containsPoint(p)&&(u[e]++,d[e].push(i))}for(let e=0;e<h.length;e++){let i=new r(h[e].min,h[e].max,t.depth+1);i.data={indexes:d[e]},t.children.push(i)}for(let i of(t.data={},t.children))processSplatTreeNode(e,i,n,a)};let a=(e,t,i)=>{let a=[0,0,0],s=[0,0,0],o=[],l=Math.floor(e.length/4);for(let t=0;t<l;t++){let i=4*t,n=e[i],r=e[i+1],l=e[i+2],c=Math.round(e[i+3]);(0===t||n<a[0])&&(a[0]=n),(0===t||n>s[0])&&(s[0]=n),(0===t||r<a[1])&&(a[1]=r),(0===t||r>s[1])&&(s[1]=r),(0===t||l<a[2])&&(a[2]=l),(0===t||l>s[2])&&(s[2]=l),o.push(c)}let c=new n(t,i);return c.sceneMin=a,c.sceneMax=s,c.rootNode=new r(c.sceneMin,c.sceneMax,0),c.rootNode.data={indexes:o},c};e.onmessage=t=>{t.data.process&&function(t,i,n){let r=[];for(let e of t){let t=Math.floor(e.length/4);for(let i=0;i<t;i++){let t=4*i;r[Math.round(e[t+3])]=t}}let s=[];for(let e of t){let t=a(e,i,n);s.push(t),processSplatTreeNode(t,t.rootNode,r,e)}e.postMessage({subTrees:s})}(t.data.process.centers,t.data.process.maxDepth,t.data.process.maxCentersPerNode)}}class tq{constructor(e,t){this.maxDepth=e,this.maxCentersPerNode=t,this.subTrees=[],this.splatMesh=null}dispose(){this.diposeSplatTreeWorker(),this.disposed=!0}diposeSplatTreeWorker(){this.splatTreeWorker&&this.splatTreeWorker.terminate(),this.splatTreeWorker=null}processSplatMesh=function(e,t=()=>!0,i,n){this.splatTreeWorker||(this.splatTreeWorker=new Worker(URL.createObjectURL(new Blob(["(",tj.toString(),")(self)"],{type:"application/javascript"})))),this.splatMesh=e,this.subTrees=[];let r=new d.Pa4,a=(i,n)=>{let a=new Float32Array(4*n),s=0;for(let o=0;o<n;o++){let n=o+i;if(t(n)){e.getSplatCenter(n,r);let t=4*s;a[t]=r.x,a[t+1]=r.y,a[t+2]=r.z,a[t+3]=n,s++}}return a};return new Promise(t=>{let r=()=>!!this.disposed&&(this.diposeSplatTreeWorker(),t(),!0);i&&i(!1),_(()=>{if(r())return;let s=[];if(e.dynamicMode){let t=0;for(let i=0;i<e.scenes.length;i++){let n=e.getScene(i).splatBuffer.getSplatCount(),r=a(t,n);s.push(r),t+=n}}else{let t=a(0,e.getSplatCount());s.push(t)}this.splatTreeWorker.onmessage=i=>{!r()&&i.data.subTrees&&(n&&n(!1),_(()=>{if(!r()){for(let t of i.data.subTrees){let i=tW.convertWorkerSubTree(t,e);this.subTrees.push(i)}this.diposeSplatTreeWorker(),n&&n(!0),_(()=>{t()})}}))},_(()=>{if(r())return;i&&i(!0);let e=s.map(e=>e.buffer);!function(e,t,i,n,r){e.postMessage({process:{centers:t,maxDepth:n,maxCentersPerNode:r}},i)}(this.splatTreeWorker,s,e,this.maxDepth,this.maxCentersPerNode)})})})};countLeaves(){let e=0;return this.visitLeaves(()=>{e++}),e}visitLeaves(e){let t=(e,i)=>{for(let n of(0===e.children.length&&i(e),e.children))t(n,i)};for(let i of this.subTrees)t(i.rootNode,e)}}function tX(e){let t={};function i(i){let n;if(void 0!==t[i])return t[i];switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?(i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance")):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){let t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function tY(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name,s=void 0!==i.precision?i.precision:"highp",o=r(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);let l=a||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=u>0,x=a||t.has("OES_texture_float"),_=a?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:_}}let tK={Default:0,Gradual:1,Instant:2},tQ={None:0,Error:1,Warning:2,Info:3,Debug:4},tJ=new d.u9r,tZ=new d.vBJ;class t$ extends d.Kj0{constructor(e=tN.ThreeD,t=!1,i=!1,n=!1,r=1,a=!0,s=!1,o=!1,l=1024,c=tQ.None,h=0,u=1,p=.3){super(tJ,tZ),this.renderer=void 0,this.splatRenderMode=e,this.dynamicMode=t,this.enableOptionalEffects=i,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=r,this.enableDistancesComputationOnGPU=a,this.integerBasedDistancesComputation=s,this.antialiased=o,this.kernel2DSize=p,this.maxScreenSpaceSplatSize=l,this.logLevel=c,this.sphericalHarmonicsDegree=h,this.minSphericalHarmonicsDegree=0,this.sceneFadeInRateMultiplier=u,this.scenes=[],this.splatTree=null,this.baseSplatTree=null,this.splatDataTextures={},this.distancesTransformFeedback={id:null,vertexShader:null,fragmentShader:null,program:null,centersBuffer:null,sceneIndexesBuffer:null,outDistancesBuffer:null,centersLoc:-1,modelViewProjLoc:-1,sceneIndexesLoc:-1,transformsLocs:[]},this.globalSplatIndexToLocalSplatIndexMap=[],this.globalSplatIndexToSceneIndexMap=[],this.lastBuildSplatCount=0,this.lastBuildScenes=[],this.lastBuildMaxSplatCount=0,this.lastBuildSceneCount=0,this.firstRenderTime=-1,this.finalBuild=!1,this.webGLUtils=null,this.boundingBox=new d.ZzF,this.calculatedSceneCenter=new d.Pa4,this.maxSplatDistanceFromSceneCenter=0,this.visibleRegionBufferRadius=0,this.visibleRegionRadius=0,this.visibleRegionFadeStartRadius=0,this.visibleRegionChanging=!1,this.splatScale=1,this.pointCloudModeEnabled=!1,this.disposed=!1,this.lastRenderer=null,this.visible=!1}static buildScenes(e,t,i){let n=[];n.length=t.length;for(let r=0;r<t.length;r++){let a=t[r],s=i[r]||{},o=s.position||[0,0,0],l=s.rotation||[0,0,0,1],c=s.scale||[1,1,1],h=new d.Pa4().fromArray(o),u=new d._fP().fromArray(l),p=new d.Pa4().fromArray(c),f=t$.createScene(a,h,u,p,s.splatAlphaRemovalThreshold||1,s.opacity,s.visible);e.add(f),n[r]=f}return n}static createScene(e,t,i,n,r,a=1,s=!0){return new tV(e,t,i,n,r,a,s)}static buildSplatIndexMaps(e){let t=[],i=[],n=0;for(let r=0;r<e.length;r++){let a=e[r].getMaxSplatCount();for(let e=0;e<a;e++)t[n]=e,i[n]=r,n++}return{localSplatIndexMap:t,sceneIndexMap:i}}buildSplatTree=function(e=[],t,i){return new Promise(n=>{this.disposeSplatTree(),this.baseSplatTree=new tq(8,1e3);let r=performance.now(),a=new d.Ltg;this.baseSplatTree.processSplatMesh(this,t=>{this.getSplatColor(t,a);let i=e[this.getSceneIndexForSplat(t)]||1;return a.w>=i},t,i).then(()=>{let e=performance.now()-r;if(this.logLevel>=tQ.Info&&console.log("SplatTree build: "+e+" ms"),this.disposed)n();else{this.splatTree=this.baseSplatTree,this.baseSplatTree=null;let e=0,t=0,i=0,r=0;this.splatTree.visitLeaves(n=>{let a=n.data.indexes.length;a>0&&(t+=a,i=Math.max(i,a),r++,e++)}),this.logLevel>=tQ.Info&&(console.log(`SplatTree leaves: ${this.splatTree.countLeaves()}`),console.log(`SplatTree leaves with splats:${e}`),t/=r,console.log(`Avg splat count per node: ${t}`),console.log(`Total splat count: ${this.getSplatCount()}`)),n()}})})};build(e,t,i=!0,n=!1,r,a,s=!0){this.sceneOptions=t,this.finalBuild=n;let o=t$.getTotalMaxSplatCountForSplatBuffers(e),l=t$.buildScenes(this,e,t);if(i)for(let e=0;e<this.scenes.length&&e<l.length;e++){let t=l[e],i=this.getScene(e);t.copyTransformData(i)}this.scenes=l;let c=3;for(let t of e){let e=t.getMinSphericalHarmonicsDegree();e<c&&(c=e)}this.minSphericalHarmonicsDegree=Math.min(c,this.sphericalHarmonicsDegree);let h=!1;if(e.length!==this.lastBuildScenes.length)h=!0;else for(let t=0;t<e.length;t++)if(e[t]!==this.lastBuildScenes[t].splatBuffer){h=!0;break}let u=!0;if((1!==this.scenes.length||this.lastBuildSceneCount!==this.scenes.length||this.lastBuildMaxSplatCount!==o||h)&&(u=!1),!u){this.boundingBox=new d.ZzF,s||(this.maxSplatDistanceFromSceneCenter=0,this.visibleRegionBufferRadius=0,this.visibleRegionRadius=0,this.visibleRegionFadeStartRadius=0,this.firstRenderTime=-1),this.lastBuildScenes=[],this.lastBuildSplatCount=0,this.lastBuildMaxSplatCount=0,this.disposeMeshData(),this.geometry=tH.build(o),this.splatRenderMode===tN.ThreeD?this.material=tk.build(this.dynamicMode,this.enableOptionalEffects,this.antialiased,this.maxScreenSpaceSplatSize,this.splatScale,this.pointCloudModeEnabled,this.minSphericalHarmonicsDegree,this.kernel2DSize):this.material=tz.build(this.dynamicMode,this.enableOptionalEffects,this.splatScale,this.pointCloudModeEnabled,this.minSphericalHarmonicsDegree);let t=t$.buildSplatIndexMaps(e);this.globalSplatIndexToLocalSplatIndexMap=t.localSplatIndexMap,this.globalSplatIndexToSceneIndexMap=t.sceneIndexMap}let p=this.getSplatCount(!0);this.enableDistancesComputationOnGPU&&this.setupDistancesComputationTransformFeedback();let f=this.refreshGPUDataFromSplatBuffers(u);for(let e=0;e<this.scenes.length;e++)this.lastBuildScenes[e]=this.scenes[e];return this.lastBuildSplatCount=p,this.lastBuildMaxSplatCount=this.getMaxSplatCount(),this.lastBuildSceneCount=this.scenes.length,n&&this.scenes.length>0&&this.buildSplatTree(t.map(e=>e.splatAlphaRemovalThreshold||1),r,a).then(()=>{this.onSplatTreeReadyCallback&&this.onSplatTreeReadyCallback(this.splatTree),this.onSplatTreeReadyCallback=null}),this.visible=this.scenes.length>0,f}freeIntermediateSplatData(){let e=e=>{delete e.source.data,delete e.image,e.onUpdate=null};delete this.splatDataTextures.baseData.covariances,delete this.splatDataTextures.baseData.centers,delete this.splatDataTextures.baseData.colors,delete this.splatDataTextures.baseData.sphericalHarmonics,delete this.splatDataTextures.centerColors.data,delete this.splatDataTextures.covariances.data,this.splatDataTextures.sphericalHarmonics&&delete this.splatDataTextures.sphericalHarmonics.data,this.splatDataTextures.sceneIndexes&&delete this.splatDataTextures.sceneIndexes.data,this.splatDataTextures.centerColors.texture.needsUpdate=!0,this.splatDataTextures.centerColors.texture.onUpdate=()=>{e(this.splatDataTextures.centerColors.texture)},this.splatDataTextures.covariances.texture.needsUpdate=!0,this.splatDataTextures.covariances.texture.onUpdate=()=>{e(this.splatDataTextures.covariances.texture)},this.splatDataTextures.sphericalHarmonics&&(this.splatDataTextures.sphericalHarmonics.texture?(this.splatDataTextures.sphericalHarmonics.texture.needsUpdate=!0,this.splatDataTextures.sphericalHarmonics.texture.onUpdate=()=>{e(this.splatDataTextures.sphericalHarmonics.texture)}):this.splatDataTextures.sphericalHarmonics.textures.forEach(t=>{t.needsUpdate=!0,t.onUpdate=()=>{e(t)}})),this.splatDataTextures.sceneIndexes&&(this.splatDataTextures.sceneIndexes.texture.needsUpdate=!0,this.splatDataTextures.sceneIndexes.texture.onUpdate=()=>{e(this.splatDataTextures.sceneIndexes.texture)})}dispose(){this.disposeMeshData(),this.disposeTextures(),this.disposeSplatTree(),this.enableDistancesComputationOnGPU&&(this.computeDistancesOnGPUSyncTimeout&&(clearTimeout(this.computeDistancesOnGPUSyncTimeout),this.computeDistancesOnGPUSyncTimeout=null),this.disposeDistancesComputationGPUResources()),this.scenes=[],this.distancesTransformFeedback={id:null,vertexShader:null,fragmentShader:null,program:null,centersBuffer:null,sceneIndexesBuffer:null,outDistancesBuffer:null,centersLoc:-1,modelViewProjLoc:-1,sceneIndexesLoc:-1,transformsLocs:[]},this.renderer=null,this.globalSplatIndexToLocalSplatIndexMap=[],this.globalSplatIndexToSceneIndexMap=[],this.lastBuildSplatCount=0,this.lastBuildScenes=[],this.lastBuildMaxSplatCount=0,this.lastBuildSceneCount=0,this.firstRenderTime=-1,this.finalBuild=!1,this.webGLUtils=null,this.boundingBox=new d.ZzF,this.calculatedSceneCenter=new d.Pa4,this.maxSplatDistanceFromSceneCenter=0,this.visibleRegionBufferRadius=0,this.visibleRegionRadius=0,this.visibleRegionFadeStartRadius=0,this.visibleRegionChanging=!1,this.splatScale=1,this.pointCloudModeEnabled=!1,this.disposed=!0,this.lastRenderer=null,this.visible=!1}disposeMeshData(){this.geometry&&this.geometry!==tJ&&(this.geometry.dispose(),this.geometry=null),this.material&&(this.material.dispose(),this.material=null)}disposeTextures(){for(let e in this.splatDataTextures)if(this.splatDataTextures.hasOwnProperty(e)){let t=this.splatDataTextures[e];t.texture&&(t.texture.dispose(),t.texture=null)}this.splatDataTextures=null}disposeSplatTree(){this.splatTree&&(this.splatTree.dispose(),this.splatTree=null),this.baseSplatTree&&(this.baseSplatTree.dispose(),this.baseSplatTree=null)}getSplatTree(){return this.splatTree}onSplatTreeReady(e){this.onSplatTreeReadyCallback=e}getDataForDistancesComputation(e,t){return{centers:this.integerBasedDistancesComputation?this.getIntegerCenters(e,t,!0):this.getFloatCenters(e,t,!0),sceneIndexes:this.getSceneIndexes(e,t)}}refreshGPUDataFromSplatBuffers(e){let t=this.getSplatCount(!0);this.refreshDataTexturesFromSplatBuffers(e);let i=e?this.lastBuildSplatCount:0,{centers:n,sceneIndexes:r}=this.getDataForDistancesComputation(i,t-1);return this.enableDistancesComputationOnGPU&&this.refreshGPUBuffersForDistancesComputation(n,r,e),{from:i,to:t-1,count:t-i,centers:n,sceneIndexes:r}}refreshGPUBuffersForDistancesComputation(e,t,i=!1){let n=i?this.lastBuildSplatCount:0;this.updateGPUCentersBufferForDistancesComputation(i,e,n),this.updateGPUTransformIndexesBufferForDistancesComputation(i,t,n)}refreshDataTexturesFromSplatBuffers(e){let t=this.getSplatCount(!0),i=this.lastBuildSplatCount,n=t-1;e?this.updateBaseDataFromSplatBuffers(i,n):(this.setupDataTextures(),this.updateBaseDataFromSplatBuffers()),this.updateDataTexturesFromBaseData(i,n),this.updateVisibleRegion(e)}setupDataTextures(){let e,t,i;let n=this.getMaxSplatCount(),r=this.getSplatCount(!0);this.disposeTextures();let a=(e,t)=>{let i=new d.FM8(4096,1024);for(;i.x*i.y*e<n*t;)i.y*=2;return i},s=e=>e>=1?6:4,o=e=>{let t=s(e),i=a(t,6);return{elementsPerTexelStored:t,texSize:i}},l=this.getTargetCovarianceCompressionLevel(),c=this.getTargetSphericalHarmonicsCompressionLevel();if(this.splatRenderMode===tN.ThreeD){let t=o(l);t.texSize.x*t.texSize.y>0x1000000&&0===l&&(l=1),e=new Float32Array(6*n)}else t=new Float32Array(3*n),i=new Float32Array(4*n);let h=new Float32Array(3*n),u=new Uint8Array(4*n),p=Float32Array;1===c?p=Uint16Array:2===c&&(p=Uint8Array);let f=A(this.minSphericalHarmonicsDegree),m=this.minSphericalHarmonicsDegree?new p(n*f):void 0,g=a(4,4),v=new Uint32Array(g.x*g.y*4);t$.updateCenterColorsPaddedData(0,r-1,h,u,v);let y=new d.IEO(v,g.x,g.y,d.E2K,d.JQ4);if(y.internalFormat="RGBA32UI",y.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=y,this.material.uniforms.centersColorsTextureSize.value.copy(g),this.material.uniformsNeedUpdate=!0,this.splatDataTextures={baseData:{covariances:e,scales:t,rotations:i,centers:h,colors:u,sphericalHarmonics:m},centerColors:{data:v,texture:y,size:g}},this.splatRenderMode===tN.ThreeD){let t;let i=o(l),n=i.elementsPerTexelStored,r=i.texSize,a=l>=1?Uint32Array:Float32Array,s=l>=1?8:4,c=new a(r.x*r.y*s);if(0===l?c.set(e):t$.updatePaddedCompressedCovariancesTextureData(e,c,0,0,e.length),l>=1)(t=new d.IEO(c,r.x,r.y,d.E2K,d.JQ4)).internalFormat="RGBA32UI",this.material.uniforms.covariancesTextureHalfFloat.value=t;else{t=new d.IEO(c,r.x,r.y,d.wk1,d.VzW),this.material.uniforms.covariancesTexture.value=t;let e=new d.IEO(new Uint32Array(32),2,2,d.E2K,d.JQ4);e.internalFormat="RGBA32UI",this.material.uniforms.covariancesTextureHalfFloat.value=e,e.needsUpdate=!0}t.needsUpdate=!0,this.material.uniforms.covariancesAreHalfFloat.value=l>=1?1:0,this.material.uniforms.covariancesTextureSize.value.copy(r),this.splatDataTextures.covariances={data:c,texture:t,size:r,compressionLevel:l,elementsPerTexelStored:n,elementsPerTexelAllocated:s}}else{let e=a(4,6),n=Float32Array,s=d.VzW,o=new n(e.x*e.y*4);t$.updateScaleRotationsPaddedData(0,r-1,t,i,o);let l=new d.IEO(o,e.x,e.y,d.wk1,s);l.needsUpdate=!0,this.material.uniforms.scaleRotationsTexture.value=l,this.material.uniforms.scaleRotationsTextureSize.value.copy(e),this.splatDataTextures.scaleRotations={data:o,texture:l,size:e,compressionLevel:0}}if(m){let e=2===c?d.ywz:d.cLu,t=f;t%2!=0&&t++;let i=d.wk1,n=a(4,t);if(n.x*n.y<=0x1000000){let a=new p(n.x*n.y*4);for(let e=0;e<r;e++){let i=f*e,n=t*e;for(let e=0;e<f;e++)a[n+e]=m[i+e]}let s=new d.IEO(a,n.x,n.y,i,e);s.needsUpdate=!0,this.material.uniforms.sphericalHarmonicsTexture.value=s,this.splatDataTextures.sphericalHarmonics={componentCount:f,paddedComponentCount:t,data:a,textureCount:1,texture:s,size:n,compressionLevel:c,elementsPerTexel:4}}else{let s=f/3;(t=s)%2!=0&&t++;let o=(n=a(4,t)).x*n.y*4,l=[this.material.uniforms.sphericalHarmonicsTextureR,this.material.uniforms.sphericalHarmonicsTextureG,this.material.uniforms.sphericalHarmonicsTextureB],h=[],u=[];for(let a=0;a<3;a++){let c=new p(o);h.push(c);for(let e=0;e<r;e++){let i=f*e,n=t*e;if(s>=3){for(let e=0;e<3;e++)c[n+e]=m[i+3*a+e];if(s>=8)for(let e=0;e<5;e++)c[n+3+e]=m[i+9+5*a+e]}}let g=new d.IEO(c,n.x,n.y,i,e);u.push(g),g.needsUpdate=!0,l[a].value=g}this.material.uniforms.sphericalHarmonicsMultiTextureMode.value=1,this.splatDataTextures.sphericalHarmonics={componentCount:f,componentCountPerChannel:s,paddedComponentCount:t,data:h,textureCount:3,textures:u,size:n,compressionLevel:c,elementsPerTexel:4}}this.material.uniforms.sphericalHarmonicsTextureSize.value.copy(n),this.material.uniforms.sphericalHarmonics8BitMode.value=2===c?1:0;for(let e=0;e<this.scenes.length;e++){let t=this.scenes[e].splatBuffer;this.material.uniforms.sphericalHarmonics8BitCompressionRangeMin.value[e]=t.minSphericalHarmonicsCoeff,this.material.uniforms.sphericalHarmonics8BitCompressionRangeMax.value[e]=t.maxSphericalHarmonicsCoeff}this.material.uniformsNeedUpdate=!0}let x=a(1,4),_=new Uint32Array(x.x*x.y*1);for(let e=0;e<r;e++)_[e]=this.globalSplatIndexToSceneIndexMap[e];let b=new d.IEO(_,x.x,x.y,d.D9w,d.JQ4);b.internalFormat="R32UI",b.needsUpdate=!0,this.material.uniforms.sceneIndexesTexture.value=b,this.material.uniforms.sceneIndexesTextureSize.value.copy(x),this.material.uniformsNeedUpdate=!0,this.splatDataTextures.sceneIndexes={data:_,texture:b,size:x},this.material.uniforms.sceneCount.value=this.scenes.length}updateBaseDataFromSplatBuffers(e,t){let i=this.splatDataTextures.covariances,n=i?i.compressionLevel:void 0,r=this.splatDataTextures.scaleRotations,a=r?r.compressionLevel:void 0,s=this.splatDataTextures.sphericalHarmonics,o=s?s.compressionLevel:0;this.fillSplatDataArrays(this.splatDataTextures.baseData.covariances,this.splatDataTextures.baseData.scales,this.splatDataTextures.baseData.rotations,this.splatDataTextures.baseData.centers,this.splatDataTextures.baseData.colors,this.splatDataTextures.baseData.sphericalHarmonics,void 0,n,a,o,e,t,e)}updateDataTexturesFromBaseData(e,t){let i=this.splatDataTextures.covariances,n=i?i.compressionLevel:void 0,r=this.splatDataTextures.scaleRotations,a=r?r.compressionLevel:void 0,s=this.splatDataTextures.sphericalHarmonics,o=s?s.compressionLevel:0,l=this.splatDataTextures.centerColors,c=l.data,h=l.texture;t$.updateCenterColorsPaddedData(e,t,this.splatDataTextures.baseData.centers,this.splatDataTextures.baseData.colors,c);let u=this.renderer?this.renderer.properties.get(h):null;if(u&&u.__webglTexture?this.updateDataTexture(c,l.texture,l.size,u,4,4,4,e,t):h.needsUpdate=!0,i){let r=i.texture,a=6*e,s=6*t;if(0===n)for(let e=a;e<=s;e++){let t=this.splatDataTextures.baseData.covariances[e];i.data[e]=t}else t$.updatePaddedCompressedCovariancesTextureData(this.splatDataTextures.baseData.covariances,i.data,e*i.elementsPerTexelAllocated,a,s);let o=this.renderer?this.renderer.properties.get(r):null;o&&o.__webglTexture?0===n?this.updateDataTexture(i.data,i.texture,i.size,o,i.elementsPerTexelStored,6,4,e,t):this.updateDataTexture(i.data,i.texture,i.size,o,i.elementsPerTexelAllocated,i.elementsPerTexelAllocated,2,e,t):r.needsUpdate=!0}if(r){let i=r.data,n=r.texture;t$.updateScaleRotationsPaddedData(e,t,this.splatDataTextures.baseData.scales,this.splatDataTextures.baseData.rotations,i);let s=this.renderer?this.renderer.properties.get(n):null;s&&s.__webglTexture?this.updateDataTexture(i,r.texture,r.size,s,4,6,0===a?4:2,e,t):n.needsUpdate=!0}let d=this.splatDataTextures.baseData.sphericalHarmonics;if(d){let i=4;1===o?i=2:2===o&&(i=1);let n=(n,r,a,s,o)=>{let l=this.renderer?this.renderer.properties.get(n):null;l&&l.__webglTexture?this.updateDataTexture(s,n,r,l,a,o,i,e,t):n.needsUpdate=!0},r=s.componentCount,a=s.paddedComponentCount;if(1===s.textureCount){let i=s.data;for(let n=e;n<=t;n++){let e=r*n,t=a*n;for(let n=0;n<r;n++)i[t+n]=d[e+n]}n(s.texture,s.size,s.elementsPerTexel,i,a)}else{let i=s.componentCountPerChannel;for(let o=0;o<3;o++){let l=s.data[o];for(let n=e;n<=t;n++){let e=r*n,t=a*n;if(i>=3){for(let i=0;i<3;i++)l[t+i]=d[e+3*o+i];if(i>=8)for(let i=0;i<5;i++)l[t+3+i]=d[e+9+5*o+i]}}n(s.textures[o],s.size,s.elementsPerTexel,l,a)}}}let p=this.splatDataTextures.sceneIndexes,f=p.data;for(let e=this.lastBuildSplatCount;e<=t;e++)f[e]=this.globalSplatIndexToSceneIndexMap[e];let m=p.texture,g=this.renderer?this.renderer.properties.get(m):null;g&&g.__webglTexture?this.updateDataTexture(f,p.texture,p.size,g,1,1,1,this.lastBuildSplatCount,t):m.needsUpdate=!0}getTargetCovarianceCompressionLevel(){return this.halfPrecisionCovariancesOnGPU?1:0}getTargetSphericalHarmonicsCompressionLevel(){return Math.max(1,this.getMaximumSplatBufferCompressionLevel())}getMaximumSplatBufferCompressionLevel(){let e;for(let t=0;t<this.scenes.length;t++){let i=this.getScene(t).splatBuffer;(0===t||i.compressionLevel>e)&&(e=i.compressionLevel)}return e}getMinimumSplatBufferCompressionLevel(){let e;for(let t=0;t<this.scenes.length;t++){let i=this.getScene(t).splatBuffer;(0===t||i.compressionLevel<e)&&(e=i.compressionLevel)}return e}static computeTextureUpdateRegion(e,t,i,n,r){let a=r/n,s=Math.floor(e*a/i),o=Math.floor(t*a/i);return{dataStart:s*i*n,dataEnd:o*i*n+i*n,startRow:s,endRow:o}}updateDataTexture(e,t,i,n,r,a,s,o,l){let c=this.renderer.getContext(),h=t$.computeTextureUpdateRegion(o,l,i.x,r,a),u=h.dataEnd-h.dataStart,d=new e.constructor(e.buffer,h.dataStart*s,u),p=h.endRow-h.startRow+1,f=this.webGLUtils.convert(t.type),m=this.webGLUtils.convert(t.format,t.colorSpace),g=c.getParameter(c.TEXTURE_BINDING_2D);c.bindTexture(c.TEXTURE_2D,n.__webglTexture),c.texSubImage2D(c.TEXTURE_2D,0,0,h.startRow,i.x,p,m,f,d),c.bindTexture(c.TEXTURE_2D,g)}static updatePaddedCompressedCovariancesTextureData(e,t,i,n,r){let a=new DataView(t.buffer),s=i,o=0;for(let t=n;t<=r;t+=2)a.setUint16(2*s,e[t],!0),a.setUint16(2*s+2,e[t+1],!0),s+=2,++o>=3&&(s+=2,o=0)}static updateCenterColorsPaddedData(e,t,i,n,r){for(let a=e;a<=t;a++){let e=4*a,t=3*a,s=4*a;r[s]=n[e]+(n[e+1]<<8)+(n[e+2]<<16)+(n[e+3]<<24),r[s+1]=m(i[t]),r[s+2]=m(i[t+1]),r[s+3]=m(i[t+2])}}static updateScaleRotationsPaddedData(e,t,i,n,r){for(let a=e;a<=t;a++){let e=3*a,t=4*a,s=6*a;r[s]=i[e],r[s+1]=i[e+1],r[s+2]=i[e+2],r[s+3]=n[t],r[s+4]=n[t+1],r[s+5]=n[t+2]}}updateVisibleRegion(e){let t=this.getSplatCount(!0),i=new d.Pa4;if(!e){let e=new d.Pa4;this.scenes.forEach(t=>{e.add(t.splatBuffer.sceneCenter)}),e.multiplyScalar(1/this.scenes.length),this.calculatedSceneCenter.copy(e),this.material.uniforms.sceneCenter.value.copy(this.calculatedSceneCenter),this.material.uniformsNeedUpdate=!0}let n=e?this.lastBuildSplatCount:0;for(let e=n;e<t;e++){this.getSplatCenter(e,i,!0);let t=i.sub(this.calculatedSceneCenter).length();t>this.maxSplatDistanceFromSceneCenter&&(this.maxSplatDistanceFromSceneCenter=t)}this.maxSplatDistanceFromSceneCenter-this.visibleRegionBufferRadius>1&&(this.visibleRegionBufferRadius=this.maxSplatDistanceFromSceneCenter,this.visibleRegionRadius=Math.max(this.visibleRegionBufferRadius-1,0)),this.finalBuild&&(this.visibleRegionRadius=this.visibleRegionBufferRadius=this.maxSplatDistanceFromSceneCenter),this.updateVisibleRegionFadeDistance()}updateVisibleRegionFadeDistance(e=tK.Default){let t=.012*this.sceneFadeInRateMultiplier,i=.003*this.sceneFadeInRateMultiplier,n=this.finalBuild?t:i,r=e===tK.Default?n:i;this.visibleRegionFadeStartRadius=(this.visibleRegionRadius-this.visibleRegionFadeStartRadius)*r+this.visibleRegionFadeStartRadius;let a=(this.visibleRegionBufferRadius>0?this.visibleRegionFadeStartRadius/this.visibleRegionBufferRadius:0)>.99,s=a||e===tK.Instant?1:0;this.material.uniforms.visibleRegionFadeStartRadius.value=this.visibleRegionFadeStartRadius,this.material.uniforms.visibleRegionRadius.value=this.visibleRegionRadius,this.material.uniforms.firstRenderTime.value=this.firstRenderTime,this.material.uniforms.currentTime.value=performance.now(),this.material.uniforms.fadeInComplete.value=s,this.material.uniformsNeedUpdate=!0,this.visibleRegionChanging=!a}updateRenderIndexes(e,t){let i=this.geometry;i.attributes.splatIndex.set(e),i.attributes.splatIndex.needsUpdate=!0,t>0&&-1===this.firstRenderTime&&(this.firstRenderTime=performance.now()),i.instanceCount=t,i.setDrawRange(0,t)}updateTransforms(){for(let e=0;e<this.scenes.length;e++)this.getScene(e).updateTransform(this.dynamicMode)}updateUniforms=(function(){let e=new d.FM8;return function(t,i,n,r,a,s){if(this.getSplatCount()>0){if(e.set(t.x*this.devicePixelRatio,t.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(e),this.material.uniforms.basisViewport.value.set(1/e.x,1/e.y),this.material.uniforms.focal.value.set(i,n),this.material.uniforms.orthographicMode.value=r?1:0,this.material.uniforms.orthoZoom.value=a,this.material.uniforms.inverseFocalAdjustment.value=s,this.dynamicMode)for(let e=0;e<this.scenes.length;e++)this.material.uniforms.transforms.value[e].copy(this.getScene(e).transform);if(this.enableOptionalEffects)for(let e=0;e<this.scenes.length;e++)this.material.uniforms.sceneOpacity.value[e]=v(this.getScene(e).opacity,0,1),this.material.uniforms.sceneVisibility.value[e]=this.getScene(e).visible?1:0,this.material.uniformsNeedUpdate=!0;this.material.uniformsNeedUpdate=!0}}})();setSplatScale(e=1){this.splatScale=e,this.material.uniforms.splatScale.value=e,this.material.uniformsNeedUpdate=!0}getSplatScale(){return this.splatScale}setPointCloudModeEnabled(e){this.pointCloudModeEnabled=e,this.material.uniforms.pointCloudModeEnabled.value=e?1:0,this.material.uniformsNeedUpdate=!0}getPointCloudModeEnabled(){return this.pointCloudModeEnabled}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(e=!1){return e?t$.getTotalSplatCountForScenes(this.scenes):this.lastBuildSplatCount}static getTotalSplatCountForScenes(e){let t=0;for(let i of e)i&&i.splatBuffer&&(t+=i.splatBuffer.getSplatCount());return t}static getTotalSplatCountForSplatBuffers(e){let t=0;for(let i of e)t+=i.getSplatCount();return t}getMaxSplatCount(){return t$.getTotalMaxSplatCountForScenes(this.scenes)}static getTotalMaxSplatCountForScenes(e){let t=0;for(let i of e)i&&i.splatBuffer&&(t+=i.splatBuffer.getMaxSplatCount());return t}static getTotalMaxSplatCountForSplatBuffers(e){let t=0;for(let i of e)t+=i.getMaxSplatCount();return t}disposeDistancesComputationGPUResources(){if(!this.renderer)return;let e=this.renderer.getContext();this.distancesTransformFeedback.vao&&(e.deleteVertexArray(this.distancesTransformFeedback.vao),this.distancesTransformFeedback.vao=null),this.distancesTransformFeedback.program&&(e.deleteProgram(this.distancesTransformFeedback.program),e.deleteShader(this.distancesTransformFeedback.vertexShader),e.deleteShader(this.distancesTransformFeedback.fragmentShader),this.distancesTransformFeedback.program=null,this.distancesTransformFeedback.vertexShader=null,this.distancesTransformFeedback.fragmentShader=null),this.disposeDistancesComputationGPUBufferResources(),this.distancesTransformFeedback.id&&(e.deleteTransformFeedback(this.distancesTransformFeedback.id),this.distancesTransformFeedback.id=null)}disposeDistancesComputationGPUBufferResources(){if(!this.renderer)return;let e=this.renderer.getContext();this.distancesTransformFeedback.centersBuffer&&(this.distancesTransformFeedback.centersBuffer=null,e.deleteBuffer(this.distancesTransformFeedback.centersBuffer)),this.distancesTransformFeedback.outDistancesBuffer&&(e.deleteBuffer(this.distancesTransformFeedback.outDistancesBuffer),this.distancesTransformFeedback.outDistancesBuffer=null)}setRenderer(e){if(e!==this.renderer){this.renderer=e;let t=this.renderer.getContext(),i=new tX(t),n=new tY(t,i,{});if(i.init(n),this.webGLUtils=new d.fQK(t,i,n),this.enableDistancesComputationOnGPU&&this.getSplatCount()>0){this.setupDistancesComputationTransformFeedback();let{centers:e,sceneIndexes:t}=this.getDataForDistancesComputation(0,this.getSplatCount()-1);this.refreshGPUBuffersForDistancesComputation(e,t)}}}setupDistancesComputationTransformFeedback=function(){let e;let t=this.getMaxSplatCount();if(!this.renderer)return;let i=this.lastRenderer!==this.renderer,n=r!==t;if(!i&&!n)return;i?this.disposeDistancesComputationGPUResources():n&&this.disposeDistancesComputationGPUBufferResources();let a=this.renderer.getContext(),s=(e,t,i)=>{let n=e.createShader(t);if(!n)return console.error("Fatal error: gl could not create a shader object."),null;if(e.shaderSource(n,i),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){let i="unknown";return t===e.VERTEX_SHADER?i="vertex shader":t===e.FRAGMENT_SHADER&&(i="fragement shader"),console.error("Failed to compile "+i+" with these errors:"+e.getShaderInfoLog(n)),e.deleteShader(n),null}return n};this.integerBasedDistancesComputation?(e=`#version 300 es
                in ivec4 center;
                flat out int distance;`,this.dynamicMode?e+=`
                        in uint sceneIndex;
                        uniform ivec4 transforms[${T.MaxScenes}];
                        void main(void) {
                            ivec4 transform = transforms[sceneIndex];
                            distance = center.x * transform.x + center.y * transform.y + center.z * transform.z + transform.w * center.w;
                        }
                    `:e+=`
                        uniform ivec3 modelViewProj;
                        void main(void) {
                            distance = center.x * modelViewProj.x + center.y * modelViewProj.y + center.z * modelViewProj.z;
                        }
                    `):(e=`#version 300 es
                in vec4 center;
                flat out float distance;`,this.dynamicMode?e+=`
                        in uint sceneIndex;
                        uniform mat4 transforms[${T.MaxScenes}];
                        void main(void) {
                            vec4 transformedCenter = transforms[sceneIndex] * vec4(center.xyz, 1.0);
                            distance = transformedCenter.z;
                        }
                    `:e+=`
                        uniform vec3 modelViewProj;
                        void main(void) {
                            distance = center.x * modelViewProj.x + center.y * modelViewProj.y + center.z * modelViewProj.z;
                        }
                    `);let o=`#version 300 es
                precision lowp float;
                out vec4 fragColor;
                void main(){}
            `,l=a.getParameter(a.VERTEX_ARRAY_BINDING),c=a.getParameter(a.CURRENT_PROGRAM),h=!!c&&a.getProgramParameter(c,a.DELETE_STATUS);if(i&&(this.distancesTransformFeedback.vao=a.createVertexArray()),a.bindVertexArray(this.distancesTransformFeedback.vao),i){let t=a.createProgram(),i=s(a,a.VERTEX_SHADER,e),n=s(a,a.FRAGMENT_SHADER,o);if(!i||!n)throw Error("Could not compile shaders for distances computation on GPU.");if(a.attachShader(t,i),a.attachShader(t,n),a.transformFeedbackVaryings(t,["distance"],a.SEPARATE_ATTRIBS),a.linkProgram(t),!a.getProgramParameter(t,a.LINK_STATUS))throw console.error("Fatal error: Failed to link program: "+a.getProgramInfoLog(t)),a.deleteProgram(t),a.deleteShader(n),a.deleteShader(i),Error("Could not link shaders for distances computation on GPU.");this.distancesTransformFeedback.program=t,this.distancesTransformFeedback.vertexShader=i,this.distancesTransformFeedback.vertexShader=n}if(a.useProgram(this.distancesTransformFeedback.program),this.distancesTransformFeedback.centersLoc=a.getAttribLocation(this.distancesTransformFeedback.program,"center"),this.dynamicMode){this.distancesTransformFeedback.sceneIndexesLoc=a.getAttribLocation(this.distancesTransformFeedback.program,"sceneIndex");for(let e=0;e<this.scenes.length;e++)this.distancesTransformFeedback.transformsLocs[e]=a.getUniformLocation(this.distancesTransformFeedback.program,`transforms[${e}]`)}else this.distancesTransformFeedback.modelViewProjLoc=a.getUniformLocation(this.distancesTransformFeedback.program,"modelViewProj");(i||n)&&(this.distancesTransformFeedback.centersBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.distancesTransformFeedback.centersBuffer),a.enableVertexAttribArray(this.distancesTransformFeedback.centersLoc),this.integerBasedDistancesComputation?a.vertexAttribIPointer(this.distancesTransformFeedback.centersLoc,4,a.INT,0,0):a.vertexAttribPointer(this.distancesTransformFeedback.centersLoc,4,a.FLOAT,!1,0,0),this.dynamicMode&&(this.distancesTransformFeedback.sceneIndexesBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.distancesTransformFeedback.sceneIndexesBuffer),a.enableVertexAttribArray(this.distancesTransformFeedback.sceneIndexesLoc),a.vertexAttribIPointer(this.distancesTransformFeedback.sceneIndexesLoc,1,a.UNSIGNED_INT,0,0))),(i||n)&&(this.distancesTransformFeedback.outDistancesBuffer=a.createBuffer()),a.bindBuffer(a.ARRAY_BUFFER,this.distancesTransformFeedback.outDistancesBuffer),a.bufferData(a.ARRAY_BUFFER,4*t,a.STATIC_READ),i&&(this.distancesTransformFeedback.id=a.createTransformFeedback()),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,this.distancesTransformFeedback.id),a.bindBufferBase(a.TRANSFORM_FEEDBACK_BUFFER,0,this.distancesTransformFeedback.outDistancesBuffer),c&&!0!==h&&a.useProgram(c),l&&a.bindVertexArray(l),this.lastRenderer=this.renderer,r=t};updateGPUCentersBufferForDistancesComputation(e,t,i){if(!this.renderer)return;let n=this.renderer.getContext(),r=n.getParameter(n.VERTEX_ARRAY_BINDING);n.bindVertexArray(this.distancesTransformFeedback.vao);let a=this.integerBasedDistancesComputation?Uint32Array:Float32Array;if(n.bindBuffer(n.ARRAY_BUFFER,this.distancesTransformFeedback.centersBuffer),e)n.bufferSubData(n.ARRAY_BUFFER,16*i,t);else{let e=new a(16*this.getMaxSplatCount());e.set(t),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}n.bindBuffer(n.ARRAY_BUFFER,null),r&&n.bindVertexArray(r)}updateGPUTransformIndexesBufferForDistancesComputation(e,t,i){if(!this.renderer||!this.dynamicMode)return;let n=this.renderer.getContext(),r=n.getParameter(n.VERTEX_ARRAY_BINDING);if(n.bindVertexArray(this.distancesTransformFeedback.vao),n.bindBuffer(n.ARRAY_BUFFER,this.distancesTransformFeedback.sceneIndexesBuffer),e)n.bufferSubData(n.ARRAY_BUFFER,4*i,t);else{let e=new Uint32Array(4*this.getMaxSplatCount());e.set(t),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}n.bindBuffer(n.ARRAY_BUFFER,null),r&&n.bindVertexArray(r)}getSceneIndexes(e,t){let i;i=new Uint32Array(t-e+1);for(let n=e;n<=t;n++)i[n]=this.globalSplatIndexToSceneIndexMap[n];return i}fillTransformsArray=(function(){let e=[];return function(t){e.length!==t.length&&(e.length=t.length);for(let t=0;t<this.scenes.length;t++){let i=this.getScene(t).transform.elements;for(let n=0;n<16;n++)e[16*t+n]=i[n]}t.set(e)}})();computeDistancesOnGPU=(function(){let e=new d.yGw;return function(t,i){if(!this.renderer)return;let n=this.renderer.getContext(),r=n.getParameter(n.VERTEX_ARRAY_BINDING),a=n.getParameter(n.CURRENT_PROGRAM),s=!!a&&n.getProgramParameter(a,n.DELETE_STATUS);if(n.bindVertexArray(this.distancesTransformFeedback.vao),n.useProgram(this.distancesTransformFeedback.program),n.enable(n.RASTERIZER_DISCARD),this.dynamicMode)for(let i=0;i<this.scenes.length;i++)if(e.copy(this.getScene(i).transform),e.premultiply(t),this.integerBasedDistancesComputation){let t=t$.getIntegerMatrixArray(e),r=[t[2],t[6],t[10],t[14]];n.uniform4i(this.distancesTransformFeedback.transformsLocs[i],r[0],r[1],r[2],r[3])}else n.uniformMatrix4fv(this.distancesTransformFeedback.transformsLocs[i],!1,e.elements);else if(this.integerBasedDistancesComputation){let e=t$.getIntegerMatrixArray(t),i=[e[2],e[6],e[10]];n.uniform3i(this.distancesTransformFeedback.modelViewProjLoc,i[0],i[1],i[2])}else{let e=[t.elements[2],t.elements[6],t.elements[10]];n.uniform3f(this.distancesTransformFeedback.modelViewProjLoc,e[0],e[1],e[2])}n.bindBuffer(n.ARRAY_BUFFER,this.distancesTransformFeedback.centersBuffer),n.enableVertexAttribArray(this.distancesTransformFeedback.centersLoc),this.integerBasedDistancesComputation?n.vertexAttribIPointer(this.distancesTransformFeedback.centersLoc,4,n.INT,0,0):n.vertexAttribPointer(this.distancesTransformFeedback.centersLoc,4,n.FLOAT,!1,0,0),this.dynamicMode&&(n.bindBuffer(n.ARRAY_BUFFER,this.distancesTransformFeedback.sceneIndexesBuffer),n.enableVertexAttribArray(this.distancesTransformFeedback.sceneIndexesLoc),n.vertexAttribIPointer(this.distancesTransformFeedback.sceneIndexesLoc,1,n.UNSIGNED_INT,0,0)),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,this.distancesTransformFeedback.id),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,0,this.distancesTransformFeedback.outDistancesBuffer),n.beginTransformFeedback(n.POINTS),n.drawArrays(n.POINTS,0,this.getSplatCount()),n.endTransformFeedback(),n.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,0,null),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),n.disable(n.RASTERIZER_DISCARD);let o=n.fenceSync(n.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush();let l=new Promise(e=>{let t=()=>{if(this.disposed)e();else switch(n.clientWaitSync(o,0,0)){case n.TIMEOUT_EXPIRED:return this.computeDistancesOnGPUSyncTimeout=setTimeout(t),this.computeDistancesOnGPUSyncTimeout;case n.WAIT_FAILED:throw Error("should never get here");default:this.computeDistancesOnGPUSyncTimeout=null,n.deleteSync(o);let r=n.getParameter(n.VERTEX_ARRAY_BINDING);n.bindVertexArray(this.distancesTransformFeedback.vao),n.bindBuffer(n.ARRAY_BUFFER,this.distancesTransformFeedback.outDistancesBuffer),n.getBufferSubData(n.ARRAY_BUFFER,0,i),n.bindBuffer(n.ARRAY_BUFFER,null),r&&n.bindVertexArray(r),e()}};this.computeDistancesOnGPUSyncTimeout=setTimeout(t)});return a&&!0!==s&&n.useProgram(a),r&&n.bindVertexArray(r),l}})();getLocalSplatParameters(e,t,i){null==i&&(i=!this.dynamicMode),t.splatBuffer=this.getSplatBufferForSplat(e),t.localIndex=this.getSplatLocalIndex(e),t.sceneTransform=i?this.getSceneTransformForSplat(e):null}fillSplatDataArrays(e,t,i,n,r,a,s,o=0,l=0,c=1,h,u,p=0,f){let m=new d.Pa4;m.x=void 0,m.y=void 0,this.splatRenderMode===tN.ThreeD?m.z=void 0:m.z=1;let g=new d.yGw,v=0,y=this.scenes.length-1;null!=f&&f>=0&&f<=this.scenes.length&&(v=f,y=f);for(let d=v;d<=y;d++){let f;null==s&&(s=!this.dynamicMode);let v=this.getScene(d),y=v.splatBuffer;if(s&&(this.getSceneTransform(d,g),f=g),e&&y.fillSplatCovarianceArray(e,f,h,u,p,o),t||i){if(!t||!i)throw Error('SplatMesh::fillSplatDataArrays() -> "scales" and "rotations" must both be valid.');y.fillSplatScaleRotationArray(t,i,f,h,u,p,l,m)}n&&y.fillSplatCenterArray(n,f,h,u,p),r&&y.fillSplatColorArray(r,v.minimumAlpha,h,u,p),a&&y.fillSphericalHarmonicsArray(a,this.minSphericalHarmonicsDegree,f,h,u,p,c),p+=y.getSplatCount()}}getIntegerCenters(e,t,i=!1){let n;let r=t-e+1,a=new Float32Array(3*r);this.fillSplatDataArrays(null,null,null,a,null,null,void 0,void 0,void 0,void 0,e);let s=i?4:3;n=new Int32Array(r*s);for(let e=0;e<r;e++){for(let t=0;t<3;t++)n[e*s+t]=Math.round(1e3*a[3*e+t]);i&&(n[e*s+3]=1e3)}return n}getFloatCenters(e,t,i=!1){let n=t-e+1,r=new Float32Array(3*n);if(this.fillSplatDataArrays(null,null,null,r,null,null,void 0,void 0,void 0,void 0,e),!i)return r;let a=new Float32Array(4*n);for(let e=0;e<n;e++){for(let t=0;t<3;t++)a[4*e+t]=r[3*e+t];a[4*e+3]=1}return a}getSplatCenter=(function(){let e={};return function(t,i,n){this.getLocalSplatParameters(t,e,n),e.splatBuffer.getSplatCenter(e.localIndex,i,e.sceneTransform)}})();getSplatScaleAndRotation=(function(){let e={},t=new d.Pa4;return function(i,n,r,a){this.getLocalSplatParameters(i,e,a),t.x=void 0,t.y=void 0,t.z=void 0,this.splatRenderMode===tN.TwoD&&(t.z=0),e.splatBuffer.getSplatScaleAndRotation(e.localIndex,n,r,e.sceneTransform,t)}})();getSplatColor=(function(){let e={};return function(t,i){this.getLocalSplatParameters(t,e),e.splatBuffer.getSplatColor(e.localIndex,i)}})();getSceneTransform(e,t){let i=this.getScene(e);i.updateTransform(this.dynamicMode),t.copy(i.transform)}getScene(e){if(e<0||e>=this.scenes.length)throw Error("SplatMesh::getScene() -> Invalid scene index.");return this.scenes[e]}getSceneCount(){return this.scenes.length}getSplatBufferForSplat(e){return this.getScene(this.globalSplatIndexToSceneIndexMap[e]).splatBuffer}getSceneIndexForSplat(e){return this.globalSplatIndexToSceneIndexMap[e]}getSceneTransformForSplat(e){return this.getScene(this.globalSplatIndexToSceneIndexMap[e]).transform}getSplatLocalIndex(e){return this.globalSplatIndexToLocalSplatIndexMap[e]}static getIntegerMatrixArray(e){let t=e.elements,i=[];for(let e=0;e<16;e++)i[e]=Math.round(1e3*t[e]);return i}computeBoundingBox(e=!1,t){let i=this.getSplatCount();if(null!=t){if(t<0||t>=this.scenes.length)throw Error("SplatMesh::computeBoundingBox() -> Invalid scene index.");i=this.scenes[t].splatBuffer.getSplatCount()}let n=new Float32Array(3*i);this.fillSplatDataArrays(null,null,null,n,null,null,e,void 0,void 0,void 0,void 0,t);let r=new d.Pa4,a=new d.Pa4;for(let e=0;e<i;e++){let t=3*e,i=n[t],s=n[t+1],o=n[t+2];(0===e||i<r.x)&&(r.x=i),(0===e||s<r.y)&&(r.y=s),(0===e||o<r.z)&&(r.z=o),(0===e||i>a.x)&&(a.x=i),(0===e||s>a.y)&&(a.y=s),(0===e||o>a.z)&&(a.z=o)}return new d.ZzF(r,a)}}var t0="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAEXAmAAAGAQf39/f39/f39/f39/f39/fwACEgEDZW52Bm1lbW9yeQIDAICABAMDAgABBz4DEV9fd2FzbV9jYWxsX2N0b3JzAAAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAALc29ydEluZGV4ZXMAAQqiDwICAAucDwMBfAd9Bn8gCyAKayEMAkACQCAOBEAgDQRAQfj///8HIQpBiICAgHghDSALIAxNDQMgDCEFA0AgAyAFQQJ0IgFqIAIgACABaigCAEECdGooAgAiATYCACABIAogASAKSBshCiABIA0gASANShshDSAFQQFqIgUgC0cNAAsMAwsgDwRAIAsgDE0NAkF/IQ9B+P///wchCkGIgICAeCENIAwhAgNAIA8gByAAIAJBAnQiGmooAgBBAnQiG2ooAgAiDkcEQAJ/IAUqAjgiESAIIA5BBnRqIg8qAjyUIAUqAigiEiAPKgI4lCAFKgIIIhMgDyoCMJQgBSoCGCIUIA8qAjSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIRgCfyARIA8qAiyUIBIgDyoCKJQgEyAPKgIglCAUIA8qAiSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIRkCfyARIA8qAhyUIBIgDyoCGJQgEyAPKgIQlCAUIA8qAhSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIRwCfyARIA8qAgyUIBIgDyoCCJQgEyAPKgIAlCAUIA8qAgSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIR0gDiEPCyADIBpqIAEgG0ECdGoiDigCBCAcbCAOKAIAIB1saiAOKAIIIBlsaiAOKAIMIBhsaiIONgIAIA4gCiAKIA5KGyEKIA4gDSANIA5IGyENIAJBAWoiAiALRw0ACwwDCwJ/IAUqAii7RAAAAAAAQI9AoiIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAshAgJ/IAUqAhi7RAAAAAAAQI9AoiIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAshByALIAxNAn8gBSoCCLtEAAAAAABAj0CiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEPQfj///8HIQpBiICAgHghDQ0CIAwhBQNAIAMgBUECdCIIaiABIAAgCGooAgBBBHRqIggoAgQgB2wgCCgCACAPbGogCCgCCCACbGoiCDYCACAIIAogCCAKSBshCiAIIA0gCCANShshDSAFQQFqIgUgC0cNAAsMAgsgDQRAQfj///8HIQpBiICAgHghDSALIAxNDQIgDCEFA0AgAyAFQQJ0IgFqAn8gAiAAIAFqKAIAQQJ0aioCALtEAAAAAAAAsECiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyIONgIAIAogDiAKIA5IGyEKIA0gDiANIA5KGyENIAVBAWoiBSALRw0ACwwCCyAPRQRAIAsgDE0NASAFKgIoIREgBSoCGCESIAUqAgghE0H4////ByEKQYiAgIB4IQ0gDCEFA0ACfyARIAEgACAFQQJ0IgdqKAIAQQR0aiICKgIIlCATIAIqAgCUIBIgAioCBJSSkrtEAAAAAAAAsECiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEOIAMgB2ogDjYCACAKIA4gCiAOSBshCiANIA4gDSAOShshDSAFQQFqIgUgC0cNAAsMAgsgCyAMTQ0AQX8hD0H4////ByEKQYiAgIB4IQ0gDCECA0AgDyAHIAAgAkECdCIYaigCAEECdCIZaigCACIORwRAIAUqAjgiESAIIA5BBnRqIg8qAjyUIAUqAigiEiAPKgI4lCAFKgIIIhMgDyoCMJQgBSoCGCIUIA8qAjSUkpKSIRUgESAPKgIslCASIA8qAiiUIBMgDyoCIJQgFCAPKgIklJKSkiEWIBEgDyoCHJQgEiAPKgIYlCATIA8qAhCUIBQgDyoCFJSSkpIhFyARIA8qAgyUIBIgDyoCCJQgEyAPKgIAlCAUIA8qAgSUkpKSIREgDiEPCyADIBhqAn8gFSABIBlBAnRqIg4qAgyUIBYgDioCCJQgESAOKgIAlCAXIA4qAgSUkpKSu0QAAAAAAACwQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIg42AgAgCiAOIAogDkgbIQogDSAOIA0gDkobIQ0gAkEBaiICIAtHDQALDAELQYiAgIB4IQ1B+P///wchCgsgCyAMSwRAIAlBAWuzIA2yIAqyk5UhESAMIQ0DQAJ/IBEgAyANQQJ0aiIBKAIAIAprspQiEotDAAAAT10EQCASqAwBC0GAgICAeAshDiABIA42AgAgBCAOQQJ0aiIBIAEoAgBBAWo2AgAgDUEBaiINIAtHDQALCyAJQQJPBEAgBCgCACENQQEhCgNAIAQgCkECdGoiASABKAIAIA1qIg02AgAgCkEBaiIKIAlHDQALCyAMQQBKBEAgDCEKA0AgBiAKQQFrIgFBAnQiAmogACACaigCADYCACAKQQFLIAEhCg0ACwsgCyAMSgRAIAshCgNAIAYgCyAEIAMgCkEBayIKQQJ0IgFqKAIAQQJ0aiICKAIAIgVrQQJ0aiAAIAFqKAIANgIAIAIgBUEBazYCACAKIAxKDQALCws=";function t1(e){let t,i,n,r,a,s,o,l,c,h,u,d,p,f,m,g,v,y,x,_;e.onmessage=A=>{if(A.data.centers)centers=A.data.centers,sceneIndexes=A.data.sceneIndexes,r?new Int32Array(i,f+A.data.range.from*_.BytesPerInt*4,4*A.data.range.count).set(new Int32Array(centers)):new Float32Array(i,f+A.data.range.from*_.BytesPerFloat*4,4*A.data.range.count).set(new Float32Array(centers)),a&&new Uint32Array(i,c+4*A.data.range.from,A.data.range.count).set(new Uint32Array(sceneIndexes)),x=A.data.range.from+A.data.range.count;else if(A.data.sort){let b,S,w;let M=Math.min(A.data.sort.splatRenderCount||0,x),E=Math.min(A.data.sort.splatSortCount||0,x),C=A.data.sort.usePrecomputedDistances;!n&&(b=A.data.sort.indexesToSort,w=A.data.sort.transforms,C&&(S=A.data.sort.precomputedDistances)),function(x,A,b,S,w,M,E){let C=performance.now();if(!n&&(new Uint32Array(i,o,w.byteLength/_.BytesPerInt).set(w),new Float32Array(i,h,E.byteLength/_.BytesPerFloat).set(E),S)){let e;(r?new Int32Array(i,u,M.byteLength/_.BytesPerInt):new Float32Array(i,u,M.byteLength/_.BytesPerFloat)).set(M)}g||(g=new Uint32Array(y)),new Float32Array(i,m,16).set(b),new Uint32Array(i,p,y).set(g),t.exports.sortIndexes(o,f,u,d,p,m,l,c,h,y,x,A,s,S,r,a);let T={sortDone:!0,splatSortCount:x,splatRenderCount:A,sortTime:0};if(!n){let e=new Uint32Array(i,l,A);(!v||v.length<A)&&(v=new Uint32Array(A)),v.set(e),T.sortedIndexes=v}let R=performance.now();T.sortTime=R-C,e.postMessage(T)}(E,M,A.data.sort.modelViewProj,C,b,S,w)}else if(A.data.init){_=A.data.init.Constants,s=A.data.init.splatCount,n=A.data.init.useSharedMemory,r=A.data.init.integerBasedSort,a=A.data.init.dynamicMode,y=A.data.init.distanceMapRange,x=0;let g=r?4*_.BytesPerInt:4*_.BytesPerFloat,v=new Uint8Array(A.data.init.sorterWasmBytes),b=16*_.BytesPerFloat,S=s*_.BytesPerInt,w=s*g,M=r?s*_.BytesPerInt:s*_.BytesPerFloat,E=s*_.BytesPerInt,C=s*_.BytesPerInt,T=r?y*_.BytesPerInt*2:y*_.BytesPerFloat*2,R=a?s*_.BytesPerInt:0,P=a?_.MaxScenes*b:0,I=Math.floor((S+w+b+M+E+T+C+R+P+32*_.MemoryPageSize)/_.MemoryPageSize)+1,L={module:{},env:{memory:new WebAssembly.Memory({initial:I,maximum:I,shared:!0})}};WebAssembly.compile(v).then(e=>WebAssembly.instantiate(e,L)).then(r=>{t=r,h=(c=(l=(p=(d=(u=(m=(f=(o=0)+S)+w)+b)+M)+E)+T)+C)+R,i=L.env.memory.buffer,n?e.postMessage({sortSetupPhase1Complete:!0,indexesToSortBuffer:i,indexesToSortOffset:o,sortedIndexesBuffer:i,sortedIndexesOffset:l,precomputedDistancesBuffer:i,precomputedDistancesOffset:u,transformsBuffer:i,transformsOffset:h}):e.postMessage({sortSetupPhase1Complete:!0})})}}}let t2={None:0,VR:1,AR:2};class t3{static createButton(e,t={}){let i=document.createElement("button");function n(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null}function r(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return i.id="VRButton",i.style.display="none",r(i),navigator.xr.isSessionSupported("immersive-vr").then(function(r){r?function(){let n=null;async function r(t){t.addEventListener("end",a),await e.xr.setSession(t),i.textContent="EXIT VR",n=t}function a(){n.removeEventListener("end",a),i.textContent="ENTER VR",n=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR";let s={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){null===n?navigator.xr.requestSession("immersive-vr",s).then(r):(n.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(r).catch(e=>{console.warn(e)}))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(r).catch(e=>{console.warn(e)})}():(n(),i.textContent="VR NOT SUPPORTED"),r&&t3.xrSessionIsGranted&&i.click()}).catch(function(e){n(),console.warn("Exception when trying to call xr.isSessionSupported",e),i.textContent="VR NOT ALLOWED"}),i;{let e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",r(e),e}}static registerSessionGrantedListener(){"undefined"!=typeof navigator&&"xr"in navigator&&!/WebXRViewer\//i.test(navigator.userAgent)&&navigator.xr.addEventListener("sessiongranted",()=>{t3.xrSessionIsGranted=!0})}}t3.xrSessionIsGranted=!1,t3.registerSessionGrantedListener();class t4{static createButton(e,t={}){let i=document.createElement("button");function n(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null}function r(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return i.id="ARButton",i.style.display="none",r(i),navigator.xr.isSessionSupported("immersive-ar").then(function(r){r?function(){if(void 0===t.domOverlay){let e=document.createElement("div");e.style.display="none",document.body.appendChild(e);let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",38),i.setAttribute("height",38),i.style.position="absolute",i.style.right="20px",i.style.top="20px",i.addEventListener("click",function(){n.end()}),e.appendChild(i);let r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),r.setAttribute("stroke","#fff"),r.setAttribute("stroke-width",2),i.appendChild(r),void 0===t.optionalFeatures&&(t.optionalFeatures=[]),t.optionalFeatures.push("dom-overlay"),t.domOverlay={root:e}}let n=null;async function r(r){r.addEventListener("end",a),e.xr.setReferenceSpaceType("local"),await e.xr.setSession(r),i.textContent="STOP AR",t.domOverlay.root.style.display="",n=r}function a(){n.removeEventListener("end",a),i.textContent="START AR",t.domOverlay.root.style.display="none",n=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="START AR",i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){null===n?navigator.xr.requestSession("immersive-ar",t).then(r):(n.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-ar",t).then(r).catch(e=>{console.warn(e)}))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-ar",t).then(r).catch(e=>{console.warn(e)})}():(n(),i.textContent="AR NOT SUPPORTED")}).catch(function(e){n(),console.warn("Exception when trying to call xr.isSessionSupported",e),i.textContent="AR NOT ALLOWED"}),i;{let e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",r(e),e}}}let t5={Always:0,OnChange:1,Never:2};class t6{constructor(e={}){if(e.cameraUp||(e.cameraUp=[0,1,0]),this.cameraUp=new d.Pa4().fromArray(e.cameraUp),e.initialCameraPosition||(e.initialCameraPosition=[0,10,15]),this.initialCameraPosition=new d.Pa4().fromArray(e.initialCameraPosition),e.initialCameraLookAt||(e.initialCameraLookAt=[0,0,0]),this.initialCameraLookAt=new d.Pa4().fromArray(e.initialCameraLookAt),this.dropInMode=e.dropInMode||!1,(void 0===e.selfDrivenMode||null===e.selfDrivenMode)&&(e.selfDrivenMode=!0),this.selfDrivenMode=e.selfDrivenMode&&!this.dropInMode,this.selfDrivenUpdateFunc=this.selfDrivenUpdate.bind(this),void 0===e.useBuiltInControls&&(e.useBuiltInControls=!0),this.useBuiltInControls=e.useBuiltInControls,this.rootElement=e.rootElement,this.ignoreDevicePixelRatio=e.ignoreDevicePixelRatio||!1,this.devicePixelRatio=this.ignoreDevicePixelRatio?1:window.devicePixelRatio||1,this.halfPrecisionCovariancesOnGPU=e.halfPrecisionCovariancesOnGPU||!1,this.threeScene=e.threeScene,this.renderer=e.renderer,this.camera=e.camera,this.gpuAcceleratedSort=e.gpuAcceleratedSort||!1,(void 0===e.integerBasedSort||null===e.integerBasedSort)&&(e.integerBasedSort=!0),this.integerBasedSort=e.integerBasedSort,(void 0===e.sharedMemoryForWorkers||null===e.sharedMemoryForWorkers)&&(e.sharedMemoryForWorkers=!0),this.sharedMemoryForWorkers=e.sharedMemoryForWorkers,this.dynamicScene=!!e.dynamicScene,this.antialiased=e.antialiased||!1,this.kernel2DSize=void 0===e.kernel2DSize?.3:e.kernel2DSize,this.webXRMode=e.webXRMode||t2.None,this.webXRMode!==t2.None&&(this.gpuAcceleratedSort=!1),this.webXRActive=!1,this.webXRSessionInit=e.webXRSessionInit||{},this.renderMode=e.renderMode||t5.Always,this.sceneRevealMode=e.sceneRevealMode||tK.Default,this.focalAdjustment=e.focalAdjustment||1,this.maxScreenSpaceSplatSize=e.maxScreenSpaceSplatSize||1024,this.logLevel=e.logLevel||tQ.None,this.sphericalHarmonicsDegree=e.sphericalHarmonicsDegree||0,this.enableOptionalEffects=e.enableOptionalEffects||!1,(void 0===e.enableSIMDInSort||null===e.enableSIMDInSort)&&(e.enableSIMDInSort=!0),this.enableSIMDInSort=e.enableSIMDInSort,(void 0===e.inMemoryCompressionLevel||null===e.inMemoryCompressionLevel)&&(e.inMemoryCompressionLevel=0),this.inMemoryCompressionLevel=e.inMemoryCompressionLevel,(void 0===e.optimizeSplatData||null===e.optimizeSplatData)&&(e.optimizeSplatData=!0),this.optimizeSplatData=e.optimizeSplatData,(void 0===e.freeIntermediateSplatData||null===e.freeIntermediateSplatData)&&(e.freeIntermediateSplatData=!1),this.freeIntermediateSplatData=e.freeIntermediateSplatData,M()){let e=E();e.major<17&&(this.enableSIMDInSort=!1),e.major<16&&(this.sharedMemoryForWorkers=!1)}(void 0===e.splatRenderMode||null===e.splatRenderMode)&&(e.splatRenderMode=tN.ThreeD),this.splatRenderMode=e.splatRenderMode,this.sceneFadeInRateMultiplier=e.sceneFadeInRateMultiplier||1,this.splatSortDistanceMapPrecision=e.splatSortDistanceMapPrecision||T.DefaultSplatSortDistanceMapPrecision;let t=this.integerBasedSort?20:24;this.splatSortDistanceMapPrecision=v(this.splatSortDistanceMapPrecision,10,t),this.onSplatMeshChangedCallback=null,this.createSplatMesh(),this.controls=null,this.perspectiveControls=null,this.orthographicControls=null,this.orthographicCamera=null,this.perspectiveCamera=null,this.showMeshCursor=!1,this.showControlPlane=!1,this.showInfo=!1,this.sceneHelper=null,this.sortWorker=null,this.sortRunning=!1,this.splatRenderCount=0,this.splatSortCount=0,this.lastSplatSortCount=0,this.sortWorkerIndexesToSort=null,this.sortWorkerSortedIndexes=null,this.sortWorkerPrecomputedDistances=null,this.sortWorkerTransforms=null,this.preSortMessages=[],this.runAfterNextSort=[],this.selfDrivenModeRunning=!1,this.splatRenderReady=!1,this.raycaster=new tU,this.infoPanel=null,this.startInOrthographicMode=!1,this.currentFPS=0,this.lastSortTime=0,this.consecutiveRenderFrames=0,this.previousCameraTarget=new d.Pa4,this.nextCameraTarget=new d.Pa4,this.mousePosition=new d.FM8,this.mouseDownPosition=new d.FM8,this.mouseDownTime=null,this.resizeObserver=null,this.mouseMoveListener=null,this.mouseDownListener=null,this.mouseUpListener=null,this.keyDownListener=null,this.sortPromise=null,this.sortPromiseResolver=null,this.splatSceneDownloadPromises={},this.splatSceneDownloadAndBuildPromise=null,this.splatSceneRemovalPromise=null,this.loadingSpinner=new tM(null,this.rootElement||document.body),this.loadingSpinner.hide(),this.loadingProgressBar=new tE(this.rootElement||document.body),this.loadingProgressBar.hide(),this.infoPanel=new tC(this.rootElement||document.body),this.infoPanel.hide(),this.usingExternalCamera=!!this.dropInMode||!!this.camera,this.usingExternalRenderer=!!this.dropInMode||!!this.renderer,this.initialized=!1,this.disposing=!1,this.disposed=!1,this.disposePromise=null,this.dropInMode||this.init()}createSplatMesh(){this.splatMesh=new t$(this.splatRenderMode,this.dynamicScene,this.enableOptionalEffects,this.halfPrecisionCovariancesOnGPU,this.devicePixelRatio,this.gpuAcceleratedSort,this.integerBasedSort,this.antialiased,this.maxScreenSpaceSplatSize,this.logLevel,this.sphericalHarmonicsDegree,this.sceneFadeInRateMultiplier,this.kernel2DSize),this.splatMesh.frustumCulled=!1,this.onSplatMeshChangedCallback&&this.onSplatMeshChangedCallback()}init(){this.initialized||(this.rootElement||(this.usingExternalRenderer?this.rootElement=this.renderer.domElement||document.body:(this.rootElement=document.createElement("div"),this.rootElement.style.width="100%",this.rootElement.style.height="100%",this.rootElement.style.position="absolute",document.body.appendChild(this.rootElement))),this.setupCamera(),this.setupRenderer(),this.setupWebXR(this.webXRSessionInit),this.setupControls(),this.setupEventHandlers(),this.threeScene=this.threeScene||new d.xsS,this.sceneHelper=new tP(this.threeScene),this.sceneHelper.setupMeshCursor(),this.sceneHelper.setupFocusMarker(),this.sceneHelper.setupControlPlane(),this.loadingProgressBar.setContainer(this.rootElement),this.loadingSpinner.setContainer(this.rootElement),this.infoPanel.setContainer(this.rootElement),this.initialized=!0)}setupCamera(){if(!this.usingExternalCamera){let e=new d.FM8;this.getRenderDimensions(e),this.perspectiveCamera=new d.cPb(50,e.x/e.y,.1,1e3),this.orthographicCamera=new d.iKG(-(e.x/2),e.x/2,e.y/2,-(e.y/2),.1,1e3),this.camera=this.startInOrthographicMode?this.orthographicCamera:this.perspectiveCamera,this.camera.position.copy(this.initialCameraPosition),this.camera.up.copy(this.cameraUp).normalize(),this.camera.lookAt(this.initialCameraLookAt)}}setupRenderer(){if(!this.usingExternalRenderer){let e=new d.FM8;this.getRenderDimensions(e),this.renderer=new d.CP7({antialias:!1,precision:"highp"}),this.renderer.setPixelRatio(this.devicePixelRatio),this.renderer.autoClear=!0,this.renderer.setClearColor(new d.Ilk(0),0),this.renderer.setSize(e.x,e.y),this.resizeObserver=new ResizeObserver(()=>{this.getRenderDimensions(e),this.renderer.setSize(e.x,e.y),this.forceRenderNextFrame()}),this.resizeObserver.observe(this.rootElement),this.rootElement.appendChild(this.renderer.domElement)}}setupWebXR(e){this.webXRMode&&(this.webXRMode===t2.VR?this.rootElement.appendChild(t3.createButton(this.renderer,e)):this.webXRMode===t2.AR&&this.rootElement.appendChild(t4.createButton(this.renderer,e)),this.renderer.xr.addEventListener("sessionstart",e=>{this.webXRActive=!0}),this.renderer.xr.addEventListener("sessionend",e=>{this.webXRActive=!1}),this.renderer.xr.enabled=!0,this.camera.position.copy(this.initialCameraPosition),this.camera.up.copy(this.cameraUp).normalize(),this.camera.lookAt(this.initialCameraLookAt))}setupControls(){if(this.useBuiltInControls&&this.webXRMode===t2.None){for(let e of(this.usingExternalCamera?this.camera.isOrthographicCamera?this.orthographicControls=new tS(this.camera,this.renderer.domElement):this.perspectiveControls=new tS(this.camera,this.renderer.domElement):(this.perspectiveControls=new tS(this.perspectiveCamera,this.renderer.domElement),this.orthographicControls=new tS(this.orthographicCamera,this.renderer.domElement)),[this.orthographicControls,this.perspectiveControls]))e&&(e.listenToKeyEvents(window),e.rotateSpeed=.5,e.maxPolarAngle=.75*Math.PI,e.minPolarAngle=.1,e.enableDamping=!0,e.dampingFactor=.05,e.target.copy(this.initialCameraLookAt),e.update());this.controls=this.camera.isOrthographicCamera?this.orthographicControls:this.perspectiveControls,this.controls.update()}}setupEventHandlers(){this.useBuiltInControls&&this.webXRMode===t2.None&&(this.mouseMoveListener=this.onMouseMove.bind(this),this.renderer.domElement.addEventListener("pointermove",this.mouseMoveListener,!1),this.mouseDownListener=this.onMouseDown.bind(this),this.renderer.domElement.addEventListener("pointerdown",this.mouseDownListener,!1),this.mouseUpListener=this.onMouseUp.bind(this),this.renderer.domElement.addEventListener("pointerup",this.mouseUpListener,!1),this.keyDownListener=this.onKeyDown.bind(this),window.addEventListener("keydown",this.keyDownListener,!1))}removeEventHandlers(){this.useBuiltInControls&&(this.renderer.domElement.removeEventListener("pointermove",this.mouseMoveListener),this.mouseMoveListener=null,this.renderer.domElement.removeEventListener("pointerdown",this.mouseDownListener),this.mouseDownListener=null,this.renderer.domElement.removeEventListener("pointerup",this.mouseUpListener),this.mouseUpListener=null,window.removeEventListener("keydown",this.keyDownListener),this.keyDownListener=null)}setRenderMode(e){this.renderMode=e}setActiveSphericalHarmonicsDegrees(e){this.splatMesh.material.uniforms.sphericalHarmonicsDegree.value=e,this.splatMesh.material.uniformsNeedUpdate=!0}onSplatMeshChanged(e){this.onSplatMeshChangedCallback=e}onKeyDown=(function(){let e=new d.Pa4,t=new d.yGw,i=new d.yGw;return function(n){switch(e.set(0,0,-1),e.transformDirection(this.camera.matrixWorld),t.makeRotationAxis(e,Math.PI/128),i.makeRotationAxis(e,-Math.PI/128),n.code){case"KeyG":this.focalAdjustment+=.02,this.forceRenderNextFrame();break;case"KeyF":this.focalAdjustment-=.02,this.forceRenderNextFrame();break;case"ArrowLeft":this.camera.up.transformDirection(t);break;case"ArrowRight":this.camera.up.transformDirection(i);break;case"KeyC":this.showMeshCursor=!this.showMeshCursor;break;case"KeyU":this.showControlPlane=!this.showControlPlane;break;case"KeyI":this.showInfo=!this.showInfo,this.showInfo?this.infoPanel.show():this.infoPanel.hide();break;case"KeyO":this.usingExternalCamera||this.setOrthographicMode(!this.camera.isOrthographicCamera);break;case"KeyP":this.usingExternalCamera||this.splatMesh.setPointCloudModeEnabled(!this.splatMesh.getPointCloudModeEnabled());break;case"Equal":this.usingExternalCamera||this.splatMesh.setSplatScale(this.splatMesh.getSplatScale()+.05);break;case"Minus":this.usingExternalCamera||this.splatMesh.setSplatScale(Math.max(this.splatMesh.getSplatScale()-.05,0))}}})();onMouseMove(e){this.mousePosition.set(e.offsetX,e.offsetY)}onMouseDown(){this.mouseDownPosition.copy(this.mousePosition),this.mouseDownTime=y()}onMouseUp=(function(){let e=new d.FM8;return function(t){e.copy(this.mousePosition).sub(this.mouseDownPosition),y()-this.mouseDownTime<.5&&2>e.length()&&this.onMouseClick(t)}})();onMouseClick(e){this.mousePosition.set(e.offsetX,e.offsetY),this.checkForFocalPointChange()}checkForFocalPointChange=(function(){let e=new d.FM8,t=new d.Pa4,i=[];return function(){if(!this.transitioningCameraTarget&&(this.getRenderDimensions(e),i.length=0,this.raycaster.setFromCameraAndScreenPosition(this.camera,this.mousePosition,e),this.raycaster.intersectSplatMesh(this.splatMesh,i),i.length>0)){let e=i[0].origin;t.copy(e).sub(this.camera.position),t.length()>.75&&(this.previousCameraTarget.copy(this.controls.target),this.nextCameraTarget.copy(e),this.transitioningCameraTarget=!0,this.transitioningCameraTargetStartTime=y())}}})();getRenderDimensions(e){this.rootElement?(e.x=this.rootElement.offsetWidth,e.y=this.rootElement.offsetHeight):this.renderer.getSize(e)}setOrthographicMode(e){if(e===this.camera.isOrthographicCamera)return;let t=this.camera,i=e?this.orthographicCamera:this.perspectiveCamera;if(i.position.copy(t.position),i.up.copy(t.up),i.rotation.copy(t.rotation),i.quaternion.copy(t.quaternion),i.matrix.copy(t.matrix),this.camera=i,this.controls){let n=e=>{e.saveState(),e.reset()},r=this.controls,a=e?this.orthographicControls:this.perspectiveControls;n(a),n(r),a.target.copy(r.target),e?t6.setCameraZoomFromPosition(i,t,r):t6.setCameraPositionFromZoom(i,t,a),this.controls=a,this.camera.lookAt(this.controls.target)}}static setCameraPositionFromZoom=(function(){let e=new d.Pa4;return function(t,i,n){let r=1/(.001*i.zoom);e.copy(n.target).sub(t.position).normalize().multiplyScalar(r).negate(),t.position.copy(n.target).add(e)}})();static setCameraZoomFromPosition=(function(){let e=new d.Pa4;return function(t,i,n){let r=e.copy(n.target).sub(i.position).length();t.zoom=1/(.001*r)}})();updateSplatMesh=(function(){let e=new d.FM8;return function(){if(this.splatMesh&&this.splatMesh.getSplatCount()>0){this.splatMesh.updateVisibleRegionFadeDistance(this.sceneRevealMode),this.splatMesh.updateTransforms(),this.getRenderDimensions(e);let t=.5*this.camera.projectionMatrix.elements[0]*this.devicePixelRatio*e.x,i=.5*this.camera.projectionMatrix.elements[5]*this.devicePixelRatio*e.y,n=this.camera.isOrthographicCamera?1/this.devicePixelRatio:1,r=this.focalAdjustment*n;this.adjustForWebXRStereo(e),this.splatMesh.updateUniforms(e,t*r,i*r,this.camera.isOrthographicCamera,this.camera.zoom||1,1/r)}}})();adjustForWebXRStereo(e){if(this.camera&&this.webXRActive){let t=this.renderer.xr.getCamera().projectionMatrix.elements[0],i=this.camera.projectionMatrix.elements[0];e.x*=i/t}}isLoadingOrUnloading(){return Object.keys(this.splatSceneDownloadPromises).length>0||null!==this.splatSceneDownloadAndBuildPromise||null!==this.splatSceneRemovalPromise}isDisposingOrDisposed(){return this.disposing||this.disposed}addSplatSceneDownloadPromise(e){this.splatSceneDownloadPromises[e.id]=e}removeSplatSceneDownloadPromise(e){delete this.splatSceneDownloadPromises[e.id]}setSplatSceneDownloadAndBuildPromise(e){this.splatSceneDownloadAndBuildPromise=e}clearSplatSceneDownloadAndBuildPromise(){this.splatSceneDownloadAndBuildPromise=null}addSplatScene(e,t={}){if(this.isLoadingOrUnloading())throw Error("Cannot add splat scene while another load or unload is already in progress.");if(this.isDisposingOrDisposed())throw Error("Cannot add splat scene after dispose() is called.");t.progressiveLoad&&this.splatMesh.scenes&&this.splatMesh.scenes.length>0&&(console.log('addSplatScene(): "progressiveLoad" option ignore because there are multiple splat scenes'),t.progressiveLoad=!1);let i=void 0!==t.format&&null!==t.format?t.format:tm(e),n=t6.isProgressivelyLoadable(i)&&t.progressiveLoad,r=void 0===t.showLoadingUI||null===t.showLoadingUI||t.showLoadingUI,a=null;r&&(this.loadingSpinner.removeAllTasks(),a=this.loadingSpinner.addTask("Downloading..."));let s=(e,t,i)=>{if(r){if(i===e6.Downloading){if(100==e)this.loadingSpinner.setMessageForTask(a,"Download complete!");else if(n)this.loadingSpinner.setMessageForTask(a,"Downloading splats...");else{let e=t?`: ${t}`:"...";this.loadingSpinner.setMessageForTask(a,`Downloading${e}`)}}else i===e6.Processing&&this.loadingSpinner.setMessageForTask(a,"Processing splats...")}},o=!1,l=0,c=(e,t)=>{r&&((e&&n||t&&!n)&&(this.loadingSpinner.removeTask(a),t||o||this.loadingProgressBar.show()),n&&(t?(o=!0,this.loadingProgressBar.hide()):this.loadingProgressBar.setProgress(l)))};return(n?this.downloadAndBuildSingleSplatSceneProgressiveLoad.bind(this):this.downloadAndBuildSingleSplatSceneStandardLoad.bind(this))(e,i,t.splatAlphaRemovalThreshold,((e,i,a)=>{!n&&t.onProgress&&t.onProgress(0,"0%",e6.Processing);let s={rotation:t.rotation||t.orientation,position:t.position,scale:t.scale,splatAlphaRemovalThreshold:t.splatAlphaRemovalThreshold};return this.addSplatBuffers([e],[s],a,i&&r,r,n,n).then(()=>{!n&&t.onProgress&&t.onProgress(100,"100%",e6.Processing),c(i,a)})}).bind(this),(e,i,n)=>{l=e,s(e,i,n),t.onProgress&&t.onProgress(e,i,n)},(()=>{this.loadingProgressBar.hide(),this.loadingSpinner.removeAllTasks()}).bind(this),t.headers)}downloadAndBuildSingleSplatSceneStandardLoad(e,t,i,n,r,a,s){let o=this.downloadSplatSceneToSplatBuffer(e,i,r,!1,void 0,t,s),l=S(o.abortHandler);return o.then(e=>(this.removeSplatSceneDownloadPromise(o),n(e,!0,!0).then(()=>{l.resolve(),this.clearSplatSceneDownloadAndBuildPromise()}))).catch(t=>{a&&a(),this.clearSplatSceneDownloadAndBuildPromise(),this.removeSplatSceneDownloadPromise(o),l.reject(this.updateError(t,`Viewer::addSplatScene -> Could not load file ${e}`))}),this.addSplatSceneDownloadPromise(o),this.setSplatSceneDownloadAndBuildPromise(l.promise),l.promise}downloadAndBuildSingleSplatSceneProgressiveLoad(e,t,i,n,r,a,s){let o=0,l=!1,c=[],h=()=>{if(c.length>0&&!l&&!this.isDisposingOrDisposed()){l=!0;let e=c.shift();n(e.splatBuffer,e.firstBuild,e.finalBuild).then(()=>{l=!1,e.firstBuild?d.resolve():e.finalBuild&&(p.resolve(),this.clearSplatSceneDownloadAndBuildPromise()),c.length>0&&_(()=>h())})}},u=this.downloadSplatSceneToSplatBuffer(e,i,r,!0,(e,t)=>{!this.isDisposingOrDisposed()&&(t||0===c.length||e.getSplatCount()>c[0].splatBuffer.getSplatCount())&&(c.push({splatBuffer:e,firstBuild:0===o,finalBuild:t}),o++,h())},t,s),d=S(u.abortHandler),p=S();return this.addSplatSceneDownloadPromise(u),this.setSplatSceneDownloadAndBuildPromise(p.promise),u.then(()=>{this.removeSplatSceneDownloadPromise(u)}).catch(e=>{this.clearSplatSceneDownloadAndBuildPromise(),this.removeSplatSceneDownloadPromise(u);let t=this.updateError(e,"Viewer::addSplatScene -> Could not load one or more scenes");d.reject(t),a&&a(t)}),d.promise}addSplatScenes(e,t=!0,i){let n;if(this.isLoadingOrUnloading())throw Error("Cannot add splat scene while another load or unload is already in progress.");if(this.isDisposingOrDisposed())throw Error("Cannot add splat scene after dispose() is called.");let r=e.length,a=[];t&&(this.loadingSpinner.removeAllTasks(),n=this.loadingSpinner.addTask("Downloading..."));let s=(e,s,o,l)=>{a[e]=s;let c=0;for(let e=0;e<r;e++)c+=a[e]||0;c/=r,o=`${c.toFixed(2)}%`,t&&l===e6.Downloading&&this.loadingSpinner.setMessageForTask(n,100==c?"Download complete!":`Downloading: ${o}`),i&&i(c,o,l)},o=[],l=[];for(let t=0;t<e.length;t++){let i=e[t],n=void 0!==i.format&&null!==i.format?i.format:tm(i.path),r=this.downloadSplatSceneToSplatBuffer(i.path,i.splatAlphaRemovalThreshold,s.bind(this,t),!1,void 0,n,i.headers);o.push(r),l.push(r.promise)}let c=new p((r,a)=>{Promise.all(l).then(a=>{t&&this.loadingSpinner.removeTask(n),i&&i(0,"0%",e6.Processing),this.addSplatBuffers(a,e,!0,t,t,!1,!1).then(()=>{i&&i(100,"100%",e6.Processing),this.clearSplatSceneDownloadAndBuildPromise(),r()})}).catch(e=>{t&&this.loadingSpinner.removeTask(n),this.clearSplatSceneDownloadAndBuildPromise(),a(this.updateError(e,"Viewer::addSplatScenes -> Could not load one or more splat scenes."))}).finally(()=>{this.removeSplatSceneDownloadPromise(c)})},e=>{for(let t of o)t.abort(e)});return this.addSplatSceneDownloadPromise(c),this.setSplatSceneDownloadAndBuildPromise(c),c}downloadSplatSceneToSplatBuffer(e,t=1,i,n=!1,r,a,s){try{if(a===tf.Splat||a===tf.KSplat||a===tf.Ply){let o=!n&&this.optimizeSplatData;if(a===tf.Splat)return td.loadFromURL(e,i,n,r,t,this.inMemoryCompressionLevel,o,s);if(a===tf.KSplat)return tp.loadFromURL(e,i,n,r,s);if(a===tf.Ply)return tt.loadFromURL(e,i,n,r,t,this.inMemoryCompressionLevel,o,this.sphericalHarmonicsDegree,s)}else if(a===tf.Spz)return tc.loadFromURL(e,i,t,this.inMemoryCompressionLevel,this.optimizeSplatData,this.sphericalHarmonicsDegree,s)}catch(e){throw this.updateError(e,null)}throw Error(`Viewer::downloadSplatSceneToSplatBuffer -> File format not supported: ${e}`)}static isProgressivelyLoadable(e){return e===tf.Splat||e===tf.KSplat||e===tf.Ply}addSplatBuffers=function(e,t=[],i=!0,n=!0,r=!0,a=!1,s=!1,o=!0){if(this.isDisposingOrDisposed())return Promise.resolve();let l=null,c=()=>{null!==l&&(this.loadingSpinner.removeTask(l),l=null)};return this.splatRenderReady=!1,new Promise(h=>{n&&(l=this.loadingSpinner.addTask("Processing splats...")),_(()=>{if(this.isDisposingOrDisposed())h();else{let n=this.addSplatBuffersToMesh(e,t,i,r,a,o),l=this.splatMesh.getMaxSplatCount();this.sortWorker&&this.sortWorker.maxSplatCount!==l&&this.disposeSortWorker(),this.gpuAcceleratedSort||this.preSortMessages.push({centers:n.centers.buffer,sceneIndexes:n.sceneIndexes.buffer,range:{from:n.from,to:n.to,count:n.count}}),(!this.sortWorker&&l>0?this.setupSortWorker(this.splatMesh):Promise.resolve()).then(()=>{this.isDisposingOrDisposed()||this.runSplatSort(!0,!0).then(e=>{this.sortWorker&&e?(s?this.splatRenderReady=!0:this.runAfterNextSort.push(()=>{this.splatRenderReady=!0}),this.runAfterNextSort.push(()=>{c(),h()})):(this.splatRenderReady=!0,c(),h())})})}},!0)})};addSplatBuffersToMesh=function(e,t,i=!0,n=!1,r=!1,s=!0){if(this.isDisposingOrDisposed())return;let o=[],l=[];r||(o=this.splatMesh.scenes.map(e=>e.splatBuffer)||[],l=this.splatMesh.sceneOptions?this.splatMesh.sceneOptions.map(e=>e):[]),o.push(...e),l.push(...t),this.renderer&&this.splatMesh.setRenderer(this.renderer);let c=this.splatMesh.build(o,l,!0,i,e=>{if(this.isDisposingOrDisposed())return;let t=this.splatMesh.getSplatCount();n&&t>=15e5&&!e&&!a&&(this.loadingSpinner.setMinimized(!0,!0),a=this.loadingSpinner.addTask("Optimizing data structures..."))},e=>{!this.isDisposingOrDisposed()&&e&&a&&(this.loadingSpinner.removeTask(a),a=null)},s);return i&&this.freeIntermediateSplatData&&this.splatMesh.freeIntermediateSplatData(),c};setupSortWorker(e){if(!this.isDisposingOrDisposed())return new Promise(t=>{let i=this.integerBasedSort?Int32Array:Float32Array,n=e.getSplatCount(),r=e.getMaxSplatCount();this.sortWorker=function(e,t,i,n,r,a=T.DefaultSplatSortDistanceMapPrecision){let s=new Worker(URL.createObjectURL(new Blob(["(",t1.toString(),")(self)"],{type:"application/javascript"}))),o="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAEbA2AAAGAQf39/f39/f39/f39/f39/fwBgAAF/AhIBA2VudgZtZW1vcnkCAwCAgAQDBAMAAQIHVAQRX193YXNtX2NhbGxfY3RvcnMAABhfX3dhc21fYXBwbHlfZGF0YV9yZWxvY3MAAAtzb3J0SW5kZXhlcwABE2Vtc2NyaXB0ZW5fdGxzX2luaXQAAgqWEAMDAAELihAEAXwDewN/A30gCyAKayEMAkACQCAOBEAgDQRAQfj///8HIQpBiICAgHghDSALIAxNDQMgDCEBA0AgAyABQQJ0IgVqIAIgACAFaigCAEECdGooAgAiBTYCACAFIAogBSAKSBshCiAFIA0gBSANShshDSABQQFqIgEgC0cNAAsMAwsgDwRAIAsgDE0NAkF/IQ9B+P///wchCkGIgICAeCENIAwhAgNAIA8gByAAIAJBAnQiFWooAgAiFkECdGooAgAiFEcEQAJ/IAX9CQI4IAggFEEGdGoiDv0JAgwgDioCHP0gASAOKgIs/SACIA4qAjz9IAP95gEgBf0JAiggDv0JAgggDioCGP0gASAOKgIo/SACIA4qAjj9IAP95gEgBf0JAgggDv0JAgAgDioCEP0gASAOKgIg/SACIA4qAjD9IAP95gEgBf0JAhggDv0JAgQgDioCFP0gASAOKgIk/SACIA4qAjT9IAP95gH95AH95AH95AEiEf1f/QwAAAAAAECPQAAAAAAAQI9AIhL98gEiE/0hASIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAshDgJ/IBP9IQAiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgL/REgDv0cAQJ/IBEgEf0NCAkKCwwNDg8AAAAAAAAAAP1fIBL98gEiEf0hACIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAv9HAICfyAR/SEBIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4C/0cAyESIBQhDwsgAyAVaiABIBZBBHRq/QAAACAS/bUBIhH9GwAgEf0bAWogEf0bAmogEf0bA2oiDjYCACAOIAogCiAOShshCiAOIA0gDSAOSBshDSACQQFqIgIgC0cNAAsMAwsCfyAFKgIIu/0UIAUqAhi7/SIB/QwAAAAAAECPQAAAAAAAQI9A/fIBIhH9IQEiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIQ4CfyAR/SEAIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyECAn8gBSoCKLtEAAAAAABAj0CiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEFQfj///8HIQpBiICAgHghDSALIAxNDQIgAv0RIA79HAEgBf0cAiESIAwhBQNAIAMgBUECdCICaiABIAAgAmooAgBBBHRq/QAAACAS/bUBIhH9GwAgEf0bAWogEf0bAmoiAjYCACACIAogAiAKSBshCiACIA0gAiANShshDSAFQQFqIgUgC0cNAAsMAgsgDQRAQfj///8HIQpBiICAgHghDSALIAxNDQIgDCEBA0AgAyABQQJ0IgVqAn8gAiAAIAVqKAIAQQJ0aioCALtEAAAAAAAAsECiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyIONgIAIAogDiAKIA5IGyEKIA0gDiANIA5KGyENIAFBAWoiASALRw0ACwwCCyAPRQRAIAsgDE0NASAFKgIoIRcgBSoCGCEYIAUqAgghGUH4////ByEKQYiAgIB4IQ0gDCEFA0ACfyAXIAEgACAFQQJ0IgdqKAIAQQR0aiICKgIIlCAZIAIqAgCUIBggAioCBJSSkrtEAAAAAAAAsECiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEOIAMgB2ogDjYCACAKIA4gCiAOSBshCiANIA4gDSAOShshDSAFQQFqIgUgC0cNAAsMAgsgCyAMTQ0AQX8hD0H4////ByEKQYiAgIB4IQ0gDCECA0AgDyAHIAAgAkECdCIUaigCAEECdCIVaigCACIORwRAIAX9CQI4IAggDkEGdGoiD/0JAgwgDyoCHP0gASAPKgIs/SACIA8qAjz9IAP95gEgBf0JAiggD/0JAgggDyoCGP0gASAPKgIo/SACIA8qAjj9IAP95gEgBf0JAgggD/0JAgAgDyoCEP0gASAPKgIg/SACIA8qAjD9IAP95gEgBf0JAhggD/0JAgQgDyoCFP0gASAPKgIk/SACIA8qAjT9IAP95gH95AH95AH95AEhESAOIQ8LIAMgFGoCfyAR/R8DIAEgFUECdCIOQQxyaioCAJQgEf0fAiABIA5BCHJqKgIAlCAR/R8AIAEgDmoqAgCUIBH9HwEgASAOQQRyaioCAJSSkpK7RAAAAAAAALBAoiIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAsiDjYCACAKIA4gCiAOSBshCiANIA4gDSAOShshDSACQQFqIgIgC0cNAAsMAQtBiICAgHghDUH4////ByEKCyALIAxLBEAgCUEBa7MgDbIgCrKTlSEXIAwhDQNAAn8gFyADIA1BAnRqIgEoAgAgCmuylCIYi0MAAABPXQRAIBioDAELQYCAgIB4CyEOIAEgDjYCACAEIA5BAnRqIgEgASgCAEEBajYCACANQQFqIg0gC0cNAAsLIAlBAk8EQCAEKAIAIQ1BASEKA0AgBCAKQQJ0aiIBIAEoAgAgDWoiDTYCACAKQQFqIgogCUcNAAsLIAxBAEoEQCAMIQoDQCAGIApBAWsiAUECdCICaiAAIAJqKAIANgIAIApBAUshAiABIQogAg0ACwsgCyAMSgRAIAshCgNAIAYgCyAEIAMgCkEBayIKQQJ0IgFqKAIAQQJ0aiICKAIAIgVrQQJ0aiAAIAFqKAIANgIAIAIgBUEBazYCACAKIAxKDQALCwsEAEEACw==",l=M()?E():null;i||t?i?!t&&l&&l.major<=16&&l.minor<4&&(o="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAEXAmAAAGAQf39/f39/f39/f39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMDAgABBz4DEV9fd2FzbV9jYWxsX2N0b3JzAAAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAALc29ydEluZGV4ZXMAAQrrDwICAAvlDwQBfAN7B30DfyALIAprIQwCQAJAIA4EQCANBEBB+P///wchCkGIgICAeCENIAsgDE0NAyAMIQUDQCADIAVBAnQiAWogAiAAIAFqKAIAQQJ0aigCACIBNgIAIAEgCiABIApIGyEKIAEgDSABIA1KGyENIAVBAWoiBSALRw0ACwwDCyAPBEAgCyAMTQ0CQX8hD0H4////ByEKQYiAgIB4IQ0gDCECA0AgDyAHIAAgAkECdCIcaigCACIdQQJ0aigCACIbRwRAAn8gBf0JAjggCCAbQQZ0aiIO/QkCDCAOKgIc/SABIA4qAiz9IAIgDioCPP0gA/3mASAF/QkCKCAO/QkCCCAOKgIY/SABIA4qAij9IAIgDioCOP0gA/3mASAF/QkCCCAO/QkCACAOKgIQ/SABIA4qAiD9IAIgDioCMP0gA/3mASAF/QkCGCAO/QkCBCAOKgIU/SABIA4qAiT9IAIgDioCNP0gA/3mAf3kAf3kAf3kASIR/V/9DAAAAAAAQI9AAAAAAABAj0AiEv3yASIT/SEBIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEOAn8gE/0hACIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAv9ESAO/RwBAn8gESAR/Q0ICQoLDA0ODwABAgMAAQID/V8gEv3yASIR/SEAIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4C/0cAgJ/IBH9IQEiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgL/RwDIRIgGyEPCyADIBxqIAEgHUEEdGr9AAAAIBL9tQEiEf0bACAR/RsBaiAR/RsCaiAR/RsDaiIONgIAIA4gCiAKIA5KGyEKIA4gDSANIA5IGyENIAJBAWoiAiALRw0ACwwDCwJ/IAUqAgi7/RQgBSoCGLv9IgH9DAAAAAAAQI9AAAAAAABAj0D98gEiEf0hASIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAshDgJ/IBH9IQAiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLAn8gBSoCKLtEAAAAAABAj0CiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEFQfj///8HIQpBiICAgHghDSALIAxNDQL9ESAO/RwBIAX9HAIhEiAMIQUDQCADIAVBAnQiAmogASAAIAJqKAIAQQR0av0AAAAgEv21ASIR/RsAIBH9GwFqIBH9GwJqIgI2AgAgAiAKIAIgCkgbIQogAiANIAIgDUobIQ0gBUEBaiIFIAtHDQALDAILIA0EQEH4////ByEKQYiAgIB4IQ0gCyAMTQ0CIAwhBQNAIAMgBUECdCIBagJ/IAIgACABaigCAEECdGoqAgC7RAAAAAAAALBAoiIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAsiDjYCACAKIA4gCiAOSBshCiANIA4gDSAOShshDSAFQQFqIgUgC0cNAAsMAgsgD0UEQCALIAxNDQEgBSoCKCEUIAUqAhghFSAFKgIIIRZB+P///wchCkGIgICAeCENIAwhBQNAAn8gFCABIAAgBUECdCIHaigCAEEEdGoiAioCCJQgFiACKgIAlCAVIAIqAgSUkpK7RAAAAAAAALBAoiIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAshDiADIAdqIA42AgAgCiAOIAogDkgbIQogDSAOIA0gDkobIQ0gBUEBaiIFIAtHDQALDAILIAsgDE0NAEF/IQ9B+P///wchCkGIgICAeCENIAwhAgNAIA8gByAAIAJBAnQiG2ooAgBBAnQiHGooAgAiDkcEQCAFKgI4IhQgCCAOQQZ0aiIPKgI8lCAFKgIoIhUgDyoCOJQgBSoCCCIWIA8qAjCUIAUqAhgiFyAPKgI0lJKSkiEYIBQgDyoCLJQgFSAPKgIolCAWIA8qAiCUIBcgDyoCJJSSkpIhGSAUIA8qAhyUIBUgDyoCGJQgFiAPKgIQlCAXIA8qAhSUkpKSIRogFCAPKgIMlCAVIA8qAgiUIBYgDyoCAJQgFyAPKgIElJKSkiEUIA4hDwsgAyAbagJ/IBggASAcQQJ0aiIOKgIMlCAZIA4qAgiUIBQgDioCAJQgGiAOKgIElJKSkrtEAAAAAAAAsECiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyIONgIAIAogDiAKIA5IGyEKIA0gDiANIA5KGyENIAJBAWoiAiALRw0ACwwBC0GIgICAeCENQfj///8HIQoLIAsgDEsEQCAJQQFrsyANsiAKspOVIRQgDCENA0ACfyAUIAMgDUECdGoiASgCACAKa7KUIhWLQwAAAE9dBEAgFagMAQtBgICAgHgLIQ4gASAONgIAIAQgDkECdGoiASABKAIAQQFqNgIAIA1BAWoiDSALRw0ACwsgCUECTwRAIAQoAgAhDUEBIQoDQCAEIApBAnRqIgEgASgCACANaiINNgIAIApBAWoiCiAJRw0ACwsgDEEASgRAIAwhCgNAIAYgCkEBayIBQQJ0IgJqIAAgAmooAgA2AgAgCkEBSyABIQoNAAsLIAsgDEoEQCALIQoDQCAGIAsgBCADIApBAWsiCkECdCIBaigCAEECdGoiAigCACIFa0ECdGogACABaigCADYCACACIAVBAWs2AgAgCiAMSg0ACwsL"):o=t0:(o=t0,l&&l.major<=16&&l.minor<4&&(o="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAEXAmAAAGAQf39/f39/f39/f39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMDAgABBz4DEV9fd2FzbV9jYWxsX2N0b3JzAAAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAALc29ydEluZGV4ZXMAAQqiDwICAAucDwMBfAd9Bn8gCyAKayEMAkACQCAOBEAgDQRAQfj///8HIQpBiICAgHghDSALIAxNDQMgDCEFA0AgAyAFQQJ0IgFqIAIgACABaigCAEECdGooAgAiATYCACABIAogASAKSBshCiABIA0gASANShshDSAFQQFqIgUgC0cNAAsMAwsgDwRAIAsgDE0NAkF/IQ9B+P///wchCkGIgICAeCENIAwhAgNAIA8gByAAIAJBAnQiGmooAgBBAnQiG2ooAgAiDkcEQAJ/IAUqAjgiESAIIA5BBnRqIg8qAjyUIAUqAigiEiAPKgI4lCAFKgIIIhMgDyoCMJQgBSoCGCIUIA8qAjSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIRgCfyARIA8qAiyUIBIgDyoCKJQgEyAPKgIglCAUIA8qAiSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIRkCfyARIA8qAhyUIBIgDyoCGJQgEyAPKgIQlCAUIA8qAhSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIRwCfyARIA8qAgyUIBIgDyoCCJQgEyAPKgIAlCAUIA8qAgSUkpKSu0QAAAAAAECPQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIR0gDiEPCyADIBpqIAEgG0ECdGoiDigCBCAcbCAOKAIAIB1saiAOKAIIIBlsaiAOKAIMIBhsaiIONgIAIA4gCiAKIA5KGyEKIA4gDSANIA5IGyENIAJBAWoiAiALRw0ACwwDCwJ/IAUqAii7RAAAAAAAQI9AoiIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAshAgJ/IAUqAhi7RAAAAAAAQI9AoiIQmUQAAAAAAADgQWMEQCAQqgwBC0GAgICAeAshByALIAxNAn8gBSoCCLtEAAAAAABAj0CiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEPQfj///8HIQpBiICAgHghDQ0CIAwhBQNAIAMgBUECdCIIaiABIAAgCGooAgBBBHRqIggoAgQgB2wgCCgCACAPbGogCCgCCCACbGoiCDYCACAIIAogCCAKSBshCiAIIA0gCCANShshDSAFQQFqIgUgC0cNAAsMAgsgDQRAQfj///8HIQpBiICAgHghDSALIAxNDQIgDCEFA0AgAyAFQQJ0IgFqAn8gAiAAIAFqKAIAQQJ0aioCALtEAAAAAAAAsECiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyIONgIAIAogDiAKIA5IGyEKIA0gDiANIA5KGyENIAVBAWoiBSALRw0ACwwCCyAPRQRAIAsgDE0NASAFKgIoIREgBSoCGCESIAUqAgghE0H4////ByEKQYiAgIB4IQ0gDCEFA0ACfyARIAEgACAFQQJ0IgdqKAIAQQR0aiICKgIIlCATIAIqAgCUIBIgAioCBJSSkrtEAAAAAAAAsECiIhCZRAAAAAAAAOBBYwRAIBCqDAELQYCAgIB4CyEOIAMgB2ogDjYCACAKIA4gCiAOSBshCiANIA4gDSAOShshDSAFQQFqIgUgC0cNAAsMAgsgCyAMTQ0AQX8hD0H4////ByEKQYiAgIB4IQ0gDCECA0AgDyAHIAAgAkECdCIYaigCAEECdCIZaigCACIORwRAIAUqAjgiESAIIA5BBnRqIg8qAjyUIAUqAigiEiAPKgI4lCAFKgIIIhMgDyoCMJQgBSoCGCIUIA8qAjSUkpKSIRUgESAPKgIslCASIA8qAiiUIBMgDyoCIJQgFCAPKgIklJKSkiEWIBEgDyoCHJQgEiAPKgIYlCATIA8qAhCUIBQgDyoCFJSSkpIhFyARIA8qAgyUIBIgDyoCCJQgEyAPKgIAlCAUIA8qAgSUkpKSIREgDiEPCyADIBhqAn8gFSABIBlBAnRqIg4qAgyUIBYgDioCCJQgESAOKgIAlCAXIA4qAgSUkpKSu0QAAAAAAACwQKIiEJlEAAAAAAAA4EFjBEAgEKoMAQtBgICAgHgLIg42AgAgCiAOIAogDkgbIQogDSAOIA0gDkobIQ0gAkEBaiICIAtHDQALDAELQYiAgIB4IQ1B+P///wchCgsgCyAMSwRAIAlBAWuzIA2yIAqyk5UhESAMIQ0DQAJ/IBEgAyANQQJ0aiIBKAIAIAprspQiEotDAAAAT10EQCASqAwBC0GAgICAeAshDiABIA42AgAgBCAOQQJ0aiIBIAEoAgBBAWo2AgAgDUEBaiINIAtHDQALCyAJQQJPBEAgBCgCACENQQEhCgNAIAQgCkECdGoiASABKAIAIA1qIg02AgAgCkEBaiIKIAlHDQALCyAMQQBKBEAgDCEKA0AgBiAKQQFrIgFBAnQiAmogACACaigCADYCACAKQQFLIAEhCg0ACwsgCyAMSgRAIAshCgNAIAYgCyAEIAMgCkEBayIKQQJ0IgFqKAIAQQJ0aiICKAIAIgVrQQJ0aiAAIAFqKAIANgIAIAIgBUEBazYCACAKIAxKDQALCws="));let c=atob(o),h=new Uint8Array(c.length);for(let e=0;e<c.length;e++)h[e]=c.charCodeAt(e);return s.postMessage({init:{sorterWasmBytes:h.buffer,splatCount:e,useSharedMemory:t,integerBasedSort:n,dynamicMode:r,distanceMapRange:1<<a,Constants:{BytesPerFloat:T.BytesPerFloat,BytesPerInt:T.BytesPerInt,MemoryPageSize:T.MemoryPageSize,MaxScenes:T.MaxScenes}}}),s}(r,this.sharedMemoryForWorkers,this.enableSIMDInSort,this.integerBasedSort,this.splatMesh.dynamicMode,this.splatSortDistanceMapPrecision),this.sortWorker.onmessage=e=>{if(e.data.sortDone){if(this.sortRunning=!1,this.sharedMemoryForWorkers)this.splatMesh.updateRenderIndexes(this.sortWorkerSortedIndexes,e.data.splatRenderCount);else{let t=new Uint32Array(e.data.sortedIndexes.buffer,0,e.data.splatRenderCount);this.splatMesh.updateRenderIndexes(t,e.data.splatRenderCount)}this.lastSplatSortCount=this.splatSortCount,this.lastSortTime=e.data.sortTime,this.sortPromiseResolver(),this.sortPromiseResolver=null,this.forceRenderNextFrame(),this.runAfterNextSort.length>0&&(this.runAfterNextSort.forEach(e=>{e()}),this.runAfterNextSort.length=0)}else if(e.data.sortCanceled)this.sortRunning=!1;else if(e.data.sortSetupPhase1Complete){this.logLevel>=tQ.Info&&console.log("Sorting web worker WASM setup complete."),this.sharedMemoryForWorkers?(this.sortWorkerSortedIndexes=new Uint32Array(e.data.sortedIndexesBuffer,e.data.sortedIndexesOffset,r),this.sortWorkerIndexesToSort=new Uint32Array(e.data.indexesToSortBuffer,e.data.indexesToSortOffset,r),this.sortWorkerPrecomputedDistances=new i(e.data.precomputedDistancesBuffer,e.data.precomputedDistancesOffset,r),this.sortWorkerTransforms=new Float32Array(e.data.transformsBuffer,e.data.transformsOffset,16*T.MaxScenes)):(this.sortWorkerIndexesToSort=new Uint32Array(r),this.sortWorkerPrecomputedDistances=new i(r),this.sortWorkerTransforms=new Float32Array(16*T.MaxScenes));for(let e=0;e<n;e++)this.sortWorkerIndexesToSort[e]=e;if(this.sortWorker.maxSplatCount=r,this.logLevel>=tQ.Info){console.log("Sorting web worker ready.");let e=this.splatMesh.getSplatDataTextures(),t=e.covariances.size,i=e.centerColors.size;console.log("Covariances texture size: "+t.x+" x "+t.y),console.log("Centers/colors texture size: "+i.x+" x "+i.y)}t()}}})}updateError(e,t){return e instanceof f?e:e instanceof e8?Error("File type or server does not support progressive loading."):t?Error(t):e}disposeSortWorker(){this.sortWorker&&this.sortWorker.terminate(),this.sortWorker=null,this.sortPromise=null,this.sortPromiseResolver&&(this.sortPromiseResolver(),this.sortPromiseResolver=null),this.preSortMessages=[],this.sortRunning=!1}removeSplatScene(e,t=!0){return this.removeSplatScenes([e],t)}removeSplatScenes(e,t=!0){let i;if(this.isLoadingOrUnloading())throw Error("Cannot remove splat scene while another load or unload is already in progress.");if(this.isDisposingOrDisposed())throw Error("Cannot remove splat scene after dispose() is called.");return this.splatSceneRemovalPromise=new Promise((i,n)=>{let r;t&&(this.loadingSpinner.removeAllTasks(),this.loadingSpinner.show(),r=this.loadingSpinner.addTask("Removing splat scene..."));let a=()=>{t&&(this.loadingSpinner.hide(),this.loadingSpinner.removeTask(r))},s=e=>{a(),this.splatSceneRemovalPromise=null,e?n(e):i()},o=()=>!!this.isDisposingOrDisposed()&&(s(),!0);(this.sortPromise||Promise.resolve()).then(()=>{if(o())return;let t=[],i=[],n=[];for(let r=0;r<this.splatMesh.scenes.length;r++){let a=!1;for(let t of e)if(t===r){a=!0;break}if(!a){let e=this.splatMesh.scenes[r];t.push(e.splatBuffer),i.push(this.splatMesh.sceneOptions[r]),n.push({position:e.position.clone(),quaternion:e.quaternion.clone(),scale:e.scale.clone()})}}this.disposeSortWorker(),this.splatMesh.dispose(),this.sceneRevealMode=tK.Instant,this.createSplatMesh(),this.addSplatBuffers(t,i,!0,!1,!0).then(()=>{o()||(a(),this.splatMesh.scenes.forEach((e,t)=>{e.position.copy(n[t].position),e.quaternion.copy(n[t].quaternion),e.scale.copy(n[t].scale)}),this.splatMesh.updateTransforms(),this.splatRenderReady=!1,this.runSplatSort(!0).then(()=>{if(o()){this.splatRenderReady=!0;return}(this.sortPromise||Promise.resolve()).then(()=>{this.splatRenderReady=!0,s()})}))}).catch(e=>{s(e)})})}),this.splatSceneRemovalPromise}start(){if(this.selfDrivenMode)this.webXRMode?this.renderer.setAnimationLoop(this.selfDrivenUpdateFunc):this.requestFrameId=requestAnimationFrame(this.selfDrivenUpdateFunc),this.selfDrivenModeRunning=!0;else throw Error("Cannot start viewer unless it is in self driven mode.")}stop(){this.selfDrivenMode&&this.selfDrivenModeRunning&&(this.webXRMode?this.renderer.setAnimationLoop(null):cancelAnimationFrame(this.requestFrameId),this.selfDrivenModeRunning=!1)}async dispose(){if(this.isDisposingOrDisposed())return this.disposePromise;let e=[],t=[];for(let i in this.splatSceneDownloadPromises)if(this.splatSceneDownloadPromises.hasOwnProperty(i)){let n=this.splatSceneDownloadPromises[i];t.push(n),e.push(n.promise)}return this.sortPromise&&e.push(this.sortPromise),this.disposing=!0,this.disposePromise=Promise.all(e).finally(()=>{this.stop(),this.orthographicControls&&(this.orthographicControls.dispose(),this.orthographicControls=null),this.perspectiveControls&&(this.perspectiveControls.dispose(),this.perspectiveControls=null),this.controls=null,this.splatMesh&&(this.splatMesh.dispose(),this.splatMesh=null),this.sceneHelper&&(this.sceneHelper.dispose(),this.sceneHelper=null),this.resizeObserver&&(this.resizeObserver.unobserve(this.rootElement),this.resizeObserver=null),this.disposeSortWorker(),this.removeEventHandlers(),this.loadingSpinner.removeAllTasks(),this.loadingSpinner.setContainer(null),this.loadingProgressBar.hide(),this.loadingProgressBar.setContainer(null),this.infoPanel.setContainer(null),this.camera=null,this.threeScene=null,this.splatRenderReady=!1,this.initialized=!1,this.renderer&&(this.usingExternalRenderer||(this.rootElement.removeChild(this.renderer.domElement),this.renderer.dispose()),this.renderer=null),this.usingExternalRenderer||document.body.removeChild(this.rootElement),this.sortWorkerSortedIndexes=null,this.sortWorkerIndexesToSort=null,this.sortWorkerPrecomputedDistances=null,this.sortWorkerTransforms=null,this.disposed=!0,this.disposing=!1,this.disposePromise=null}),t.forEach(e=>{e.abort("Scene disposed")}),this.disposePromise}selfDrivenUpdate(){this.selfDrivenMode&&!this.webXRMode&&(this.requestFrameId=requestAnimationFrame(this.selfDrivenUpdateFunc)),this.update(),this.shouldRender()?(this.render(),this.consecutiveRenderFrames++):this.consecutiveRenderFrames=0,this.renderNextFrame=!1}forceRenderNextFrame(){this.renderNextFrame=!0}shouldRender=(function(){let e=0,t=new d.Pa4,i=new d._fP;return function(){if(!this.initialized||!this.splatRenderReady||this.isDisposingOrDisposed())return!1;let n=!1,r=!1;if(this.camera){let e=this.camera.position,n=this.camera.quaternion;r=Math.abs(e.x-t.x)>1e-4||Math.abs(e.y-t.y)>1e-4||Math.abs(e.z-t.z)>1e-4||Math.abs(n.x-i.x)>1e-4||Math.abs(n.y-i.y)>1e-4||Math.abs(n.z-i.z)>1e-4||Math.abs(n.w-i.w)>1e-4}return n=this.renderMode!==t5.Never&&(0===e||this.splatMesh.visibleRegionChanging||r||this.renderMode===t5.Always||!0===this.dynamicMode||this.renderNextFrame),this.camera&&(t.copy(this.camera.position),i.copy(this.camera.quaternion)),e++,n}})();render=function(){if(!this.initialized||!this.splatRenderReady||this.isDisposingOrDisposed())return;let e=this.renderer.autoClear;(e=>{for(let t of e.children)if(t.visible)return!0;return!1})(this.threeScene)&&(this.renderer.render(this.threeScene,this.camera),this.renderer.autoClear=!1),this.renderer.render(this.splatMesh,this.camera),this.renderer.autoClear=!1,this.sceneHelper.getFocusMarkerOpacity()>0&&this.renderer.render(this.sceneHelper.focusMarker,this.camera),this.showControlPlane&&this.renderer.render(this.sceneHelper.controlPlane,this.camera),this.renderer.autoClear=e};update(e,t){this.dropInMode&&this.updateForDropInMode(e,t),!this.initialized||!this.splatRenderReady||this.isDisposingOrDisposed()||(this.controls&&(this.controls.update(),this.camera.isOrthographicCamera&&!this.usingExternalCamera&&t6.setCameraPositionFromZoom(this.camera,this.camera,this.controls)),this.runSplatSort(),this.updateForRendererSizeChanges(),this.updateSplatMesh(),this.updateMeshCursor(),this.updateFPS(),this.timingSensitiveUpdates(),this.updateInfoPanel(),this.updateControlPlane())}updateForDropInMode(e,t){this.renderer=e,this.splatMesh&&this.splatMesh.setRenderer(this.renderer),this.camera=t,this.controls&&(this.controls.object=t),this.init()}updateFPS=(s=y(),o=0,function(){if(this.consecutiveRenderFrames>60){let e=y();e-s>=1?(this.currentFPS=o,o=0,s=e):o++}else this.currentFPS=null});updateForRendererSizeChanges=(function(){let e;let t=new d.FM8,i=new d.FM8;return function(){this.usingExternalCamera||(this.renderer.getSize(i),void 0!==e&&e===this.camera.isOrthographicCamera&&i.x===t.x&&i.y===t.y||(this.camera.isOrthographicCamera?(this.camera.left=-i.x/2,this.camera.right=i.x/2,this.camera.top=i.y/2,this.camera.bottom=-i.y/2):this.camera.aspect=i.x/i.y,this.camera.updateProjectionMatrix(),t.copy(i),e=this.camera.isOrthographicCamera))}})();timingSensitiveUpdates=function(){let e=y();l||(l=e);let t=e-l;this.updateCameraTransition(e),this.updateFocusMarker(t),l=e};updateCameraTransition=(c=new d.Pa4,h=new d.Pa4,u=new d.Pa4,function(e){if(this.transitioningCameraTarget){h.copy(this.previousCameraTarget).sub(this.camera.position).normalize(),u.copy(this.nextCameraTarget).sub(this.camera.position).normalize();let t=Math.acos(h.dot(u)),i=(t/(Math.PI/3)*.65+.3)/t*(e-this.transitioningCameraTargetStartTime);c.copy(this.previousCameraTarget).lerp(this.nextCameraTarget,i),this.camera.lookAt(c),this.controls.target.copy(c),i>=1&&(this.transitioningCameraTarget=!1)}});updateFocusMarker=(function(){let e=new d.FM8,t=!1;return function(i){if(this.getRenderDimensions(e),this.transitioningCameraTarget){this.sceneHelper.setFocusMarkerVisibility(!0);let n=Math.min(Math.max(this.sceneHelper.getFocusMarkerOpacity(),0)+10*i,1);this.sceneHelper.setFocusMarkerOpacity(n),this.sceneHelper.updateFocusMarker(this.nextCameraTarget,this.camera,e),t=!0,this.forceRenderNextFrame()}else{let n;if((n=t?1:Math.min(this.sceneHelper.getFocusMarkerOpacity(),1))>0){this.sceneHelper.updateFocusMarker(this.nextCameraTarget,this.camera,e);let t=Math.max(n-2.5*i,0);this.sceneHelper.setFocusMarkerOpacity(t),0===t&&this.sceneHelper.setFocusMarkerVisibility(!1)}n>0&&this.forceRenderNextFrame(),t=!1}}})();updateMeshCursor=(function(){let e=[],t=new d.FM8;return function(){this.showMeshCursor?(this.forceRenderNextFrame(),this.getRenderDimensions(t),e.length=0,this.raycaster.setFromCameraAndScreenPosition(this.camera,this.mousePosition,t),this.raycaster.intersectSplatMesh(this.splatMesh,e),e.length>0?(this.sceneHelper.setMeshCursorVisibility(!0),this.sceneHelper.positionAndOrientMeshCursor(e[0].origin,this.camera)):this.sceneHelper.setMeshCursorVisibility(!1)):(this.sceneHelper.getMeschCursorVisibility()&&this.forceRenderNextFrame(),this.sceneHelper.setMeshCursorVisibility(!1))}})();updateInfoPanel=(function(){let e=new d.FM8;return function(){if(!this.showInfo)return;let t=this.splatMesh.getSplatCount();this.getRenderDimensions(e);let i=this.controls?this.controls.target:null,n=this.showMeshCursor?this.sceneHelper.meshCursor.position:null,r=t>0?this.splatRenderCount/t*100:0;this.infoPanel.update(e,this.camera.position,i,this.camera.up,this.camera.isOrthographicCamera,n,this.currentFPS||"N/A",t,this.splatRenderCount,r,this.lastSortTime,this.focalAdjustment,this.splatMesh.getSplatScale(),this.splatMesh.getPointCloudModeEnabled())}})();updateControlPlane(){this.showControlPlane?(this.sceneHelper.setControlPlaneVisibility(!0),this.sceneHelper.positionAndOrientControlPlane(this.controls.target,this.camera.up)):this.sceneHelper.setControlPlaneVisibility(!1)}runSplatSort=(function(){let e=new d.yGw,t=[],i=new d.Pa4(0,0,-1),n=new d.Pa4(0,0,-1),r=new d.Pa4,a=new d.Pa4,s=[],o=[{angleThreshold:.55,sortFractions:[.125,.33333,.75]},{angleThreshold:.65,sortFractions:[.33333,.66667]},{angleThreshold:.8,sortFractions:[.5]}];return function(l=!1,c=!1){if(!this.initialized)return Promise.resolve(!1);if(this.sortRunning)return Promise.resolve(!0);if(0>=this.splatMesh.getSplatCount())return this.splatRenderCount=0,Promise.resolve(!1);let h=0,u=0,d=!1,p=!1;if(n.set(0,0,-1).applyQuaternion(this.camera.quaternion),h=n.dot(i),u=a.copy(this.camera.position).sub(r).length(),!l&&!this.splatMesh.dynamicMode&&0===s.length&&(h<=.99&&(d=!0),u>=1&&(p=!0),!d&&!p))return Promise.resolve(!1);this.sortRunning=!0;let{splatRenderCount:f,shouldSortAll:m}=this.gatherSceneNodesForSort();m=m||c,this.splatRenderCount=f,e.copy(this.camera.matrixWorld).invert();let g=this.perspectiveCamera||this.camera;e.premultiply(g.projectionMatrix),this.splatMesh.dynamicMode||e.multiply(this.splatMesh.matrixWorld);let v=Promise.resolve(!0);return this.gpuAcceleratedSort&&(s.length<=1||s.length%2==0)&&(v=this.splatMesh.computeDistancesOnGPU(e,this.sortWorkerPrecomputedDistances)),v.then(()=>{if(0===s.length){if(this.splatMesh.dynamicMode||m)s.push(this.splatRenderCount);else{for(let e of o)if(h<e.angleThreshold){for(let t of e.sortFractions)s.push(Math.floor(this.splatRenderCount*t));break}s.push(this.splatRenderCount)}}let a=Math.min(s.shift(),this.splatRenderCount);this.splatSortCount=a,t[0]=this.camera.position.x,t[1]=this.camera.position.y,t[2]=this.camera.position.z;let l={modelViewProj:e.elements,cameraPosition:t,splatRenderCount:this.splatRenderCount,splatSortCount:a,usePrecomputedDistances:this.gpuAcceleratedSort};return this.splatMesh.dynamicMode&&this.splatMesh.fillTransformsArray(this.sortWorkerTransforms),!this.sharedMemoryForWorkers&&(l.indexesToSort=this.sortWorkerIndexesToSort,l.transforms=this.sortWorkerTransforms,this.gpuAcceleratedSort&&(l.precomputedDistances=this.sortWorkerPrecomputedDistances)),this.sortPromise=new Promise(e=>{this.sortPromiseResolver=e}),this.preSortMessages.length>0&&(this.preSortMessages.forEach(e=>{this.sortWorker.postMessage(e)}),this.preSortMessages=[]),this.sortWorker.postMessage({sort:l}),0===s.length&&(r.copy(this.camera.position),i.copy(n)),!0}),v}})();gatherSceneNodesForSort=(function(){let e=[],t=null,i=new d.Pa4,n=new d.Pa4,r=new d.Pa4,a=new d.yGw,s=new d.yGw,o=new d.yGw,l=new d.Pa4,c=new d.Pa4(0,0,-1),h=new d.Pa4,u=e=>h.copy(e.max).sub(e.min).length();return function(h=!1){this.getRenderDimensions(l);let p=l.y/2/Math.tan(this.camera.fov/2*d.M8C.DEG2RAD),f=Math.atan(l.x/2/p),m=Math.atan(l.y/2/p),g=Math.cos(f),v=Math.cos(m),y=this.splatMesh.getSplatTree();if(y){s.copy(this.camera.matrixWorld).invert(),this.splatMesh.dynamicMode||s.multiply(this.splatMesh.matrixWorld);let t=0,l=0;for(let d=0;d<y.subTrees.length;d++){let p=y.subTrees[d];a.copy(s),this.splatMesh.dynamicMode&&(this.splatMesh.getSceneTransform(d,o),a.multiply(o));let f=p.nodesWithIndexes.length;for(let s=0;s<f;s++){let o=p.nodesWithIndexes[s];if(!o.data||!o.data.indexes||0===o.data.indexes.length)continue;r.copy(o.center).applyMatrix4(a);let d=r.length();r.normalize(),i.copy(r).setX(0).normalize(),n.copy(r).setY(0).normalize();let f=c.dot(n),m=c.dot(i),y=u(o),x=m<v-.6,_=f<g-.6;(h||!_&&!x||!(d>y))&&(l+=o.data.indexes.length,e[t]=o,o.data.distanceToNode=d,t++)}}e.length=t,e.sort((e,t)=>e.data.distanceToNode<t.data.distanceToNode?-1:1);let d=l*T.BytesPerInt;for(let i=0;i<t;i++){let t=e[i],n=t.data.indexes.length,r=n*T.BytesPerInt;new Uint32Array(this.sortWorkerIndexesToSort.buffer,d-r,n).set(t.data.indexes),d-=r}return{splatRenderCount:l,shouldSortAll:!1}}{let e=this.splatMesh.getSplatCount();if(!t||t.length!==e){t=new Uint32Array(e);for(let i=0;i<e;i++)t[i]=i}return this.sortWorkerIndexesToSort.set(t),{splatRenderCount:e,shouldSortAll:!0}}}})();getSplatMesh(){return this.splatMesh}getSplatScene(e){return this.splatMesh.getScene(e)}getSceneCount(){return this.splatMesh.getSceneCount()}isMobile(){return navigator.userAgent.includes("Mobi")}}class t8 extends d.ZAu{constructor(e={}){super(),e.selfDrivenMode=!1,e.useBuiltInControls=!1,e.rootElement=null,e.dropInMode=!0,e.camera=void 0,e.renderer=void 0,this.viewer=new t6(e),this.splatMesh=null,this.updateSplatMesh(),this.callbackMesh=t8.createCallbackMesh(),this.add(this.callbackMesh),this.callbackMesh.onBeforeRender=t8.onBeforeRender.bind(this,this.viewer),this.viewer.onSplatMeshChanged(()=>{this.updateSplatMesh()})}updateSplatMesh(){this.splatMesh!==this.viewer.splatMesh&&(this.splatMesh&&this.remove(this.splatMesh),this.splatMesh=this.viewer.splatMesh,this.add(this.viewer.splatMesh))}addSplatScene(e,t={}){return!1!==t.showLoadingUI&&(t.showLoadingUI=!0),this.viewer.addSplatScene(e,t)}addSplatScenes(e,t){return!1!==t&&(t=!0),this.viewer.addSplatScenes(e,t)}getSplatScene(e){return this.viewer.getSplatScene(e)}removeSplatScene(e,t=!0){return this.viewer.removeSplatScene(e,t)}removeSplatScenes(e,t=!0){return this.viewer.removeSplatScenes(e,t)}getSceneCount(){return this.viewer.getSceneCount()}setActiveSphericalHarmonicsDegrees(e){this.viewer.setActiveSphericalHarmonicsDegrees(e)}async dispose(){return await this.viewer.dispose()}static onBeforeRender(e,t,i,n){e.update(t,n)}static createCallbackMesh(){let e=new d.xo$(1,8,8),t=new d.vBJ;t.colorWrite=!1,t.depthWrite=!1;let i=new d.Kj0(e,t);return i.frustumCulled=!1,i}}},1795:function(e,t,i){"use strict";let n;i.d(t,{$V:()=>od,$YQ:()=>nc,A5E:()=>tj,CP7:()=>rX,D1R:()=>b,D9w:()=>R,DvJ:()=>iv,E2K:()=>I,EJi:()=>sS,F5T:()=>tV,FM8:()=>es,GUF:()=>F,IEO:()=>r7,Ilk:()=>tk,JOQ:()=>iI,JQ4:()=>w,KI_:()=>U,Kj0:()=>im,L5s:()=>s7,LgZ:()=>d,Ltg:()=>eE,M8C:()=>ea,N$j:()=>r9,NMF:()=>D,OdW:()=>ai,OoA:()=>g,Ox3:()=>s8,PMe:()=>s0,Pa4:()=>eI,QRU:()=>oe,QmN:()=>a,RsA:()=>r,SPe:()=>au,SUY:()=>ot,Syv:()=>L,TUv:()=>r8,TlE:()=>tY,Tme:()=>tb,TyD:()=>v,UY4:()=>aS,UlW:()=>O,Vkp:()=>eo,VzW:()=>M,WdD:()=>iF,Wid:()=>sb,Wl3:()=>s,WwZ:()=>B,Xaj:()=>h,YLQ:()=>y,ZAu:()=>rH,Zp0:()=>s9,ZzF:()=>eB,_12:()=>iU,_C8:()=>sC,_fP:()=>eP,a$l:()=>tJ,aH4:()=>x,aLr:()=>eZ,aNw:()=>sV,av9:()=>P,b_z:()=>aZ,bdR:()=>c,blk:()=>ab,cLu:()=>E,cPb:()=>iw,cek:()=>s5,dUE:()=>sB,dd2:()=>eT,dj0:()=>W,dpR:()=>sX,ehD:()=>o,ejS:()=>aA,epp:()=>ev,fHI:()=>aJ,fQK:()=>rk,hH6:()=>sj,iKG:()=>iY,iLg:()=>sN,iUV:()=>ou,jFi:()=>l,jyz:()=>ib,k74:()=>u,kB5:()=>rJ,lb7:()=>an,m7l:()=>sk,nls:()=>ad,pBf:()=>q,qkB:()=>T,qyh:()=>A,rDY:()=>iA,rpg:()=>f,u9r:()=>t5,uWy:()=>m,vBJ:()=>tG,vpT:()=>rK,wem:()=>_,wk1:()=>C,woe:()=>aT,x12:()=>ay,xEZ:()=>eM,xo$:()=>sv,xsS:()=>rY,yC1:()=>sF,yGw:()=>e8,ywz:()=>S,z$h:()=>N,zHn:()=>e6});let r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},a={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},s=0,o=2,l=0,c=1,h=5,u=204,d=205,p="attached",f=1e3,m=1001,g=1002,v=1003,y=1004,x=1005,_=1006,A=1007,b=1008,S=1009,w=1014,M=1015,E=1016,C=1023,T=1026,R=1029,P=1030,I=1033,L=2300,D=2301,B=0,O=1,N=2,U="srgb",F="srgb-linear",k="display-p3",z="display-p3-linear",H="linear",V="srgb",G="rec709",W=35048,j="300 es";class q{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let i=this._listeners[e];if(void 0!==i){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}let X=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Y=1234567,K=Math.PI/180,Q=180/Math.PI;function J(){let e=0xffffffff*Math.random()|0,t=0xffffffff*Math.random()|0,i=0xffffffff*Math.random()|0,n=0xffffffff*Math.random()|0;return(X[255&e]+X[e>>8&255]+X[e>>16&255]+X[e>>24&255]+"-"+X[255&t]+X[t>>8&255]+"-"+X[t>>16&15|64]+X[t>>24&255]+"-"+X[63&i|128]+X[i>>8&255]+"-"+X[i>>16&255]+X[i>>24&255]+X[255&n]+X[n>>8&255]+X[n>>16&255]+X[n>>24&255]).toLowerCase()}function Z(e,t,i){return Math.max(t,Math.min(i,e))}function $(e,t){return(e%t+t)%t}function ee(e,t,i){return(1-i)*e+i*t}function et(e){return(e&e-1)==0&&0!==e}function ei(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function en(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/0xffffffff;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/0x7fffffff,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw Error("Invalid component type.")}}function er(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(0xffffffff*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(0x7fffffff*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw Error("Invalid component type.")}}let ea={DEG2RAD:K,RAD2DEG:Q,generateUUID:J,clamp:Z,euclideanModulo:$,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:ee,damp:function(e,t,i,n){return ee(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs($(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Y=e);let t=Y+=0x6d2b79f5;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/0x100000000},degToRad:function(e){return e*K},radToDeg:function(e){return e*Q},isPowerOfTwo:et,ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:ei,setQuaternionFromProperEuler:function(e,t,i,n,r){let a=Math.cos,s=Math.sin,o=a(i/2),l=s(i/2),c=a((t+n)/2),h=s((t+n)/2),u=a((t-n)/2),d=s((t-n)/2),p=a((n-t)/2),f=s((n-t)/2);switch(r){case"XYX":e.set(o*h,l*u,l*d,o*c);break;case"YZY":e.set(l*d,o*h,l*u,o*c);break;case"ZXZ":e.set(l*u,l*d,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:er,denormalize:en};class es{constructor(e=0,t=0){es.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(Z(this.dot(e)/t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*i-a*n+e.x,this.y=r*n+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class eo{constructor(e,t,i,n,r,a,s,o,l){eo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,n,r,a,s,o,l)}set(e,t,i,n,r,a,s,o,l){let c=this.elements;return c[0]=e,c[1]=n,c[2]=s,c[3]=t,c[4]=r,c[5]=o,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[3],o=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],x=n[7],_=n[2],A=n[5],b=n[8];return r[0]=a*f+s*v+o*_,r[3]=a*m+s*y+o*A,r[6]=a*g+s*x+o*b,r[1]=l*f+c*v+h*_,r[4]=l*m+c*y+h*A,r[7]=l*g+c*x+h*b,r[2]=u*f+d*v+p*_,r[5]=u*m+d*y+p*A,r[8]=u*g+d*x+p*b,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-i*r*c+i*s*o+n*r*l-n*a*o}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=c*a-s*l,u=s*o-c*r,d=l*r-a*o,p=t*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(n*l-c*i)*f,e[2]=(s*i-n*a)*f,e[3]=u*f,e[4]=(c*t-n*o)*f,e[5]=(n*r-s*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(a*t-i*r)*f,this}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,a,s){let o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*a+l*s)+a+e,-n*l,n*o,-n*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(el.makeScale(e,t)),this}rotate(e){return this.premultiply(el.makeRotation(-e)),this}translate(e,t){return this.premultiply(el.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let el=new eo;function ec(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function eh(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let eu={};function ed(e){e in eu||(eu[e]=!0,console.warn(e))}let ep=new eo().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ef=new eo().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),em={[F]:{transfer:H,primaries:G,toReference:e=>e,fromReference:e=>e},[U]:{transfer:V,primaries:G,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[z]:{transfer:H,primaries:"p3",toReference:e=>e.applyMatrix3(ef),fromReference:e=>e.applyMatrix3(ep)},[k]:{transfer:V,primaries:"p3",toReference:e=>e.convertSRGBToLinear().applyMatrix3(ef),fromReference:e=>e.applyMatrix3(ep).convertLinearToSRGB()}},eg=new Set([F,z]),ev={enabled:!0,_workingColorSpace:F,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(colorSpace){if(!eg.has(colorSpace))throw Error(`Unsupported working color space, "${colorSpace}".`);this._workingColorSpace=colorSpace},convert:function(e,t,i){if(!1===this.enabled||t===i||!t||!i)return e;let n=em[t].toReference;return(0,em[i].fromReference)(n(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return em[e].primaries},getTransfer:function(e){return""===e?H:em[e].transfer}};function ey(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ex(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class e_{static getDataURL(e){let t;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===n&&(n=eh("canvas")),n.width=e.width,n.height=e.height;let i=n.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=n}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let t=eh("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e++)r[e]=255*ey(r[e]/255);return i.putImageData(n,0,0),t}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ey(t[e]/255)):t[e]=ey(t[e]);return{data:t,width:e.width,height:e.height}}}}let eA=0;class eb{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:eA++}),this.uuid=J(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(eS(n[t].image)):e.push(eS(n[t]))}else e=eS(n);i.url=e}return t||(e.images[this.uuid]=i),i}}function eS(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?e_.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ew=0;class eM extends q{constructor(e=eM.DEFAULT_IMAGE,t=eM.DEFAULT_MAPPING,i=m,n=m,r=_,a=b,s=C,o=S,l=eM.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ew++}),this.uuid=J(),this.name="",this.source=new eb(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new es(0,0),this.repeat=new es(1,1),this.center=new es(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new eo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof c?this.colorSpace=c:(ed("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=3001===c?U:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case f:e.x=e.x-Math.floor(e.x);break;case m:e.x=e.x<0?0:1;break;case g:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case f:e.y=e.y-Math.floor(e.y);break;case m:e.y=e.y<0?0:1;break;case g:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ed("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===U?3001:3e3}set encoding(e){ed("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=3001===e?U:""}}eM.DEFAULT_IMAGE=null,eM.DEFAULT_MAPPING=300,eM.DEFAULT_ANISOTROPY=1;class eE{constructor(e=0,t=0,i=0,n=1){eE.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*t+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*t+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*t+a[7]*i+a[11]*n+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r;let a=e.elements,s=a[0],o=a[4],l=a[8],c=a[1],h=a[5],u=a[9],d=a[2],p=a[6],f=a[10];if(.01>Math.abs(o-c)&&.01>Math.abs(l-d)&&.01>Math.abs(u-p)){if(.1>Math.abs(o+c)&&.1>Math.abs(l+d)&&.1>Math.abs(u+p)&&.1>Math.abs(s+h+f-3))return this.set(1,0,0,0),this;t=Math.PI;let e=(s+1)/2,a=(h+1)/2,m=(f+1)/2,g=(o+c)/4,v=(l+d)/4,y=(u+p)/4;return e>a&&e>m?e<.01?(i=0,n=.707106781,r=.707106781):(n=g/(i=Math.sqrt(e)),r=v/i):a>m?a<.01?(i=.707106781,n=0,r=.707106781):(i=g/(n=Math.sqrt(a)),r=y/n):m<.01?(i=.707106781,n=.707106781,r=0):(i=v/(r=Math.sqrt(m)),n=y/r),this.set(i,n,r,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-o)*(c-o));return .001>Math.abs(m)&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-o)/m,this.w=Math.acos((s+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class eC extends q{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new eE(0,0,e,t),this.scissorTest=!1,this.viewport=new eE(0,0,e,t),void 0!==i.encoding&&(ed("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=3001===i.encoding?U:""),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:_,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},i),this.texture=new eM({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps,this.texture.internalFormat=i.internalFormat,this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new eb(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class eT extends eC{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class eR extends eM{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=v,this.minFilter=v,this.wrapR=m,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class eP{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,a,s){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],u=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===s){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h;return}if(1===s){e[t+0]=u,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(h!==f||o!==u||l!==d||c!==p){let e=1-s,t=o*u+l*d+c*p+h*f,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){let r=Math.sqrt(n),a=Math.atan2(r,t*i);e=Math.sin(e*a)/r,s=Math.sin(s*a)/r}let r=s*i;if(o=o*e+u*r,l=l*e+d*r,c=c*e+p*r,h=h*e+f*r,e===1-s){let e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,a){let s=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[a],u=r[a+1],d=r[a+2],p=r[a+3];return e[t]=s*p+c*h+o*d-l*u,e[t+1]=o*p+c*u+l*h-s*d,e[t+2]=l*p+c*d+s*u-o*h,e[t+3]=c*p-s*h-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let i=e._x,n=e._y,r=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(i/2),c=s(n/2),h=s(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(a){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],n=t[4],r=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],h=t[10],u=i+s+h;if(u>0){let e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(a-n)*e}else if(i>s&&i>h){let e=2*Math.sqrt(1+i-s-h);this._w=(c-o)/e,this._x=.25*e,this._y=(n+a)/e,this._z=(r+l)/e}else if(s>h){let e=2*Math.sqrt(1+s-i-h);this._w=(r-l)/e,this._x=(n+a)/e,this._y=.25*e,this._z=(o+c)/e}else{let e=2*Math.sqrt(1+h-i-s);this._w=(a-n)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=i,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Z(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,n=e._y,r=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+a*s+n*l-r*o,this._y=n*c+a*o+r*s-i*l,this._z=r*c+a*l+i*o-n*s,this._w=a*c-i*s-n*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,n=this._y,r=this._z,a=this._w,s=a*e._w+i*e._x+n*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=i,this._y=n,this._z=r,this;let o=1-s*s;if(o<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this}let l=Math.sqrt(o),c=Math.atan2(l,s),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=a*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class eI{constructor(e=0,t=0,i=0){eI.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(eD.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(eD.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=e.elements,a=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*a,this}applyQuaternion(e){let t=this.x,i=this.y,n=this.z,r=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*n-s*i),c=2*(s*t-r*n),h=2*(r*i-a*t);return this.x=t+o*l+a*h-s*c,this.y=i+o*c+s*l-r*h,this.z=n+o*h+r*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,n=e.y,r=e.z,a=t.x,s=t.y,o=t.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return eL.copy(this).projectOnVector(e),this.sub(eL)}reflect(e){return this.sub(eL.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());return 0===t?Math.PI/2:Math.acos(Z(this.dot(e)/t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let eL=new eI,eD=new eP;class eB{constructor(e=new eI(Infinity,Infinity,Infinity),t=new eI(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(eN.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(eN.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=eN.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(void 0!==i){let n=i.getAttribute("position");if(!0===t&&void 0!==n&&!0!==e.isInstancedMesh)for(let t=0,i=n.count;t<i;t++)!0===e.isMesh?e.getVertexPosition(t,eN):eN.fromBufferAttribute(n,t),eN.applyMatrix4(e.matrixWorld),this.expandByPoint(eN);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),eU.copy(e.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),eU.copy(i.boundingBox)),eU.applyMatrix4(e.matrixWorld),this.union(eU)}let n=e.children;for(let e=0,i=n.length;e<i;e++)this.expandByObject(n[e],t);return this}containsPoint(e){return!(e.x<this.min.x)&&!(e.x>this.max.x)&&!(e.y<this.min.y)&&!(e.y>this.max.y)&&!(e.z<this.min.z)&&!(e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x)&&!(e.min.x>this.max.x)&&!(e.max.y<this.min.y)&&!(e.min.y>this.max.y)&&!(e.max.z<this.min.z)&&!(e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,eN),eN.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(eW),ej.subVectors(this.max,eW),eF.subVectors(e.a,eW),ek.subVectors(e.b,eW),ez.subVectors(e.c,eW),eH.subVectors(ek,eF),eV.subVectors(ez,ek),eG.subVectors(eF,ez);let t=[0,-eH.z,eH.y,0,-eV.z,eV.y,0,-eG.z,eG.y,eH.z,0,-eH.x,eV.z,0,-eV.x,eG.z,0,-eG.x,-eH.y,eH.x,0,-eV.y,eV.x,0,-eG.y,eG.x,0];return!!(eY(t,eF,ek,ez,ej)&&eY(t=[1,0,0,0,1,0,0,0,1],eF,ek,ez,ej))&&(eq.crossVectors(eH,eV),eY(t=[eq.x,eq.y,eq.z],eF,ek,ez,ej))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,eN).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(eN).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(eO[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),eO[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),eO[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),eO[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),eO[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),eO[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),eO[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),eO[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(eO)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}let eO=[new eI,new eI,new eI,new eI,new eI,new eI,new eI,new eI],eN=new eI,eU=new eB,eF=new eI,ek=new eI,ez=new eI,eH=new eI,eV=new eI,eG=new eI,eW=new eI,ej=new eI,eq=new eI,eX=new eI;function eY(e,t,i,n,r){for(let a=0,s=e.length-3;a<=s;a+=3){eX.fromArray(e,a);let s=r.x*Math.abs(eX.x)+r.y*Math.abs(eX.y)+r.z*Math.abs(eX.z),o=t.dot(eX),l=i.dot(eX),c=n.dot(eX);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}let eK=new eB,eQ=new eI,eJ=new eI;class eZ{constructor(e=new eI,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;void 0!==t?i.copy(t):eK.setFromPoints(e).getCenter(i);let n=0;for(let t=0,r=e.length;t<r;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;eQ.subVectors(e,this.center);let t=eQ.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),i=(e-this.radius)*.5;this.center.addScaledVector(eQ,i/e),this.radius+=i}return this}union(e){return e.isEmpty()||(this.isEmpty()?this.copy(e):!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(eJ.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(eQ.copy(e.center).add(eJ)),this.expandByPoint(eQ.copy(e.center).sub(eJ)))),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}let e$=new eI,e0=new eI,e1=new eI,e2=new eI,e3=new eI,e4=new eI,e5=new eI;class e6{constructor(e=new eI,t=new eI(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,e$)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=e$.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(e$.copy(this.origin).addScaledVector(this.direction,t),e$.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){let r,a,s,o;e0.copy(e).add(t).multiplyScalar(.5),e1.copy(t).sub(e).normalize(),e2.copy(this.origin).sub(e0);let l=.5*e.distanceTo(t),c=-this.direction.dot(e1),h=e2.dot(this.direction),u=-e2.dot(e1),d=e2.lengthSq(),p=Math.abs(1-c*c);if(p>0){if(r=c*u-h,a=c*h-u,o=l*p,r>=0){if(a>=-o){if(a<=o){let e=1/p;r*=e,a*=e,s=r*(r+c*a+2*h)+a*(c*r+a+2*u)+d}else s=-(r=Math.max(0,-(c*(a=l)+h)))*r+a*(a+2*u)+d}else s=-(r=Math.max(0,-(c*(a=-l)+h)))*r+a*(a+2*u)+d}else a<=-o?(a=(r=Math.max(0,-(-c*l+h)))>0?-l:Math.min(Math.max(-l,-u),l),s=-r*r+a*(a+2*u)+d):a<=o?(r=0,s=(a=Math.min(Math.max(-l,-u),l))*(a+2*u)+d):(a=(r=Math.max(0,-(c*l+h)))>0?l:Math.min(Math.max(-l,-u),l),s=-r*r+a*(a+2*u)+d)}else a=c>0?-l:l,s=-(r=Math.max(0,-(c*a+h)))*r+a*(a+2*u)+d;return i&&i.copy(this.origin).addScaledVector(this.direction,r),n&&n.copy(e0).addScaledVector(e1,a),s}intersectSphere(e,t){e$.subVectors(e.center,this.origin);let i=e$.dot(this.direction),n=e$.dot(e$)-i*i,r=e.radius*e.radius;if(n>r)return null;let a=Math.sqrt(r-n),s=i-a,o=i+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return!!(0===t||e.normal.dot(this.direction)*t<0)}intersectBox(e,t){let i,n,r,a,s,o;let l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return(l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),c>=0?(r=(e.min.y-u.y)*c,a=(e.max.y-u.y)*c):(r=(e.max.y-u.y)*c,a=(e.min.y-u.y)*c),i>a||r>n)?null:((r>i||isNaN(i))&&(i=r),(a<n||isNaN(n))&&(n=a),h>=0?(s=(e.min.z-u.z)*h,o=(e.max.z-u.z)*h):(s=(e.max.z-u.z)*h,o=(e.min.z-u.z)*h),i>o||s>n)?null:((s>i||i!=i)&&(i=s),(o<n||n!=n)&&(n=o),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return null!==this.intersectBox(e,e$)}intersectTriangle(e,t,i,n,r){let a;e3.subVectors(t,e),e4.subVectors(i,e),e5.crossVectors(e3,e4);let s=this.direction.dot(e5);if(s>0){if(n)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}e2.subVectors(this.origin,e);let o=a*this.direction.dot(e4.crossVectors(e2,e4));if(o<0)return null;let l=a*this.direction.dot(e3.cross(e2));if(l<0||o+l>s)return null;let c=-a*e2.dot(e5);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class e8{constructor(e,t,i,n,r,a,s,o,l,c,h,u,d,p,f,m){e8.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,n,r,a,s,o,l,c,h,u,d,p,f,m)}set(e,t,i,n,r,a,s,o,l,c,h,u,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new e8().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,n=1/e9.setFromMatrixColumn(e,0).length(),r=1/e9.setFromMatrixColumn(e,1).length(),a=1/e9.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,n=e.y,r=e.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){let e=a*c,i=a*h,n=s*c,r=s*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-s*o,t[2]=r-e*l,t[6]=n+i*l,t[10]=a*o}else if("YXZ"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e+r*s,t[4]=n*s-i,t[8]=a*l,t[1]=a*h,t[5]=a*c,t[9]=-s,t[2]=i*s-n,t[6]=r+e*s,t[10]=a*o}else if("ZXY"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e-r*s,t[4]=-a*h,t[8]=n+i*s,t[1]=i+n*s,t[5]=a*c,t[9]=r-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){let e=a*c,i=a*h,n=s*c,r=s*h;t[0]=o*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){let e=a*o,i=a*l,n=s*o,r=s*l;t[0]=o*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){let e=a*o,i=a*l,n=s*o,r=s*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=a*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=s*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(te,e,tt)}lookAt(e,t,i){let n=this.elements;return tr.subVectors(e,t),0===tr.lengthSq()&&(tr.z=1),tr.normalize(),ti.crossVectors(i,tr),0===ti.lengthSq()&&(1===Math.abs(i.z)?tr.x+=1e-4:tr.z+=1e-4,tr.normalize(),ti.crossVectors(i,tr)),ti.normalize(),tn.crossVectors(tr,ti),n[0]=ti.x,n[4]=tn.x,n[8]=tr.x,n[1]=ti.y,n[5]=tn.y,n[9]=tr.y,n[2]=ti.z,n[6]=tn.z,n[10]=tr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[4],o=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],x=i[11],_=i[15],A=n[0],b=n[4],S=n[8],w=n[12],M=n[1],E=n[5],C=n[9],T=n[13],R=n[2],P=n[6],I=n[10],L=n[14],D=n[3],B=n[7],O=n[11],N=n[15];return r[0]=a*A+s*M+o*R+l*D,r[4]=a*b+s*E+o*P+l*B,r[8]=a*S+s*C+o*I+l*O,r[12]=a*w+s*T+o*L+l*N,r[1]=c*A+h*M+u*R+d*D,r[5]=c*b+h*E+u*P+d*B,r[9]=c*S+h*C+u*I+d*O,r[13]=c*w+h*T+u*L+d*N,r[2]=p*A+f*M+m*R+g*D,r[6]=p*b+f*E+m*P+g*B,r[10]=p*S+f*C+m*I+g*O,r[14]=p*w+f*T+m*L+g*N,r[3]=v*A+y*M+x*R+_*D,r[7]=v*b+y*E+x*P+_*B,r[11]=v*S+y*C+x*I+_*O,r[15]=v*w+y*T+x*L+_*N,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14],p=e[3],f=e[7];return p*(+r*o*h-n*l*h-r*s*u+i*l*u+n*s*d-i*o*d)+f*(+t*o*d-t*l*u+r*a*u-n*a*d+n*l*c-r*o*c)+e[11]*(+t*l*h-t*s*d-r*a*h+i*a*d+r*s*c-i*l*c)+e[15]*(-n*s*c-t*o*h+t*s*u+n*a*h-i*a*u+i*o*c)}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,i){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*u*l+f*o*d-s*m*d-h*o*g+s*u*g,y=p*u*l-c*m*l-p*o*d+a*m*d+c*o*g-a*u*g,x=c*f*l-p*h*l+p*s*d-a*f*d-c*s*g+a*h*g,_=p*h*o-c*f*o-p*s*u+a*f*u+c*s*m-a*h*m,A=t*v+i*y+n*x+r*_;if(0===A)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let b=1/A;return e[0]=v*b,e[1]=(f*u*r-h*m*r-f*n*d+i*m*d+h*n*g-i*u*g)*b,e[2]=(s*m*r-f*o*r+f*n*l-i*m*l-s*n*g+i*o*g)*b,e[3]=(h*o*r-s*u*r-h*n*l+i*u*l+s*n*d-i*o*d)*b,e[4]=y*b,e[5]=(c*m*r-p*u*r+p*n*d-t*m*d-c*n*g+t*u*g)*b,e[6]=(p*o*r-a*m*r-p*n*l+t*m*l+a*n*g-t*o*g)*b,e[7]=(a*u*r-c*o*r+c*n*l-t*u*l-a*n*d+t*o*d)*b,e[8]=x*b,e[9]=(p*h*r-c*f*r-p*i*d+t*f*d+c*i*g-t*h*g)*b,e[10]=(a*f*r-p*s*r+p*i*l-t*f*l-a*i*g+t*s*g)*b,e[11]=(c*s*r-a*h*r-c*i*l+t*h*l+a*i*d-t*s*d)*b,e[12]=_*b,e[13]=(c*f*n-p*h*n+p*i*u-t*f*u-c*i*m+t*h*m)*b,e[14]=(p*s*n-a*f*n-p*i*o+t*f*o+a*i*m-t*s*m)*b,e[15]=(a*h*n-c*s*n+c*i*o-t*h*o-a*i*u+t*s*u)*b,this}scale(e){let t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return Math.sqrt(Math.max(t,e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),n=Math.sin(t),r=1-i,a=e.x,s=e.y,o=e.z,l=r*a,c=r*s;return this.set(l*a+i,l*s-n*o,l*o+n*s,0,l*s+n*o,c*s+i,c*o-n*a,0,l*o-n*s,c*o+n*a,r*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,a){return this.set(1,i,r,0,e,1,a,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){let n=this.elements,r=t._x,a=t._y,s=t._z,o=t._w,l=r+r,c=a+a,h=s+s,u=r*l,d=r*c,p=r*h,f=a*c,m=a*h,g=s*h,v=o*l,y=o*c,x=o*h,_=i.x,A=i.y,b=i.z;return n[0]=(1-(f+g))*_,n[1]=(d+x)*_,n[2]=(p-y)*_,n[3]=0,n[4]=(d-x)*A,n[5]=(1-(u+g))*A,n[6]=(m+v)*A,n[7]=0,n[8]=(p+y)*b,n[9]=(m-v)*b,n[10]=(1-(u+f))*b,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){let n=this.elements,r=e9.set(n[0],n[1],n[2]).length(),a=e9.set(n[4],n[5],n[6]).length(),s=e9.set(n[8],n[9],n[10]).length();0>this.determinant()&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],e7.copy(this);let o=1/r,l=1/a,c=1/s;return e7.elements[0]*=o,e7.elements[1]*=o,e7.elements[2]*=o,e7.elements[4]*=l,e7.elements[5]*=l,e7.elements[6]*=l,e7.elements[8]*=c,e7.elements[9]*=c,e7.elements[10]*=c,t.setFromRotationMatrix(e7),i.x=r,i.y=a,i.z=s,this}makePerspective(e,t,i,n,r,a,s=2e3){let o,l;let c=this.elements;if(2e3===s)o=-(a+r)/(a-r),l=-2*a*r/(a-r);else if(2001===s)o=-a/(a-r),l=-a*r/(a-r);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return c[0]=2*r/(t-e),c[4]=0,c[8]=(t+e)/(t-e),c[12]=0,c[1]=0,c[5]=2*r/(i-n),c[9]=(i+n)/(i-n),c[13]=0,c[2]=0,c[6]=0,c[10]=o,c[14]=l,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,n,r,a,s=2e3){let o,l;let c=this.elements,h=1/(t-e),u=1/(i-n),d=1/(a-r);if(2e3===s)o=(a+r)*d,l=-2*d;else if(2001===s)o=r*d,l=-1*d;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return c[0]=2*h,c[4]=0,c[8]=0,c[12]=-((t+e)*h),c[1]=0,c[5]=2*u,c[9]=0,c[13]=-((i+n)*u),c[2]=0,c[6]=0,c[10]=l,c[14]=-o,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}let e9=new eI,e7=new e8,te=new eI(0,0,0),tt=new eI(1,1,1),ti=new eI,tn=new eI,tr=new eI,ta=new e8,ts=new eP;class to{constructor(e=0,t=0,i=0,n=to.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let n=e.elements,r=n[0],a=n[4],s=n[8],o=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(t){case"XYZ":this._y=Math.asin(Z(s,-1,1)),.9999999>Math.abs(s)?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Z(c,-1,1)),.9999999>Math.abs(c)?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Z(u,-1,1)),.9999999>Math.abs(u)?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Z(h,-1,1)),.9999999>Math.abs(h)?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Z(o,-1,1)),.9999999>Math.abs(o)?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-Z(a,-1,1)),.9999999>Math.abs(a)?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return ta.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ta,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return ts.setFromEuler(this),this.setFromQuaternion(ts,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}to.DEFAULT_ORDER="XYZ";class tl{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}isEnabled(e){return(this.mask&(1<<e|0))!=0}}let tc=0,th=new eI,tu=new eP,td=new e8,tp=new eI,tf=new eI,tm=new eI,tg=new eP,tv=new eI(1,0,0),ty=new eI(0,1,0),tx=new eI(0,0,1),t_={type:"added"},tA={type:"removed"};class tb extends q{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:tc++}),this.uuid=J(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=tb.DEFAULT_UP.clone();let e=new eI,t=new to,i=new eP,n=new eI(1,1,1);t._onChange(function(){i.setFromEuler(t,!1)}),i._onChange(function(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new e8},normalMatrix:{value:new eo}}),this.matrix=new e8,this.matrixWorld=new e8,this.matrixAutoUpdate=tb.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=tb.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new tl,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return tu.setFromAxisAngle(e,t),this.quaternion.multiply(tu),this}rotateOnWorldAxis(e,t){return tu.setFromAxisAngle(e,t),this.quaternion.premultiply(tu),this}rotateX(e){return this.rotateOnAxis(tv,e)}rotateY(e){return this.rotateOnAxis(ty,e)}rotateZ(e){return this.rotateOnAxis(tx,e)}translateOnAxis(e,t){return th.copy(e).applyQuaternion(this.quaternion),this.position.add(th.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(tv,e)}translateY(e){return this.translateOnAxis(ty,e)}translateZ(e){return this.translateOnAxis(tx,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(td.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?tp.copy(e):tp.set(e,t,i);let n=this.parent;this.updateWorldMatrix(!0,!1),tf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?td.lookAt(tf,tp,this.up):td.lookAt(tp,tf,this.up),this.quaternion.setFromRotationMatrix(td),n&&(td.extractRotation(n.matrixWorld),tu.setFromRotationMatrix(td),this.quaternion.premultiply(tu.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(t_)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return -1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tA)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),td.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),td.multiply(e.parent.matrixWorld)),e.applyMatrix4(td),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){let n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);let n=this.children;for(let r=0,a=n.length;r<a;r++)n[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tf,e,tm),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(tf,tg,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,n=t.length;i<n;i++){let n=t[i];(!0===n.matrixWorldAutoUpdate||!0===e)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,i=e.length;t<i;t++){let i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){let n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material){if(Array.isArray(this.material)){let t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material)}if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){let i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){let t=a(e.geometries),n=a(e.materials),r=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),c=a(e.animations),h=a(e.nodes);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),s.length>0&&(i.images=s),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function a(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){let i=e.children[t];this.add(i.clone())}return this}}tb.DEFAULT_UP=new eI(0,1,0),tb.DEFAULT_MATRIX_AUTO_UPDATE=!0,tb.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let tS=new eI,tw=new eI,tM=new eI,tE=new eI,tC=new eI,tT=new eI,tR=new eI,tP=new eI,tI=new eI,tL=new eI,tD=!1;class tB{constructor(e=new eI,t=new eI,i=new eI){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),tS.subVectors(e,t),n.cross(tS);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){tS.subVectors(n,t),tw.subVectors(i,t),tM.subVectors(e,t);let a=tS.dot(tS),s=tS.dot(tw),o=tS.dot(tM),l=tw.dot(tw),c=tw.dot(tM),h=a*l-s*s;if(0===h)return r.set(0,0,0),null;let u=1/h,d=(l*o-s*c)*u,p=(a*c-s*o)*u;return r.set(1-d-p,p,d)}static containsPoint(e,t,i,n){return null!==this.getBarycoord(e,t,i,n,tE)&&tE.x>=0&&tE.y>=0&&tE.x+tE.y<=1}static getUV(e,t,i,n,r,a,s,o){return!1===tD&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),tD=!0),this.getInterpolation(e,t,i,n,r,a,s,o)}static getInterpolation(e,t,i,n,r,a,s,o){return null===this.getBarycoord(e,t,i,n,tE)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,tE.x),o.addScaledVector(a,tE.y),o.addScaledVector(s,tE.z),o)}static isFrontFacing(e,t,i,n){return tS.subVectors(i,t),tw.subVectors(e,t),0>tS.cross(tw).dot(n)}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tS.subVectors(this.c,this.b),tw.subVectors(this.a,this.b),.5*tS.cross(tw).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return tB.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return tB.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return!1===tD&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),tD=!0),tB.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}getInterpolation(e,t,i,n,r){return tB.getInterpolation(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return tB.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return tB.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i,n;let r=this.a,a=this.b,s=this.c;tC.subVectors(a,r),tT.subVectors(s,r),tP.subVectors(e,r);let o=tC.dot(tP),l=tT.dot(tP);if(o<=0&&l<=0)return t.copy(r);tI.subVectors(e,a);let c=tC.dot(tI),h=tT.dot(tI);if(c>=0&&h<=c)return t.copy(a);let u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return i=o/(o-c),t.copy(r).addScaledVector(tC,i);tL.subVectors(e,s);let d=tC.dot(tL),p=tT.dot(tL);if(p>=0&&d<=p)return t.copy(s);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),t.copy(r).addScaledVector(tT,n);let m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return tR.subVectors(s,a),n=(h-c)/(h-c+(d-p)),t.copy(a).addScaledVector(tR,n);let g=1/(m+f+u);return i=f*g,n=u*g,t.copy(r).addScaledVector(tC,i).addScaledVector(tT,n)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let tO={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},tN={h:0,s:0,l:0},tU={h:0,s:0,l:0};function tF(e,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?e+(t-e)*6*i:i<.5?t:i<2/3?e+(t-e)*6*(2/3-i):e}class tk{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){return void 0===t&&void 0===i?e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e):this.setRGB(e,t,i),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=U){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ev.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=ev.workingColorSpace){return this.r=e,this.g=t,this.b=i,ev.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=ev.workingColorSpace){if(e=$(e,1),t=Z(t,0,1),i=Z(i,0,1),0===t)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=tF(r,n,e+1/3),this.g=tF(r,n,e),this.b=tF(r,n,e-1/3)}return ev.toWorkingColorSpace(this,n),this}setStyle(e,t=U){let i;function n(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;let a=i[1],s=i[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===r)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=U){let i=tO[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ey(e.r),this.g=ey(e.g),this.b=ey(e.b),this}copyLinearToSRGB(e){return this.r=ex(e.r),this.g=ex(e.g),this.b=ex(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=U){return ev.fromWorkingColorSpace(tz.copy(this),e),65536*Math.round(Z(255*tz.r,0,255))+256*Math.round(Z(255*tz.g,0,255))+Math.round(Z(255*tz.b,0,255))}getHexString(e=U){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ev.workingColorSpace){let i,n;ev.fromWorkingColorSpace(tz.copy(this),t);let r=tz.r,a=tz.g,s=tz.b,o=Math.max(r,a,s),l=Math.min(r,a,s),c=(l+o)/2;if(l===o)i=0,n=0;else{let e=o-l;switch(n=c<=.5?e/(o+l):e/(2-o-l),o){case r:i=(a-s)/e+(a<s?6:0);break;case a:i=(s-r)/e+2;break;case s:i=(r-a)/e+4}i/=6}return e.h=i,e.s=n,e.l=c,e}getRGB(e,t=ev.workingColorSpace){return ev.fromWorkingColorSpace(tz.copy(this),t),e.r=tz.r,e.g=tz.g,e.b=tz.b,e}getStyle(e=U){ev.fromWorkingColorSpace(tz.copy(this),e);let t=tz.r,i=tz.g,n=tz.b;return e!==U?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(e,t,i){return this.getHSL(tN),this.setHSL(tN.h+e,tN.s+t,tN.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(tN),e.getHSL(tU);let i=ee(tN.h,tU.h,t),n=ee(tN.s,tU.s,t),r=ee(tN.l,tU.l,t);return this.setHSL(i,n,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,i=this.g,n=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*n,this.g=r[1]*t+r[4]*i+r[7]*n,this.b=r[2]*t+r[5]*i+r[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let tz=new tk;tk.NAMES=tO;let tH=0;class tV extends q{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:tH++}),this.uuid=J(),this.name="",this.type="Material",this.blending=c,this.side=s,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=u,this.blendDst=d,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new tk(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let n=this[t];if(void 0===n){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==c&&(i.blending=this.blending),this.side!==s&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),this.blendSrc!==u&&(i.blendSrc=this.blendSrc),this.blendDst!==d&&(i.blendDst=this.blendDst),100!==this.blendEquation&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(i.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(i.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){let t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(null!==t){let e=t.length;i=Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class tG extends tV{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new tk(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}let tW=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(n[e]=0,n[256|e]=32768,r[e]=24,r[256|e]=24):t<-14?(n[e]=1024>>-t-14,n[256|e]=1024>>-t-14|32768,r[e]=-t-1,r[256|e]=-t-1):t<=15?(n[e]=t+15<<10,n[256|e]=t+15<<10|32768,r[e]=13,r[256|e]=13):t<128?(n[e]=31744,n[256|e]=64512,r[e]=24,r[256|e]=24):(n[e]=31744,n[256|e]=64512,r[e]=13,r[256|e]=13)}let a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,i=0;for(;(8388608&t)==0;)t<<=1,i-=8388608;t&=-8388609,i+=0x38800000,a[e]=t|i}for(let e=1024;e<2048;++e)a[e]=0x38000000+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=0x47800000,s[32]=0x80000000;for(let e=33;e<63;++e)s[e]=0x80000000+(e-32<<23);s[63]=0xc7800000;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:a,exponentTable:s,offsetTable:o}}(),tj={toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Z(e,-65504,65504),tW.floatView[0]=e;let t=tW.uint32View[0],i=t>>23&511;return tW.baseTable[i]+((8388607&t)>>tW.shiftTable[i])},fromHalfFloat:function(e){let t=e>>10;return tW.uint32View[0]=tW.mantissaTable[tW.offsetTable[t]+(1023&e)]+tW.exponentTable[t],tW.floatView[0]}},tq=new eI,tX=new es;class tY{constructor(e,t,i=!1){if(Array.isArray(e))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=M,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)tX.fromBufferAttribute(this,t),tX.applyMatrix3(e),this.setXY(t,tX.x,tX.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)tq.fromBufferAttribute(this,t),tq.applyMatrix3(e),this.setXYZ(t,tq.x,tq.y,tq.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)tq.fromBufferAttribute(this,t),tq.applyMatrix4(e),this.setXYZ(t,tq.x,tq.y,tq.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)tq.fromBufferAttribute(this,t),tq.applyNormalMatrix(e),this.setXYZ(t,tq.x,tq.y,tq.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)tq.fromBufferAttribute(this,t),tq.transformDirection(e),this.setXYZ(t,tq.x,tq.y,tq.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=en(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=er(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=en(t,this.array)),t}setX(e,t){return this.normalized&&(t=er(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=en(t,this.array)),t}setY(e,t){return this.normalized&&(t=er(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=en(t,this.array)),t}setZ(e,t){return this.normalized&&(t=er(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=en(t,this.array)),t}setW(e,t){return this.normalized&&(t=er(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=er(t,this.array),i=er(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=er(t,this.array),i=er(i,this.array),n=er(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=er(t,this.array),i=er(i,this.array),n=er(n,this.array),r=er(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),e}}class tK extends tY{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class tQ extends tY{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class tJ extends tY{constructor(e,t,i){super(new Float32Array(e),t,i)}}let tZ=0,t$=new e8,t0=new tb,t1=new eI,t2=new eB,t3=new eB,t4=new eI;class t5 extends q{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:tZ++}),this.uuid=J(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ec(e)?tQ:tK)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let t=new eo().getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return t$.makeRotationFromQuaternion(e),this.applyMatrix4(t$),this}rotateX(e){return t$.makeRotationX(e),this.applyMatrix4(t$),this}rotateY(e){return t$.makeRotationY(e),this.applyMatrix4(t$),this}rotateZ(e){return t$.makeRotationZ(e),this.applyMatrix4(t$),this}translate(e,t,i){return t$.makeTranslation(e,t,i),this.applyMatrix4(t$),this}scale(e,t,i){return t$.makeScale(e,t,i),this.applyMatrix4(t$),this}lookAt(e){return t0.lookAt(e),t0.updateMatrix(),this.applyMatrix4(t0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(t1).negate(),this.translate(t1.x,t1.y,t1.z),this}setFromPoints(e){let t=[];for(let i=0,n=e.length;i<n;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new tJ(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new eB);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new eI(-1/0,-1/0,-1/0),new eI(Infinity,Infinity,Infinity));return}if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){let i=t[e];t2.setFromBufferAttribute(i),this.morphTargetsRelative?(t4.addVectors(this.boundingBox.min,t2.min),this.boundingBox.expandByPoint(t4),t4.addVectors(this.boundingBox.max,t2.max),this.boundingBox.expandByPoint(t4)):(this.boundingBox.expandByPoint(t2.min),this.boundingBox.expandByPoint(t2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new eZ);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new eI,1/0);return}if(e){let i=this.boundingSphere.center;if(t2.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){let i=t[e];t3.setFromBufferAttribute(i),this.morphTargetsRelative?(t4.addVectors(t2.min,t3.min),t2.expandByPoint(t4),t4.addVectors(t2.max,t3.max),t2.expandByPoint(t4)):(t2.expandByPoint(t3.min),t2.expandByPoint(t3.max))}t2.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)t4.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(t4));if(t)for(let r=0,a=t.length;r<a;r++){let a=t[r],s=this.morphTargetsRelative;for(let t=0,r=a.count;t<r;t++)t4.fromBufferAttribute(a,t),s&&(t1.fromBufferAttribute(e,t),t4.add(t1)),n=Math.max(n,i.distanceToSquared(t4))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,n=t.position.array,r=t.normal.array,a=t.uv.array,s=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new tY(new Float32Array(4*s),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let e=0;e<s;e++)l[e]=new eI,c[e]=new eI;let h=new eI,u=new eI,d=new eI,p=new es,f=new es,m=new es,g=new eI,v=new eI,y=this.groups;0===y.length&&(y=[{start:0,count:i.length}]);for(let e=0,t=y.length;e<t;++e){let t=y[e],r=t.start,s=t.count;for(let e=r,t=r+s;e<t;e+=3)!function(e,t,i){h.fromArray(n,3*e),u.fromArray(n,3*t),d.fromArray(n,3*i),p.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*i),u.sub(h),d.sub(h),f.sub(p),m.sub(p);let r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(v),c[t].add(v),c[i].add(v))}(i[e+0],i[e+1],i[e+2])}let x=new eI,_=new eI,A=new eI,b=new eI;function S(e){A.fromArray(r,3*e),b.copy(A);let t=l[e];x.copy(t),x.sub(A.multiplyScalar(A.dot(t))).normalize(),_.crossVectors(b,t);let i=_.dot(c[e]);o[4*e]=x.x,o[4*e+1]=x.y,o[4*e+2]=x.z,o[4*e+3]=i<0?-1:1}for(let e=0,t=y.length;e<t;++e){let t=y[e],n=t.start,r=t.count;for(let e=n,t=n+r;e<t;e+=3)S(i[e+0]),S(i[e+1]),S(i[e+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new tY(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);let n=new eI,r=new eI,a=new eI,s=new eI,o=new eI,l=new eI,c=new eI,h=new eI;if(e)for(let u=0,d=e.count;u<d;u+=3){let d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);n.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),c.subVectors(a,r),h.subVectors(n,r),c.cross(h),s.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),s.add(c),o.add(c),l.add(c),i.setXYZ(d,s.x,s.y,s.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,r),h.subVectors(n,r),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)t4.fromBufferAttribute(e,t),t4.normalize(),e.setXYZ(t,t4.x,t4.y,t4.z)}toNonIndexed(){function e(e,t){let i=e.array,n=e.itemSize,r=e.normalized,a=new i.constructor(t.length*n),s=0,o=0;for(let r=0,l=t.length;r<l;r++){s=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*n;for(let e=0;e<n;e++)a[o++]=i[s++]}return new tY(a,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new t5,i=this.index.array,n=this.attributes;for(let r in n){let a=e(n[r],i);t.setAttribute(r,a)}let r=this.morphAttributes;for(let n in r){let a=[],s=r[n];for(let t=0,n=s.length;t<n;t++){let n=e(s[t],i);a.push(n)}t.morphAttributes[n]=a}t.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,i=a.length;e<i;e++){let i=a[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let t in i){let n=i[t];e.data.attributes[t]=n.toJSON(e.data)}let n={},r=!1;for(let t in this.morphAttributes){let i=this.morphAttributes[t],a=[];for(let t=0,n=i.length;t<n;t++){let n=i[t];a.push(n.toJSON(e.data))}a.length>0&&(n[t]=a,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;null!==i&&this.setIndex(i.clone(t));let n=e.attributes;for(let e in n){let i=n[e];this.setAttribute(e,i.clone(t))}let r=e.morphAttributes;for(let e in r){let i=[],n=r[e];for(let e=0,r=n.length;e<r;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,t=a.length;e<t;e++){let t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}let s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let t6=new e8,t8=new e6,t9=new eZ,t7=new eI,ie=new eI,it=new eI,ii=new eI,ir=new eI,ia=new eI,is=new es,io=new es,il=new es,ic=new eI,ih=new eI,iu=new eI,id=new eI,ip=new eI;class im extends tb{constructor(e=new t5,t=new tG){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(n,e);let s=this.morphTargetInfluences;if(r&&s){ia.set(0,0,0);for(let i=0,n=r.length;i<n;i++){let n=s[i],o=r[i];0!==n&&(ir.fromBufferAttribute(o,e),a?ia.addScaledVector(ir,n):ia.addScaledVector(ir.sub(t),n))}t.add(ia)}return t}raycast(e,t){let i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),t9.copy(i.boundingSphere),t9.applyMatrix4(r),t8.copy(e.ray).recast(e.near),!1===t9.containsPoint(t8.origin)&&(null===t8.intersectSphere(t9,t7)||t8.origin.distanceToSquared(t7)>(e.far-e.near)**2)||(t6.copy(r).invert(),t8.copy(e.ray).applyMatrix4(t6),null!==i.boundingBox&&!1===t8.intersectsBox(i.boundingBox)))return;this._computeIntersections(e,t,t8)}}_computeIntersections(e,t,i){let n;let r=this.geometry,a=this.material,s=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==s){if(Array.isArray(a))for(let r=0,o=u.length;r<o;r++){let o=u[r],p=a[o.materialIndex],f=Math.max(o.start,d.start),m=Math.min(s.count,Math.min(o.start+o.count,d.start+d.count));for(let r=f;r<m;r+=3){let a=s.getX(r);(n=ig(this,p,e,i,l,c,h,a,s.getX(r+1),s.getX(r+2)))&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=o.materialIndex,t.push(n))}}else{let r=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);for(let u=r;u<o;u+=3){let r=s.getX(u);(n=ig(this,a,e,i,l,c,h,r,s.getX(u+1),s.getX(u+2)))&&(n.faceIndex=Math.floor(u/3),t.push(n))}}}else if(void 0!==o){if(Array.isArray(a))for(let r=0,s=u.length;r<s;r++){let s=u[r],p=a[s.materialIndex],f=Math.max(s.start,d.start),m=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));for(let r=f;r<m;r+=3)(n=ig(this,p,e,i,l,c,h,r,r+1,r+2))&&(n.faceIndex=Math.floor(r/3),n.face.materialIndex=s.materialIndex,t.push(n))}else{let r=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);for(let o=r;o<s;o+=3)(n=ig(this,a,e,i,l,c,h,o,o+1,o+2))&&(n.faceIndex=Math.floor(o/3),t.push(n))}}}}function ig(e,t,i,n,r,a,o,l,c,h){e.getVertexPosition(l,ie),e.getVertexPosition(c,it),e.getVertexPosition(h,ii);let u=function(e,t,i,n,r,a,o,l){let c;if(null===(1===t.side?n.intersectTriangle(o,a,r,!0,l):n.intersectTriangle(r,a,o,t.side===s,l)))return null;ip.copy(l),ip.applyMatrix4(e.matrixWorld);let h=i.ray.origin.distanceTo(ip);return h<i.near||h>i.far?null:{distance:h,point:ip.clone(),object:e}}(e,t,i,n,ie,it,ii,id);if(u){r&&(is.fromBufferAttribute(r,l),io.fromBufferAttribute(r,c),il.fromBufferAttribute(r,h),u.uv=tB.getInterpolation(id,ie,it,ii,is,io,il,new es)),a&&(is.fromBufferAttribute(a,l),io.fromBufferAttribute(a,c),il.fromBufferAttribute(a,h),u.uv1=tB.getInterpolation(id,ie,it,ii,is,io,il,new es),u.uv2=u.uv1),o&&(ic.fromBufferAttribute(o,l),ih.fromBufferAttribute(o,c),iu.fromBufferAttribute(o,h),u.normal=tB.getInterpolation(id,ie,it,ii,ic,ih,iu,new eI),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));let e={a:l,b:c,c:h,normal:new eI,materialIndex:0};tB.getNormal(ie,it,ii,e.normal),u.face=e}return u}class iv extends t5{constructor(e=1,t=1,i=1,n=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};let s=this;n=Math.floor(n),r=Math.floor(r);let o=[],l=[],c=[],h=[],u=0,d=0;function p(e,t,i,n,r,a,p,f,m,g,v){let y=a/m,x=p/g,_=a/2,A=p/2,b=f/2,S=m+1,w=g+1,M=0,E=0,C=new eI;for(let a=0;a<w;a++){let s=a*x-A;for(let o=0;o<S;o++){let u=o*y-_;C[e]=u*n,C[t]=s*r,C[i]=b,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[i]=f>0?1:-1,c.push(C.x,C.y,C.z),h.push(o/m),h.push(1-a/g),M+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){let i=u+t+S*e,n=u+t+S*(e+1),r=u+(t+1)+S*(e+1),a=u+(t+1)+S*e;o.push(i,n,a),o.push(n,r,a),E+=6}s.addGroup(d,E,v),d+=E,u+=M}p("z","y","x",-1,-1,i,t,e,a=Math.floor(a),r,0),p("z","y","x",1,-1,i,t,-e,a,r,1),p("x","z","y",1,1,e,i,t,n,a,2),p("x","z","y",1,-1,e,i,-t,n,a,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new tJ(l,3)),this.setAttribute("normal",new tJ(c,3)),this.setAttribute("uv",new tJ(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iv(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function iy(e){let t={};for(let i in e)for(let n in t[i]={},e[i]){let r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][n]=null):t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}return t}function ix(e){let t={};for(let i=0;i<e.length;i++){let n=iy(e[i]);for(let e in n)t[e]=n[e]}return t}function i_(e){return null===e.getRenderTarget()?e.outputColorSpace:ev.workingColorSpace}let iA={clone:iy,merge:ix};class ib extends tV{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=iy(e.uniforms),this.uniformsGroups=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);for(let i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){let n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;let i={};for(let e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class iS extends tb{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new e8,this.projectionMatrix=new e8,this.projectionMatrixInverse=new e8,this.coordinateSystem=2e3}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class iw extends iS{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*Q*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*K*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Q*Math.atan(Math.tan(.5*K*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*K*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,s=a.fullHeight;r+=a.offsetX*n/e,t-=a.offsetY*i/s,n*=a.width/e,i*=a.height/s}let s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class iM extends tb{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;let n=new iw(-90,1,e,t);n.layers=this.layers,this.add(n);let r=new iw(-90,1,e,t);r.layers=this.layers,this.add(r);let a=new iw(-90,1,e,t);a.layers=this.layers,this.add(a);let s=new iw(-90,1,e,t);s.layers=this.layers,this.add(s);let o=new iw(-90,1,e,t);o.layers=this.layers,this.add(o);let l=new iw(-90,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){let e=this.coordinateSystem,t=this.children.concat(),[i,n,r,a,s,o]=t;for(let e of t)this.remove(e);if(2e3===e)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else if(2001===e)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1);else throw Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(let e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();let{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[r,a,s,o,l,c]=this.children,h=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;let f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,r),e.setRenderTarget(i,1,n),e.render(t,a),e.setRenderTarget(i,2,n),e.render(t,s),e.setRenderTarget(i,3,n),e.render(t,o),e.setRenderTarget(i,4,n),e.render(t,l),i.texture.generateMipmaps=f,e.setRenderTarget(i,5,n),e.render(t,c),e.setRenderTarget(h,u,d),e.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class iE extends eM{constructor(e,t,i,n,r,a,s,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:301,i,n,r,a,s,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class iC extends eT{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1};void 0!==t.encoding&&(ed("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=3001===t.encoding?U:""),this.texture=new iE([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:_}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new iv(5,5,5),r=new ib({name:"CubemapFromEquirect",uniforms:iy(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:l});r.uniforms.tEquirect.value=t;let a=new im(n,r),s=t.minFilter;return t.minFilter===b&&(t.minFilter=_),new iM(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,n){let r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,n);e.setRenderTarget(r)}}let iT=new eI,iR=new eI,iP=new eo;class iI{constructor(e=new eI(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let n=iT.subVectors(i,t).cross(iR.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let i=e.delta(iT),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||iP.getNormalMatrix(e),n=this.coplanarPoint(iT).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}let iL=new eZ,iD=new eI;class iB{constructor(e=new iI,t=new iI,i=new iI,n=new iI,r=new iI,a=new iI){this.planes=[e,t,i,n,r,a]}set(e,t,i,n,r,a){let s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=2e3){let i=this.planes,n=e.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],c=n[5],h=n[6],u=n[7],d=n[8],p=n[9],f=n[10],m=n[11],g=n[12],v=n[13],y=n[14],x=n[15];if(i[0].setComponents(o-r,u-l,m-d,x-g).normalize(),i[1].setComponents(o+r,u+l,m+d,x+g).normalize(),i[2].setComponents(o+a,u+c,m+p,x+v).normalize(),i[3].setComponents(o-a,u-c,m-p,x-v).normalize(),i[4].setComponents(o-s,u-h,m-f,x-y).normalize(),2e3===t)i[5].setComponents(o+s,u+h,m+f,x+y).normalize();else if(2001===t)i[5].setComponents(s,h,f,y).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),iL.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),iL.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(iL)}intersectsSprite(e){return iL.center.set(0,0,0),iL.radius=.7071067811865476,iL.applyMatrix4(e.matrixWorld),this.intersectsSphere(iL)}intersectsSphere(e){let t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let n=t[i];if(iD.x=n.normal.x>0?e.max.x:e.min.x,iD.y=n.normal.y>0?e.max.y:e.min.y,iD.z=n.normal.z>0?e.max.z:e.min.z,0>n.distanceToPoint(iD))return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(0>t[i].distanceToPoint(e))return!1;return!0}clone(){return new this.constructor().copy(this)}}function iO(){let e=null,t=!1,i=null,n=null;function r(t,a){i(t,a),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function iN(e,t){let i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){let e=n.get(t);(!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version});return}t.isInterleavedBufferAttribute&&(t=t.data);let a=n.get(t);if(void 0===a)n.set(t,function(t,n){let r;let a=t.array,s=t.usage,o=a.byteLength,l=e.createBuffer();if(e.bindBuffer(n,l),e.bufferData(n,a,s),t.onUploadCallback(),a instanceof Float32Array)r=e.FLOAT;else if(a instanceof Uint16Array){if(t.isFloat16BufferAttribute){if(i)r=e.HALF_FLOAT;else throw Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.")}else r=e.UNSIGNED_SHORT}else if(a instanceof Int16Array)r=e.SHORT;else if(a instanceof Uint32Array)r=e.UNSIGNED_INT;else if(a instanceof Int32Array)r=e.INT;else if(a instanceof Int8Array)r=e.BYTE;else if(a instanceof Uint8Array)r=e.UNSIGNED_BYTE;else if(a instanceof Uint8ClampedArray)r=e.UNSIGNED_BYTE;else throw Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);return{buffer:l,type:r,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version,size:o}}(t,r));else if(a.version<t.version){if(a.size!==t.array.byteLength)throw Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){let a=n.array,s=n._updateRange,o=n.updateRanges;if(e.bindBuffer(r,t),-1===s.count&&0===o.length&&e.bufferSubData(r,0,a),0!==o.length){for(let t=0,n=o.length;t<n;t++){let n=o[t];i?e.bufferSubData(r,n.start*a.BYTES_PER_ELEMENT,a,n.start,n.count):e.bufferSubData(r,n.start*a.BYTES_PER_ELEMENT,a.subarray(n.start,n.start+n.count))}n.clearUpdateRanges()}-1!==s.count&&(i?e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),n.onUploadCallback()}(a.buffer,t,r),a.version=t.version}}}}class iU extends t5{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};let r=e/2,a=t/2,s=Math.floor(i),o=Math.floor(n),l=s+1,c=o+1,h=e/s,u=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){let t=e*u-a;for(let i=0;i<l;i++){let n=i*h-r;p.push(n,-t,0),f.push(0,0,1),m.push(i/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){let i=t+l*e,n=t+l*(e+1),r=t+1+l*(e+1),a=t+1+l*e;d.push(i,n,a),d.push(n,r,a)}this.setIndex(d),this.setAttribute("position",new tJ(p,3)),this.setAttribute("normal",new tJ(f,3)),this.setAttribute("uv",new tJ(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iU(e.width,e.height,e.widthSegments,e.heightSegments)}}let iF={alphahash_fragment:"#ifdef USE_ALPHAHASH\n	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n	const float ALPHA_HASH_SCALE = 0.05;\n	float hash2D( vec2 value ) {\n		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n	}\n	float hash3D( vec3 value ) {\n		return hash2D( vec2( hash2D( value.xy ), value.z ) );\n	}\n	float getAlphaHashThreshold( vec3 position ) {\n		float maxDeriv = max(\n			length( dFdx( position.xyz ) ),\n			length( dFdy( position.xyz ) )\n		);\n		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n		vec2 pixScales = vec2(\n			exp2( floor( log2( pixScale ) ) ),\n			exp2( ceil( log2( pixScale ) ) )\n		);\n		vec2 alpha = vec2(\n			hash3D( floor( pixScales.x * position.xyz ) ),\n			hash3D( floor( pixScales.y * position.xyz ) )\n		);\n		float lerpFactor = fract( log2( pixScale ) );\n		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n		float a = min( lerpFactor, 1.0 - lerpFactor );\n		vec3 cases = vec3(\n			x * x / ( 2.0 * a * ( 1.0 - a ) ),\n			( x - 0.5 * a ) / ( 1.0 - a ),\n			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n		);\n		float threshold = ( x < ( 1.0 - a ) )\n			? ( ( x < a ) ? cases.x : cases.y )\n			: cases.z;\n		return clamp( threshold , 1.0e-6, 1.0 );\n	}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n	if ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n	uniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n	reflectedLight.indirectDiffuse *= ambientOcclusion;\n	#if defined( USE_CLEARCOAT ) \n		clearcoatSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_SHEEN ) \n		sheenSpecularIndirect *= ambientOcclusion;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD )\n		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n	#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n	attribute float batchId;\n	uniform highp sampler2D batchingTexture;\n	mat4 getBatchingMatrix( const in float i ) {\n		int size = textureSize( batchingTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n	mat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n	vPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n	vec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n	return 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( specularColor, 1.0, dotVH );\n	float G = G_BlinnPhong_Implicit( );\n	float D = D_BlinnPhong( shininess, dotNH );\n	return F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n	const mat3 XYZ_TO_REC709 = mat3(\n		 3.2404542, -0.9692660,  0.0556434,\n		-1.5371385,  1.8760108, -0.2040259,\n		-0.4985314,  0.0415560,  1.0572252\n	);\n	vec3 Fresnel0ToIor( vec3 fresnel0 ) {\n		vec3 sqrtF0 = sqrt( fresnel0 );\n		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n	}\n	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n	}\n	float IorToFresnel0( float transmittedIor, float incidentIor ) {\n		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n	}\n	vec3 evalSensitivity( float OPD, vec3 shift ) {\n		float phase = 2.0 * PI * OPD * 1.0e-9;\n		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n		xyz /= 1.0685e-7;\n		vec3 rgb = XYZ_TO_REC709 * xyz;\n		return rgb;\n	}\n	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n		vec3 I;\n		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n		float cosTheta2Sq = 1.0 - sinTheta2Sq;\n		if ( cosTheta2Sq < 0.0 ) {\n			return vec3( 1.0 );\n		}\n		float cosTheta2 = sqrt( cosTheta2Sq );\n		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n		float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n		float T121 = 1.0 - R12;\n		float phi12 = 0.0;\n		if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n		float phi21 = PI - phi12;\n		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n		vec3 phi23 = vec3( 0.0 );\n		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n		vec3 phi = vec3( phi21 ) + phi23;\n		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n		vec3 r123 = sqrt( R123 );\n		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n		vec3 C0 = R12 + Rs;\n		I = C0;\n		vec3 Cm = Rs - T121;\n		for ( int m = 1; m <= 2; ++ m ) {\n			Cm *= r123;\n			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n			I += Cm * Sm;\n		}\n		return max( I, vec3( 0.0 ) );\n	}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vBumpMapUv );\n		vec2 dSTdy = dFdy( vBumpMapUv );\n		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 ) * faceDirection;\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n	vec4 plane;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n		plane = clippingPlanes[ i ];\n		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n	}\n	#pragma unroll_loop_end\n	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n		bool clipped = true;\n		#pragma unroll_loop_start\n		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n			plane = clippingPlanes[ i ];\n			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n		}\n		#pragma unroll_loop_end\n		if ( clipped ) discard;\n	#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n	varying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n	vClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n	diffuseColor *= vColor;\n#elif defined( USE_COLOR )\n	diffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR )\n	varying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n	varying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	varying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n	vColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n	vColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n	vColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n	vColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n	const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n	return fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n	float precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n	float precisionSafeLength( vec3 v ) {\n		float maxComponent = max3( abs( v ) );\n		return length( v / maxComponent ) * maxComponent;\n	}\n#endif\nstruct IncidentLight {\n	vec3 color;\n	vec3 direction;\n	bool visible;\n};\nstruct ReflectedLight {\n	vec3 directDiffuse;\n	vec3 directSpecular;\n	vec3 indirectDiffuse;\n	vec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n	varying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n	mat3 tmp;\n	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n	return tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n	return dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n	return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n	return vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n	return RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n	#define cubeUV_minMipLevel 4.0\n	#define cubeUV_minTileSize 16.0\n	float getFace( vec3 direction ) {\n		vec3 absDirection = abs( direction );\n		float face = - 1.0;\n		if ( absDirection.x > absDirection.z ) {\n			if ( absDirection.x > absDirection.y )\n				face = direction.x > 0.0 ? 0.0 : 3.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		} else {\n			if ( absDirection.z > absDirection.y )\n				face = direction.z > 0.0 ? 2.0 : 5.0;\n			else\n				face = direction.y > 0.0 ? 1.0 : 4.0;\n		}\n		return face;\n	}\n	vec2 getUV( vec3 direction, float face ) {\n		vec2 uv;\n		if ( face == 0.0 ) {\n			uv = vec2( direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 1.0 ) {\n			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n		} else if ( face == 2.0 ) {\n			uv = vec2( - direction.x, direction.y ) / abs( direction.z );\n		} else if ( face == 3.0 ) {\n			uv = vec2( - direction.z, direction.y ) / abs( direction.x );\n		} else if ( face == 4.0 ) {\n			uv = vec2( - direction.x, direction.z ) / abs( direction.y );\n		} else {\n			uv = vec2( direction.x, direction.y ) / abs( direction.z );\n		}\n		return 0.5 * ( uv + 1.0 );\n	}\n	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n		float face = getFace( direction );\n		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n		mipInt = max( mipInt, cubeUV_minMipLevel );\n		float faceSize = exp2( mipInt );\n		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n		if ( face > 2.0 ) {\n			uv.y += faceSize;\n			face -= 3.0;\n		}\n		uv.x += face * faceSize;\n		uv.x += filterInt * 3.0 * cubeUV_minTileSize;\n		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n		uv.x *= CUBEUV_TEXEL_WIDTH;\n		uv.y *= CUBEUV_TEXEL_HEIGHT;\n		#ifdef texture2DGradEXT\n			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n		#else\n			return texture2D( envMap, uv ).rgb;\n		#endif\n	}\n	#define cubeUV_r0 1.0\n	#define cubeUV_m0 - 2.0\n	#define cubeUV_r1 0.8\n	#define cubeUV_m1 - 1.0\n	#define cubeUV_r4 0.4\n	#define cubeUV_m4 2.0\n	#define cubeUV_r5 0.305\n	#define cubeUV_m5 3.0\n	#define cubeUV_r6 0.21\n	#define cubeUV_m6 4.0\n	float roughnessToMip( float roughness ) {\n		float mip = 0.0;\n		if ( roughness >= cubeUV_r1 ) {\n			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n		} else if ( roughness >= cubeUV_r4 ) {\n			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n		} else if ( roughness >= cubeUV_r5 ) {\n			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n		} else if ( roughness >= cubeUV_r6 ) {\n			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n		} else {\n			mip = - 2.0 * log2( 1.16 * roughness );		}\n		return mip;\n	}\n	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n		float mipF = fract( mip );\n		float mipInt = floor( mip );\n		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n		if ( mipF == 0.0 ) {\n			return vec4( color0, 1.0 );\n		} else {\n			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n			return vec4( mix( color0, color1, mipF ), 1.0 );\n		}\n	}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n	vec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n	mat3 bm = mat3( batchingMatrix );\n	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n	transformedNormal = bm * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = bm * transformedTangent;\n	#endif\n#endif\n#ifdef USE_INSTANCING\n	mat3 im = mat3( instanceMatrix );\n	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n	transformedNormal = im * transformedNormal;\n	#ifdef USE_TANGENT\n		transformedTangent = im * transformedTangent;\n	#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n	transformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n	#ifdef FLIP_SIDED\n		transformedTangent = - transformedTangent;\n	#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n	totalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n	uniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n	vec3( 0.8224621, 0.177538, 0.0 ),\n	vec3( 0.0331941, 0.9668058, 0.0 ),\n	vec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n	vec3( 1.2249401, - 0.2249404, 0.0 ),\n	vec3( - 0.0420569, 1.0420571, 0.0 ),\n	vec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n	return value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n	return value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n	return sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vec3 cameraToFrag;\n		if ( isOrthographic ) {\n			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToFrag = normalize( vWorldPosition - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vec3 reflectVec = reflect( cameraToFrag, worldNormal );\n		#else\n			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n		#endif\n	#else\n		vec3 reflectVec = vReflect;\n	#endif\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 envColor = vec4( 0.0 );\n	#endif\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_MIX )\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n	#elif defined( ENVMAP_BLENDING_ADD )\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n	#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float envMapIntensity;\n	uniform float flipEnvMap;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		varying vec3 vWorldPosition;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n		#define ENV_WORLDPOS\n	#endif\n	#ifdef ENV_WORLDPOS\n		\n		varying vec3 vWorldPosition;\n	#else\n		varying vec3 vReflect;\n		uniform float refractionRatio;\n	#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n	vec3 getIBLIrradiance( const in vec3 normal ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n			return PI * envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n		#ifdef ENVMAP_TYPE_CUBE_UV\n			vec3 reflectVec = reflect( - viewDir, normal );\n			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n			return envMapColor.rgb * envMapIntensity;\n		#else\n			return vec3( 0.0 );\n		#endif\n	}\n	#ifdef USE_ANISOTROPY\n		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n			#ifdef ENVMAP_TYPE_CUBE_UV\n				vec3 bentNormal = cross( bitangent, viewDir );\n				bentNormal = normalize( cross( bentNormal, bitangent ) );\n				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n				return getIBLRadiance( viewDir, bentNormal, roughness );\n			#else\n				return vec3( 0.0 );\n			#endif\n		}\n	#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n	#ifdef ENV_WORLDPOS\n		vWorldPosition = worldPosition.xyz;\n	#else\n		vec3 cameraToVertex;\n		if ( isOrthographic ) {\n			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n		} else {\n			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n		}\n		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n		#ifdef ENVMAP_MODE_REFLECTION\n			vReflect = reflect( cameraToVertex, worldNormal );\n		#else\n			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n		#endif\n	#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n	vFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n	varying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef FOG_EXP2\n		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n	#endif\n	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	varying float vFogDepth;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n	uniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n	float dotNL = dot( normal, lightDirection );\n	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n	#ifdef USE_GRADIENTMAP\n		return vec3( texture2D( gradientMap, coord ).r );\n	#else\n		vec2 fw = fwidth( coord ) * 0.5;\n		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n	#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n	reflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n	vec3 diffuseColor;\n	float specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Lambert\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n	uniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n	float x = normal.x, y = normal.y, z = normal.z;\n	vec3 result = shCoefficients[ 0 ] * 0.886227;\n	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n	return result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n	return irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n	vec3 irradiance = ambientLightColor;\n	return irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n	#if defined ( LEGACY_LIGHTS )\n		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n		}\n		return 1.0;\n	#else\n		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n		if ( cutoffDistance > 0.0 ) {\n			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n		}\n		return distanceFalloff;\n	#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n	return smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n	struct DirectionalLight {\n		vec3 direction;\n		vec3 color;\n	};\n	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n		light.color = directionalLight.color;\n		light.direction = directionalLight.direction;\n		light.visible = true;\n	}\n#endif\n#if NUM_POINT_LIGHTS > 0\n	struct PointLight {\n		vec3 position;\n		vec3 color;\n		float distance;\n		float decay;\n	};\n	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = pointLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float lightDistance = length( lVector );\n		light.color = pointLight.color;\n		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n		light.visible = ( light.color != vec3( 0.0 ) );\n	}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n	struct SpotLight {\n		vec3 position;\n		vec3 direction;\n		vec3 color;\n		float distance;\n		float decay;\n		float coneCos;\n		float penumbraCos;\n	};\n	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n		vec3 lVector = spotLight.position - geometryPosition;\n		light.direction = normalize( lVector );\n		float angleCos = dot( light.direction, spotLight.direction );\n		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n		if ( spotAttenuation > 0.0 ) {\n			float lightDistance = length( lVector );\n			light.color = spotLight.color * spotAttenuation;\n			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n			light.visible = ( light.color != vec3( 0.0 ) );\n		} else {\n			light.color = vec3( 0.0 );\n			light.visible = false;\n		}\n	}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n	struct RectAreaLight {\n		vec3 color;\n		vec3 position;\n		vec3 halfWidth;\n		vec3 halfHeight;\n	};\n	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;\n	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n	struct HemisphereLight {\n		vec3 direction;\n		vec3 skyColor;\n		vec3 groundColor;\n	};\n	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n		float dotNL = dot( normal, hemiLight.direction );\n		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n		return irradiance;\n	}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n	vec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_Toon\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n	vec3 diffuseColor;\n	vec3 specularColor;\n	float specularShininess;\n	float specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct				RE_Direct_BlinnPhong\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n	material.ior = ior;\n	#ifdef USE_SPECULAR\n		float specularIntensityFactor = specularIntensity;\n		vec3 specularColorFactor = specularColor;\n		#ifdef USE_SPECULAR_COLORMAP\n			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n		#endif\n		#ifdef USE_SPECULAR_INTENSITYMAP\n			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n		#endif\n		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n	#else\n		float specularIntensityFactor = 1.0;\n		vec3 specularColorFactor = vec3( 1.0 );\n		material.specularF90 = 1.0;\n	#endif\n	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n	material.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n	material.clearcoat = clearcoat;\n	material.clearcoatRoughness = clearcoatRoughness;\n	material.clearcoatF0 = vec3( 0.04 );\n	material.clearcoatF90 = 1.0;\n	#ifdef USE_CLEARCOATMAP\n		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n	#endif\n	#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n	#endif\n	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n	material.clearcoatRoughness += geometryRoughness;\n	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n	material.iridescence = iridescence;\n	material.iridescenceIOR = iridescenceIOR;\n	#ifdef USE_IRIDESCENCEMAP\n		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n	#endif\n	#ifdef USE_IRIDESCENCE_THICKNESSMAP\n		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n	#else\n		material.iridescenceThickness = iridescenceThicknessMaximum;\n	#endif\n#endif\n#ifdef USE_SHEEN\n	material.sheenColor = sheenColor;\n	#ifdef USE_SHEEN_COLORMAP\n		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n	#endif\n	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	#ifdef USE_ANISOTROPYMAP\n		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n	#else\n		vec2 anisotropyV = anisotropyVector;\n	#endif\n	material.anisotropy = length( anisotropyV );\n	if( material.anisotropy == 0.0 ) {\n		anisotropyV = vec2( 1.0, 0.0 );\n	} else {\n		anisotropyV /= material.anisotropy;\n		material.anisotropy = saturate( material.anisotropy );\n	}\n	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n	vec3 diffuseColor;\n	float roughness;\n	vec3 specularColor;\n	float specularF90;\n	#ifdef USE_CLEARCOAT\n		float clearcoat;\n		float clearcoatRoughness;\n		vec3 clearcoatF0;\n		float clearcoatF90;\n	#endif\n	#ifdef USE_IRIDESCENCE\n		float iridescence;\n		float iridescenceIOR;\n		float iridescenceThickness;\n		vec3 iridescenceFresnel;\n		vec3 iridescenceF0;\n	#endif\n	#ifdef USE_SHEEN\n		vec3 sheenColor;\n		float sheenRoughness;\n	#endif\n	#ifdef IOR\n		float ior;\n	#endif\n	#ifdef USE_TRANSMISSION\n		float transmission;\n		float transmissionAlpha;\n		float thickness;\n		float attenuationDistance;\n		vec3 attenuationColor;\n	#endif\n	#ifdef USE_ANISOTROPY\n		float anisotropy;\n		float alphaT;\n		vec3 anisotropyT;\n		vec3 anisotropyB;\n	#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n	float a2 = pow2( alpha );\n	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n	return 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n	float a2 = pow2( alpha );\n	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n	return RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n		float v = 0.5 / ( gv + gl );\n		return saturate(v);\n	}\n	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n		float a2 = alphaT * alphaB;\n		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n		highp float v2 = dot( v, v );\n		float w2 = a2 / v2;\n		return RECIPROCAL_PI * a2 * pow2 ( w2 );\n	}\n#endif\n#ifdef USE_CLEARCOAT\n	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n		vec3 f0 = material.clearcoatF0;\n		float f90 = material.clearcoatF90;\n		float roughness = material.clearcoatRoughness;\n		float alpha = pow2( roughness );\n		vec3 halfDir = normalize( lightDir + viewDir );\n		float dotNL = saturate( dot( normal, lightDir ) );\n		float dotNV = saturate( dot( normal, viewDir ) );\n		float dotNH = saturate( dot( normal, halfDir ) );\n		float dotVH = saturate( dot( viewDir, halfDir ) );\n		vec3 F = F_Schlick( f0, f90, dotVH );\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n		return F * ( V * D );\n	}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n	vec3 f0 = material.specularColor;\n	float f90 = material.specularF90;\n	float roughness = material.roughness;\n	float alpha = pow2( roughness );\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotVH = saturate( dot( viewDir, halfDir ) );\n	vec3 F = F_Schlick( f0, f90, dotVH );\n	#ifdef USE_IRIDESCENCE\n		F = mix( F, material.iridescenceFresnel, material.iridescence );\n	#endif\n	#ifdef USE_ANISOTROPY\n		float dotTL = dot( material.anisotropyT, lightDir );\n		float dotTV = dot( material.anisotropyT, viewDir );\n		float dotTH = dot( material.anisotropyT, halfDir );\n		float dotBL = dot( material.anisotropyB, lightDir );\n		float dotBV = dot( material.anisotropyB, viewDir );\n		float dotBH = dot( material.anisotropyB, halfDir );\n		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n	#else\n		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n		float D = D_GGX( alpha, dotNH );\n	#endif\n	return F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n	const float LUT_SIZE = 64.0;\n	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n	const float LUT_BIAS = 0.5 / LUT_SIZE;\n	float dotNV = saturate( dot( N, V ) );\n	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n	uv = uv * LUT_SCALE + LUT_BIAS;\n	return uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n	float l = length( f );\n	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n	float x = dot( v1, v2 );\n	float y = abs( x );\n	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n	float b = 3.4175940 + ( 4.1616724 + y ) * y;\n	float v = a / b;\n	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n	return cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n	vec3 lightNormal = cross( v1, v2 );\n	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n	vec3 T1, T2;\n	T1 = normalize( V - N * dot( V, N ) );\n	T2 = - cross( N, T1 );\n	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n	vec3 coords[ 4 ];\n	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n	coords[ 0 ] = normalize( coords[ 0 ] );\n	coords[ 1 ] = normalize( coords[ 1 ] );\n	coords[ 2 ] = normalize( coords[ 2 ] );\n	coords[ 3 ] = normalize( coords[ 3 ] );\n	vec3 vectorFormFactor = vec3( 0.0 );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n	return vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n	float alpha = pow2( roughness );\n	float invAlpha = 1.0 / alpha;\n	float cos2h = dotNH * dotNH;\n	float sin2h = max( 1.0 - cos2h, 0.0078125 );\n	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n	vec3 halfDir = normalize( lightDir + viewDir );\n	float dotNL = saturate( dot( normal, lightDir ) );\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float D = D_Charlie( sheenRoughness, dotNH );\n	float V = V_Neubelt( dotNV, dotNL );\n	return sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	float r2 = roughness * roughness;\n	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n	return saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n	float dotNV = saturate( dot( normal, viewDir ) );\n	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n	vec4 r = roughness * c0 + c1;\n	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n	return fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	return specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n	vec2 fab = DFGApprox( normal, viewDir, roughness );\n	#ifdef USE_IRIDESCENCE\n		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n	#else\n		vec3 Fr = specularColor;\n	#endif\n	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n	float Ess = fab.x + fab.y;\n	float Ems = 1.0 - Ess;\n	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n	singleScatter += FssEss;\n	multiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n		vec3 normal = geometryNormal;\n		vec3 viewDir = geometryViewDir;\n		vec3 position = geometryPosition;\n		vec3 lightPos = rectAreaLight.position;\n		vec3 halfWidth = rectAreaLight.halfWidth;\n		vec3 halfHeight = rectAreaLight.halfHeight;\n		vec3 lightColor = rectAreaLight.color;\n		float roughness = material.roughness;\n		vec3 rectCoords[ 4 ];\n		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n		vec2 uv = LTC_Uv( normal, viewDir, roughness );\n		vec4 t1 = texture2D( ltc_1, uv );\n		vec4 t2 = texture2D( ltc_2, uv );\n		mat3 mInv = mat3(\n			vec3( t1.x, 0, t1.y ),\n			vec3(    0, 1,    0 ),\n			vec3( t1.z, 0, t1.w )\n		);\n		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n	}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n	vec3 irradiance = dotNL * directLight.color;\n	#ifdef USE_CLEARCOAT\n		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n		vec3 ccIrradiance = dotNLcc * directLight.color;\n		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n	#endif\n	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n	#ifdef USE_CLEARCOAT\n		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n	#endif\n	#ifdef USE_SHEEN\n		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n	#endif\n	vec3 singleScattering = vec3( 0.0 );\n	vec3 multiScattering = vec3( 0.0 );\n	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n	#ifdef USE_IRIDESCENCE\n		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n	#else\n		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n	#endif\n	vec3 totalScattering = singleScattering + multiScattering;\n	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n	reflectedLight.indirectSpecular += radiance * singleScattering;\n	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct				RE_Direct_Physical\n#define RE_Direct_RectArea		RE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular		RE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n	geometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n	float dotNVi = saturate( dot( normal, geometryViewDir ) );\n	if ( material.iridescenceThickness == 0.0 ) {\n		material.iridescence = 0.0;\n	} else {\n		material.iridescence = saturate( material.iridescence );\n	}\n	if ( material.iridescence > 0.0 ) {\n		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n	}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n	PointLight pointLight;\n	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n		pointLight = pointLights[ i ];\n		getPointLightInfo( pointLight, geometryPosition, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n		pointLightShadow = pointLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n	SpotLight spotLight;\n	vec4 spotColor;\n	vec3 spotLightCoord;\n	bool inSpotLightMap;\n	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n		spotLight = spotLights[ i ];\n		getSpotLightInfo( spotLight, geometryPosition, directLight );\n		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n		#else\n		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n		#endif\n		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n		#endif\n		#undef SPOT_LIGHT_MAP_INDEX\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n		spotLightShadow = spotLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n	DirectionalLight directionalLight;\n	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLightShadow;\n	#endif\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n		directionalLight = directionalLights[ i ];\n		getDirectionalLightInfo( directionalLight, directLight );\n		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n		directionalLightShadow = directionalLightShadows[ i ];\n		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n		#endif\n		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n	RectAreaLight rectAreaLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n		rectAreaLight = rectAreaLights[ i ];\n		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n	}\n	#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n	vec3 iblIrradiance = vec3( 0.0 );\n	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n	#if defined( USE_LIGHT_PROBES )\n		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n	#endif\n	#if ( NUM_HEMI_LIGHTS > 0 )\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if defined( RE_IndirectSpecular )\n	vec3 radiance = vec3( 0.0 );\n	vec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n		irradiance += lightMapIrradiance;\n	#endif\n	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n		iblIrradiance += getIBLIrradiance( geometryNormal );\n	#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n	#ifdef USE_ANISOTROPY\n		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n	#else\n		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n	#endif\n	#ifdef USE_CLEARCOAT\n		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n	#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n	uniform float logDepthBufFC;\n	varying float vFragDepth;\n	varying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		varying float vFragDepth;\n		varying float vIsPerspective;\n	#else\n		uniform float logDepthBufFC;\n	#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		vFragDepth = 1.0 + gl_Position.w;\n		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n	#else\n		if ( isPerspectiveMatrix( projectionMatrix ) ) {\n			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n			gl_Position.z *= gl_Position.w;\n		}\n	#endif\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 sampledDiffuseColor = texture2D( map, vMapUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n	\n	#endif\n	diffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n	#if defined( USE_POINTS_UV )\n		vec2 uv = vUv;\n	#else\n		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n	#endif\n#endif\n#ifdef USE_MAP\n	diffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n	diffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n	varying vec2 vUv;\n#else\n	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n		uniform mat3 uvTransform;\n	#endif\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n	metalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n	uniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n	vColor *= morphTargetBaseInfluence;\n	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n		#if defined( USE_COLOR_ALPHA )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n		#elif defined( USE_COLOR )\n			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n		#endif\n	}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	objectNormal *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n	#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	uniform float morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n		uniform sampler2DArray morphTargetsTexture;\n		uniform ivec2 morphTargetsTextureSize;\n		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n			int y = texelIndex / morphTargetsTextureSize.x;\n			int x = texelIndex - y * morphTargetsTextureSize.x;\n			ivec3 morphUV = ivec3( x, y, morphTargetIndex );\n			return texelFetch( morphTargetsTexture, morphUV, 0 );\n		}\n	#else\n		#ifndef USE_MORPHNORMALS\n			uniform float morphTargetInfluences[ 8 ];\n		#else\n			uniform float morphTargetInfluences[ 4 ];\n		#endif\n	#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	transformed *= morphTargetBaseInfluence;\n	#ifdef MORPHTARGETS_TEXTURE\n		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n		}\n	#else\n		transformed += morphTarget0 * morphTargetInfluences[ 0 ];\n		transformed += morphTarget1 * morphTargetInfluences[ 1 ];\n		transformed += morphTarget2 * morphTargetInfluences[ 2 ];\n		transformed += morphTarget3 * morphTargetInfluences[ 3 ];\n		#ifndef USE_MORPHNORMALS\n			transformed += morphTarget4 * morphTargetInfluences[ 4 ];\n			transformed += morphTarget5 * morphTargetInfluences[ 5 ];\n			transformed += morphTarget6 * morphTargetInfluences[ 6 ];\n			transformed += morphTarget7 * morphTargetInfluences[ 7 ];\n		#endif\n	#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n	vec3 normal = normalize( vNormal );\n	#ifdef DOUBLE_SIDED\n		normal *= faceDirection;\n	#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n	#ifdef USE_TANGENT\n		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn = getTangentFrame( - vViewPosition, normal,\n		#if defined( USE_NORMALMAP )\n			vNormalMapUv\n		#elif defined( USE_CLEARCOAT_NORMALMAP )\n			vClearcoatNormalMapUv\n		#else\n			vUv\n		#endif\n		);\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn[0] *= faceDirection;\n		tbn[1] *= faceDirection;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	#ifdef USE_TANGENT\n		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n	#else\n		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n	#endif\n	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n		tbn2[0] *= faceDirection;\n		tbn2[1] *= faceDirection;\n	#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	#ifdef FLIP_SIDED\n		normal = - normal;\n	#endif\n	#ifdef DOUBLE_SIDED\n		normal = normal * faceDirection;\n	#endif\n	normal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n	mapN.xy *= normalScale;\n	normal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n	#ifdef USE_TANGENT\n		varying vec3 vTangent;\n		varying vec3 vBitangent;\n	#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n	vNormal = normalize( transformedNormal );\n	#ifdef USE_TANGENT\n		vTangent = normalize( transformedTangent );\n		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n	#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n	uniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( uv.st );\n		vec2 st1 = dFdy( uv.st );\n		vec3 N = surf_norm;\n		vec3 q1perp = cross( q1, N );\n		vec3 q0perp = cross( N, q0 );\n		vec3 T = q1perp * st0.x + q0perp * st1.x;\n		vec3 B = q1perp * st0.y + q0perp * st1.y;\n		float det = max( dot( T, T ), dot( B, B ) );\n		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n		return mat3( T * scale, B * scale, N );\n	}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n	vec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n	clearcoatMapN.xy *= clearcoatNormalScale;\n	clearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n	uniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform sampler2D clearcoatNormalMap;\n	uniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n	uniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n	return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n	return 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n	vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n	return dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n	return packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n	return ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n	gl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n	mvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n	mvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n	gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n	vec3 dithering( vec3 color ) {\n		float grid_position = rand( gl_FragCoord.xy );\n		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n		return color + dither_shift_RGB;\n	}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n	roughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n	uniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n	}\n	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n		return unpackRGBATo2Half( texture2D( shadow, uv ) );\n	}\n	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n		float occlusion = 1.0;\n		vec2 distribution = texture2DDistribution( shadow, uv );\n		float hard_shadow = step( compare , distribution.x );\n		if (hard_shadow != 1.0 ) {\n			float distance = compare - distribution.x ;\n			float variance = max( 0.00000, distribution.y * distribution.y );\n			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n		}\n		return occlusion;\n	}\n	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n		float shadow = 1.0;\n		shadowCoord.xyz /= shadowCoord.w;\n		shadowCoord.z += shadowBias;\n		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n		if ( frustumTest ) {\n		#if defined( SHADOWMAP_TYPE_PCF )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx0 = - texelSize.x * shadowRadius;\n			float dy0 = - texelSize.y * shadowRadius;\n			float dx1 = + texelSize.x * shadowRadius;\n			float dy1 = + texelSize.y * shadowRadius;\n			float dx2 = dx0 / 2.0;\n			float dy2 = dy0 / 2.0;\n			float dx3 = dx1 / 2.0;\n			float dy3 = dy1 / 2.0;\n			shadow = (\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n			) * ( 1.0 / 17.0 );\n		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n			float dx = texelSize.x;\n			float dy = texelSize.y;\n			vec2 uv = shadowCoord.xy;\n			vec2 f = fract( uv * shadowMapSize + 0.5 );\n			uv -= f * texelSize;\n			shadow = (\n				texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n					 f.x ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n					 f.y ) +\n				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n						  f.x ),\n					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n						  f.x ),\n					 f.y )\n			) * ( 1.0 / 9.0 );\n		#elif defined( SHADOWMAP_TYPE_VSM )\n			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#else\n			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n		#endif\n		}\n		return shadow;\n	}\n	vec2 cubeToUV( vec3 v, float texelSizeY ) {\n		vec3 absV = abs( v );\n		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n		absV *= scaleToCube;\n		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n		vec2 planar = v.xy;\n		float almostATexel = 1.5 * texelSizeY;\n		float almostOne = 1.0 - almostATexel;\n		if ( absV.z >= almostOne ) {\n			if ( v.z > 0.0 )\n				planar.x = 4.0 - v.x;\n		} else if ( absV.x >= almostOne ) {\n			float signX = sign( v.x );\n			planar.x = v.z * signX + 2.0 * signX;\n		} else if ( absV.y >= almostOne ) {\n			float signY = sign( v.y );\n			planar.x = v.x + 2.0 * signY + 2.0;\n			planar.y = v.z * signY - 2.0;\n		}\n		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n	}\n	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n		vec3 lightToPosition = shadowCoord.xyz;\n		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;\n		vec3 bd3D = normalize( lightToPosition );\n		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n			return (\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n			) * ( 1.0 / 9.0 );\n		#else\n			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n		#endif\n	}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n		struct DirectionalLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n		struct SpotLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n		};\n		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n		struct PointLightShadow {\n			float shadowBias;\n			float shadowNormalBias;\n			float shadowRadius;\n			vec2 shadowMapSize;\n			float shadowCameraNear;\n			float shadowCameraFar;\n		};\n		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n	#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n	vec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n		#pragma unroll_loop_start\n		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n		}\n		#pragma unroll_loop_end\n	#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n		shadowWorldPosition = worldPosition;\n		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n		#endif\n		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n	}\n	#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n	float shadow = 1.0;\n	#ifdef USE_SHADOWMAP\n	#if NUM_DIR_LIGHT_SHADOWS > 0\n	DirectionalLightShadow directionalLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n		directionalLight = directionalLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_SPOT_LIGHT_SHADOWS > 0\n	SpotLightShadow spotLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n		spotLight = spotLightShadows[ i ];\n		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#if NUM_POINT_LIGHT_SHADOWS > 0\n	PointLightShadow pointLight;\n	#pragma unroll_loop_start\n	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n		pointLight = pointLightShadows[ i ];\n		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n	}\n	#pragma unroll_loop_end\n	#endif\n	#endif\n	return shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n	uniform highp sampler2D boneTexture;\n	mat4 getBoneMatrix( const in float i ) {\n		int size = textureSize( boneTexture, 0 ).x;\n		int j = int( i ) * 4;\n		int x = j % size;\n		int y = j / size;\n		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n		return mat4( v1, v2, v3, v4 );\n	}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	transformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n	#ifdef USE_TANGENT\n		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n	#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n	return saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	return saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n	color *= toneMappingExposure;\n	color = max( vec3( 0.0 ), color - 0.004 );\n	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n	return a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n	const mat3 ACESInputMat = mat3(\n		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),\n		vec3( 0.04823, 0.01566, 0.83777 )\n	);\n	const mat3 ACESOutputMat = mat3(\n		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),\n		vec3( -0.07367, -0.00605,  1.07602 )\n	);\n	color *= toneMappingExposure / 0.6;\n	color = ACESInputMat * color;\n	color = RRTAndODTFit( color );\n	color = ACESOutputMat * color;\n	return saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n	vec3( 1.6605, - 0.1246, - 0.0182 ),\n	vec3( - 0.5876, 1.1329, - 0.1006 ),\n	vec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n	vec3( 0.6274, 0.0691, 0.0164 ),\n	vec3( 0.3293, 0.9195, 0.0880 ),\n	vec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n	vec3 x2 = x * x;\n	vec3 x4 = x2 * x2;\n	return + 15.5 * x4 * x2\n		- 40.14 * x4 * x\n		+ 31.96 * x4\n		- 6.868 * x2 * x\n		+ 0.4298 * x2\n		+ 0.1191 * x\n		- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n	const mat3 AgXInsetMatrix = mat3(\n		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n	);\n	const mat3 AgXOutsetMatrix = mat3(\n		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n	);\n	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;\n	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n	color *= toneMappingExposure;\n	color = AgXInsetMatrix * color;\n	color = max( color, 1e-10 );	color = log2( color );\n	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n	color = clamp( color, 0.0, 1.0 );\n	color = agxDefaultContrastApprox( color );\n	color = AgXOutsetMatrix * color;\n	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n	return color;\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n	material.transmission = transmission;\n	material.transmissionAlpha = 1.0;\n	material.thickness = thickness;\n	material.attenuationDistance = attenuationDistance;\n	material.attenuationColor = attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n	#endif\n	vec3 pos = vWorldPosition;\n	vec3 v = normalize( cameraPosition - pos );\n	vec3 n = inverseTransformDirection( normal, viewMatrix );\n	vec4 transmitted = getIBLVolumeRefraction(\n		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n		material.attenuationColor, material.attenuationDistance );\n	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n	uniform float transmission;\n	uniform float thickness;\n	uniform float attenuationDistance;\n	uniform vec3 attenuationColor;\n	#ifdef USE_TRANSMISSIONMAP\n		uniform sampler2D transmissionMap;\n	#endif\n	#ifdef USE_THICKNESSMAP\n		uniform sampler2D thicknessMap;\n	#endif\n	uniform vec2 transmissionSamplerSize;\n	uniform sampler2D transmissionSamplerMap;\n	uniform mat4 modelMatrix;\n	uniform mat4 projectionMatrix;\n	varying vec3 vWorldPosition;\n	float w0( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n	}\n	float w1( float a ) {\n		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n	}\n	float w2( float a ){\n		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n	}\n	float w3( float a ) {\n		return ( 1.0 / 6.0 ) * ( a * a * a );\n	}\n	float g0( float a ) {\n		return w0( a ) + w1( a );\n	}\n	float g1( float a ) {\n		return w2( a ) + w3( a );\n	}\n	float h0( float a ) {\n		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n	}\n	float h1( float a ) {\n		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n	}\n	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n		uv = uv * texelSize.zw + 0.5;\n		vec2 iuv = floor( uv );\n		vec2 fuv = fract( uv );\n		float g0x = g0( fuv.x );\n		float g1x = g1( fuv.x );\n		float h0x = h0( fuv.x );\n		float h1x = h1( fuv.x );\n		float h0y = h0( fuv.y );\n		float h1y = h1( fuv.y );\n		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n	}\n	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n		vec2 fLodSizeInv = 1.0 / fLodSize;\n		vec2 cLodSizeInv = 1.0 / cLodSize;\n		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n		return mix( fSample, cSample, fract( lod ) );\n	}\n	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n		vec3 modelScale;\n		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n		return normalize( refractionVector ) * thickness * modelScale;\n	}\n	float applyIorToRoughness( const in float roughness, const in float ior ) {\n		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n	}\n	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n	}\n	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n		if ( isinf( attenuationDistance ) ) {\n			return vec3( 1.0 );\n		} else {\n			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;\n		}\n	}\n	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n		const in vec3 attenuationColor, const in float attenuationDistance ) {\n		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n		vec3 refractedRayExit = position + transmissionRay;\n		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n		vec2 refractionCoords = ndcPos.xy / ndcPos.w;\n		refractionCoords += 1.0;\n		refractionCoords /= 2.0;\n		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n		vec3 attenuatedColor = transmittance * transmittedLight.rgb;\n		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n	}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform mat3 mapTransform;\n	varying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n	uniform mat3 alphaMapTransform;\n	varying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n	uniform mat3 lightMapTransform;\n	varying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n	uniform mat3 aoMapTransform;\n	varying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n	uniform mat3 bumpMapTransform;\n	varying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n	uniform mat3 normalMapTransform;\n	varying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	uniform mat3 displacementMapTransform;\n	varying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n	uniform mat3 emissiveMapTransform;\n	varying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n	uniform mat3 metalnessMapTransform;\n	varying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	uniform mat3 roughnessMapTransform;\n	varying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	uniform mat3 anisotropyMapTransform;\n	varying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n	uniform mat3 clearcoatMapTransform;\n	varying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	uniform mat3 clearcoatNormalMapTransform;\n	varying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	uniform mat3 clearcoatRoughnessMapTransform;\n	varying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	uniform mat3 sheenColorMapTransform;\n	varying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	uniform mat3 sheenRoughnessMapTransform;\n	varying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	uniform mat3 iridescenceMapTransform;\n	varying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	uniform mat3 iridescenceThicknessMapTransform;\n	varying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n	uniform mat3 specularMapTransform;\n	varying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	uniform mat3 specularColorMapTransform;\n	varying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	uniform mat3 specularIntensityMapTransform;\n	varying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	uniform mat3 transmissionMapTransform;\n	varying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n	uniform mat3 thicknessMapTransform;\n	varying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n	vUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n	vec4 worldPosition = vec4( transformed, 1.0 );\n	#ifdef USE_BATCHING\n		worldPosition = batchingMatrix * worldPosition;\n	#endif\n	#ifdef USE_INSTANCING\n		worldPosition = instanceMatrix * worldPosition;\n	#endif\n	worldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n	vec2 scale;\n	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},ik={common:{diffuse:{value:new tk(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new eo},alphaMap:{value:null},alphaMapTransform:{value:new eo},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new eo}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new eo}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new eo}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new eo},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new eo},normalScale:{value:new es(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new eo},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new eo}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new eo}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new eo}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tk(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new tk(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new eo},alphaTest:{value:0},uvTransform:{value:new eo}},sprite:{diffuse:{value:new tk(0xffffff)},opacity:{value:1},center:{value:new es(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new eo},alphaMap:{value:null},alphaMapTransform:{value:new eo},alphaTest:{value:0}}},iz={basic:{uniforms:ix([ik.common,ik.specularmap,ik.envmap,ik.aomap,ik.lightmap,ik.fog]),vertexShader:iF.meshbasic_vert,fragmentShader:iF.meshbasic_frag},lambert:{uniforms:ix([ik.common,ik.specularmap,ik.envmap,ik.aomap,ik.lightmap,ik.emissivemap,ik.bumpmap,ik.normalmap,ik.displacementmap,ik.fog,ik.lights,{emissive:{value:new tk(0)}}]),vertexShader:iF.meshlambert_vert,fragmentShader:iF.meshlambert_frag},phong:{uniforms:ix([ik.common,ik.specularmap,ik.envmap,ik.aomap,ik.lightmap,ik.emissivemap,ik.bumpmap,ik.normalmap,ik.displacementmap,ik.fog,ik.lights,{emissive:{value:new tk(0)},specular:{value:new tk(1118481)},shininess:{value:30}}]),vertexShader:iF.meshphong_vert,fragmentShader:iF.meshphong_frag},standard:{uniforms:ix([ik.common,ik.envmap,ik.aomap,ik.lightmap,ik.emissivemap,ik.bumpmap,ik.normalmap,ik.displacementmap,ik.roughnessmap,ik.metalnessmap,ik.fog,ik.lights,{emissive:{value:new tk(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:iF.meshphysical_vert,fragmentShader:iF.meshphysical_frag},toon:{uniforms:ix([ik.common,ik.aomap,ik.lightmap,ik.emissivemap,ik.bumpmap,ik.normalmap,ik.displacementmap,ik.gradientmap,ik.fog,ik.lights,{emissive:{value:new tk(0)}}]),vertexShader:iF.meshtoon_vert,fragmentShader:iF.meshtoon_frag},matcap:{uniforms:ix([ik.common,ik.bumpmap,ik.normalmap,ik.displacementmap,ik.fog,{matcap:{value:null}}]),vertexShader:iF.meshmatcap_vert,fragmentShader:iF.meshmatcap_frag},points:{uniforms:ix([ik.points,ik.fog]),vertexShader:iF.points_vert,fragmentShader:iF.points_frag},dashed:{uniforms:ix([ik.common,ik.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:iF.linedashed_vert,fragmentShader:iF.linedashed_frag},depth:{uniforms:ix([ik.common,ik.displacementmap]),vertexShader:iF.depth_vert,fragmentShader:iF.depth_frag},normal:{uniforms:ix([ik.common,ik.bumpmap,ik.normalmap,ik.displacementmap,{opacity:{value:1}}]),vertexShader:iF.meshnormal_vert,fragmentShader:iF.meshnormal_frag},sprite:{uniforms:ix([ik.sprite,ik.fog]),vertexShader:iF.sprite_vert,fragmentShader:iF.sprite_frag},background:{uniforms:{uvTransform:{value:new eo},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:iF.background_vert,fragmentShader:iF.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:iF.backgroundCube_vert,fragmentShader:iF.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:iF.cube_vert,fragmentShader:iF.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:iF.equirect_vert,fragmentShader:iF.equirect_frag},distanceRGBA:{uniforms:ix([ik.common,ik.displacementmap,{referencePosition:{value:new eI},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:iF.distanceRGBA_vert,fragmentShader:iF.distanceRGBA_frag},shadow:{uniforms:ix([ik.lights,ik.fog,{color:{value:new tk(0)},opacity:{value:1}}]),vertexShader:iF.shadow_vert,fragmentShader:iF.shadow_frag}};iz.physical={uniforms:ix([iz.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new eo},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new eo},clearcoatNormalScale:{value:new es(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new eo},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new eo},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new eo},sheen:{value:0},sheenColor:{value:new tk(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new eo},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new eo},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new eo},transmissionSamplerSize:{value:new es},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new eo},attenuationDistance:{value:0},attenuationColor:{value:new tk(0)},specularColor:{value:new tk(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new eo},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new eo},anisotropyVector:{value:new es},anisotropyMap:{value:null},anisotropyMapTransform:{value:new eo}}]),vertexShader:iF.meshphysical_vert,fragmentShader:iF.meshphysical_frag};let iH={r:0,b:0,g:0};function iV(e,t,i,n,r,a,o){let l,c;let h=new tk(0),u=!0===a?0:1,d=null,p=0,f=null;function m(t,i){t.getRGB(iH,i_(e)),n.buffers.color.setClear(iH.r,iH.g,iH.b,i,o)}return{getClearColor:function(){return h},setClearColor:function(e,t=1){h.set(e),m(h,u=t)},getClearAlpha:function(){return u},setClearAlpha:function(e){m(h,u=e)},render:function(a,g){let v=!1,y=!0===g.isScene?g.background:null;y&&y.isTexture&&(y=(g.backgroundBlurriness>0?i:t).get(y)),null===y?m(h,u):y&&y.isColor&&(m(y,1),v=!0);let x=e.xr.getEnvironmentBlendMode();"additive"===x?n.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===x&&n.buffers.color.setClear(0,0,0,0,o),(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||306===y.mapping)?(void 0===c&&((c=new im(new iv(1,1,1),new ib({name:"BackgroundCubeMaterial",uniforms:iy(iz.backgroundCube.uniforms),vertexShader:iz.backgroundCube.vertexShader,fragmentShader:iz.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=ev.getTransfer(y.colorSpace)!==V,(d!==y||p!==y.version||f!==e.toneMapping)&&(c.material.needsUpdate=!0,d=y,p=y.version,f=e.toneMapping),c.layers.enableAll(),a.unshift(c,c.geometry,c.material,0,0,null)):y&&y.isTexture&&(void 0===l&&((l=new im(new iU(2,2),new ib({name:"BackgroundMaterial",uniforms:iy(iz.background.uniforms),vertexShader:iz.background.vertexShader,fragmentShader:iz.background.fragmentShader,side:s,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=y,l.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,l.material.toneMapped=ev.getTransfer(y.colorSpace)!==V,!0===y.matrixAutoUpdate&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),(d!==y||p!==y.version||f!==e.toneMapping)&&(l.material.needsUpdate=!0,d=y,p=y.version,f=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null))}}}function iG(e,t,i,n){let r=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=n.isWebGL2?null:t.get("OES_vertex_array_object"),s=n.isWebGL2||null!==a,o={},l=p(null),c=l,h=!1;function u(t){return n.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){return n.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){let t=[],i=[],n=[];for(let e=0;e<r;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function f(){let e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,r){let a=c.newAttributes,s=c.enabledAttributes,o=c.attributeDivisors;a[i]=1,0===s[i]&&(e.enableVertexAttribArray(i),s[i]=1),o[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function v(){let t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function y(t,i,n,r,a,s,o){!0===o?e.vertexAttribIPointer(t,i,n,a,s):e.vertexAttribPointer(t,i,n,r,a,s)}function x(){_(),h=!0,c!==l&&u((c=l).object)}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,x,_){let A=!1;if(s){let t=function(t,i,r){let s=!0===r.wireframe,l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[s];return void 0===h&&(h=p(n.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[s]=h),h}(x,d,l);c!==t&&u((c=t).object),(A=function(e,t,i,n){let r=c.attributes,a=t.attributes,s=0,o=i.getAttributes();for(let t in o)if(o[t].location>=0){let i=r[t],n=a[t];if(void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor)),void 0===i||i.attribute!==n||n&&i.data!==n.data)return!0;s++}return c.attributesNum!==s||c.index!==n}(r,x,d,_))&&function(e,t,i,n){let r={},a=t.attributes,s=0,o=i.getAttributes();for(let t in o)if(o[t].location>=0){let i=a[t];void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor));let n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[t]=n,s++}c.attributes=r,c.attributesNum=s,c.index=n}(r,x,d,_)}else{let e=!0===l.wireframe;(c.geometry!==x.id||c.program!==d.id||c.wireframe!==e)&&(c.geometry=x.id,c.program=d.id,c.wireframe=e,A=!0)}null!==_&&i.update(_,e.ELEMENT_ARRAY_BUFFER),(A||h)&&(h=!1,function(r,a,s,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();let l=o.attributes,c=s.getAttributes(),h=a.defaultAttributeValues;for(let t in c){let a=c[t];if(a.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){let t=s.normalized,l=s.itemSize,c=i.get(s);if(void 0===c)continue;let h=c.buffer,u=c.type,d=c.bytesPerElement,p=!0===n.isWebGL2&&(u===e.INT||u===e.UNSIGNED_INT||1013===s.gpuType);if(s.isInterleavedBufferAttribute){let i=s.data,n=i.stride,c=s.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)g(a.location+e,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,u,t,n*d,(c+l/a.locationSize*e)*d,p)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,u,t,l*d,l/a.locationSize*e*d,p)}}else if(void 0!==h){let i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(a.location,i);break;case 3:e.vertexAttrib3fv(a.location,i);break;case 4:e.vertexAttrib4fv(a.location,i);break;default:e.vertexAttrib1fv(a.location,i)}}}}v()}(r,l,d,x),null!==_&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(_).buffer))},reset:x,resetDefaultState:_,dispose:function(){for(let e in x(),o){let t=o[e];for(let e in t){let i=t[e];for(let e in i)d(i[e].object),delete i[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;let t=o[e.id];for(let e in t){let i=t[e];for(let e in i)d(i[e].object),delete i[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(let t in o){let i=o[t];if(void 0===i[e.id])continue;let n=i[e.id];for(let e in n)d(n[e].object),delete n[e];delete i[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function iW(e,t,i,n){let r;let a=n.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r,1)},this.renderInstances=function(n,s,o){let l,c;if(0!==o){if(a)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[c](r,n,s,o),i.update(s,r,o)}},this.renderMultiDraw=function(e,n,a){if(0===a)return;let s=t.get("WEBGL_multi_draw");if(null===s)for(let t=0;t<a;t++)this.render(e[t],n[t]);else{s.multiDrawArraysWEBGL(r,e,0,n,0,a);let t=0;for(let e=0;e<a;e++)t+=n[e];i.update(t,r,1)}}}function ij(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name,s=void 0!==i.precision?i.precision:"highp",o=r(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);let l=a||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=u>0,x=a||t.has("OES_texture_float"),_=a?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:_}}function iq(e){let t=this,i=null,n=0,r=!1,a=!1,s=new iI,o=new eo,l={value:null,needsUpdate:!1};function c(e,i,n,r){let a=null!==e?e.length:0,c=null;if(0!==a){if(c=l.value,!0!==r||null===c){let t=n+4*a,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==a;++t,i+=4)s.copy(e[t]).applyMatrix4(r,o),s.normal.toArray(c,i),c[i+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let i=0!==e.length||t||0!==n||r;return r=t,n=e.length,i},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){i=c(e,t,0)},this.setState=function(s,o,h){let u=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(r&&null!==u&&0!==u.length&&(!a||p)){let e=a?0:n,t=4*e,r=f.clippingState||null;l.value=r,r=c(u,o,t,h);for(let e=0;e!==t;++e)r[e]=i[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}else a?c(null):(l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0)}}function iX(e){let t=new WeakMap;function i(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){let a=r.mapping;if(303===a||304===a){if(t.has(r))return i(t.get(r).texture,r.mapping);{let a=r.image;if(!a||!(a.height>0))return null;{let s=new iC(a.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",n),i(s.texture,r.mapping)}}}}return r},dispose:function(){t=new WeakMap}}}class iY extends iS{constructor(e=-1,t=1,i=1,n=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,a=i+e,s=n+t,o=n-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,a=r+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}let iK=[.125,.215,.35,.446,.526,.582],iQ=new iY,iJ=new tk,iZ=null,i$=0,i0=0,i1=(1+Math.sqrt(5))/2,i2=1/i1,i3=[new eI(1,1,1),new eI(-1,1,1),new eI(1,1,-1),new eI(-1,1,-1),new eI(0,i1,i2),new eI(0,i1,-i2),new eI(i2,0,i1),new eI(-i2,0,i1),new eI(i1,i2,0),new eI(-i1,i2,0)];class i4{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){iZ=this._renderer.getRenderTarget(),i$=this._renderer.getActiveCubeFace(),i0=this._renderer.getActiveMipmapLevel(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=i9(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=i8(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(iZ,i$,i0),e.scissorTest=!1,i6(e,0,0,e.width,e.height)}_fromTexture(e,t){301===e.mapping||302===e.mapping?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),iZ=this._renderer.getRenderTarget(),i$=this._renderer.getActiveCubeFace(),i0=this._renderer.getActiveMipmapLevel();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:_,minFilter:_,generateMipmaps:!1,type:E,format:C,colorSpace:F,depthBuffer:!1},n=i5(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){var r;null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=i5(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let t=[],i=[],n=[],r=e,a=e-4+1+iK.length;for(let s=0;s<a;s++){let a=Math.pow(2,r);i.push(a);let o=1/a;s>e-4?o=iK[s-e+4-1]:0===s&&(o=0),n.push(o);let l=1/(a-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=new Float32Array(108),p=new Float32Array(72),f=new Float32Array(36);for(let e=0;e<6;e++){let t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];d.set(n,18*e),p.set(u,12*e);let r=[e,e,e,e,e,e];f.set(r,6*e)}let m=new t5;m.setAttribute("position",new tY(d,3)),m.setAttribute("uv",new tY(p,2)),m.setAttribute("faceIndex",new tY(f,1)),t.push(m),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=(r=n,new ib({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(20)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new eI(0,1,0)}},vertexShader:i7(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:l,depthTest:!1,depthWrite:!1}))}return n}_compileMaterial(e){let t=new im(this._lodPlanes[0],e);this._renderer.compile(t,iQ)}_sceneToCubeUV(e,t,i,n){let r=new iw(90,1,t,i),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(iJ),o.toneMapping=0,o.autoClear=!1;let h=new tG({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new im(new iv,h),d=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,d=!0):(h.color.copy(iJ),d=!0);for(let t=0;t<6;t++){let i=t%3;0===i?(r.up.set(0,a[t],0),r.lookAt(s[t],0,0)):1===i?(r.up.set(0,0,a[t]),r.lookAt(0,s[t],0)):(r.up.set(0,a[t],0),r.lookAt(0,0,s[t]));let l=this._cubeSize;i6(n,i*l,t>2?l:0,l,l),o.setRenderTarget(n),d&&o.render(u,r),o.render(e,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,n=301===e.mapping||302===e.mapping;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=i9()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=i8());let r=n?this._cubemapMaterial:this._equirectMaterial,a=new im(this._lodPlanes[0],r);r.uniforms.envMap.value=e;let s=this._cubeSize;i6(t,0,0,3*s,2*s),i.setRenderTarget(t),i.render(a,iQ)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){let i=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),n=i3[(t-1)%i3.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,r){let a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,n,"latitudinal",r),this._halfBlur(a,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,a,s){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let c=new im(this._lodPlanes[n],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);let m=[],g=0;for(let e=0;e<20;++e){let t=e/p,i=Math.exp(-t*t/2);m.push(i),0===e?g+=i:e<f&&(g+=2*i)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===a,s&&(h.poleAxis.value=s);let{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-i;let y=this._sizeLods[n],x=4*(this._cubeSize-y);i6(t,3*y*(n>v-4?n-v+4:0),x,3*y,2*y),o.setRenderTarget(t),o.render(c,iQ)}}function i5(e,t,i){let n=new eT(e,t,i);return n.texture.mapping=306,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function i6(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function i8(){return new ib({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:i7(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:l,depthTest:!1,depthWrite:!1})}function i9(){return new ib({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:i7(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:l,depthTest:!1,depthWrite:!1})}function i7(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ne(e){let t=new WeakMap,i=null;function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){let a=r.mapping,s=303===a||304===a,o=301===a||302===a;if(s||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=t.get(r);return null===i&&(i=new i4(e)),n=s?i.fromEquirectangular(r,n):i.fromCubemap(r,n),t.set(r,n),n.texture}if(t.has(r))return t.get(r).texture;{let a=r.image;if(!(s&&a&&a.height>0||o&&a&&function(e){let t=0;for(let i=0;i<6;i++)void 0!==e[i]&&t++;return 6===t}(a)))return null;{null===i&&(i=new i4(e));let a=s?i.fromEquirectangular(r):i.fromCubemap(r);return t.set(r,a),r.addEventListener("dispose",n),a.texture}}}}return r},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function nt(e){let t={};function i(i){let n;if(void 0!==t[i])return t[i];switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?(i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance")):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){let t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ni(e,t,i,n){let r={},a=new WeakMap;function s(e){let o=e.target;for(let e in null!==o.index&&t.remove(o.index),o.attributes)t.remove(o.attributes[e]);for(let e in o.morphAttributes){let i=o.morphAttributes[e];for(let e=0,n=i.length;e<n;e++)t.remove(i[e])}o.removeEventListener("dispose",s),delete r[o.id];let l=a.get(o);l&&(t.remove(l),a.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(e){let i=[],n=e.index,r=e.attributes.position,s=0;if(null!==n){let e=n.array;s=n.version;for(let t=0,n=e.length;t<n;t+=3){let n=e[t+0],r=e[t+1],a=e[t+2];i.push(n,r,r,a,a,n)}}else{if(void 0===r)return;let e=r.array;s=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){let e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}let o=new(ec(i)?tQ:tK)(i,1);o.version=s;let l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,i.memory.geometries++),t},update:function(i){let n=i.attributes;for(let i in n)t.update(n[i],e.ARRAY_BUFFER);let r=i.morphAttributes;for(let i in r){let n=r[i];for(let i=0,r=n.length;i<r;i++)t.update(n[i],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){let t=a.get(e);if(t){let i=e.index;null!==i&&t.version<i.version&&o(e)}else o(e);return a.get(e)}}}function nn(e,t,i,n){let r,a,s;let o=n.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,a,t*s),i.update(n,r,1)},this.renderInstances=function(n,l,c){let h,u;if(0!==c){if(o)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[u](r,l,a,n*s,c),i.update(l,r,c)}},this.renderMultiDraw=function(e,n,o){if(0===o)return;let l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<o;t++)this.render(e[t]/s,n[t]);else{l.multiDrawElementsWEBGL(r,n,0,a,e,0,o);let t=0;for(let e=0;e<o;e++)t+=n[e];i.update(t,r,1)}}}function nr(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(i,n,r){switch(t.calls++,n){case e.TRIANGLES:t.triangles+=i/3*r;break;case e.LINES:t.lines+=i/2*r;break;case e.LINE_STRIP:t.lines+=r*(i-1);break;case e.LINE_LOOP:t.lines+=r*i;break;case e.POINTS:t.points+=r*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function na(e,t){return e[0]-t[0]}function ns(e,t){return Math.abs(t[1])-Math.abs(e[1])}function no(e,t,i){let n={},r=new Float32Array(8),a=new WeakMap,s=new eE,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,c,h){let u=l.morphTargetInfluences;if(!0===t.isWebGL2){let n=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==n?n.length:0,o=a.get(c);if(void 0===o||o.count!==r){void 0!==o&&o.texture.dispose();let e=void 0!==c.morphAttributes.position,i=void 0!==c.morphAttributes.normal,n=void 0!==c.morphAttributes.color,l=c.morphAttributes.position||[],h=c.morphAttributes.normal||[],u=c.morphAttributes.color||[],d=0;!0===e&&(d=1),!0===i&&(d=2),!0===n&&(d=3);let p=c.attributes.position.count*d,f=1;p>t.maxTextureSize&&(f=Math.ceil(p/t.maxTextureSize),p=t.maxTextureSize);let m=new Float32Array(p*f*4*r),g=new eR(m,p,f,r);g.type=M,g.needsUpdate=!0;let v=4*d;for(let t=0;t<r;t++){let r=l[t],a=h[t],o=u[t],c=p*f*4*t;for(let t=0;t<r.count;t++){let l=t*v;!0===e&&(s.fromBufferAttribute(r,t),m[c+l+0]=s.x,m[c+l+1]=s.y,m[c+l+2]=s.z,m[c+l+3]=0),!0===i&&(s.fromBufferAttribute(a,t),m[c+l+4]=s.x,m[c+l+5]=s.y,m[c+l+6]=s.z,m[c+l+7]=0),!0===n&&(s.fromBufferAttribute(o,t),m[c+l+8]=s.x,m[c+l+9]=s.y,m[c+l+10]=s.z,m[c+l+11]=4===o.itemSize?s.w:1)}}o={count:r,texture:g,size:new es(p,f)},a.set(c,o),c.addEventListener("dispose",function e(){g.dispose(),a.delete(c),c.removeEventListener("dispose",e)})}let l=0;for(let e=0;e<u.length;e++)l+=u[e];let d=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",d),h.getUniforms().setValue(e,"morphTargetInfluences",u),h.getUniforms().setValue(e,"morphTargetsTexture",o.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",o.size)}else{let t=void 0===u?0:u.length,i=n[c.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];n[c.id]=i}for(let e=0;e<t;e++){let t=i[e];t[0]=e,t[1]=u[e]}i.sort(ns);for(let e=0;e<8;e++)e<t&&i[e][1]?(o[e][0]=i[e][0],o[e][1]=i[e][1]):(o[e][0]=Number.MAX_SAFE_INTEGER,o[e][1]=0);o.sort(na);let a=c.morphAttributes.position,s=c.morphAttributes.normal,l=0;for(let e=0;e<8;e++){let t=o[e],i=t[0],n=t[1];i!==Number.MAX_SAFE_INTEGER&&n?(a&&c.getAttribute("morphTarget"+e)!==a[i]&&c.setAttribute("morphTarget"+e,a[i]),s&&c.getAttribute("morphNormal"+e)!==s[i]&&c.setAttribute("morphNormal"+e,s[i]),r[e]=n,l+=n):(a&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),s&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),r[e]=0)}let d=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",d),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function nl(e,t,i,n){let r=new WeakMap;function a(e){let t=e.target;t.removeEventListener("dispose",a),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(s){let o=n.render.frame,l=s.geometry,c=t.get(s,l);if(r.get(c)!==o&&(t.update(c),r.set(c,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),r.get(s)!==o&&(i.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&i.update(s.instanceColor,e.ARRAY_BUFFER),r.set(s,o))),s.isSkinnedMesh){let e=s.skeleton;r.get(e)!==o&&(e.update(),r.set(e,o))}return c},dispose:function(){r=new WeakMap}}}class nc extends eM{constructor(e,t,i,n,r,a,s,o,l,c){if((c=void 0!==c?c:T)!==T&&1027!==c)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===T&&(i=w),void 0===i&&1027===c&&(i=1020),super(null,n,r,a,s,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:v,this.minFilter=void 0!==o?o:v,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}let nh=new eM,nu=new nc(1,1);nu.compareFunction=515;let nd=new eR,np=new class extends eM{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=v,this.minFilter=v,this.wrapR=m,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},nf=new iE,nm=[],ng=[],nv=new Float32Array(16),ny=new Float32Array(9),nx=new Float32Array(4);function n_(e,t,i){let n=e[0];if(n<=0||n>0)return e;let r=t*i,a=nm[r];if(void 0===a&&(a=new Float32Array(r),nm[r]=a),0!==t){n.toArray(a,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(a,r)}return a}function nA(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function nb(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function nS(e,t){let i=ng[t];void 0===i&&(i=new Int32Array(t),ng[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function nw(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function nM(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(nA(i,t))return;e.uniform2fv(this.addr,t),nb(i,t)}}function nE(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(nA(i,t))return;e.uniform3fv(this.addr,t),nb(i,t)}}function nC(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(nA(i,t))return;e.uniform4fv(this.addr,t),nb(i,t)}}function nT(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(nA(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),nb(i,t)}else{if(nA(i,n))return;nx.set(n),e.uniformMatrix2fv(this.addr,!1,nx),nb(i,n)}}function nR(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(nA(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),nb(i,t)}else{if(nA(i,n))return;ny.set(n),e.uniformMatrix3fv(this.addr,!1,ny),nb(i,n)}}function nP(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(nA(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),nb(i,t)}else{if(nA(i,n))return;nv.set(n),e.uniformMatrix4fv(this.addr,!1,nv),nb(i,n)}}function nI(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function nL(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(nA(i,t))return;e.uniform2iv(this.addr,t),nb(i,t)}}function nD(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(nA(i,t))return;e.uniform3iv(this.addr,t),nb(i,t)}}function nB(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(nA(i,t))return;e.uniform4iv(this.addr,t),nb(i,t)}}function nO(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function nN(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(nA(i,t))return;e.uniform2uiv(this.addr,t),nb(i,t)}}function nU(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(nA(i,t))return;e.uniform3uiv(this.addr,t),nb(i,t)}}function nF(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(nA(i,t))return;e.uniform4uiv(this.addr,t),nb(i,t)}}function nk(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r);let a=this.type===e.SAMPLER_2D_SHADOW?nu:nh;i.setTexture2D(t||a,r)}function nz(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||np,r)}function nH(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||nf,r)}function nV(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||nd,r)}function nG(e,t){e.uniform1fv(this.addr,t)}function nW(e,t){let i=n_(t,this.size,2);e.uniform2fv(this.addr,i)}function nj(e,t){let i=n_(t,this.size,3);e.uniform3fv(this.addr,i)}function nq(e,t){let i=n_(t,this.size,4);e.uniform4fv(this.addr,i)}function nX(e,t){let i=n_(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function nY(e,t){let i=n_(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function nK(e,t){let i=n_(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function nQ(e,t){e.uniform1iv(this.addr,t)}function nJ(e,t){e.uniform2iv(this.addr,t)}function nZ(e,t){e.uniform3iv(this.addr,t)}function n$(e,t){e.uniform4iv(this.addr,t)}function n0(e,t){e.uniform1uiv(this.addr,t)}function n1(e,t){e.uniform2uiv(this.addr,t)}function n2(e,t){e.uniform3uiv(this.addr,t)}function n3(e,t){e.uniform4uiv(this.addr,t)}function n4(e,t,i){let n=this.cache,r=t.length,a=nS(i,r);nA(n,a)||(e.uniform1iv(this.addr,a),nb(n,a));for(let e=0;e!==r;++e)i.setTexture2D(t[e]||nh,a[e])}function n5(e,t,i){let n=this.cache,r=t.length,a=nS(i,r);nA(n,a)||(e.uniform1iv(this.addr,a),nb(n,a));for(let e=0;e!==r;++e)i.setTexture3D(t[e]||np,a[e])}function n6(e,t,i){let n=this.cache,r=t.length,a=nS(i,r);nA(n,a)||(e.uniform1iv(this.addr,a),nb(n,a));for(let e=0;e!==r;++e)i.setTextureCube(t[e]||nf,a[e])}function n8(e,t,i){let n=this.cache,r=t.length,a=nS(i,r);nA(n,a)||(e.uniform1iv(this.addr,a),nb(n,a));for(let e=0;e!==r;++e)i.setTexture2DArray(t[e]||nd,a[e])}class n9{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return nw;case 35664:return nM;case 35665:return nE;case 35666:return nC;case 35674:return nT;case 35675:return nR;case 35676:return nP;case 5124:case 35670:return nI;case 35667:case 35671:return nL;case 35668:case 35672:return nD;case 35669:case 35673:return nB;case 5125:return nO;case 36294:return nN;case 36295:return nU;case 36296:return nF;case 35678:case 36198:case 36298:case 36306:case 35682:return nk;case 35679:case 36299:case 36307:return nz;case 35680:case 36300:case 36308:case 36293:return nH;case 36289:case 36303:case 36311:case 36292:return nV}}(t.type)}}class n7{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return nG;case 35664:return nW;case 35665:return nj;case 35666:return nq;case 35674:return nX;case 35675:return nY;case 35676:return nK;case 5124:case 35670:return nQ;case 35667:case 35671:return nJ;case 35668:case 35672:return nZ;case 35669:case 35673:return n$;case 5125:return n0;case 36294:return n1;case 36295:return n2;case 36296:return n3;case 35678:case 36198:case 36298:case 36306:case 35682:return n4;case 35679:case 36299:case 36307:return n5;case 35680:case 36300:case 36308:case 36293:return n6;case 36289:case 36303:case 36311:case 36292:return n8}}(t.type)}}class re{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let n=this.seq;for(let r=0,a=n.length;r!==a;++r){let a=n[r];a.setValue(e,t[a.id],i)}}}let rt=/(\w+)(\])?(\[|\.)?/g;function ri(e,t){e.seq.push(t),e.map[t.id]=t}class rn{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){let i=e.getActiveUniform(t,n),r=e.getUniformLocation(t,i.name);!function(e,t,i){let n=e.name,r=n.length;for(rt.lastIndex=0;;){let a=rt.exec(n),s=rt.lastIndex,o=a[1],l="]"===a[2],c=a[3];if(l&&(o|=0),void 0===c||"["===c&&s+2===r){ri(i,void 0===c?new n9(o,e,t):new n7(o,e,t));break}{let e=i.map[o];void 0===e&&ri(i,e=new re(o)),i=e}}}(i,r,this)}}setValue(e,t,i,n){let r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){let n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,a=t.length;r!==a;++r){let a=t[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}}static seqWithValue(e,t){let i=[];for(let n=0,r=e.length;n!==r;++n){let r=e[n];r.id in t&&i.push(r)}return i}}function rr(e,t,i){let n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}let ra=0;function rs(e,t,i){let n=e.getShaderParameter(t,e.COMPILE_STATUS),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";let a=/ERROR: 0:(\d+)/.exec(r);if(!a)return r;{let n=parseInt(a[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){let i=e.split("\n"),n=[],r=Math.max(t-6,0),a=Math.min(t+6,i.length);for(let e=r;e<a;e++){let r=e+1;n.push(`${r===t?">":" "} ${r}: ${i[e]}`)}return n.join("\n")}(e.getShaderSource(t),n)}}function ro(e){return""!==e}function rl(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function rc(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}let rh=/^[ \t]*#include +<([\w\d./]+)>/gm;function ru(e){return e.replace(rh,rp)}let rd=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function rp(e,t){let i=iF[t];if(void 0===i){let e=rd.get(t);if(void 0!==e)i=iF[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e);else throw Error("Can not resolve #include <"+t+">")}return ru(i)}let rf=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function rm(e){return e.replace(rf,rg)}function rg(e,t,i,n){let r="";for(let e=parseInt(t);e<parseInt(i);e++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function rv(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function ry(e,t,i,n){let r,a,s,o,l,c;let h=e.getContext(),u=i.defines,d=i.vertexShader,p=i.fragmentShader,f=(l="SHADOWMAP_TYPE_BASIC",1===i.shadowMapType?l="SHADOWMAP_TYPE_PCF":2===i.shadowMapType?l="SHADOWMAP_TYPE_PCF_SOFT":3===i.shadowMapType&&(l="SHADOWMAP_TYPE_VSM"),l),m=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),g=(c="ENVMAP_MODE_REFLECTION",i.envMap&&302===i.envMapMode&&(c="ENVMAP_MODE_REFRACTION"),c),v=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(i),y=function(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let i=Math.log2(t)-2;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:1/t,maxMip:i}}(i),x=i.isWebGL2?"":[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||"physical"===i.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ro).join("\n"),_=[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(ro).join("\n"),A=function(e){let t=[];for(let i in e){let n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(u),b=h.createProgram(),S=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((r=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,A].filter(ro).join("\n")).length>0&&(r+="\n"),(a=[x,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,A].filter(ro).join("\n")).length>0&&(a+="\n")):(r=[rv(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,A,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+g:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+f:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(ro).join("\n"),a=[x,rv(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,A,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+m:"",i.envMap?"#define "+g:"",i.envMap?"#define "+v:"",y?"#define CUBEUV_TEXEL_WIDTH "+y.texelWidth:"",y?"#define CUBEUV_TEXEL_HEIGHT "+y.texelHeight:"",y?"#define CUBEUV_MAX_MIP "+y.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+f:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?iF.tonemapping_pars_fragment:"",0!==i.toneMapping?function(e,t){let i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 6:i="AgX";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",iF.colorspace_pars_fragment,function(e,t){let i=function(e){let t;let i=ev.getPrimaries(ev.workingColorSpace),n=ev.getPrimaries(e);switch(i===n?t="":"p3"===i&&n===G?t="LinearDisplayP3ToLinearSRGB":i===G&&"p3"===n&&(t="LinearSRGBToLinearDisplayP3"),e){case F:case z:return[t,"LinearTransferOETF"];case U:case k:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[t,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(ro).join("\n")),d=rc(d=rl(d=ru(d),i),i),p=rc(p=rl(p=ru(p),i),i),d=rm(d),p=rm(p),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(S="#version 300 es\n",r=[_,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["precision mediump sampler2DArray;","#define varying in",i.glslVersion===j?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===j?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);let w=S+r+d,M=S+a+p,E=rr(h,h.VERTEX_SHADER,w),C=rr(h,h.FRAGMENT_SHADER,M);function T(t){if(e.debug.checkShaderErrors){let i=h.getProgramInfoLog(b).trim(),n=h.getShaderInfoLog(E).trim(),s=h.getShaderInfoLog(C).trim(),o=!0,l=!0;if(!1===h.getProgramParameter(b,h.LINK_STATUS)){if(o=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(h,b,E,C);else{let e=rs(h,E,"vertex"),t=rs(h,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+h.getError()+" - VALIDATE_STATUS "+h.getProgramParameter(b,h.VALIDATE_STATUS)+"\n\nProgram Info Log: "+i+"\n"+e+"\n"+t)}}else""!==i?console.warn("THREE.WebGLProgram: Program Info Log:",i):(""===n||""===s)&&(l=!1);l&&(t.diagnostics={runnable:o,programLog:i,vertexShader:{log:n,prefix:r},fragmentShader:{log:s,prefix:a}})}h.deleteShader(E),h.deleteShader(C),s=new rn(h,b),o=function(e,t){let i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){let n=e.getActiveAttrib(t,r),a=n.name,s=1;n.type===e.FLOAT_MAT2&&(s=2),n.type===e.FLOAT_MAT3&&(s=3),n.type===e.FLOAT_MAT4&&(s=4),i[a]={type:n.type,location:e.getAttribLocation(t,a),locationSize:s}}return i}(h,b)}h.attachShader(b,E),h.attachShader(b,C),void 0!==i.index0AttributeName?h.bindAttribLocation(b,0,i.index0AttributeName):!0===i.morphTargets&&h.bindAttribLocation(b,0,"position"),h.linkProgram(b),this.getUniforms=function(){return void 0===s&&T(this),s},this.getAttributes=function(){return void 0===o&&T(this),o};let R=!1===i.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===R&&(R=h.getProgramParameter(b,37297)),R},this.destroy=function(){n.releaseStatesOfProgram(this),h.deleteProgram(b),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=ra++,this.cacheKey=t,this.usedTimes=1,this.program=b,this.vertexShader=E,this.fragmentShader=C,this}let rx=0;class r_{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return!1===a.has(n)&&(a.add(n),n.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(e){for(let t of this.materialCache.get(e))t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return void 0===i&&(i=new rA(e),t.set(e,i)),i}}class rA{constructor(e){this.id=rx++,this.code=e,this.usedTimes=0}}function rb(e,t,i,n,r,a,s){let l=new tl,h=new r_,u=[],d=r.isWebGL2,p=r.logarithmicDepthBuffer,f=r.vertexTextures,m=r.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(a,l,u,y,x){let _,A,b,S;let w=y.fog,M=x.geometry,E=a.isMeshStandardMaterial?y.environment:null,C=(a.isMeshStandardMaterial?i:t).get(a.envMap||E),T=C&&306===C.mapping?C.image.height:null,R=g[a.type];null!==a.precision&&(m=r.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",m,"instead.");let P=M.morphAttributes.position||M.morphAttributes.normal||M.morphAttributes.color,I=void 0!==P?P.length:0,L=0;if(void 0!==M.morphAttributes.position&&(L=1),void 0!==M.morphAttributes.normal&&(L=2),void 0!==M.morphAttributes.color&&(L=3),R){let e=iz[R];_=e.vertexShader,A=e.fragmentShader}else _=a.vertexShader,A=a.fragmentShader,h.update(a),b=h.getVertexShaderID(a),S=h.getFragmentShaderID(a);let D=e.getRenderTarget(),B=!0===x.isInstancedMesh,O=!0===x.isBatchedMesh,N=!!a.map,U=!!a.matcap,k=!!C,z=!!a.aoMap,H=!!a.lightMap,G=!!a.bumpMap,W=!!a.normalMap,j=!!a.displacementMap,q=!!a.emissiveMap,X=!!a.metalnessMap,Y=!!a.roughnessMap,K=a.anisotropy>0,Q=a.clearcoat>0,J=a.iridescence>0,Z=a.sheen>0,$=a.transmission>0,ee=K&&!!a.anisotropyMap,et=Q&&!!a.clearcoatMap,ei=Q&&!!a.clearcoatNormalMap,en=Q&&!!a.clearcoatRoughnessMap,er=J&&!!a.iridescenceMap,ea=J&&!!a.iridescenceThicknessMap,es=Z&&!!a.sheenColorMap,eo=Z&&!!a.sheenRoughnessMap,el=!!a.specularMap,ec=!!a.specularColorMap,eh=!!a.specularIntensityMap,eu=$&&!!a.transmissionMap,ed=$&&!!a.thicknessMap,ep=!!a.gradientMap,ef=!!a.alphaMap,em=a.alphaTest>0,eg=!!a.alphaHash,ey=!!a.extensions,ex=!!M.attributes.uv1,e_=!!M.attributes.uv2,eA=!!M.attributes.uv3,eb=0;return a.toneMapped&&(null===D||!0===D.isXRRenderTarget)&&(eb=e.toneMapping),{isWebGL2:d,shaderID:R,shaderType:a.type,shaderName:a.name,vertexShader:_,fragmentShader:A,defines:a.defines,customVertexShaderID:b,customFragmentShaderID:S,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:m,batching:O,instancing:B,instancingColor:B&&null!==x.instanceColor,supportsVertexTextures:f,outputColorSpace:null===D?e.outputColorSpace:!0===D.isXRRenderTarget?D.texture.colorSpace:F,map:N,matcap:U,envMap:k,envMapMode:k&&C.mapping,envMapCubeUVHeight:T,aoMap:z,lightMap:H,bumpMap:G,normalMap:W,displacementMap:f&&j,emissiveMap:q,normalMapObjectSpace:W&&1===a.normalMapType,normalMapTangentSpace:W&&0===a.normalMapType,metalnessMap:X,roughnessMap:Y,anisotropy:K,anisotropyMap:ee,clearcoat:Q,clearcoatMap:et,clearcoatNormalMap:ei,clearcoatRoughnessMap:en,iridescence:J,iridescenceMap:er,iridescenceThicknessMap:ea,sheen:Z,sheenColorMap:es,sheenRoughnessMap:eo,specularMap:el,specularColorMap:ec,specularIntensityMap:eh,transmission:$,transmissionMap:eu,thicknessMap:ed,gradientMap:ep,opaque:!1===a.transparent&&a.blending===c,alphaMap:ef,alphaTest:em,alphaHash:eg,combine:a.combine,mapUv:N&&v(a.map.channel),aoMapUv:z&&v(a.aoMap.channel),lightMapUv:H&&v(a.lightMap.channel),bumpMapUv:G&&v(a.bumpMap.channel),normalMapUv:W&&v(a.normalMap.channel),displacementMapUv:j&&v(a.displacementMap.channel),emissiveMapUv:q&&v(a.emissiveMap.channel),metalnessMapUv:X&&v(a.metalnessMap.channel),roughnessMapUv:Y&&v(a.roughnessMap.channel),anisotropyMapUv:ee&&v(a.anisotropyMap.channel),clearcoatMapUv:et&&v(a.clearcoatMap.channel),clearcoatNormalMapUv:ei&&v(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:en&&v(a.clearcoatRoughnessMap.channel),iridescenceMapUv:er&&v(a.iridescenceMap.channel),iridescenceThicknessMapUv:ea&&v(a.iridescenceThicknessMap.channel),sheenColorMapUv:es&&v(a.sheenColorMap.channel),sheenRoughnessMapUv:eo&&v(a.sheenRoughnessMap.channel),specularMapUv:el&&v(a.specularMap.channel),specularColorMapUv:ec&&v(a.specularColorMap.channel),specularIntensityMapUv:eh&&v(a.specularIntensityMap.channel),transmissionMapUv:eu&&v(a.transmissionMap.channel),thicknessMapUv:ed&&v(a.thicknessMap.channel),alphaMapUv:ef&&v(a.alphaMap.channel),vertexTangents:!!M.attributes.tangent&&(W||K),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!M.attributes.color&&4===M.attributes.color.itemSize,vertexUv1s:ex,vertexUv2s:e_,vertexUv3s:eA,pointsUvs:!0===x.isPoints&&!!M.attributes.uv&&(N||ef),fog:!!w,useFog:!0===a.fog,fogExp2:w&&w.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:p,skinning:!0===x.isSkinnedMesh,morphTargets:void 0!==M.morphAttributes.position,morphNormals:void 0!==M.morphAttributes.normal,morphColors:void 0!==M.morphAttributes.color,morphTargetsCount:I,morphTextureStride:L,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numLightProbes:l.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:eb,useLegacyLights:e._useLegacyLights,decodeVideoTexture:N&&!0===a.map.isVideoTexture&&ev.getTransfer(a.map.colorSpace)===V,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===o,flipSided:1===a.side,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:ey&&!0===a.extensions.derivatives,extensionFragDepth:ey&&!0===a.extensions.fragDepth,extensionDrawBuffers:ey&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:ey&&!0===a.extensions.shaderTextureLOD,extensionClipCullDistance:ey&&a.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:d||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var i,n,r,a;let s=[];if(t.shaderID?s.push(t.shaderID):(s.push(t.customVertexShaderID),s.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)s.push(e),s.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(i=s,n=t,i.push(n.precision),i.push(n.outputColorSpace),i.push(n.envMapMode),i.push(n.envMapCubeUVHeight),i.push(n.mapUv),i.push(n.alphaMapUv),i.push(n.lightMapUv),i.push(n.aoMapUv),i.push(n.bumpMapUv),i.push(n.normalMapUv),i.push(n.displacementMapUv),i.push(n.emissiveMapUv),i.push(n.metalnessMapUv),i.push(n.roughnessMapUv),i.push(n.anisotropyMapUv),i.push(n.clearcoatMapUv),i.push(n.clearcoatNormalMapUv),i.push(n.clearcoatRoughnessMapUv),i.push(n.iridescenceMapUv),i.push(n.iridescenceThicknessMapUv),i.push(n.sheenColorMapUv),i.push(n.sheenRoughnessMapUv),i.push(n.specularMapUv),i.push(n.specularColorMapUv),i.push(n.specularIntensityMapUv),i.push(n.transmissionMapUv),i.push(n.thicknessMapUv),i.push(n.combine),i.push(n.fogExp2),i.push(n.sizeAttenuation),i.push(n.morphTargetsCount),i.push(n.morphAttributeCount),i.push(n.numDirLights),i.push(n.numPointLights),i.push(n.numSpotLights),i.push(n.numSpotLightMaps),i.push(n.numHemiLights),i.push(n.numRectAreaLights),i.push(n.numDirLightShadows),i.push(n.numPointLightShadows),i.push(n.numSpotLightShadows),i.push(n.numSpotLightShadowsWithMaps),i.push(n.numLightProbes),i.push(n.shadowMapType),i.push(n.toneMapping),i.push(n.numClippingPlanes),i.push(n.numClipIntersection),i.push(n.depthPacking),r=s,a=t,l.disableAll(),a.isWebGL2&&l.enable(0),a.supportsVertexTextures&&l.enable(1),a.instancing&&l.enable(2),a.instancingColor&&l.enable(3),a.matcap&&l.enable(4),a.envMap&&l.enable(5),a.normalMapObjectSpace&&l.enable(6),a.normalMapTangentSpace&&l.enable(7),a.clearcoat&&l.enable(8),a.iridescence&&l.enable(9),a.alphaTest&&l.enable(10),a.vertexColors&&l.enable(11),a.vertexAlphas&&l.enable(12),a.vertexUv1s&&l.enable(13),a.vertexUv2s&&l.enable(14),a.vertexUv3s&&l.enable(15),a.vertexTangents&&l.enable(16),a.anisotropy&&l.enable(17),a.alphaHash&&l.enable(18),a.batching&&l.enable(19),r.push(l.mask),l.disableAll(),a.fog&&l.enable(0),a.useFog&&l.enable(1),a.flatShading&&l.enable(2),a.logarithmicDepthBuffer&&l.enable(3),a.skinning&&l.enable(4),a.morphTargets&&l.enable(5),a.morphNormals&&l.enable(6),a.morphColors&&l.enable(7),a.premultipliedAlpha&&l.enable(8),a.shadowMapEnabled&&l.enable(9),a.useLegacyLights&&l.enable(10),a.doubleSided&&l.enable(11),a.flipSided&&l.enable(12),a.useDepthPacking&&l.enable(13),a.dithering&&l.enable(14),a.transmission&&l.enable(15),a.sheen&&l.enable(16),a.opaque&&l.enable(17),a.pointsUvs&&l.enable(18),a.decodeVideoTexture&&l.enable(19),r.push(l.mask),s.push(e.outputColorSpace)),s.push(t.customProgramCacheKey),s.join()},getUniforms:function(e){let t;let i=g[e.type];if(i){let e=iz[i];t=iA.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,i){let n;for(let e=0,t=u.length;e<t;e++){let t=u[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new ry(e,i,t,a),u.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){let t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){h.remove(e)},programs:u,dispose:function(){h.dispose()}}}function rS(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function rw(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function rM(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function rE(){let e=[],t=0,i=[],n=[],r=[];function a(i,n,r,a,s,o){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:a,renderOrder:i.renderOrder,z:s,group:o},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=a,l.renderOrder=i.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,s,o,l,c){let h=a(e,t,s,o,l,c);s.transmission>0?n.push(h):!0===s.transparent?r.push(h):i.push(h)},unshift:function(e,t,s,o,l,c){let h=a(e,t,s,o,l,c);s.transmission>0?n.unshift(h):!0===s.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=t,n=e.length;i<n;i++){let t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||rw),n.length>1&&n.sort(t||rM),r.length>1&&r.sort(t||rM)}}}function rC(){let e=new WeakMap;return{get:function(t,i){let n;let r=e.get(t);return void 0===r?(n=new rE,e.set(t,[n])):i>=r.length?(n=new rE,r.push(n)):n=r[i],n},dispose:function(){e=new WeakMap}}}function rT(){let e={};return{get:function(t){let i;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":i={direction:new eI,color:new tk};break;case"SpotLight":i={position:new eI,direction:new eI,color:new tk,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new eI,color:new tk,distance:0,decay:0};break;case"HemisphereLight":i={direction:new eI,skyColor:new tk,groundColor:new tk};break;case"RectAreaLight":i={color:new tk,position:new eI,halfWidth:new eI,halfHeight:new eI}}return e[t.id]=i,i}}}let rR=0;function rP(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function rI(e,t){let i=new rT,n=function(){let e={};return{get:function(t){let i;if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new es};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new es,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new eI);let a=new eI,s=new e8,o=new e8;return{setup:function(a,s){let o=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,x=0,_=0;a.sort(rP);let A=!0===s?Math.PI:1;for(let e=0,t=a.length;e<t;e++){let t=a[e],s=t.color,b=t.intensity,S=t.distance,w=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=s.r*b*A,l+=s.g*b*A,c+=s.b*b*A;else if(t.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],b);_++}else if(t.isDirectionalLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=w,r.directionalShadowMatrix[h]=t.shadow.matrix,m++}r.directional[h]=e,h++}else if(t.isSpotLight){let e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(b*A),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[d]=e;let a=t.shadow;if(t.map&&(r.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&x++),r.spotLightMatrix[d]=a.matrix,t.castShadow){let e=n.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,r.spotShadow[d]=e,r.spotShadowMap[d]=w,v++}d++}else if(t.isRectAreaLight){let e=i.get(t);e.color.copy(s).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*A),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=w,r.pointShadowMatrix[u]=t.shadow.matrix,g++}r.point[u]=e,u++}else if(t.isHemisphereLight){let e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(b*A),e.groundColor.copy(t.groundColor).multiplyScalar(b*A),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2?!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ik.LTC_FLOAT_1,r.rectAreaLTC2=ik.LTC_FLOAT_2):(r.rectAreaLTC1=ik.LTC_HALF_1,r.rectAreaLTC2=ik.LTC_HALF_2):!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=ik.LTC_FLOAT_1,r.rectAreaLTC2=ik.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=ik.LTC_HALF_1,r.rectAreaLTC2=ik.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;let b=r.hash;(b.directionalLength!==h||b.pointLength!==u||b.spotLength!==d||b.rectAreaLength!==p||b.hemiLength!==f||b.numDirectionalShadows!==m||b.numPointShadows!==g||b.numSpotShadows!==v||b.numSpotMaps!==y||b.numLightProbes!==_)&&(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-x,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=x,r.numLightProbes=_,b.directionalLength=h,b.pointLength=u,b.spotLength=d,b.rectAreaLength=p,b.hemiLength=f,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=v,b.numSpotMaps=y,b.numLightProbes=_,r.version=rR++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0,u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){let d=e[t];if(d.isDirectionalLight){let e=r.directional[i];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),i++}else if(d.isSpotLight){let e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){let e=r.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),o.identity(),s.copy(d.matrixWorld),s.premultiply(u),o.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){let e=r.point[n];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){let e=r.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),h++}}},state:r}}function rL(e,t){let i=new rI(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function rD(e,t){let i=new WeakMap;return{get:function(n,r=0){let a;let s=i.get(n);return void 0===s?(a=new rL(e,t),i.set(n,[a])):r>=s.length?(a=new rL(e,t),s.push(a)):a=s[r],a},dispose:function(){i=new WeakMap}}}class rB extends tV{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class rO extends tV{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function rN(e,t,i){let n=new iB,r=new es,a=new es,c=new eE,h=new rB({depthPacking:3201}),u=new rO,d={},p=i.maxTextureSize,f={[s]:1,1:s,[o]:o},m=new ib({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new es},radius:{value:4}},vertexShader:"void main() {\n	gl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n	const float samples = float( VSM_SAMPLES );\n	float mean = 0.0;\n	float squared_mean = 0.0;\n	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n	for ( float i = 0.0; i < samples; i ++ ) {\n		float uvOffset = uvStart + i * uvStride;\n		#ifdef HORIZONTAL_PASS\n			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n			mean += distribution.x;\n			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n		#else\n			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n			mean += depth;\n			squared_mean += depth * depth;\n		#endif\n	}\n	mean = mean / samples;\n	squared_mean = squared_mean / samples;\n	float std_dev = sqrt( squared_mean - mean * mean );\n	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),g=m.clone();g.defines.HORIZONTAL_PASS=1;let y=new t5;y.setAttribute("position",new tY(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let x=new im(y,m),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let A=this.type;function b(t,i,n,r){let a=null,s=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===n.isPointLight?u:h,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){let e=a.uuid,t=i.uuid,n=d[e];void 0===n&&(n={},d[e]=n);let r=n[t];void 0===r&&(r=a.clone(),n[t]=r,i.addEventListener("dispose",S)),a=r}return a.visible=i.visible,a.wireframe=i.wireframe,3===r?a.side=null!==i.shadowSide?i.shadowSide:i.side:a.side=null!==i.shadowSide?i.shadowSide:f[i.side],a.alphaMap=i.alphaMap,a.alphaTest=i.alphaTest,a.map=i.map,a.clipShadows=i.clipShadows,a.clippingPlanes=i.clippingPlanes,a.clipIntersection=i.clipIntersection,a.displacementMap=i.displacementMap,a.displacementScale=i.displacementScale,a.displacementBias=i.displacementBias,a.wireframeLinewidth=i.wireframeLinewidth,a.linewidth=i.linewidth,!0===n.isPointLight&&!0===a.isMeshDistanceMaterial&&(e.properties.get(a).light=n),a}function S(e){for(let t in e.target.removeEventListener("dispose",S),d){let i=d[t],n=e.target.uuid;n in i&&(i[n].dispose(),delete i[n])}}this.render=function(i,s,o){if(!1===_.enabled||!1===_.autoUpdate&&!1===_.needsUpdate||0===i.length)return;let h=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),f=e.state;f.setBlending(l),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);let y=3!==A&&3===this.type,S=3===A&&3!==this.type;for(let l=0,h=i.length;l<h;l++){let h=i[l],u=h.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);let d=u.getFrameExtents();if(r.multiply(d),a.copy(u.mapSize),(r.x>p||r.y>p)&&(r.x>p&&(a.x=Math.floor(p/d.x),r.x=a.x*d.x,u.mapSize.x=a.x),r.y>p&&(a.y=Math.floor(p/d.y),r.y=a.y*d.y,u.mapSize.y=a.y)),null===u.map||!0===y||!0===S){let e=3!==this.type?{minFilter:v,magFilter:v}:{};null!==u.map&&u.map.dispose(),u.map=new eT(r.x,r.y,e),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();let _=u.getViewportCount();for(let i=0;i<_;i++){let r=u.getViewport(i);c.set(a.x*r.x,a.y*r.y,a.x*r.z,a.y*r.w),f.viewport(c),u.updateMatrices(h,i),n=u.getFrustum(),function i(r,a,s,o,l){if(!1===r.visible)return;if(r.layers.test(a.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&3===l)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,r.matrixWorld);let i=t.update(r),n=r.material;if(Array.isArray(n)){let t=i.groups;for(let c=0,h=t.length;c<h;c++){let h=t[c],u=n[h.materialIndex];if(u&&u.visible){let t=b(r,u,o,l);r.onBeforeShadow(e,r,a,s,i,t,h),e.renderBufferDirect(s,null,i,t,r,h),r.onAfterShadow(e,r,a,s,i,t,h)}}}else if(n.visible){let t=b(r,n,o,l);r.onBeforeShadow(e,r,a,s,i,t,null),e.renderBufferDirect(s,null,i,t,r,null),r.onAfterShadow(e,r,a,s,i,t,null)}}let c=r.children;for(let e=0,t=c.length;e<t;e++)i(c[e],a,s,o,l)}(s,o,u.camera,h,this.type)}!0!==u.isPointLightShadow&&3===this.type&&function(i,n){let a=t.update(x);m.defines.VSM_SAMPLES!==i.blurSamples&&(m.defines.VSM_SAMPLES=i.blurSamples,g.defines.VSM_SAMPLES=i.blurSamples,m.needsUpdate=!0,g.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new eT(r.x,r.y)),m.uniforms.shadow_pass.value=i.map.texture,m.uniforms.resolution.value=i.mapSize,m.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,a,m,x,null),g.uniforms.shadow_pass.value=i.mapPass.texture,g.uniforms.resolution.value=i.mapSize,g.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,a,g,x,null)}(u,o),u.needsUpdate=!1}A=this.type,_.needsUpdate=!1,e.setRenderTarget(h,u,d)}}function rU(e,t,i){let n=i.isWebGL2,r=new function(){let t=!1,i=new eE,n=null,r=new eE(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,a,s,o){!0===o&&(t*=s,n*=s,a*=s),i.set(t,n,a,s),!1===r.equals(i)&&(e.clearColor(t,n,a,s),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(t){t?Y(e.DEPTH_TEST):K(e.DEPTH_TEST)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},s=new function(){let t=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(i){t||(i?Y(e.STENCIL_TEST):K(e.STENCIL_TEST))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,s){(n!==t||r!==i||a!==s)&&(e.stencilFunc(t,i,s),n=t,r=i,a=s)},setOp:function(t,i,n){(s!==t||o!==i||l!==n)&&(e.stencilOp(t,i,n),s=t,o=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,c=null}}},p=new WeakMap,f=new WeakMap,m={},g={},v=new WeakMap,y=[],x=null,_=!1,A=null,b=null,S=null,w=null,M=null,E=null,C=null,T=new tk(0,0,0),R=0,P=!1,I=null,L=null,D=null,B=null,O=null,N=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),U=!1,F=0,k=e.getParameter(e.VERSION);-1!==k.indexOf("WebGL")?U=parseFloat(/^WebGL (\d)/.exec(k)[1])>=1:-1!==k.indexOf("OpenGL ES")&&(U=parseFloat(/^OpenGL ES (\d)/.exec(k)[1])>=2);let z=null,H={},V=e.getParameter(e.SCISSOR_BOX),G=e.getParameter(e.VIEWPORT),W=new eE().fromArray(V),j=new eE().fromArray(G);function q(t,i,r,a){let s=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<r;o++)n&&(t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY)?e.texImage3D(i,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(i+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return o}let X={};function Y(t){!0!==m[t]&&(e.enable(t),m[t]=!0)}function K(t){!1!==m[t]&&(e.disable(t),m[t]=!1)}X[e.TEXTURE_2D]=q(e.TEXTURE_2D,e.TEXTURE_2D,1),X[e.TEXTURE_CUBE_MAP]=q(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(X[e.TEXTURE_2D_ARRAY]=q(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),X[e.TEXTURE_3D]=q(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),r.setClear(0,0,0,1),a.setClear(1),s.setClear(0),Y(e.DEPTH_TEST),a.setFunc(3),$(!1),ee(1),Y(e.CULL_FACE),Z(l);let Q={100:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(n)Q[103]=e.MIN,Q[104]=e.MAX;else{let e=t.get("EXT_blend_minmax");null!==e&&(Q[103]=e.MIN_EXT,Q[104]=e.MAX_EXT)}let J={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,[u]:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,[d]:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA,211:e.CONSTANT_COLOR,212:e.ONE_MINUS_CONSTANT_COLOR,213:e.CONSTANT_ALPHA,214:e.ONE_MINUS_CONSTANT_ALPHA};function Z(t,i,n,r,a,s,o,u,d,p){if(t===l){!0===_&&(K(e.BLEND),_=!1);return}if(!1===_&&(Y(e.BLEND),_=!0),t!==h){if(t!==A||p!==P){if((100!==b||100!==M)&&(e.blendEquation(e.FUNC_ADD),b=100,M=100),p)switch(t){case c:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case c:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}S=null,w=null,E=null,C=null,T.set(0,0,0),R=0,A=t,P=p}return}a=a||i,s=s||n,o=o||r,(i!==b||a!==M)&&(e.blendEquationSeparate(Q[i],Q[a]),b=i,M=a),(n!==S||r!==w||s!==E||o!==C)&&(e.blendFuncSeparate(J[n],J[r],J[s],J[o]),S=n,w=r,E=s,C=o),(!1===u.equals(T)||d!==R)&&(e.blendColor(u.r,u.g,u.b,d),T.copy(u),R=d),A=t,P=!1}function $(t){I!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),I=t)}function ee(t){0!==t?(Y(e.CULL_FACE),t!==L&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):K(e.CULL_FACE),L=t}function et(t,i,n){t?(Y(e.POLYGON_OFFSET_FILL),(B!==i||O!==n)&&(e.polygonOffset(i,n),B=i,O=n)):K(e.POLYGON_OFFSET_FILL)}return{buffers:{color:r,depth:a,stencil:s},enable:Y,disable:K,bindFramebuffer:function(t,i){return g[t]!==i&&(e.bindFramebuffer(t,i),g[t]=i,n&&(t===e.DRAW_FRAMEBUFFER&&(g[e.FRAMEBUFFER]=i),t===e.FRAMEBUFFER&&(g[e.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,r){let a=y,s=!1;if(n){if(void 0===(a=v.get(r))&&(a=[],v.set(r,a)),n.isWebGLMultipleRenderTargets){let t=n.texture;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let i=0,n=t.length;i<n;i++)a[i]=e.COLOR_ATTACHMENT0+i;a.length=t.length,s=!0}}else a[0]!==e.COLOR_ATTACHMENT0&&(a[0]=e.COLOR_ATTACHMENT0,s=!0)}else a[0]!==e.BACK&&(a[0]=e.BACK,s=!0);s&&(i.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return x!==t&&(e.useProgram(t),x=t,!0)},setBlending:Z,setMaterial:function(t,i){t.side===o?K(e.CULL_FACE):Y(e.CULL_FACE);let n=1===t.side;i&&(n=!n),$(n),t.blending===c&&!1===t.transparent?Z(l):Z(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),r.setMask(t.colorWrite);let h=t.stencilWrite;s.setTest(h),h&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),et(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?Y(e.SAMPLE_ALPHA_TO_COVERAGE):K(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:$,setCullFace:ee,setLineWidth:function(t){t!==D&&(U&&e.lineWidth(t),D=t)},setPolygonOffset:et,setScissorTest:function(t){t?Y(e.SCISSOR_TEST):K(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+N-1),z!==t&&(e.activeTexture(t),z=t)},bindTexture:function(t,i,n){void 0===n&&(n=null===z?e.TEXTURE0+N-1:z);let r=H[n];void 0===r&&(r={type:void 0,texture:void 0},H[n]=r),(r.type!==t||r.texture!==i)&&(z!==n&&(e.activeTexture(n),z=n),e.bindTexture(t,i||X[t]),r.type=t,r.texture=i)},unbindTexture:function(){let t=H[z];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,i){let n=f.get(i);void 0===n&&(n=new WeakMap,f.set(i,n));let r=n.get(t);void 0===r&&(r=e.getUniformBlockIndex(i,t.name),n.set(t,r))},uniformBlockBinding:function(t,i){let n=f.get(i).get(t);p.get(i)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),p.set(i,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===W.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),W.copy(t))},viewport:function(t){!1===j.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),j.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(0xffffffff),e.stencilFunc(e.ALWAYS,0,0xffffffff),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===n&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),m={},z=null,H={},g={},v=new WeakMap,y=[],x=null,_=!1,A=null,b=null,S=null,w=null,M=null,E=null,C=null,T=new tk(0,0,0),R=0,P=!1,I=null,L=null,D=null,B=null,O=null,W.set(0,0,e.canvas.width,e.canvas.height),j.set(0,0,e.canvas.width,e.canvas.height),r.reset(),a.reset(),s.reset()}}}function rF(e,t,i,n,r,a,s){let o;let l=r.isWebGL2,c=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,h="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new WeakMap,d=new WeakMap,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function R(e,t){return p?new OffscreenCanvas(e,t):eh("canvas")}function P(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let n=t?ei:Math.floor,a=n(r*e.width),s=n(r*e.height);void 0===o&&(o=R(a,s));let l=i?R(a,s):o;return l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),l}"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+").")}return e}function I(e){return et(e.width)&&et(e.height)}function L(e,t){return e.generateMipmaps&&t&&e.minFilter!==v&&e.minFilter!==_}function D(t){e.generateMipmap(t)}function B(i,n,r,a,s=!1){if(!1===l)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;if(n===e.RED&&(r===e.FLOAT&&(o=e.R32F),r===e.HALF_FLOAT&&(o=e.R16F),r===e.UNSIGNED_BYTE&&(o=e.R8)),n===e.RED_INTEGER&&(r===e.UNSIGNED_BYTE&&(o=e.R8UI),r===e.UNSIGNED_SHORT&&(o=e.R16UI),r===e.UNSIGNED_INT&&(o=e.R32UI),r===e.BYTE&&(o=e.R8I),r===e.SHORT&&(o=e.R16I),r===e.INT&&(o=e.R32I)),n===e.RG&&(r===e.FLOAT&&(o=e.RG32F),r===e.HALF_FLOAT&&(o=e.RG16F),r===e.UNSIGNED_BYTE&&(o=e.RG8)),n===e.RGBA){let t=s?H:ev.getTransfer(a);r===e.FLOAT&&(o=e.RGBA32F),r===e.HALF_FLOAT&&(o=e.RGBA16F),r===e.UNSIGNED_BYTE&&(o=t===V?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return(o===e.R16F||o===e.R32F||o===e.RG16F||o===e.RG32F||o===e.RGBA16F||o===e.RGBA32F)&&t.get("EXT_color_buffer_float"),o}function O(e,t,i){return!0===L(e,i)||e.isFramebufferTexture&&e.minFilter!==v&&e.minFilter!==_?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function N(t){return t===v||t===y||t===x?e.NEAREST:e.LINEAR}function U(e){let t=e.target;t.removeEventListener("dispose",U),function(e){let t=n.get(e);if(void 0===t.__webglInit)return;let i=e.source,r=d.get(i);if(r){let n=r[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&z(e),0===Object.keys(r).length&&d.delete(i)}n.remove(e)}(t),t.isVideoTexture&&u.delete(t)}function k(t){let i=t.target;i.removeEventListener("dispose",k),function(t){let i=t.texture,r=n.get(t),a=n.get(i);if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(r.__webglFramebuffer[t]))for(let i=0;i<r.__webglFramebuffer[t].length;i++)e.deleteFramebuffer(r.__webglFramebuffer[t][i]);else e.deleteFramebuffer(r.__webglFramebuffer[t]);r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t])}else{if(Array.isArray(r.__webglFramebuffer))for(let t=0;t<r.__webglFramebuffer.length;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer);if(r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,r=i.length;t<r;t++){let r=n.get(i[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),s.memory.textures--),n.remove(i[t])}n.remove(i),n.remove(t)}(i)}function z(t){let i=n.get(t);e.deleteTexture(i.__webglTexture);let r=t.source,a=d.get(r);delete a[i.__cacheKey],s.memory.textures--}let G=0;function W(t,r){let a=n.get(t);if(t.isVideoTexture&&function(e){let t=s.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){let e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(!1===e.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(a,t,r);return}}i.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+r)}let j={[f]:e.REPEAT,[m]:e.CLAMP_TO_EDGE,[g]:e.MIRRORED_REPEAT},q={[v]:e.NEAREST,[y]:e.NEAREST_MIPMAP_NEAREST,[x]:e.NEAREST_MIPMAP_LINEAR,[_]:e.LINEAR,[A]:e.LINEAR_MIPMAP_NEAREST,[b]:e.LINEAR_MIPMAP_LINEAR},X={512:e.NEVER,519:e.ALWAYS,513:e.LESS,515:e.LEQUAL,514:e.EQUAL,518:e.GEQUAL,516:e.GREATER,517:e.NOTEQUAL};function Y(i,a,s){if(s?(e.texParameteri(i,e.TEXTURE_WRAP_S,j[a.wrapS]),e.texParameteri(i,e.TEXTURE_WRAP_T,j[a.wrapT]),(i===e.TEXTURE_3D||i===e.TEXTURE_2D_ARRAY)&&e.texParameteri(i,e.TEXTURE_WRAP_R,j[a.wrapR]),e.texParameteri(i,e.TEXTURE_MAG_FILTER,q[a.magFilter]),e.texParameteri(i,e.TEXTURE_MIN_FILTER,q[a.minFilter])):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(i===e.TEXTURE_3D||i===e.TEXTURE_2D_ARRAY)&&e.texParameteri(i,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),(a.wrapS!==m||a.wrapT!==m)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,e.TEXTURE_MAG_FILTER,N(a.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,N(a.minFilter)),a.minFilter!==v&&a.minFilter!==_&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(i,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(i,e.TEXTURE_COMPARE_FUNC,X[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){let s=t.get("EXT_texture_filter_anisotropic");a.magFilter!==v&&(a.minFilter===x||a.minFilter===b)&&(a.type!==M||!1!==t.has("OES_texture_float_linear"))&&(!1!==l||a.type!==E||!1!==t.has("OES_texture_half_float_linear"))&&(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function K(t,i){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",U));let r=i.source,a=d.get(r);void 0===a&&(a={},d.set(r,a));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(i);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,n=!0),a[o].usedTimes++;let r=a[t.__cacheKey];void 0!==r&&(a[t.__cacheKey].usedTimes--,0===r.usedTimes&&z(i)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return n}function Q(t,s,o){let c=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(c=e.TEXTURE_3D);let h=K(t,s),u=s.source;i.bindTexture(c,t.__webglTexture,e.TEXTURE0+o);let d=n.get(u);if(u.version!==d.__version||!0===h){let t;i.activeTexture(e.TEXTURE0+o);let n=ev.getPrimaries(ev.workingColorSpace),p=""===s.colorSpace?null:ev.getPrimaries(s.colorSpace),f=""===s.colorSpace||n===p?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,f);let g=!l&&(s.wrapS!==m||s.wrapT!==m||s.minFilter!==v&&s.minFilter!==_)&&!1===I(s.image),y=P(s.image,g,!1,r.maxTextureSize),x=I(y=er(s,y))||l,A=a.convert(s.format,s.colorSpace),b=a.convert(s.type),S=B(s.internalFormat,A,b,s.colorSpace,s.isVideoTexture);Y(c,s,x);let E=s.mipmaps,R=l&&!0!==s.isVideoTexture&&36196!==S,N=void 0===d.__version||!0===h,U=O(s,y,x);if(s.isDepthTexture)S=e.DEPTH_COMPONENT,l?S=s.type===M?e.DEPTH_COMPONENT32F:s.type===w?e.DEPTH_COMPONENT24:1020===s.type?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:s.type===M&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),s.format===T&&S===e.DEPTH_COMPONENT&&1012!==s.type&&s.type!==w&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),s.type=w,b=a.convert(s.type)),1027===s.format&&S===e.DEPTH_COMPONENT&&(S=e.DEPTH_STENCIL,1020!==s.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),s.type=1020,b=a.convert(s.type))),N&&(R?i.texStorage2D(e.TEXTURE_2D,1,S,y.width,y.height):i.texImage2D(e.TEXTURE_2D,0,S,y.width,y.height,0,A,b,null));else if(s.isDataTexture){if(E.length>0&&x){R&&N&&i.texStorage2D(e.TEXTURE_2D,U,S,E[0].width,E[0].height);for(let n=0,r=E.length;n<r;n++)t=E[n],R?i.texSubImage2D(e.TEXTURE_2D,n,0,0,t.width,t.height,A,b,t.data):i.texImage2D(e.TEXTURE_2D,n,S,t.width,t.height,0,A,b,t.data);s.generateMipmaps=!1}else R?(N&&i.texStorage2D(e.TEXTURE_2D,U,S,y.width,y.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,y.width,y.height,A,b,y.data)):i.texImage2D(e.TEXTURE_2D,0,S,y.width,y.height,0,A,b,y.data)}else if(s.isCompressedTexture){if(s.isCompressedArrayTexture){R&&N&&i.texStorage3D(e.TEXTURE_2D_ARRAY,U,S,E[0].width,E[0].height,y.depth);for(let n=0,r=E.length;n<r;n++)t=E[n],s.format!==C?null!==A?R?i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,n,0,0,0,t.width,t.height,y.depth,A,t.data,0,0):i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,n,S,t.width,t.height,y.depth,0,t.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):R?i.texSubImage3D(e.TEXTURE_2D_ARRAY,n,0,0,0,t.width,t.height,y.depth,A,b,t.data):i.texImage3D(e.TEXTURE_2D_ARRAY,n,S,t.width,t.height,y.depth,0,A,b,t.data)}else{R&&N&&i.texStorage2D(e.TEXTURE_2D,U,S,E[0].width,E[0].height);for(let n=0,r=E.length;n<r;n++)t=E[n],s.format!==C?null!==A?R?i.compressedTexSubImage2D(e.TEXTURE_2D,n,0,0,t.width,t.height,A,t.data):i.compressedTexImage2D(e.TEXTURE_2D,n,S,t.width,t.height,0,t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):R?i.texSubImage2D(e.TEXTURE_2D,n,0,0,t.width,t.height,A,b,t.data):i.texImage2D(e.TEXTURE_2D,n,S,t.width,t.height,0,A,b,t.data)}}else if(s.isDataArrayTexture)R?(N&&i.texStorage3D(e.TEXTURE_2D_ARRAY,U,S,y.width,y.height,y.depth),i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,y.width,y.height,y.depth,A,b,y.data)):i.texImage3D(e.TEXTURE_2D_ARRAY,0,S,y.width,y.height,y.depth,0,A,b,y.data);else if(s.isData3DTexture)R?(N&&i.texStorage3D(e.TEXTURE_3D,U,S,y.width,y.height,y.depth),i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,y.width,y.height,y.depth,A,b,y.data)):i.texImage3D(e.TEXTURE_3D,0,S,y.width,y.height,y.depth,0,A,b,y.data);else if(s.isFramebufferTexture){if(N){if(R)i.texStorage2D(e.TEXTURE_2D,U,S,y.width,y.height);else{let t=y.width,n=y.height;for(let r=0;r<U;r++)i.texImage2D(e.TEXTURE_2D,r,S,t,n,0,A,b,null),t>>=1,n>>=1}}}else if(E.length>0&&x){R&&N&&i.texStorage2D(e.TEXTURE_2D,U,S,E[0].width,E[0].height);for(let n=0,r=E.length;n<r;n++)t=E[n],R?i.texSubImage2D(e.TEXTURE_2D,n,0,0,A,b,t):i.texImage2D(e.TEXTURE_2D,n,S,A,b,t);s.generateMipmaps=!1}else R?(N&&i.texStorage2D(e.TEXTURE_2D,U,S,y.width,y.height),i.texSubImage2D(e.TEXTURE_2D,0,0,0,A,b,y)):i.texImage2D(e.TEXTURE_2D,0,S,A,b,y);L(s,x)&&D(c),d.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function J(t,r,s,o,l,h){let u=a.convert(s.format,s.colorSpace),d=a.convert(s.type),p=B(s.internalFormat,u,d,s.colorSpace);if(!n.get(r).__hasExternalTextures){let t=Math.max(1,r.width>>h),n=Math.max(1,r.height>>h);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?i.texImage3D(l,h,p,t,n,r.depth,0,u,d,null):i.texImage2D(l,h,p,t,n,0,u,d,null)}i.bindFramebuffer(e.FRAMEBUFFER,t),en(r)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,n.get(s).__webglTexture,0,ee(r)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,n.get(s).__webglTexture,h),i.bindFramebuffer(e.FRAMEBUFFER,null)}function Z(t,i,n){if(e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer){let r=!0===l?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(n||en(i)){let t=i.depthTexture;t&&t.isDepthTexture&&(t.type===M?r=e.DEPTH_COMPONENT32F:t.type===w&&(r=e.DEPTH_COMPONENT24));let n=ee(i);en(i)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,n,r,i.width,i.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,n,r,i.width,i.height)}else e.renderbufferStorage(e.RENDERBUFFER,r,i.width,i.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(i.depthBuffer&&i.stencilBuffer){let r=ee(i);n&&!1===en(i)?e.renderbufferStorageMultisample(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,i.width,i.height):en(i)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,r,e.DEPTH24_STENCIL8,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{let t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<t.length;r++){let s=t[r],o=a.convert(s.format,s.colorSpace),l=a.convert(s.type),h=B(s.internalFormat,o,l,s.colorSpace),u=ee(i);n&&!1===en(i)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,h,i.width,i.height):en(i)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,h,i.width,i.height):e.renderbufferStorage(e.RENDERBUFFER,h,i.width,i.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function $(t){let r=n.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,t),!(r.depthTexture&&r.depthTexture.isDepthTexture))throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),W(r.depthTexture,0);let a=n.get(r.depthTexture).__webglTexture,s=ee(r);if(r.depthTexture.format===T)en(r)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else if(1027===r.depthTexture.format)en(r)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0);else throw Error("Unknown depthTexture format")}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),Z(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),Z(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(e.FRAMEBUFFER,null)}function ee(e){return Math.min(r.maxSamples,e.samples)}function en(e){let i=n.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function er(e,i){let n=e.colorSpace,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||1035===e.format||n!==F&&""!==n&&(ev.getTransfer(n)===V?!1===l?!0===t.has("EXT_sRGB")&&r===C?(e.format=1035,e.minFilter=_,e.generateMipmaps=!1):i=e_.sRGBToLinear(i):(r!==C||a!==S)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),i}this.allocateTextureUnit=function(){let e=G;return e>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+r.maxTextures),G+=1,e},this.resetTextureUnits=function(){G=0},this.setTexture2D=W,this.setTexture2DArray=function(t,r){let a=n.get(t);if(t.version>0&&a.__version!==t.version){Q(a,t,r);return}i.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+r)},this.setTexture3D=function(t,r){let a=n.get(t);if(t.version>0&&a.__version!==t.version){Q(a,t,r);return}i.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+r)},this.setTextureCube=function(t,s){let o=n.get(t);if(t.version>0&&o.__version!==t.version){(function(t,s,o){if(6!==s.image.length)return;let c=K(t,s),h=s.source;i.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);let u=n.get(h);if(h.version!==u.__version||!0===c){let t;i.activeTexture(e.TEXTURE0+o);let n=ev.getPrimaries(ev.workingColorSpace),d=""===s.colorSpace?null:ev.getPrimaries(s.colorSpace),p=""===s.colorSpace||n===d?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);let f=s.isCompressedTexture||s.image[0].isCompressedTexture,m=s.image[0]&&s.image[0].isDataTexture,g=[];for(let e=0;e<6;e++)f||m?g[e]=m?s.image[e].image:s.image[e]:g[e]=P(s.image[e],!1,!0,r.maxCubemapSize),g[e]=er(s,g[e]);let v=g[0],y=I(v)||l,x=a.convert(s.format,s.colorSpace),_=a.convert(s.type),A=B(s.internalFormat,x,_,s.colorSpace),b=l&&!0!==s.isVideoTexture,S=void 0===u.__version||!0===c,w=O(s,v,y);if(Y(e.TEXTURE_CUBE_MAP,s,y),f){b&&S&&i.texStorage2D(e.TEXTURE_CUBE_MAP,w,A,v.width,v.height);for(let n=0;n<6;n++){t=g[n].mipmaps;for(let r=0;r<t.length;r++){let a=t[r];s.format!==C?null!==x?b?i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,0,0,a.width,a.height,x,a.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,A,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):b?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,0,0,a.width,a.height,x,_,a.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r,A,a.width,a.height,0,x,_,a.data)}}}else{t=s.mipmaps,b&&S&&(t.length>0&&w++,i.texStorage2D(e.TEXTURE_CUBE_MAP,w,A,g[0].width,g[0].height));for(let n=0;n<6;n++)if(m){b?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,0,0,g[n].width,g[n].height,x,_,g[n].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,A,g[n].width,g[n].height,0,x,_,g[n].data);for(let r=0;r<t.length;r++){let a=t[r].image[n].image;b?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,0,0,a.width,a.height,x,_,a.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,A,a.width,a.height,0,x,_,a.data)}}else{b?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,0,0,x,_,g[n]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,A,x,_,g[n]);for(let r=0;r<t.length;r++){let a=t[r];b?i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,0,0,x,_,a.image[n]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r+1,A,x,_,a.image[n])}}}L(s,y)&&D(e.TEXTURE_CUBE_MAP),u.__version=h.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version})(o,t,s);return}i.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,i,r){let a=n.get(t);void 0!==i&&J(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==r&&$(t)},this.setupRenderTarget=function(t){let o=t.texture,c=n.get(t),h=n.get(o);t.addEventListener("dispose",k),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=o.version,s.memory.textures++);let u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=I(t)||l;if(u){c.__webglFramebuffer=[];for(let t=0;t<6;t++)if(l&&o.mipmaps&&o.mipmaps.length>0){c.__webglFramebuffer[t]=[];for(let i=0;i<o.mipmaps.length;i++)c.__webglFramebuffer[t][i]=e.createFramebuffer()}else c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(l&&o.mipmaps&&o.mipmaps.length>0){c.__webglFramebuffer=[];for(let t=0;t<o.mipmaps.length;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else c.__webglFramebuffer=e.createFramebuffer();if(d){if(r.drawBuffers){let i=t.texture;for(let t=0,r=i.length;t<r;t++){let r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.")}if(l&&t.samples>0&&!1===en(t)){let n=d?o:[o];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){let r=n[i];c.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,c.__webglColorRenderbuffer[i]);let s=a.convert(r.format,r.colorSpace),o=a.convert(r.type),l=B(r.internalFormat,s,o,r.colorSpace,!0===t.isXRRenderTarget),h=ee(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,h,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,c.__webglColorRenderbuffer[i])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),Z(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){i.bindTexture(e.TEXTURE_CUBE_MAP,h.__webglTexture),Y(e.TEXTURE_CUBE_MAP,o,p);for(let i=0;i<6;i++)if(l&&o.mipmaps&&o.mipmaps.length>0)for(let n=0;n<o.mipmaps.length;n++)J(c.__webglFramebuffer[i][n],t,o,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,n);else J(c.__webglFramebuffer[i],t,o,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);L(o,p)&&D(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){let r=t.texture;for(let a=0,s=r.length;a<s;a++){let s=r[a],o=n.get(s);i.bindTexture(e.TEXTURE_2D,o.__webglTexture),Y(e.TEXTURE_2D,s,p),J(c.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+a,e.TEXTURE_2D,0),L(s,p)&&D(e.TEXTURE_2D)}i.unbindTexture()}else{let n=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?n=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(n,h.__webglTexture),Y(n,o,p),l&&o.mipmaps&&o.mipmaps.length>0)for(let i=0;i<o.mipmaps.length;i++)J(c.__webglFramebuffer[i],t,o,e.COLOR_ATTACHMENT0,n,i);else J(c.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0,n,0);L(o,p)&&D(n),i.unbindTexture()}t.depthBuffer&&$(t)},this.updateRenderTargetMipmap=function(t){let r=I(t)||l,a=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=a.length;s<o;s++){let o=a[s];if(L(o,r)){let r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=n.get(o).__webglTexture;i.bindTexture(r,a),D(r),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===en(t)){let r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,s=t.height,o=e.COLOR_BUFFER_BIT,l=[],c=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=n.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<r.length;t++)i.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(e.COLOR_ATTACHMENT0+i),t.depthBuffer&&l.push(c);let p=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),d&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[i]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[c]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[c])),d){let t=n.get(r[i]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),h&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<r.length;t++){i.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);let a=n.get(r[t]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=$,this.setupFrameBufferTexture=J,this.useMultisampledRTT=en}function rk(e,t,i){let n=i.isWebGL2;return{convert:function(i,r=""){let a;let s=ev.getTransfer(r);if(i===S)return e.UNSIGNED_BYTE;if(1017===i)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return e.BYTE;if(1011===i)return e.SHORT;if(1012===i)return e.UNSIGNED_SHORT;if(1013===i)return e.INT;if(i===w)return e.UNSIGNED_INT;if(i===M)return e.FLOAT;if(i===E)return n?e.HALF_FLOAT:null!==(a=t.get("OES_texture_half_float"))?a.HALF_FLOAT_OES:null;if(1021===i)return e.ALPHA;if(i===C)return e.RGBA;if(1024===i)return e.LUMINANCE;if(1025===i)return e.LUMINANCE_ALPHA;if(i===T)return e.DEPTH_COMPONENT;if(1027===i)return e.DEPTH_STENCIL;if(1035===i)return null!==(a=t.get("EXT_sRGB"))?a.SRGB_ALPHA_EXT:null;if(1028===i)return e.RED;if(i===R)return e.RED_INTEGER;if(i===P)return e.RG;if(1031===i)return e.RG_INTEGER;if(i===I)return e.RGBA_INTEGER;if(33776===i||33777===i||33778===i||33779===i){if(s===V){if(null===(a=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(33776===i)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===i)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===i)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===i)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(a=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===i)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===i)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===i)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===i)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(35840===i||35841===i||35842===i||35843===i){if(null===(a=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===i)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return null!==(a=t.get("WEBGL_compressed_texture_etc1"))?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(null===(a=t.get("WEBGL_compressed_texture_etc")))return null;if(37492===i)return s===V?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(null===(a=t.get("WEBGL_compressed_texture_astc")))return null;if(37808===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return s===V?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===i||36494===i||36495===i){if(null===(a=t.get("EXT_texture_compression_bptc")))return null;if(36492===i)return s===V?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===i)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===i)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===i||36284===i||36285===i||36286===i){if(null===(a=t.get("EXT_texture_compression_rgtc")))return null;if(36492===i)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===i)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===i)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===i)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return 1020===i?n?e.UNSIGNED_INT_24_8:null!==(a=t.get("WEBGL_depth_texture"))?a.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[i]?e[i]:null}}}class rz extends iw{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class rH extends tb{constructor(){super(),this.isGroup=!0,this.type="Group"}}let rV={type:"move"};class rG{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new rH,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new rH,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new eI,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new eI),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new rH,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new eI,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new eI),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,a=null,s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){for(let n of(a=!0,e.hand.values())){let e=t.getJointPose(n,i),r=this._getHandJoint(l,n);null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=e.radius),r.visible=null!==e}let n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=n.position.distanceTo(r.position);l.inputState.pinching&&s>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,i))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1);null!==s&&(null===(n=t.getPose(e.targetRaySpace,i))&&null!==r&&(n=r),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(rV)))}return null!==s&&(s.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let i=new rH;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class rW extends q{constructor(e,t){super();let i=this,n=null,r=1,a=null,s="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],x=new es,_=null,A=new iw;A.layers.enable(1),A.viewport=new eE;let b=new iw;b.layers.enable(2),b.viewport=new eE;let M=[A,b],E=new rz;E.layers.enable(1),E.layers.enable(2);let R=null,P=null;function I(e){let t=y.indexOf(e.inputSource);if(-1===t)return;let i=v[t];void 0!==i&&(i.update(e.inputSource,e.frame,l||a),i.dispatchEvent({type:e.type,data:e.inputSource}))}function L(){n.removeEventListener("select",I),n.removeEventListener("selectstart",I),n.removeEventListener("selectend",I),n.removeEventListener("squeeze",I),n.removeEventListener("squeezestart",I),n.removeEventListener("squeezeend",I),n.removeEventListener("end",L),n.removeEventListener("inputsourceschange",D);for(let e=0;e<v.length;e++){let t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}R=null,P=null,e.setRenderTarget(m),d=null,u=null,h=null,n=null,g=null,F.stop(),i.isPresenting=!1,e.setPixelRatio(_),e.setSize(x.width,x.height,!1),i.dispatchEvent({type:"sessionend"})}function D(e){for(let t=0;t<e.removed.length;t++){let i=e.removed[t],n=y.indexOf(i);n>=0&&(y[n]=null,v[n].disconnect(i))}for(let t=0;t<e.added.length;t++){let i=e.added[t],n=y.indexOf(i);if(-1===n){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(i),n=e;break}if(null===y[e]){y[e]=i,n=e;break}}if(-1===n)break}let r=v[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new rG,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new rG,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new rG,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(c){if(null!==(n=c)){if(m=e.getRenderTarget(),n.addEventListener("select",I),n.addEventListener("selectstart",I),n.addEventListener("selectend",I),n.addEventListener("squeeze",I),n.addEventListener("squeezestart",I),n.addEventListener("squeezeend",I),n.addEventListener("end",L),n.addEventListener("inputsourceschange",D),!0!==f.xrCompatible&&await t.makeXRCompatible(),_=e.getPixelRatio(),e.getSize(x),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2){let i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),g=new eT(d.framebufferWidth,d.framebufferHeight,{format:C,type:S,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let i=null,a=null,s=null;f.depth&&(s=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,i=f.stencil?1027:T,a=f.stencil?1020:w);let o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:r};u=(h=new XRWebGLBinding(n,t)).createProjectionLayer(o),n.updateRenderState({layers:[u]}),e.setPixelRatio(1),e.setSize(u.textureWidth,u.textureHeight,!1),g=new eT(u.textureWidth,u.textureHeight,{format:C,type:S,depthTexture:new nc(u.textureWidth,u.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await n.requestReferenceSpace(s),F.setContext(n),F.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode};let B=new eI,O=new eI;function N(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){var t,i,r;if(null===n)return;E.near=b.near=A.near=e.near,E.far=b.far=A.far=e.far,(R!==E.near||P!==E.far)&&(n.updateRenderState({depthNear:E.near,depthFar:E.far}),R=E.near,P=E.far);let a=e.parent,s=E.cameras;N(E,a);for(let e=0;e<s.length;e++)N(s[e],a);2===s.length?function(e,t,i){B.setFromMatrixPosition(t.matrixWorld),O.setFromMatrixPosition(i.matrixWorld);let n=B.distanceTo(O),r=t.projectionMatrix.elements,a=i.projectionMatrix.elements,s=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(a[8]+1)/a[0],d=n/(-h+u),p=-(d*h);t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(p),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let f=s+d,m=o+d;e.projectionMatrix.makePerspective(s*h-p,s*u+(n-p),l*o/m*f,c*o/m*f,f,m),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(E,A,b):E.projectionMatrix.copy(A.projectionMatrix),t=e,i=E,null===(r=a)?t.matrix.copy(i.matrixWorld):(t.matrix.copy(r.matrixWorld),t.matrix.invert(),t.matrix.multiply(i.matrixWorld)),t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(i.projectionMatrix),t.projectionMatrixInverse.copy(i.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*Q*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)},this.getCamera=function(){return E},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(e){o=e,null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let U=null,F=new iO;F.setAnimationLoop(function(t,n){if(c=n.getViewerPose(l||a),p=n,null!==c){let t=c.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let i=!1;t.length!==E.cameras.length&&(E.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){let r=t[n],a=null;if(null!==d)a=d.getViewport(r);else{let t=h.getViewSubImage(u,r);a=t.viewport,0===n&&(e.setRenderTargetTextures(g,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=M[n];void 0===s&&((s=new iw).layers.enable(n),s.viewport=new eE,M[n]=s),s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(r.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===n&&(E.matrix.copy(s.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),!0===i&&E.cameras.push(s)}}for(let e=0;e<v.length;e++){let t=y[e],i=v[e];null!==t&&void 0!==i&&i.update(t,n,l||a)}U&&U(t,n),n.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:n}),p=null}),this.setAnimationLoop=function(e){U=e},this.dispose=function(){}}}function rj(e,t){function i(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map,i(r.map,n.mapTransform)),r.alphaMap&&(n.alphaMap.value=r.alphaMap,i(r.alphaMap,n.alphaMapTransform)),r.bumpMap&&(n.bumpMap.value=r.bumpMap,i(r.bumpMap,n.bumpMapTransform),n.bumpScale.value=r.bumpScale,1===r.side&&(n.bumpScale.value*=-1)),r.normalMap&&(n.normalMap.value=r.normalMap,i(r.normalMap,n.normalMapTransform),n.normalScale.value.copy(r.normalScale),1===r.side&&n.normalScale.value.negate()),r.displacementMap&&(n.displacementMap.value=r.displacementMap,i(r.displacementMap,n.displacementMapTransform),n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap,i(r.emissiveMap,n.emissiveMapTransform)),r.specularMap&&(n.specularMap.value=r.specularMap,i(r.specularMap,n.specularMapTransform)),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);let a=t.get(r).envMap;if(a&&(n.envMap.value=a,n.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;let t=!0===e._useLegacyLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*t,i(r.lightMap,n.lightMapTransform)}r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity,i(r.aoMap,n.aoMapTransform))}return{refreshFogUniforms:function(t,i){i.color.getRGB(t.fogColor.value,i_(e)),i.isFog?(t.fogNear.value=i.near,t.fogFar.value=i.far):i.isFogExp2&&(t.fogDensity.value=i.density)},refreshMaterialUniforms:function(e,r,a,s,o){var l,c,h,u,d,p,f,m,g,v,y,x,_,A,b,S,w,M,E,C,T;r.isMeshBasicMaterial?n(e,r):r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),l=e,(c=r).gradientMap&&(l.gradientMap.value=c.gradientMap)):r.isMeshPhongMaterial?(n(e,r),h=e,u=r,h.specular.value.copy(u.specular),h.shininess.value=Math.max(u.shininess,1e-4)):r.isMeshStandardMaterial?(n(e,r),d=e,p=r,d.metalness.value=p.metalness,p.metalnessMap&&(d.metalnessMap.value=p.metalnessMap,i(p.metalnessMap,d.metalnessMapTransform)),d.roughness.value=p.roughness,p.roughnessMap&&(d.roughnessMap.value=p.roughnessMap,i(p.roughnessMap,d.roughnessMapTransform)),t.get(p).envMap&&(d.envMapIntensity.value=p.envMapIntensity),r.isMeshPhysicalMaterial&&(f=e,m=r,g=o,f.ior.value=m.ior,m.sheen>0&&(f.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),f.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(f.sheenColorMap.value=m.sheenColorMap,i(m.sheenColorMap,f.sheenColorMapTransform)),m.sheenRoughnessMap&&(f.sheenRoughnessMap.value=m.sheenRoughnessMap,i(m.sheenRoughnessMap,f.sheenRoughnessMapTransform))),m.clearcoat>0&&(f.clearcoat.value=m.clearcoat,f.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(f.clearcoatMap.value=m.clearcoatMap,i(m.clearcoatMap,f.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,i(m.clearcoatRoughnessMap,f.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(f.clearcoatNormalMap.value=m.clearcoatNormalMap,i(m.clearcoatNormalMap,f.clearcoatNormalMapTransform),f.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),1===m.side&&f.clearcoatNormalScale.value.negate())),m.iridescence>0&&(f.iridescence.value=m.iridescence,f.iridescenceIOR.value=m.iridescenceIOR,f.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(f.iridescenceMap.value=m.iridescenceMap,i(m.iridescenceMap,f.iridescenceMapTransform)),m.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=m.iridescenceThicknessMap,i(m.iridescenceThicknessMap,f.iridescenceThicknessMapTransform))),m.transmission>0&&(f.transmission.value=m.transmission,f.transmissionSamplerMap.value=g.texture,f.transmissionSamplerSize.value.set(g.width,g.height),m.transmissionMap&&(f.transmissionMap.value=m.transmissionMap,i(m.transmissionMap,f.transmissionMapTransform)),f.thickness.value=m.thickness,m.thicknessMap&&(f.thicknessMap.value=m.thicknessMap,i(m.thicknessMap,f.thicknessMapTransform)),f.attenuationDistance.value=m.attenuationDistance,f.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(f.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(f.anisotropyMap.value=m.anisotropyMap,i(m.anisotropyMap,f.anisotropyMapTransform))),f.specularIntensity.value=m.specularIntensity,f.specularColor.value.copy(m.specularColor),m.specularColorMap&&(f.specularColorMap.value=m.specularColorMap,i(m.specularColorMap,f.specularColorMapTransform)),m.specularIntensityMap&&(f.specularIntensityMap.value=m.specularIntensityMap,i(m.specularIntensityMap,f.specularIntensityMapTransform)))):r.isMeshMatcapMaterial?(n(e,r),v=e,(y=r).matcap&&(v.matcap.value=y.matcap)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,i){let n=t.get(i).light;e.referencePosition.value.setFromMatrixPosition(n.matrixWorld),e.nearDistance.value=n.shadow.camera.near,e.farDistance.value=n.shadow.camera.far}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(x=e,_=r,x.diffuse.value.copy(_.color),x.opacity.value=_.opacity,_.map&&(x.map.value=_.map,i(_.map,x.mapTransform)),r.isLineDashedMaterial&&(A=e,b=r,A.dashSize.value=b.dashSize,A.totalSize.value=b.dashSize+b.gapSize,A.scale.value=b.scale)):r.isPointsMaterial?(S=e,w=r,M=a,E=s,S.diffuse.value.copy(w.color),S.opacity.value=w.opacity,S.size.value=w.size*M,S.scale.value=.5*E,w.map&&(S.map.value=w.map,i(w.map,S.uvTransform)),w.alphaMap&&(S.alphaMap.value=w.alphaMap,i(w.alphaMap,S.alphaMapTransform)),w.alphaTest>0&&(S.alphaTest.value=w.alphaTest)):r.isSpriteMaterial?(C=e,T=r,C.diffuse.value.copy(T.color),C.opacity.value=T.opacity,C.rotation.value=T.rotation,T.map&&(C.map.value=T.map,i(T.map,C.mapTransform)),T.alphaMap&&(C.alphaMap.value=T.alphaMap,i(T.alphaMap,C.alphaMapTransform)),T.alphaTest>0&&(C.alphaTest.value=T.alphaTest)):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function rq(e,t,i,n){let r={},a={},s=[],o=i.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e){let t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){let i=t.target;i.removeEventListener("dispose",c);let n=s.indexOf(i.__bindingPointIndex);s.splice(n,1),e.deleteBuffer(r[i.id]),delete r[i.id],delete a[i.id]}return{bind:function(e,t){let i=t.program;n.uniformBlockBinding(e,i)},update:function(i,h){let u=r[i.id];void 0===u&&(function(e){let t=e.uniforms,i=0;for(let e=0,n=t.length;e<n;e++){let n=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=n.length;e<t;e++){let t=n[e],r=Array.isArray(t.value)?t.value:[t.value];for(let e=0,n=r.length;e<n;e++){let n=l(r[e]),a=i%16;0!==a&&16-a<n.boundary&&(i+=16-a),t.__data=new Float32Array(n.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=i,i+=n.storage}}}let n=i%16;n>0&&(i+=16-n),e.__size=i,e.__cache={}}(i),u=function(t){let i=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;let n=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,n),e.bufferData(e.UNIFORM_BUFFER,r,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,i,n),n}(i),r[i.id]=u,i.addEventListener("dispose",c));let d=h.program;n.updateUBOMapping(i,d);let p=t.render.frame;a[i.id]!==p&&(function(t){let i=r[t.id],n=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,i);for(let t=0,i=n.length;t<i;t++){let i=Array.isArray(n[t])?n[t]:[n[t]];for(let n=0,r=i.length;n<r;n++){let r=i[n];if(!0===function(e,t,i,n){let r=e.value,a=t+"_"+i;if(void 0===n[a])return"number"==typeof r||"boolean"==typeof r?n[a]=r:n[a]=r.clone(),!0;{let e=n[a];if("number"==typeof r||"boolean"==typeof r){if(e!==r)return n[a]=r,!0}else if(!1===e.equals(r))return e.copy(r),!0}return!1}(r,t,n,a)){let t=r.__offset,i=Array.isArray(r.value)?r.value:[r.value],n=0;for(let a=0;a<i.length;a++){let s=i[a],o=l(s);"number"==typeof s||"boolean"==typeof s?(r.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+n,r.__data)):s.isMatrix3?(r.__data[0]=s.elements[0],r.__data[1]=s.elements[1],r.__data[2]=s.elements[2],r.__data[3]=0,r.__data[4]=s.elements[3],r.__data[5]=s.elements[4],r.__data[6]=s.elements[5],r.__data[7]=0,r.__data[8]=s.elements[6],r.__data[9]=s.elements[7],r.__data[10]=s.elements[8],r.__data[11]=0):(s.toArray(r.__data,n),n+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(i),a[i.id]=p)},dispose:function(){for(let t in r)e.deleteBuffer(r[t]);s=[],r={},a={}}}}class rX{constructor(e={}){let t,i,n,r,a,l,c,h,u,d,p,f,m,g,v,y,x,_,A,T,P,L,D,B,O;let{canvas:N=function(){let e=eh("canvas");return e.style.display="block",e}(),context:k=null,depth:z=!0,stencil:H=!0,alpha:V=!1,antialias:G=!1,premultipliedAlpha:W=!0,preserveDrawingBuffer:j=!1,powerPreference:q="default",failIfMajorPerformanceCaveat:X=!1}=e;this.isWebGLRenderer=!0,t=null!==k?k.getContextAttributes().alpha:V;let Y=new Uint32Array(4),K=new Int32Array(4),Q=null,J=null,Z=[],$=[];this.domElement=N,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=U,this._useLegacyLights=!1,this.toneMapping=0,this.toneMappingExposure=1;let ee=this,et=!1,en=0,er=0,ea=null,eo=-1,el=null,ec=new eE,eu=new eE,ed=null,ep=new tk(0),ef=0,em=N.width,eg=N.height,ev=1,ey=null,ex=null,e_=new eE(0,0,em,eg),eA=new eE(0,0,em,eg),eb=!1,eS=new iB,ew=!1,eM=!1,eC=null,eR=new e8,eP=new es,eL=new eI,eD={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function eB(){return null===ea?ev:1}let eO=k;function eN(e,t){for(let i=0;i<e.length;i++){let n=e[i],r=N.getContext(n,t);if(null!==r)return r}return null}try{if("setAttribute"in N&&N.setAttribute("data-engine","three.js r160"),N.addEventListener("webglcontextlost",ek,!1),N.addEventListener("webglcontextrestored",ez,!1),N.addEventListener("webglcontextcreationerror",eH,!1),null===eO){let e=["webgl2","webgl","experimental-webgl"];if(!0===ee.isWebGL1Renderer&&e.shift(),eO=eN(e,{alpha:!0,depth:z,stencil:H,antialias:G,premultipliedAlpha:W,preserveDrawingBuffer:j,powerPreference:q,failIfMajorPerformanceCaveat:X}),null===eO){if(eN(e))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}}"undefined"!=typeof WebGLRenderingContext&&eO instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===eO.getShaderPrecisionFormat&&(eO.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function eU(){i=new nt(eO),n=new ij(eO,i,e),i.init(n),D=new rk(eO,i,n),r=new rU(eO,i,n),a=new nr(eO),l=new rS,c=new rF(eO,i,r,l,n,D,a),h=new iX(ee),u=new ne(ee),d=new iN(eO,n),B=new iG(eO,i,d,n),p=new ni(eO,d,a,B),f=new nl(eO,p,d,a),T=new no(eO,n,c),x=new iq(l),m=new rb(ee,h,u,i,n,B,x),g=new rj(ee,l),v=new rC,y=new rD(i,n),A=new iV(ee,h,u,r,f,t,W),_=new rN(ee,f,n),O=new rq(eO,a,n,r),P=new iW(eO,i,a,n),L=new nn(eO,i,a,n),a.programs=m.programs,ee.capabilities=n,ee.extensions=i,ee.properties=l,ee.renderLists=v,ee.shadowMap=_,ee.state=r,ee.info=a}eU();let eF=new rW(ee,eO);function ek(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),et=!0}function ez(){console.log("THREE.WebGLRenderer: Context Restored."),et=!1;let e=a.autoReset,t=_.enabled,i=_.autoUpdate,n=_.needsUpdate,r=_.type;eU(),a.autoReset=e,_.enabled=t,_.autoUpdate=i,_.needsUpdate=n,_.type=r}function eH(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function eV(e){var t;let i=e.target;i.removeEventListener("dispose",eV),function(e){let t=l.get(e).programs;void 0!==t&&(t.forEach(function(e){m.releaseProgram(e)}),e.isShaderMaterial&&m.releaseShaderCache(e))}(t=i),l.remove(t)}function eG(e,t,i){!0===e.transparent&&e.side===o&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,eJ(e,t,i),e.side=s,e.needsUpdate=!0,eJ(e,t,i),e.side=o):eJ(e,t,i)}this.xr=eF,this.getContext=function(){return eO},this.getContextAttributes=function(){return eO.getContextAttributes()},this.forceContextLoss=function(){let e=i.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=i.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return ev},this.setPixelRatio=function(e){void 0!==e&&(ev=e,this.setSize(em,eg,!1))},this.getSize=function(e){return e.set(em,eg)},this.setSize=function(e,t,i=!0){if(eF.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}em=e,eg=t,N.width=Math.floor(e*ev),N.height=Math.floor(t*ev),!0===i&&(N.style.width=e+"px",N.style.height=t+"px"),this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(e){return e.set(em*ev,eg*ev).floor()},this.setDrawingBufferSize=function(e,t,i){em=e,eg=t,ev=i,N.width=Math.floor(e*i),N.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(ec)},this.getViewport=function(e){return e.copy(e_)},this.setViewport=function(e,t,i,n){e.isVector4?e_.set(e.x,e.y,e.z,e.w):e_.set(e,t,i,n),r.viewport(ec.copy(e_).multiplyScalar(ev).floor())},this.getScissor=function(e){return e.copy(eA)},this.setScissor=function(e,t,i,n){e.isVector4?eA.set(e.x,e.y,e.z,e.w):eA.set(e,t,i,n),r.scissor(eu.copy(eA).multiplyScalar(ev).floor())},this.getScissorTest=function(){return eb},this.setScissorTest=function(e){r.setScissorTest(eb=e)},this.setOpaqueSort=function(e){ey=e},this.setTransparentSort=function(e){ex=e},this.getClearColor=function(e){return e.copy(A.getClearColor())},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(e=!0,t=!0,i=!0){let n=0;if(e){let e=!1;if(null!==ea){let t=ea.texture.format;e=t===I||1031===t||t===R}if(e){let e=ea.texture.type,t=e===S||e===w||1012===e||1020===e||1017===e||1018===e,i=A.getClearColor(),n=A.getClearAlpha(),r=i.r,a=i.g,s=i.b;t?(Y[0]=r,Y[1]=a,Y[2]=s,Y[3]=n,eO.clearBufferuiv(eO.COLOR,0,Y)):(K[0]=r,K[1]=a,K[2]=s,K[3]=n,eO.clearBufferiv(eO.COLOR,0,K))}else n|=eO.COLOR_BUFFER_BIT}t&&(n|=eO.DEPTH_BUFFER_BIT),i&&(n|=eO.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(0xffffffff)),eO.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){N.removeEventListener("webglcontextlost",ek,!1),N.removeEventListener("webglcontextrestored",ez,!1),N.removeEventListener("webglcontextcreationerror",eH,!1),v.dispose(),y.dispose(),l.dispose(),h.dispose(),u.dispose(),f.dispose(),B.dispose(),O.dispose(),m.dispose(),eF.dispose(),eF.removeEventListener("sessionstart",ej),eF.removeEventListener("sessionend",eq),eC&&(eC.dispose(),eC=null),eX.stop()},this.renderBufferDirect=function(e,t,i,a,s,o){let f;null===t&&(t=eD);let m=s.isMesh&&0>s.matrixWorld.determinant(),v=function(e,t,i,a,s){var o,d;!0!==t.isScene&&(t=eD),c.resetTextureUnits();let p=t.fog,f=a.isMeshStandardMaterial?t.environment:null,m=null===ea?ee.outputColorSpace:!0===ea.isXRRenderTarget?ea.texture.colorSpace:F,v=(a.isMeshStandardMaterial?u:h).get(a.envMap||f),y=!0===a.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,_=!!i.attributes.tangent&&(!!a.normalMap||a.anisotropy>0),A=!!i.morphAttributes.position,b=!!i.morphAttributes.normal,S=!!i.morphAttributes.color,w=0;a.toneMapped&&(null===ea||!0===ea.isXRRenderTarget)&&(w=ee.toneMapping);let M=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,E=void 0!==M?M.length:0,C=l.get(a),R=J.state.lights;if(!0===ew&&(!0===eM||e!==el)){let t=e===el&&a.id===eo;x.setState(a,e,t)}let P=!1;a.version===C.__version?C.needsLights&&C.lightsStateVersion!==R.state.version?P=!0:C.outputColorSpace!==m?P=!0:s.isBatchedMesh&&!1===C.batching?P=!0:s.isBatchedMesh||!0!==C.batching?s.isInstancedMesh&&!1===C.instancing?P=!0:s.isInstancedMesh||!0!==C.instancing?s.isSkinnedMesh&&!1===C.skinning?P=!0:s.isSkinnedMesh||!0!==C.skinning?s.isInstancedMesh&&!0===C.instancingColor&&null===s.instanceColor?P=!0:s.isInstancedMesh&&!1===C.instancingColor&&null!==s.instanceColor?P=!0:C.envMap!==v?P=!0:!0===a.fog&&C.fog!==p?P=!0:void 0!==C.numClippingPlanes&&(C.numClippingPlanes!==x.numPlanes||C.numIntersection!==x.numIntersection)?P=!0:C.vertexAlphas!==y?P=!0:C.vertexTangents!==_?P=!0:C.morphTargets!==A?P=!0:C.morphNormals!==b?P=!0:C.morphColors!==S?P=!0:C.toneMapping!==w?P=!0:!0===n.isWebGL2&&C.morphTargetsCount!==E&&(P=!0):P=!0:P=!0:P=!0:(P=!0,C.__version=a.version);let I=C.currentProgram;!0===P&&(I=eJ(a,t,s));let L=!1,D=!1,B=!1,N=I.getUniforms(),U=C.uniforms;if(r.useProgram(I.program)&&(L=!0,D=!0,B=!0),a.id!==eo&&(eo=a.id,D=!0),L||el!==e){N.setValue(eO,"projectionMatrix",e.projectionMatrix),N.setValue(eO,"viewMatrix",e.matrixWorldInverse);let t=N.map.cameraPosition;void 0!==t&&t.setValue(eO,eL.setFromMatrixPosition(e.matrixWorld)),n.logarithmicDepthBuffer&&N.setValue(eO,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(a.isMeshPhongMaterial||a.isMeshToonMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||a.isMeshStandardMaterial||a.isShaderMaterial)&&N.setValue(eO,"isOrthographic",!0===e.isOrthographicCamera),el!==e&&(el=e,D=!0,B=!0)}if(s.isSkinnedMesh){N.setOptional(eO,s,"bindMatrix"),N.setOptional(eO,s,"bindMatrixInverse");let e=s.skeleton;e&&(n.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),N.setValue(eO,"boneTexture",e.boneTexture,c)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}s.isBatchedMesh&&(N.setOptional(eO,s,"batchingTexture"),N.setValue(eO,"batchingTexture",s._matricesTexture,c));let k=i.morphAttributes;if((void 0!==k.position||void 0!==k.normal||void 0!==k.color&&!0===n.isWebGL2)&&T.update(s,i,I),(D||C.receiveShadow!==s.receiveShadow)&&(C.receiveShadow=s.receiveShadow,N.setValue(eO,"receiveShadow",s.receiveShadow)),a.isMeshGouraudMaterial&&null!==a.envMap&&(U.envMap.value=v,U.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1),D&&(N.setValue(eO,"toneMappingExposure",ee.toneMappingExposure),C.needsLights&&(o=U,d=B,o.ambientLightColor.needsUpdate=d,o.lightProbe.needsUpdate=d,o.directionalLights.needsUpdate=d,o.directionalLightShadows.needsUpdate=d,o.pointLights.needsUpdate=d,o.pointLightShadows.needsUpdate=d,o.spotLights.needsUpdate=d,o.spotLightShadows.needsUpdate=d,o.rectAreaLights.needsUpdate=d,o.hemisphereLights.needsUpdate=d),p&&!0===a.fog&&g.refreshFogUniforms(U,p),g.refreshMaterialUniforms(U,a,ev,eg,eC),rn.upload(eO,eZ(C),U,c)),a.isShaderMaterial&&!0===a.uniformsNeedUpdate&&(rn.upload(eO,eZ(C),U,c),a.uniformsNeedUpdate=!1),a.isSpriteMaterial&&N.setValue(eO,"center",s.center),N.setValue(eO,"modelViewMatrix",s.modelViewMatrix),N.setValue(eO,"normalMatrix",s.normalMatrix),N.setValue(eO,"modelMatrix",s.matrixWorld),a.isShaderMaterial||a.isRawShaderMaterial){let e=a.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if(n.isWebGL2){let i=e[t];O.update(i,I),O.bind(i,I)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return I}(e,t,i,a,s);r.setMaterial(a,m);let y=i.index,_=1;if(!0===a.wireframe){if(void 0===(y=p.getWireframeAttribute(i)))return;_=2}let A=i.drawRange,b=i.attributes.position,S=A.start*_,w=(A.start+A.count)*_;null!==o&&(S=Math.max(S,o.start*_),w=Math.min(w,(o.start+o.count)*_)),null!==y?(S=Math.max(S,0),w=Math.min(w,y.count)):null!=b&&(S=Math.max(S,0),w=Math.min(w,b.count));let M=w-S;if(M<0||M===1/0)return;B.setup(s,a,v,i,y);let E=P;if(null!==y&&(f=d.get(y),(E=L).setIndex(f)),s.isMesh)!0===a.wireframe?(r.setLineWidth(a.wireframeLinewidth*eB()),E.setMode(eO.LINES)):E.setMode(eO.TRIANGLES);else if(s.isLine){let e=a.linewidth;void 0===e&&(e=1),r.setLineWidth(e*eB()),s.isLineSegments?E.setMode(eO.LINES):s.isLineLoop?E.setMode(eO.LINE_LOOP):E.setMode(eO.LINE_STRIP)}else s.isPoints?E.setMode(eO.POINTS):s.isSprite&&E.setMode(eO.TRIANGLES);if(s.isBatchedMesh)E.renderMultiDraw(s._multiDrawStarts,s._multiDrawCounts,s._multiDrawCount);else if(s.isInstancedMesh)E.renderInstances(S,M,s.count);else if(i.isInstancedBufferGeometry){let e=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,t=Math.min(i.instanceCount,e);E.renderInstances(S,M,t)}else E.render(S,M)},this.compile=function(e,t,i=null){null===i&&(i=e),(J=y.get(i)).init(),$.push(J),i.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(J.pushLight(e),e.castShadow&&J.pushShadow(e))}),e!==i&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(J.pushLight(e),e.castShadow&&J.pushShadow(e))}),J.setupLights(ee._useLegacyLights);let n=new Set;return e.traverse(function(e){let t=e.material;if(t){if(Array.isArray(t))for(let r=0;r<t.length;r++){let a=t[r];eG(a,i,e),n.add(a)}else eG(t,i,e),n.add(t)}}),$.pop(),J=null,n},this.compileAsync=function(e,t,n=null){let r=this.compile(e,t,n);return new Promise(t=>{function n(){if(r.forEach(function(e){l.get(e).currentProgram.isReady()&&r.delete(e)}),0===r.size){t(e);return}setTimeout(n,10)}null!==i.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let eW=null;function ej(){eX.stop()}function eq(){eX.start()}let eX=new iO;function eY(e,t,a,s){let l=e.opaque,h=e.transmissive,u=e.transparent;J.setupLightsView(a),!0===ew&&x.setGlobalState(ee.clippingPlanes,a),h.length>0&&function(e,t,r,a){if(null!==(!0===r.isScene?r.overrideMaterial:null))return;let s=n.isWebGL2;null===eC&&(eC=new eT(1,1,{generateMipmaps:!0,type:i.has("EXT_color_buffer_half_float")?E:S,minFilter:b,samples:s?4:0})),ee.getDrawingBufferSize(eP),s?eC.setSize(eP.x,eP.y):eC.setSize(ei(eP.x),ei(eP.y));let l=ee.getRenderTarget();ee.setRenderTarget(eC),ee.getClearColor(ep),(ef=ee.getClearAlpha())<1&&ee.setClearColor(0xffffff,.5),ee.clear();let h=ee.toneMapping;ee.toneMapping=0,eK(e,r,a),c.updateMultisampleRenderTarget(eC),c.updateRenderTargetMipmap(eC);let u=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e],n=i.object,s=i.geometry,l=i.material,c=i.group;if(l.side===o&&n.layers.test(a.layers)){let e=l.side;l.side=1,l.needsUpdate=!0,eQ(n,r,a,s,l,c),l.side=e,l.needsUpdate=!0,u=!0}}!0===u&&(c.updateMultisampleRenderTarget(eC),c.updateRenderTargetMipmap(eC)),ee.setRenderTarget(l),ee.setClearColor(ep,ef),ee.toneMapping=h}(l,h,t,a),s&&r.viewport(ec.copy(s)),l.length>0&&eK(l,t,a),h.length>0&&eK(h,t,a),u.length>0&&eK(u,t,a),r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),r.setPolygonOffset(!1)}function eK(e,t,i){let n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,a=e.length;r<a;r++){let a=e[r],s=a.object,o=a.geometry,l=null===n?a.material:n,c=a.group;s.layers.test(i.layers)&&eQ(s,t,i,o,l,c)}}function eQ(e,t,i,n,r,a){e.onBeforeRender(ee,t,i,n,r,a),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(ee,t,i,n,e,a),!0===r.transparent&&r.side===o&&!1===r.forceSinglePass?(r.side=1,r.needsUpdate=!0,ee.renderBufferDirect(i,t,n,r,e,a),r.side=s,r.needsUpdate=!0,ee.renderBufferDirect(i,t,n,r,e,a),r.side=o):ee.renderBufferDirect(i,t,n,r,e,a),e.onAfterRender(ee,t,i,n,r,a)}function eJ(e,t,i){var n;!0!==t.isScene&&(t=eD);let r=l.get(e),a=J.state.lights,s=J.state.shadowsArray,o=a.state.version,c=m.getParameters(e,a.state,s,t,i),d=m.getProgramCacheKey(c),p=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?u:h).get(e.envMap||r.environment),void 0===p&&(e.addEventListener("dispose",eV),p=new Map,r.programs=p);let f=p.get(d);if(void 0!==f){if(r.currentProgram===f&&r.lightsStateVersion===o)return e$(e,c),f}else c.uniforms=m.getUniforms(e),e.onBuild(i,c,ee),e.onBeforeCompile(c,ee),f=m.acquireProgram(c,d),p.set(d,f),r.uniforms=c.uniforms;let g=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(g.clippingPlanes=x.uniform),e$(e,c),r.needsLights=(n=e).isMeshLambertMaterial||n.isMeshToonMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.isShadowMaterial||n.isShaderMaterial&&!0===n.lights,r.lightsStateVersion=o,r.needsLights&&(g.ambientLightColor.value=a.state.ambient,g.lightProbe.value=a.state.probe,g.directionalLights.value=a.state.directional,g.directionalLightShadows.value=a.state.directionalShadow,g.spotLights.value=a.state.spot,g.spotLightShadows.value=a.state.spotShadow,g.rectAreaLights.value=a.state.rectArea,g.ltc_1.value=a.state.rectAreaLTC1,g.ltc_2.value=a.state.rectAreaLTC2,g.pointLights.value=a.state.point,g.pointLightShadows.value=a.state.pointShadow,g.hemisphereLights.value=a.state.hemi,g.directionalShadowMap.value=a.state.directionalShadowMap,g.directionalShadowMatrix.value=a.state.directionalShadowMatrix,g.spotShadowMap.value=a.state.spotShadowMap,g.spotLightMatrix.value=a.state.spotLightMatrix,g.spotLightMap.value=a.state.spotLightMap,g.pointShadowMap.value=a.state.pointShadowMap,g.pointShadowMatrix.value=a.state.pointShadowMatrix),r.currentProgram=f,r.uniformsList=null,f}function eZ(e){if(null===e.uniformsList){let t=e.currentProgram.getUniforms();e.uniformsList=rn.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function e$(e,t){let i=l.get(e);i.outputColorSpace=t.outputColorSpace,i.batching=t.batching,i.instancing=t.instancing,i.instancingColor=t.instancingColor,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}eX.setAnimationLoop(function(e){eW&&eW(e)}),"undefined"!=typeof self&&eX.setContext(self),this.setAnimationLoop=function(e){eW=e,eF.setAnimationLoop(e),null===e?eX.stop():eX.start()},eF.addEventListener("sessionstart",ej),eF.addEventListener("sessionend",eq),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!0===et)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===eF.enabled&&!0===eF.isPresenting&&(!0===eF.cameraAutoUpdate&&eF.updateCamera(t),t=eF.getCamera()),!0===e.isScene&&e.onBeforeRender(ee,e,t,ea),(J=y.get(e,$.length)).init(),$.push(J),eR.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),eS.setFromProjectionMatrix(eR),eM=this.localClippingEnabled,ew=x.init(this.clippingPlanes,eM),(Q=v.get(e,Z.length)).init(),Z.push(Q),function e(t,i,n,r){if(!1===t.visible)return;if(t.layers.test(i.layers)){if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(i);else if(t.isLight)J.pushLight(t),t.castShadow&&J.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||eS.intersectsSprite(t)){r&&eL.setFromMatrixPosition(t.matrixWorld).applyMatrix4(eR);let e=f.update(t),i=t.material;i.visible&&Q.push(t,e,i,n,eL.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||eS.intersectsObject(t))){let e=f.update(t),i=t.material;if(r&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),eL.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),eL.copy(e.boundingSphere.center)),eL.applyMatrix4(t.matrixWorld).applyMatrix4(eR)),Array.isArray(i)){let r=e.groups;for(let a=0,s=r.length;a<s;a++){let s=r[a],o=i[s.materialIndex];o&&o.visible&&Q.push(t,e,o,n,eL.z,s)}}else i.visible&&Q.push(t,e,i,n,eL.z,null)}}let a=t.children;for(let t=0,s=a.length;t<s;t++)e(a[t],i,n,r)}(e,t,0,ee.sortObjects),Q.finish(),!0===ee.sortObjects&&Q.sort(ey,ex),this.info.render.frame++,!0===ew&&x.beginShadows();let i=J.state.shadowsArray;if(_.render(i,e,t),!0===ew&&x.endShadows(),!0===this.info.autoReset&&this.info.reset(),A.render(Q,e),J.setupLights(ee._useLegacyLights),t.isArrayCamera){let i=t.cameras;for(let t=0,n=i.length;t<n;t++){let n=i[t];eY(Q,e,n,n.viewport)}}else eY(Q,e,t);null!==ea&&(c.updateMultisampleRenderTarget(ea),c.updateRenderTargetMipmap(ea)),!0===e.isScene&&e.onAfterRender(ee,e,t),B.resetDefaultState(),eo=-1,el=null,$.pop(),J=$.length>0?$[$.length-1]:null,Z.pop(),Q=Z.length>0?Z[Z.length-1]:null},this.getActiveCubeFace=function(){return en},this.getActiveMipmapLevel=function(){return er},this.getRenderTarget=function(){return ea},this.setRenderTargetTextures=function(e,t,n){l.get(e.texture).__webglTexture=t,l.get(e.depthTexture).__webglTexture=n;let r=l.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0!==i.has("WEBGL_multisampled_render_to_texture")||(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){let i=l.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,i=0){ea=e,en=t,er=i;let a=!0,s=null,o=!1,h=!1;if(e){let u=l.get(e);void 0!==u.__useDefaultFramebuffer?(r.bindFramebuffer(eO.FRAMEBUFFER,null),a=!1):void 0===u.__webglFramebuffer?c.setupRenderTarget(e):u.__hasExternalTextures&&c.rebindTextures(e,l.get(e.texture).__webglTexture,l.get(e.depthTexture).__webglTexture);let d=e.texture;(d.isData3DTexture||d.isDataArrayTexture||d.isCompressedArrayTexture)&&(h=!0);let p=l.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(s=Array.isArray(p[t])?p[t][i]:p[t],o=!0):s=n.isWebGL2&&e.samples>0&&!1===c.useMultisampledRTT(e)?l.get(e).__webglMultisampledFramebuffer:Array.isArray(p)?p[i]:p,ec.copy(e.viewport),eu.copy(e.scissor),ed=e.scissorTest}else ec.copy(e_).multiplyScalar(ev).floor(),eu.copy(eA).multiplyScalar(ev).floor(),ed=eb;if(r.bindFramebuffer(eO.FRAMEBUFFER,s)&&n.drawBuffers&&a&&r.drawBuffers(e,s),r.viewport(ec),r.scissor(eu),r.setScissorTest(ed),o){let n=l.get(e.texture);eO.framebufferTexture2D(eO.FRAMEBUFFER,eO.COLOR_ATTACHMENT0,eO.TEXTURE_CUBE_MAP_POSITIVE_X+t,n.__webglTexture,i)}else if(h){let n=l.get(e.texture);eO.framebufferTextureLayer(eO.FRAMEBUFFER,eO.COLOR_ATTACHMENT0,n.__webglTexture,i||0,t||0)}eo=-1},this.readRenderTargetPixels=function(e,t,a,s,o,c,h){if(!(e&&e.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let u=l.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==h&&(u=u[h]),u){r.bindFramebuffer(eO.FRAMEBUFFER,u);try{let r=e.texture,l=r.format,h=r.type;if(l!==C&&D.convert(l)!==eO.getParameter(eO.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let u=h===E&&(i.has("EXT_color_buffer_half_float")||n.isWebGL2&&i.has("EXT_color_buffer_float"));if(h!==S&&D.convert(h)!==eO.getParameter(eO.IMPLEMENTATION_COLOR_READ_TYPE)&&!(h===M&&(n.isWebGL2||i.has("OES_texture_float")||i.has("WEBGL_color_buffer_float")))&&!u){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}t>=0&&t<=e.width-s&&a>=0&&a<=e.height-o&&eO.readPixels(t,a,s,o,D.convert(l),D.convert(h),c)}finally{let e=null!==ea?l.get(ea).__webglFramebuffer:null;r.bindFramebuffer(eO.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){let n=Math.pow(2,-i),a=Math.floor(t.image.width*n),s=Math.floor(t.image.height*n);c.setTexture2D(t,0),eO.copyTexSubImage2D(eO.TEXTURE_2D,i,0,0,e.x,e.y,a,s),r.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){let a=t.image.width,s=t.image.height,o=D.convert(i.format),l=D.convert(i.type);c.setTexture2D(i,0),eO.pixelStorei(eO.UNPACK_FLIP_Y_WEBGL,i.flipY),eO.pixelStorei(eO.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),eO.pixelStorei(eO.UNPACK_ALIGNMENT,i.unpackAlignment),t.isDataTexture?eO.texSubImage2D(eO.TEXTURE_2D,n,e.x,e.y,a,s,o,l,t.image.data):t.isCompressedTexture?eO.compressedTexSubImage2D(eO.TEXTURE_2D,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):eO.texSubImage2D(eO.TEXTURE_2D,n,e.x,e.y,o,l,t.image),0===n&&i.generateMipmaps&&eO.generateMipmap(eO.TEXTURE_2D),r.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,a=0){let s;if(ee.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let o=e.max.x-e.min.x+1,l=e.max.y-e.min.y+1,h=e.max.z-e.min.z+1,u=D.convert(n.format),d=D.convert(n.type);if(n.isData3DTexture)c.setTexture3D(n,0),s=eO.TEXTURE_3D;else if(n.isDataArrayTexture||n.isCompressedArrayTexture)c.setTexture2DArray(n,0),s=eO.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}eO.pixelStorei(eO.UNPACK_FLIP_Y_WEBGL,n.flipY),eO.pixelStorei(eO.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),eO.pixelStorei(eO.UNPACK_ALIGNMENT,n.unpackAlignment);let p=eO.getParameter(eO.UNPACK_ROW_LENGTH),f=eO.getParameter(eO.UNPACK_IMAGE_HEIGHT),m=eO.getParameter(eO.UNPACK_SKIP_PIXELS),g=eO.getParameter(eO.UNPACK_SKIP_ROWS),v=eO.getParameter(eO.UNPACK_SKIP_IMAGES),y=i.isCompressedTexture?i.mipmaps[a]:i.image;eO.pixelStorei(eO.UNPACK_ROW_LENGTH,y.width),eO.pixelStorei(eO.UNPACK_IMAGE_HEIGHT,y.height),eO.pixelStorei(eO.UNPACK_SKIP_PIXELS,e.min.x),eO.pixelStorei(eO.UNPACK_SKIP_ROWS,e.min.y),eO.pixelStorei(eO.UNPACK_SKIP_IMAGES,e.min.z),i.isDataTexture||i.isData3DTexture?eO.texSubImage3D(s,a,t.x,t.y,t.z,o,l,h,u,d,y.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),eO.compressedTexSubImage3D(s,a,t.x,t.y,t.z,o,l,h,u,y.data)):eO.texSubImage3D(s,a,t.x,t.y,t.z,o,l,h,u,d,y),eO.pixelStorei(eO.UNPACK_ROW_LENGTH,p),eO.pixelStorei(eO.UNPACK_IMAGE_HEIGHT,f),eO.pixelStorei(eO.UNPACK_SKIP_PIXELS,m),eO.pixelStorei(eO.UNPACK_SKIP_ROWS,g),eO.pixelStorei(eO.UNPACK_SKIP_IMAGES,v),0===a&&n.generateMipmaps&&eO.generateMipmap(s),r.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?c.setTextureCube(e,0):e.isData3DTexture?c.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?c.setTexture2DArray(e,0):c.setTexture2D(e,0),r.unbindTexture()},this.resetState=function(){en=0,er=0,ea=null,r.reset(),B.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return 2e3}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let t=this.getContext();t.drawingBufferColorSpace=e===k?"display-p3":"srgb",t.unpackColorSpace=ev.workingColorSpace===z?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===U?3001:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=3001===e?U:F}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}(class extends rX{}).prototype.isWebGL1Renderer=!0;class rY extends tb{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class rK{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=J()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=J()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=J()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}let rQ=new eI;class rJ{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)rQ.fromBufferAttribute(this,t),rQ.applyMatrix4(e),this.setXYZ(t,rQ.x,rQ.y,rQ.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)rQ.fromBufferAttribute(this,t),rQ.applyNormalMatrix(e),this.setXYZ(t,rQ.x,rQ.y,rQ.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)rQ.fromBufferAttribute(this,t),rQ.transformDirection(e),this.setXYZ(t,rQ.x,rQ.y,rQ.z);return this}setX(e,t){return this.normalized&&(t=er(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=er(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=er(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=er(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=en(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=en(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=en(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=en(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=er(t,this.array),i=er(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=er(t,this.array),i=er(i,this.array),n=er(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=er(t,this.array),i=er(i,this.array),n=er(n,this.array),r=er(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new rJ(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new tY(new this.array.constructor(e),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}}}let rZ=new eI,r$=new eE,r0=new eE,r1=new eI,r2=new e8,r3=new eI,r4=new eZ,r5=new e8,r6=new e6;class r8 extends im{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=p,this.bindMatrix=new e8,this.bindMatrixInverse=new e8,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new eB),this.boundingBox.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,r3),this.boundingBox.expandByPoint(r3)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new eZ),this.boundingSphere.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,r3),this.boundingSphere.expandByPoint(r3)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){let i=this.material,n=this.matrixWorld;if(void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),r4.copy(this.boundingSphere),r4.applyMatrix4(n),!1!==e.ray.intersectsSphere(r4))){if(r5.copy(n).invert(),r6.copy(e.ray).applyMatrix4(r5),null!==this.boundingBox&&!1===r6.intersectsBox(this.boundingBox))return;this._computeIntersections(e,t,r6)}}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new eE,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);let n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===p?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){let i=this.skeleton,n=this.geometry;r$.fromBufferAttribute(n.attributes.skinIndex,e),r0.fromBufferAttribute(n.attributes.skinWeight,e),rZ.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){let n=r0.getComponent(e);if(0!==n){let r=r$.getComponent(e);r2.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(r1.copy(rZ).applyMatrix4(r2),n)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class r9 extends tb{constructor(){super(),this.isBone=!0,this.type="Bone"}}class r7 extends eM{constructor(e=null,t=1,i=1,n,r,a,s,o,l=v,c=v,h,u){super(null,a,s,o,l,c,n,r,h,u),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let ae=new e8,at=new e8;class ai{constructor(e=[],t=[]){this.uuid=J(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new e8)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new e8;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=e.length;n<r;n++){let r=e[n]?e[n].matrixWorld:at;ae.multiplyMatrices(r,t[n]),ae.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new ai(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length),t=new Float32Array((e=Math.max(e=4*Math.ceil(e/4),4))*e*4);t.set(this.boneMatrices);let i=new r7(t,e,e,C,M);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let n=e.bones[i],r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new r9),this.bones.push(r),this.boneInverses.push(new e8().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){let r=t[n];e.bones.push(r.uuid);let a=i[n];e.boneInverses.push(a.toArray())}return e}}class an extends tY{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}let ar=new e8,aa=new e8,as=[],ao=new eB,al=new e8,ac=new im,ah=new eZ;class au extends im{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new an(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<i;e++)this.setMatrixAt(e,al)}computeBoundingBox(){let e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new eB),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,ar),ao.copy(e.boundingBox).applyMatrix4(ar),this.boundingBox.union(ao)}computeBoundingSphere(){let e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new eZ),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,ar),ah.copy(e.boundingSphere).applyMatrix4(ar),this.boundingSphere.union(ah)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let i=this.matrixWorld,n=this.count;if(ac.geometry=this.geometry,ac.material=this.material,void 0!==ac.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),ah.copy(this.boundingSphere),ah.applyMatrix4(i),!1!==e.ray.intersectsSphere(ah)))for(let r=0;r<n;r++){this.getMatrixAt(r,ar),aa.multiplyMatrices(i,ar),ac.matrixWorld=aa,ac.raycast(e,as);for(let e=0,i=as.length;e<i;e++){let i=as[e];i.instanceId=r,i.object=this,t.push(i)}as.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new an(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class ad extends tV{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new tk(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}let ap=new eI,af=new eI,am=new e8,ag=new e6,av=new eZ;class ay extends tb{constructor(e=new t5,t=new ad){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)ap.fromBufferAttribute(t,e-1),af.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=ap.distanceTo(af);e.setAttribute("lineDistance",new tJ(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),av.copy(i.boundingSphere),av.applyMatrix4(n),av.radius+=r,!1===e.ray.intersectsSphere(av))return;am.copy(n).invert(),ag.copy(e.ray).applyMatrix4(am);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=new eI,c=new eI,h=new eI,u=new eI,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p){let i=Math.max(0,a.start),n=Math.min(p.count,a.start+a.count);for(let r=i,a=n-1;r<a;r+=d){let i=p.getX(r),n=p.getX(r+1);if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,n),ag.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let a=e.ray.origin.distanceTo(u);a<e.near||a>e.far||t.push({distance:a,point:h.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else{let i=Math.max(0,a.start),n=Math.min(f.count,a.start+a.count);for(let r=i,a=n-1;r<a;r+=d){if(l.fromBufferAttribute(f,r),c.fromBufferAttribute(f,r+1),ag.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);let i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}let ax=new eI,a_=new eI;class aA extends ay{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)ax.fromBufferAttribute(t,e),a_.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+ax.distanceTo(a_);e.setAttribute("lineDistance",new tJ(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ab extends ay{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class aS extends tV{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new tk(0xffffff),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let aw=new e8,aM=new e6,aE=new eZ,aC=new eI;class aT extends tb{constructor(e=new t5,t=new aS){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Points.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),aE.copy(i.boundingSphere),aE.applyMatrix4(n),aE.radius+=r,!1===e.ray.intersectsSphere(aE))return;aw.copy(n).invert(),aM.copy(e.ray).applyMatrix4(aw);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=i.index,c=i.attributes.position;if(null!==l){let i=Math.max(0,a.start),r=Math.min(l.count,a.start+a.count);for(let a=i;a<r;a++){let i=l.getX(a);aC.fromBufferAttribute(c,i),aR(aC,i,o,n,e,t,this)}}else{let i=Math.max(0,a.start),r=Math.min(c.count,a.start+a.count);for(let a=i;a<r;a++)aC.fromBufferAttribute(c,a),aR(aC,a,o,n,e,t,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function aR(e,t,i,n,r,a,s){let o=aM.distanceSqToPoint(e);if(o<i){let i=new eI;aM.closestPointToPoint(e,i),i.applyMatrix4(n);let l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:t,face:null,object:s})}}class aP{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,n=this.getPoint(0),r=0;t.push(0);for(let a=1;a<=e;a++)t.push(r+=(i=this.getPoint(a/e)).distanceTo(n)),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i;let n=this.getLengths(),r=0,a=n.length;i=t||e*n[a-1];let s=0,o=a-1,l;for(;s<=o;)if((l=n[r=Math.floor(s+(o-s)/2)]-i)<0)s=r+1;else if(l>0)o=r-1;else{o=r;break}if(n[r=o]===i)return r/(a-1);let c=n[r],h=n[r+1];return(r+(i-c)/(h-c))/(a-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),a=this.getPoint(n),s=t||(r.isVector2?new es:new eI);return s.copy(a).sub(r).normalize(),s}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new eI,n=[],r=[],a=[],s=new eI,o=new e8;for(let t=0;t<=e;t++){let i=t/e;n[t]=this.getTangentAt(i,new eI)}r[0]=new eI,a[0]=new eI;let l=Number.MAX_VALUE,c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],s),a[0].crossVectors(n[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(n[t-1],n[t]),s.length()>Number.EPSILON){s.normalize();let e=Math.acos(Z(n[t-1].dot(n[t]),-1,1));r[t].applyMatrix4(o.makeRotationAxis(s,e))}a[t].crossVectors(n[t],r[t])}if(!0===t){let t=Math.acos(Z(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],t*i)),a[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class aI extends aP{constructor(e=0,t=0,i=1,n=1,r=0,a=2*Math.PI,s=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t){let i=t||new es,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0!==this.aClockwise||a||(r===n?r=-n:r-=n);let s=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function aL(){let e=0,t=0,i=0,n=0;function r(r,a,s,o){e=r,t=s,i=-3*r+3*a-2*s-o,n=2*r-2*a+s+o}return{initCatmullRom:function(e,t,i,n,a){r(t,i,a*(i-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,a,s,o){let l=(t-e)/a-(i-e)/(a+s)+(i-t)/s,c=(i-t)/s-(n-t)/(s+o)+(n-i)/o;r(t,i,l*=s,c*=s)},calc:function(r){let a=r*r;return e+t*r+i*a+a*r*n}}}let aD=new eI,aB=new aL,aO=new aL,aN=new aL;function aU(e,t,i,n,r){let a=(n-t)*.5,s=(r-i)*.5,o=e*e;return e*o*(2*i-2*n+a+s)+(-3*i+3*n-2*a-s)*o+a*e+i}function aF(e,t,i,n){return function(e,t){let i=1-e;return i*i*t}(e,t)+2*(1-e)*e*i+e*e*n}function ak(e,t,i,n,r){return function(e,t){let i=1-e;return i*i*i*t}(e,t)+function(e,t){let i=1-e;return 3*i*i*e*t}(e,i)+3*(1-e)*e*e*n+e*e*e*r}class az extends aP{constructor(e=new es,t=new es,i=new es,n=new es){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new es){let i=this.v0,n=this.v1,r=this.v2,a=this.v3;return t.set(ak(e,i.x,n.x,r.x,a.x),ak(e,i.y,n.y,r.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class aH extends aP{constructor(e=new es,t=new es){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new es){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new es){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aV extends aP{constructor(e=new es,t=new es,i=new es){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new es){let i=this.v0,n=this.v1,r=this.v2;return t.set(aF(e,i.x,n.x,r.x),aF(e,i.y,n.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aG extends aP{constructor(e=new eI,t=new eI,i=new eI){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new eI){let i=this.v0,n=this.v1,r=this.v2;return t.set(aF(e,i.x,n.x,r.x),aF(e,i.y,n.y,r.y),aF(e,i.z,n.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aW extends aP{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new es){let i=this.points,n=(i.length-1)*e,r=Math.floor(n),a=n-r,s=i[0===r?r:r-1],o=i[r],l=i[r>i.length-2?i.length-1:r+1],c=i[r>i.length-3?i.length-1:r+2];return t.set(aU(a,s.x,o.x,l.x,c.x),aU(a,s.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(new es().fromArray(i))}return this}}var aj=Object.freeze({__proto__:null,ArcCurve:class extends aI{constructor(e,t,i,n,r,a){super(e,t,i,i,n,r,a),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends aP{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new eI){let i,n;let r=this.points,a=r.length,s=(a-(this.closed?0:1))*e,o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/a)+1)*a:0===l&&o===a-1&&(o=a-2,l=1),this.closed||o>0?i=r[(o-1)%a]:(aD.subVectors(r[0],r[1]).add(r[0]),i=aD);let c=r[o%a],h=r[(o+1)%a];if(this.closed||o+2<a?n=r[(o+2)%a]:(aD.subVectors(r[a-1],r[a-2]).add(r[a-1]),n=aD),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(i.distanceToSquared(c),e),r=Math.pow(c.distanceToSquared(h),e),a=Math.pow(h.distanceToSquared(n),e);r<1e-4&&(r=1),t<1e-4&&(t=r),a<1e-4&&(a=r),aB.initNonuniformCatmullRom(i.x,c.x,h.x,n.x,t,r,a),aO.initNonuniformCatmullRom(i.y,c.y,h.y,n.y,t,r,a),aN.initNonuniformCatmullRom(i.z,c.z,h.z,n.z,t,r,a)}else"catmullrom"===this.curveType&&(aB.initCatmullRom(i.x,c.x,h.x,n.x,this.tension),aO.initCatmullRom(i.y,c.y,h.y,n.y,this.tension),aN.initCatmullRom(i.z,c.z,h.z,n.z,this.tension));return t.set(aB.calc(l),aO.calc(l),aN.calc(l)),t}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(new eI().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:az,CubicBezierCurve3:class extends aP{constructor(e=new eI,t=new eI,i=new eI,n=new eI){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new eI){let i=this.v0,n=this.v1,r=this.v2,a=this.v3;return t.set(ak(e,i.x,n.x,r.x,a.x),ak(e,i.y,n.y,r.y,a.y),ak(e,i.z,n.z,r.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:aI,LineCurve:aH,LineCurve3:class extends aP{constructor(e=new eI,t=new eI){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new eI){return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new eI){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:aV,QuadraticBezierCurve3:aG,SplineCurve:aW});class aq extends aP{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){let i=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new aj[i](t,e))}return this}getPoint(e,t){let i=e*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let e=n[r]-i,a=this.curves[r],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,n=this.curves.length;i<n;i++)e.push(t+=this.curves[i].getLength());return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t;let i=[];for(let n=0,r=this.curves;n<r.length;n++){let a=r[n],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(s);for(let e=0;e<o.length;e++){let n=o[e];t&&t.equals(n)||(i.push(n),t=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(new aj[i.type]().fromJSON(i))}return this}}class aX extends aq{constructor(e){super(),this.type="Path",this.currentPoint=new es,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new aH(this.currentPoint.clone(),new es(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){let r=new aV(this.currentPoint.clone(),new es(e,t),new es(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,a){let s=new az(this.currentPoint.clone(),new es(e,t),new es(i,n),new es(r,a));return this.curves.push(s),this.currentPoint.set(r,a),this}splineThru(e){let t=new aW([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,a){let s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,i,n,r,a),this}absarc(e,t,i,n,r,a){return this.absellipse(e,t,i,i,n,r,a),this}ellipse(e,t,i,n,r,a,s,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,a,s,o),this}absellipse(e,t,i,n,r,a,s,o){let l=new aI(e,t,i,n,r,a,s,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class aY extends t5{constructor(e=[new es(0,-.5),new es(.5,0),new es(0,.5)],t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Z(n,0,2*Math.PI);let r=[],a=[],s=[],o=[],l=[],c=1/t,h=new eI,u=new es,d=new eI,p=new eI,f=new eI,m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=t;r++){let d=i+r*c*n,p=Math.sin(d),f=Math.cos(d);for(let i=0;i<=e.length-1;i++){h.x=e[i].x*p,h.y=e[i].y,h.z=e[i].x*f,a.push(h.x,h.y,h.z),u.x=r/t,u.y=i/(e.length-1),s.push(u.x,u.y);let n=o[3*i+0]*p,c=o[3*i+1],d=o[3*i+0]*f;l.push(n,c,d)}}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){let n=t+i*e.length,a=n+e.length,s=n+e.length+1,o=n+1;r.push(n,a,o),r.push(s,o,a)}this.setIndex(r),this.setAttribute("position",new tJ(a,3)),this.setAttribute("uv",new tJ(s,2)),this.setAttribute("normal",new tJ(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aY(e.points,e.segments,e.phiStart,e.phiLength)}}class aK extends aY{constructor(e=1,t=1,i=4,n=8){let r=new aX;r.absarc(0,-t/2,e,1.5*Math.PI,0),r.absarc(0,t/2,e,0,.5*Math.PI),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new aK(e.radius,e.length,e.capSegments,e.radialSegments)}}class aQ extends t5{constructor(e=1,t=32,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);let r=[],a=[],s=[],o=[],l=new eI,c=new es;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=t;r++,h+=3){let u=i+r/t*n;l.x=e*Math.cos(u),l.y=e*Math.sin(u),a.push(l.x,l.y,l.z),s.push(0,0,1),c.x=(a[h]/e+1)/2,c.y=(a[h+1]/e+1)/2,o.push(c.x,c.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new tJ(a,3)),this.setAttribute("normal",new tJ(s,3)),this.setAttribute("uv",new tJ(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aQ(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class aJ extends t5{constructor(e=1,t=1,i=1,n=32,r=1,a=!1,s=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o};let l=this;n=Math.floor(n),r=Math.floor(r);let c=[],h=[],u=[],d=[],p=0,f=[],m=i/2,g=0;function v(i){let r=p,a=new es,f=new eI,v=0,y=!0===i?e:t,x=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),p++;let _=p;for(let e=0;e<=n;e++){let t=e/n*o+s,i=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*x,f.z=y*i,h.push(f.x,f.y,f.z),u.push(0,x,0),a.x=.5*i+.5,a.y=.5*r*x+.5,d.push(a.x,a.y),p++}for(let e=0;e<n;e++){let t=r+e,n=_+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}(function(){let a=new eI,v=new eI,y=0,x=(t-e)/i;for(let l=0;l<=r;l++){let c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=n;e++){let t=e/n,r=t*o+s,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*i+m,v.z=y*f,h.push(v.x,v.y,v.z),a.set(l,x,f).normalize(),u.push(a.x,a.y,a.z),d.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<n;e++)for(let t=0;t<r;t++){let i=f[t][e],n=f[t+1][e],r=f[t+1][e+1],a=f[t][e+1];c.push(i,n,a),c.push(n,r,a),y+=6}l.addGroup(g,y,0),g+=y})(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new tJ(h,3)),this.setAttribute("normal",new tJ(u,3)),this.setAttribute("uv",new tJ(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aJ(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class aZ extends aJ{constructor(e=1,t=1,i=32,n=1,r=!1,a=0,s=2*Math.PI){super(0,e,t,i,n,r,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}static fromJSON(e){return new aZ(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class a$ extends t5{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};let r=[],a=[];function s(e){r.push(e.x,e.y,e.z)}function o(t,i){let n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function l(e,t,i,n){n<0&&1===e.x&&(a[t]=e.x-1),0===i.x&&0===i.z&&(a[t]=n/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}(function(e){let i=new eI,n=new eI,r=new eI;for(let a=0;a<t.length;a+=3)o(t[a+0],i),o(t[a+1],n),o(t[a+2],r),function(e,t,i,n){let r=n+1,a=[];for(let n=0;n<=r;n++){a[n]=[];let s=e.clone().lerp(i,n/r),o=t.clone().lerp(i,n/r),l=r-n;for(let e=0;e<=l;e++)0===e&&n===r?a[n][e]=s:a[n][e]=s.clone().lerp(o,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){let i=Math.floor(t/2);t%2==0?(s(a[e][i+1]),s(a[e+1][i]),s(a[e][i])):(s(a[e][i+1]),s(a[e+1][i+1]),s(a[e+1][i]))}}(i,n,r,e)})(n),function(e){let t=new eI;for(let i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){let e=new eI;for(let i=0;i<r.length;i+=3){var t;e.x=r[i+0],e.y=r[i+1],e.z=r[i+2];let n=c(e)/2/Math.PI+.5,s=Math.atan2(-(t=e).y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5;a.push(n,1-s)}(function(){let e=new eI,t=new eI,i=new eI,n=new eI,s=new es,o=new es,h=new es;for(let u=0,d=0;u<r.length;u+=9,d+=6){e.set(r[u+0],r[u+1],r[u+2]),t.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),h.set(a[d+4],a[d+5]),n.copy(e).add(t).add(i).divideScalar(3);let p=c(n);l(s,d+0,e,p),l(o,d+2,t,p),l(h,d+4,i,p)}})(),function(){for(let e=0;e<a.length;e+=6){let t=a[e+0],i=a[e+2],n=a[e+4],r=Math.max(t,i,n),s=Math.min(t,i,n);r>.9&&s<.1&&(t<.2&&(a[e+0]+=1),i<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new tJ(r,3)),this.setAttribute("normal",new tJ(r.slice(),3)),this.setAttribute("uv",new tJ(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a$(e.vertices,e.indices,e.radius,e.details)}}class a0 extends a${constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new a0(e.radius,e.detail)}}class a1 extends aX{constructor(e){super(e),this.uuid=J(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(new aX().fromJSON(i))}return this}}let a2=function(e,t,i=2){let n,r,a,s,o,l,c;let h=t&&t.length,u=h?t[0]*i:e.length,d=a3(e,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,i,n){let r,a,s,o,l;let c=[];for(r=0,a=t.length;r<a;r++)s=t[r]*n,o=r<a-1?t[r+1]*n:e.length,(l=a3(e,s,o,n,!1))===l.next&&(l.steiner=!0),c.push(function(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}(l));for(c.sort(a5),r=0;r<c.length;r++)i=function(e,t){let i=function(e,t){let i=t,n=-1/0,r,a=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){let e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=a&&e>n&&(n=e,r=i.x<i.next.x?i:i.next,e===a))return r}i=i.next}while(i!==t);if(!r)return null;let o=r,l=r.x,c=r.y,h=1/0,u;i=r;do{var d,p;a>=i.x&&i.x>=l&&a!==i.x&&a8(s<c?a:n,s,l,c,s<c?n:a,s,i.x,i.y)&&(u=Math.abs(s-i.y)/(a-i.x),sn(i,e)&&(u<h||u===h&&(i.x>r.x||i.x===r.x&&(d=r,p=i,0>a9(d.prev,d,p.prev)&&0>a9(p.next,d,d.next))))&&(r=i,h=u)),i=i.next}while(i!==o);return r}(e,t);if(!i)return t;let n=sr(i,e);return a4(n,n.next),a4(i,i.next)}(c[r],i);return i}(e,t,d,i)),e.length>80*i){n=a=e[0],r=s=e[1];for(let t=i;t<u;t+=i)o=e[t],l=e[t+1],o<n&&(n=o),l<r&&(r=l),o>a&&(a=o),l>s&&(s=l);c=0!==(c=Math.max(a-n,s-r))?32767/c:0}return function e(t,i,n,r,a,s,o){if(!t)return;!o&&s&&function(e,t,i,n){let r=e;do 0===r.z&&(r.z=a6(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,a,s,o,l,c=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,n=i,o=0,t=0;t<c&&(o++,n=n.nextZ);t++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(s>1)}(r)}(t,r,a,s);let l=t,c,h;for(;t.prev!==t.next;){if(c=t.prev,h=t.next,s?function(e,t,i,n){let r=e.prev,a=e.next;if(a9(r,e,a)>=0)return!1;let s=r.x,o=e.x,l=a.x,c=r.y,h=e.y,u=a.y,d=s<o?s<l?s:l:o<l?o:l,p=c<h?c<u?c:u:h<u?h:u,f=s>o?s>l?s:l:o>l?o:l,m=c>h?c>u?c:u:h>u?h:u,g=a6(d,p,t,i,n),v=a6(f,m,t,i,n),y=e.prevZ,x=e.nextZ;for(;y&&y.z>=g&&x&&x.z<=v;){if(y.x>=d&&y.x<=f&&y.y>=p&&y.y<=m&&y!==r&&y!==a&&a8(s,c,o,h,l,u,y.x,y.y)&&a9(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=d&&x.x<=f&&x.y>=p&&x.y<=m&&x!==r&&x!==a&&a8(s,c,o,h,l,u,x.x,x.y)&&a9(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=g;){if(y.x>=d&&y.x<=f&&y.y>=p&&y.y<=m&&y!==r&&y!==a&&a8(s,c,o,h,l,u,y.x,y.y)&&a9(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=v;){if(x.x>=d&&x.x<=f&&x.y>=p&&x.y<=m&&x!==r&&x!==a&&a8(s,c,o,h,l,u,x.x,x.y)&&a9(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}(t,r,a,s):function(e){let t=e.prev,i=e.next;if(a9(t,e,i)>=0)return!1;let n=t.x,r=e.x,a=i.x,s=t.y,o=e.y,l=i.y,c=n<r?n<a?n:a:r<a?r:a,h=s<o?s<l?s:l:o<l?o:l,u=n>r?n>a?n:a:r>a?r:a,d=s>o?s>l?s:l:o>l?o:l,p=i.next;for(;p!==t;){if(p.x>=c&&p.x<=u&&p.y>=h&&p.y<=d&&a8(n,s,r,o,a,l,p.x,p.y)&&a9(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}(t)){i.push(c.i/n|0),i.push(t.i/n|0),i.push(h.i/n|0),ss(t),t=h.next,l=h.next;continue}if((t=h)===l){o?1===o?e(t=function(e,t,i){let n=e;do{let r=n.prev,a=n.next.next;!a7(r,a)&&se(r,n,n.next,a)&&sn(r,a)&&sn(a,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(a.i/i|0),ss(n),ss(n.next),n=e=a),n=n.next}while(n!==e);return a4(n)}(a4(t),i,n),i,n,r,a,s,2):2===o&&function(t,i,n,r,a,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){var l,c;if(o.i!==t.i&&(l=o,c=t,l.next.i!==c.i&&l.prev.i!==c.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&se(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(l,c)&&(sn(l,c)&&sn(c,l)&&function(e,t){let i=e,n=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==e);return n}(l,c)&&(a9(l.prev,l,c.prev)||a9(l,c.prev,c))||a7(l,c)&&a9(l.prev,l,l.next)>0&&a9(c.prev,c,c.next)>0))){let l=sr(o,t);o=a4(o,o.next),l=a4(l,l.next),e(o,i,n,r,a,s,0),e(l,i,n,r,a,s,0);return}t=t.next}o=o.next}while(o!==t)}(t,i,n,r,a,s):e(a4(t),i,n,r,a,s,1);break}}}(d,p,i,n,r,c,0),p};function a3(e,t,i,n,r){let a,s;if(r===function(e,t,i,n){let r=0;for(let a=t,s=i-n;a<i;a+=n)r+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return r}(e,t,i,n)>0)for(a=t;a<i;a+=n)s=sa(a,e[a],e[a+1],s);else for(a=i-n;a>=t;a-=n)s=sa(a,e[a],e[a+1],s);return s&&a7(s,s.next)&&(ss(s),s=s.next),s}function a4(e,t){if(!e)return e;t||(t=e);let i=e,n;do if(n=!1,!i.steiner&&(a7(i,i.next)||0===a9(i.prev,i,i.next))){if(ss(i),(i=t=i.prev)===i.next)break;n=!0}else i=i.next;while(n||i!==t);return t}function a5(e,t){return e.x-t.x}function a6(e,t,i,n,r){return(e=((e=((e=((e=((e=(e-i)*r|0)|e<<8)&0xff00ff)|e<<4)&0xf0f0f0f)|e<<2)&0x33333333)|e<<1)&0x55555555)|(t=((t=((t=((t=((t=(t-n)*r|0)|t<<8)&0xff00ff)|t<<4)&0xf0f0f0f)|t<<2)&0x33333333)|t<<1)&0x55555555)<<1}function a8(e,t,i,n,r,a,s,o){return(r-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(n-o)>=(i-s)*(t-o)&&(i-s)*(a-o)>=(r-s)*(n-o)}function a9(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function a7(e,t){return e.x===t.x&&e.y===t.y}function se(e,t,i,n){let r=si(a9(e,t,i)),a=si(a9(e,t,n)),s=si(a9(i,n,e)),o=si(a9(i,n,t));return!!(r!==a&&s!==o||0===r&&st(e,i,t)||0===a&&st(e,n,t)||0===s&&st(i,e,n)||0===o&&st(i,t,n))}function st(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function si(e){return e>0?1:e<0?-1:0}function sn(e,t){return 0>a9(e.prev,e,e.next)?a9(e,t,e.next)>=0&&a9(e,e.prev,t)>=0:0>a9(e,t,e.prev)||0>a9(e,e.next,t)}function sr(e,t){let i=new so(e.i,e.x,e.y),n=new so(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function sa(e,t,i,n){let r=new so(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function ss(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function so(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class sl{static area(e){let t=e.length,i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return .5*i}static isClockWise(e){return 0>sl.area(e)}static triangulateShape(e,t){let i=[],n=[],r=[];sc(e),sh(i,e);let a=e.length;t.forEach(sc);for(let e=0;e<t.length;e++)n.push(a),a+=t[e].length,sh(i,t[e]);let s=a2(i,n);for(let e=0;e<s.length;e+=3)r.push(s.slice(e,e+3));return r}}function sc(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function sh(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class su extends t5{constructor(e=new a1([new es(.5,.5),new es(-.5,.5),new es(-.5,-.5),new es(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let i=this,n=[],r=[];for(let a=0,s=e.length;a<s;a++)!function(e){let a,s,o,l;let c=[],h=void 0!==t.curveSegments?t.curveSegments:12,u=void 0!==t.steps?t.steps:1,d=void 0!==t.depth?t.depth:1,p=void 0===t.bevelEnabled||t.bevelEnabled,f=void 0!==t.bevelThickness?t.bevelThickness:.2,m=void 0!==t.bevelSize?t.bevelSize:f-.1,g=void 0!==t.bevelOffset?t.bevelOffset:0,v=void 0!==t.bevelSegments?t.bevelSegments:3,y=t.extrudePath,x=void 0!==t.UVGenerator?t.UVGenerator:sd,_,A=!1;y&&(_=y.getSpacedPoints(u),A=!0,p=!1,a=y.computeFrenetFrames(u,!1),s=new eI,o=new eI,l=new eI),p||(v=0,f=0,m=0,g=0);let b=e.extractPoints(h),S=b.shape,w=b.holes;if(!sl.isClockWise(S)){S=S.reverse();for(let e=0,t=w.length;e<t;e++){let t=w[e];sl.isClockWise(t)&&(w[e]=t.reverse())}}let M=sl.triangulateShape(S,w),E=S;for(let e=0,t=w.length;e<t;e++){let t=w[e];S=S.concat(t)}function C(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,i)}let T=S.length,R=M.length;function P(e,t,i){let n,r,a;let s=e.x-t.x,o=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=s*s+o*o;if(Math.abs(s*c-o*l)>Number.EPSILON){let u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=t.x-o/u,f=t.y+s/u,m=((i.x-c/d-p)*c-(i.y+l/d-f)*l)/(s*c-o*l),g=(n=p+s*m-e.x)*n+(r=f+o*m-e.y)*r;if(g<=2)return new es(n,r);a=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),e?(n=-o,r=s,a=Math.sqrt(h)):(n=s,r=o,a=Math.sqrt(h/2))}return new es(n/a,r/a)}let I=[];for(let e=0,t=E.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),I[e]=P(E[e],E[i],E[n]);let L=[],D,B=I.concat();for(let e=0,t=w.length;e<t;e++){let t=w[e];D=[];for(let e=0,i=t.length,n=i-1,r=e+1;e<i;e++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[e]=P(t[e],t[n],t[r]);L.push(D),B=B.concat(D)}for(let e=0;e<v;e++){let t=e/v,i=f*Math.cos(t*Math.PI/2),n=m*Math.sin(t*Math.PI/2)+g;for(let e=0,t=E.length;e<t;e++){let t=C(E[e],I[e],n);U(t.x,t.y,-i)}for(let e=0,t=w.length;e<t;e++){let t=w[e];D=L[e];for(let e=0,r=t.length;e<r;e++){let r=C(t[e],D[e],n);U(r.x,r.y,-i)}}}let O=m+g;for(let e=0;e<T;e++){let t=p?C(S[e],B[e],O):S[e];A?(o.copy(a.normals[0]).multiplyScalar(t.x),s.copy(a.binormals[0]).multiplyScalar(t.y),l.copy(_[0]).add(o).add(s),U(l.x,l.y,l.z)):U(t.x,t.y,0)}for(let e=1;e<=u;e++)for(let t=0;t<T;t++){let i=p?C(S[t],B[t],O):S[t];A?(o.copy(a.normals[e]).multiplyScalar(i.x),s.copy(a.binormals[e]).multiplyScalar(i.y),l.copy(_[e]).add(o).add(s),U(l.x,l.y,l.z)):U(i.x,i.y,d/u*e)}for(let e=v-1;e>=0;e--){let t=e/v,i=f*Math.cos(t*Math.PI/2),n=m*Math.sin(t*Math.PI/2)+g;for(let e=0,t=E.length;e<t;e++){let t=C(E[e],I[e],n);U(t.x,t.y,d+i)}for(let e=0,t=w.length;e<t;e++){let t=w[e];D=L[e];for(let e=0,r=t.length;e<r;e++){let r=C(t[e],D[e],n);A?U(r.x,r.y+_[u-1].y,_[u-1].x+i):U(r.x,r.y,d+i)}}}function N(e,t){let r=e.length;for(;--r>=0;){let a=r,s=r-1;s<0&&(s=e.length-1);for(let e=0,r=u+2*v;e<r;e++){let r=T*e,o=T*(e+1);!function(e,t,r,a){k(e),k(t),k(a),k(t),k(r),k(a);let s=n.length/3,o=x.generateSideWallUV(i,n,s-6,s-3,s-2,s-1);z(o[0]),z(o[1]),z(o[3]),z(o[1]),z(o[2]),z(o[3])}(t+a+r,t+s+r,t+s+o,t+a+o)}}}function U(e,t,i){c.push(e),c.push(t),c.push(i)}function F(e,t,r){k(e),k(t),k(r);let a=n.length/3,s=x.generateTopUV(i,n,a-3,a-2,a-1);z(s[0]),z(s[1]),z(s[2])}function k(e){n.push(c[3*e+0]),n.push(c[3*e+1]),n.push(c[3*e+2])}function z(e){r.push(e.x),r.push(e.y)}(function(){let e=n.length/3;if(p){let e=0,t=0*T;for(let e=0;e<R;e++){let i=M[e];F(i[2]+t,i[1]+t,i[0]+t)}t=T*(u+2*v);for(let e=0;e<R;e++){let i=M[e];F(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<R;e++){let t=M[e];F(t[2],t[1],t[0])}for(let e=0;e<R;e++){let t=M[e];F(t[0]+T*u,t[1]+T*u,t[2]+T*u)}}i.addGroup(e,n.length/3-e,0)})(),function(){let e=n.length/3,t=0;N(E,0),t+=E.length;for(let e=0,i=w.length;e<i;e++){let i=w[e];N(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}(e[a]);this.setAttribute("position",new tJ(n,3)),this.setAttribute("uv",new tJ(r,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){let n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){let i=[];for(let n=0,r=e.shapes.length;n<r;n++){let r=t[e.shapes[n]];i.push(r)}let n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=new aj[n.type]().fromJSON(n)),new su(i,e.options)}}let sd={generateTopUV:function(e,t,i,n,r){let a=t[3*i],s=t[3*i+1],o=t[3*n],l=t[3*n+1],c=t[3*r],h=t[3*r+1];return[new es(a,s),new es(o,l),new es(c,h)]},generateSideWallUV:function(e,t,i,n,r,a){let s=t[3*i],o=t[3*i+1],l=t[3*i+2],c=t[3*n],h=t[3*n+1],u=t[3*n+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(o-h)<Math.abs(s-c)?[new es(s,1-l),new es(c,1-u),new es(d,1-f),new es(m,1-v)]:[new es(o,1-l),new es(h,1-u),new es(p,1-f),new es(g,1-v)]}};class sp extends a${constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sp(e.radius,e.detail)}}class sf extends a${constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sf(e.radius,e.detail)}}class sm extends t5{constructor(e=.5,t=1,i=32,n=1,r=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},i=Math.max(3,i);let s=[],o=[],l=[],c=[],h=e,u=(t-e)/(n=Math.max(1,n)),d=new eI,p=new es;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){let n=r+e/i*a;d.x=h*Math.cos(n),d.y=h*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=u}for(let e=0;e<n;e++){let t=e*(i+1);for(let e=0;e<i;e++){let n=e+t,r=n+i+1,a=n+i+2,o=n+1;s.push(n,r,o),s.push(r,a,o)}}this.setIndex(s),this.setAttribute("position",new tJ(o,3)),this.setAttribute("normal",new tJ(l,3)),this.setAttribute("uv",new tJ(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sm(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class sg extends t5{constructor(e=new a1([new es(0,.5),new es(-.5,-.5),new es(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let i=[],n=[],r=[],a=[],s=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,o,t),s+=o,o=0;function l(e){let s=n.length/3,l=e.extractPoints(t),c=l.shape,h=l.holes;!1===sl.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){let t=h[e];!0===sl.isClockWise(t)&&(h[e]=t.reverse())}let u=sl.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){let t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){let t=c[e];n.push(t.x,t.y,0),r.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){let t=u[e],n=t[0]+s,r=t[1]+s,a=t[2]+s;i.push(n,r,a),o+=3}}this.setIndex(i),this.setAttribute("position",new tJ(n,3)),this.setAttribute("normal",new tJ(r,3)),this.setAttribute("uv",new tJ(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){let n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){let i=[];for(let n=0,r=e.shapes.length;n<r;n++){let r=t[e.shapes[n]];i.push(r)}return new sg(i,e.curveSegments)}}class sv extends t5{constructor(e=1,t=32,i=16,n=0,r=2*Math.PI,a=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(a+s,Math.PI),l=0,c=[],h=new eI,u=new eI,d=[],p=[],f=[],m=[];for(let d=0;d<=i;d++){let g=[],v=d/i,y=0;0===d&&0===a?y=.5/t:d===i&&o===Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){let o=i/t;h.x=-e*Math.cos(n+o*r)*Math.sin(a+v*s),h.y=e*Math.cos(a+v*s),h.z=e*Math.sin(n+o*r)*Math.sin(a+v*s),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){let t=c[e][n+1],r=c[e][n],s=c[e+1][n],l=c[e+1][n+1];(0!==e||a>0)&&d.push(t,r,l),(e!==i-1||o<Math.PI)&&d.push(r,s,l)}this.setIndex(d),this.setAttribute("position",new tJ(p,3)),this.setAttribute("normal",new tJ(f,3)),this.setAttribute("uv",new tJ(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class sy extends a${constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sy(e.radius,e.detail)}}class sx extends t5{constructor(e=1,t=.4,i=12,n=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);let a=[],s=[],o=[],l=[],c=new eI,h=new eI,u=new eI;for(let a=0;a<=i;a++)for(let d=0;d<=n;d++){let p=d/n*r,f=a/i*Math.PI*2;h.x=(e+t*Math.cos(f))*Math.cos(p),h.y=(e+t*Math.cos(f))*Math.sin(p),h.z=t*Math.sin(f),s.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(a/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){let i=(n+1)*e+t-1,r=(n+1)*(e-1)+t-1,s=(n+1)*(e-1)+t,o=(n+1)*e+t;a.push(i,r,o),a.push(r,s,o)}this.setIndex(a),this.setAttribute("position",new tJ(s,3)),this.setAttribute("normal",new tJ(o,3)),this.setAttribute("uv",new tJ(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sx(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class s_ extends t5{constructor(e=1,t=.4,i=64,n=8,r=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:a},i=Math.floor(i),n=Math.floor(n);let s=[],o=[],l=[],c=[],h=new eI,u=new eI,d=new eI,p=new eI,f=new eI,m=new eI,g=new eI;for(let s=0;s<=i;++s){let y=s/i*r*Math.PI*2;v(y,r,a,e,d),v(y+.01,r,a,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=n;++e){let r=e/n*Math.PI*2,a=-t*Math.cos(r),p=t*Math.sin(r);h.x=d.x+(a*g.x+p*f.x),h.y=d.y+(a*g.y+p*f.y),h.z=d.z+(a*g.z+p*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(s/i),c.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){let i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),a=(n+1)*e+t,o=(n+1)*(e-1)+t;s.push(i,r,o),s.push(r,a,o)}function v(e,t,i,n,r){let a=Math.cos(e),s=Math.sin(e),o=i/t*e,l=Math.cos(o);r.x=n*(2+l)*.5*a,r.y=n*(2+l)*s*.5,r.z=n*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new tJ(o,3)),this.setAttribute("normal",new tJ(l,3)),this.setAttribute("uv",new tJ(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new s_(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class sA extends t5{constructor(e=new aG(new eI(-1,-1,0),new eI(-1,1,0),new eI(1,1,0)),t=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r};let a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let s=new eI,o=new eI,l=new es,c=new eI,h=[],u=[],d=[],p=[];function f(r){c=e.getPointAt(r/t,c);let l=a.normals[r],d=a.binormals[r];for(let e=0;e<=n;e++){let t=e/n*Math.PI*2,r=Math.sin(t),a=-Math.cos(t);o.x=a*l.x+r*d.x,o.y=a*l.y+r*d.y,o.z=a*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),s.x=c.x+i*o.x,s.y=c.y+i*o.y,s.z=c.z+i*o.z,h.push(s.x,s.y,s.z)}}(function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){let i=(n+1)*(e-1)+(t-1),r=(n+1)*e+(t-1),a=(n+1)*e+t,s=(n+1)*(e-1)+t;p.push(i,r,s),p.push(r,a,s)}}()})(),this.setIndex(p),this.setAttribute("position",new tJ(h,3)),this.setAttribute("normal",new tJ(u,3)),this.setAttribute("uv",new tJ(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new sA(new aj[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class sb extends tV{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new tk(0xffffff),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tk(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new es(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sS extends sb{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new es(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Z(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new tk(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new tk(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new tk(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function sw(e,t,i){return e&&(i||e.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}function sM(e,t,i){let n=e.length,r=new e.constructor(n);for(let a=0,s=0;s!==n;++a){let n=i[a]*t;for(let i=0;i!==t;++i)r[s++]=e[n+i]}return r}function sE(e,t,i,n){let r=1,a=e[0];for(;void 0!==a&&void 0===a[n];)a=e[r++];if(void 0===a)return;let s=a[n];if(void 0!==s){if(Array.isArray(s))do void 0!==(s=a[n])&&(t.push(a.time),i.push.apply(i,s)),a=e[r++];while(void 0!==a);else if(void 0!==s.toArray)do void 0!==(s=a[n])&&(t.push(a.time),s.toArray(i,i.length)),a=e[r++];while(void 0!==a);else do void 0!==(s=a[n])&&(t.push(a.time),i.push(s)),a=e[r++];while(void 0!==a)}}class sC{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];t:{i:{let a;n:{r:if(!(e<n)){for(let a=i+2;;){if(void 0===n){if(e<r)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,e<(n=t[++i]))break i}a=t.length;break n}if(!(e>=r)){let s=t[1];e<s&&(i=2,r=s);for(let a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===a)break;if(n=r,e>=(r=t[--i-1]))break i}a=i,i=0;break n}break t}for(;i<a;){let n=i+a>>>1;e<t[n]?a=n:i=n+1}if(n=t[i],void 0===(r=t[i-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let e=0;e!==n;++e)t[e]=i[r+e];return t}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class sT extends sC{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){let n=this.parameterPositions,r=e-2,a=e+1,s=n[r],o=n[a];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:r=e,s=2*t-i;break;case 2402:r=n.length-2,s=t+n[r]-n[r+1];break;default:r=e,s=i}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:a=e,o=2*i-t;break;case 2402:a=1,o=i+n[1]-n[0];break;default:a=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=a*c}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==s;++e)r[e]=g*a[c+e]+v*a[l+e]+y*a[o+e]+x*a[h+e];return r}}class sR extends sC{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(i-t)/(n-t),h=1-c;for(let e=0;e!==s;++e)r[e]=a[l+e]*h+a[o+e]*c;return r}}class sP extends sC{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class sI{constructor(e,t,i,n){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=sw(t,this.TimeBufferType),this.values=sw(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let t;let i=e.constructor;if(i.toJSON!==this.toJSON)t=i.toJSON(e);else{t={name:e.name,times:sw(e.times,Array),values:sw(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new sP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new sR(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new sT(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case L:t=this.InterpolantFactoryMethodDiscrete;break;case D:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(t)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return L;case this.InterpolantFactoryMethodLinear:return D;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){let i=this.times,n=i.length,r=0,a=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==a&&i[a]>t;)--a;if(++a,0!==r||a!==n){r>=a&&(r=(a=Math.max(a,1))-1);let e=this.getValueSize();this.times=i.slice(r,a),this.values=this.values.slice(r*e,a*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==r;t++){let n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==a&&a>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,a),e=!1;break}a=n}if(void 0!==n){if(ArrayBuffer.isView(n)&&!(n instanceof DataView))for(let t=0,i=n.length;t!==i;++t){let i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=2302===this.getInterpolation(),r=e.length-1,a=1;for(let s=1;s<r;++s){let r=!1,o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0])){if(n)r=!0;else{let e=s*i,n=e-i,a=e+i;for(let s=0;s!==i;++s){let i=t[e+s];if(i!==t[n+s]||i!==t[a+s]){r=!0;break}}}}if(r){if(s!==a){e[a]=e[s];let n=s*i,r=a*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++a}}if(r>0){e[a]=e[r];for(let e=r*i,n=a*i,s=0;s!==i;++s)t[n+s]=t[e+s];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),i=new this.constructor(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}sI.prototype.TimeBufferType=Float32Array,sI.prototype.ValueBufferType=Float32Array,sI.prototype.DefaultInterpolation=D;class sL extends sI{}sL.prototype.ValueTypeName="bool",sL.prototype.ValueBufferType=Array,sL.prototype.DefaultInterpolation=L,sL.prototype.InterpolantFactoryMethodLinear=void 0,sL.prototype.InterpolantFactoryMethodSmooth=void 0;class sD extends sI{}sD.prototype.ValueTypeName="color";class sB extends sI{}sB.prototype.ValueTypeName="number";class sO extends sC{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(i-t)/(n-t),l=e*s;for(let e=l+s;l!==e;l+=4)eP.slerpFlat(r,0,a,l-s,a,l,o);return r}}class sN extends sI{InterpolantFactoryMethodLinear(e){return new sO(this.times,this.values,this.getValueSize(),e)}}sN.prototype.ValueTypeName="quaternion",sN.prototype.DefaultInterpolation=D,sN.prototype.InterpolantFactoryMethodSmooth=void 0;class sU extends sI{}sU.prototype.ValueTypeName="string",sU.prototype.ValueBufferType=Array,sU.prototype.DefaultInterpolation=L,sU.prototype.InterpolantFactoryMethodLinear=void 0,sU.prototype.InterpolantFactoryMethodSmooth=void 0;class sF extends sI{}sF.prototype.ValueTypeName="vector";class sk{constructor(e,t=-1,i,n=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=J(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,r=i.length;e!==r;++e)t.push((function(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return sB;case"vector":case"vector2":case"vector3":case"vector4":return sF;case"color":return sD;case"quaternion":return sN;case"bool":case"boolean":return sL;case"string":return sU}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let t=[],i=[];sE(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)})(i[e]).scale(n));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(sI.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){let r=t.length,a=[];for(let e=0;e<r;e++){let s=[],o=[];s.push((e+r-1)%r,e,(e+1)%r),o.push(0,1,0);let l=function(e){let t=e.length,i=Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort(function(t,i){return e[t]-e[i]}),i}(s);s=sM(s,1,l),o=sM(o,1,l),n||0!==s[0]||(s.push(r),o.push(o[0])),a.push(new sB(".morphTargetInfluences["+t[e].name+"]",s,o).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){let i=e[t],a=i.name.match(r);if(a&&a.length>1){let e=a[1],t=n[e];t||(n[e]=t=[]),t.push(i)}}let a=[];for(let e in n)a.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(e,t,i,n,r){if(0!==i.length){let a=[],s=[];sE(i,a,s,n),0!==a.length&&r.push(new e(t,a,s))}},n=[],r=e.name||"default",a=e.fps||30,s=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let e=0;e<l.length;e++){let r=l[e].keys;if(r&&0!==r.length){if(r[0].morphTargets){let e;let t={};for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(let i in t){let t=[],a=[];for(let n=0;n!==r[e].morphTargets.length;++n){let n=r[e];t.push(n.time),a.push(n.morphTarget===i?1:0)}n.push(new sB(".morphTargetInfluence["+i+"]",t,a))}o=t.length*a}else{let a=".bones["+t[e].name+"]";i(sF,a+".position",r,"pos",n),i(sN,a+".quaternion",r,"rot",n),i(sF,a+".scale",r,"scl",n)}}}return 0===n.length?null:new this(r,o,n,s)}resetDuration(){let e=this.tracks,t=0;for(let i=0,n=e.length;i!==n;++i){let e=this.tracks[i];t=Math.max(t,e.times[e.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let sz={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},sH=new class{constructor(e,t,i){let n;let r=this,a=!1,s=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===a&&void 0!==r.onStart&&r.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,o),s===o&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return -1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){let i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}};class sV{constructor(e){this.manager=void 0!==e?e:sH,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(n,r){i.load(e,n,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}sV.DEFAULT_MATERIAL_NAME="__DEFAULT";let sG={};class sW extends Error{constructor(e,t){super(e),this.response=t}}class sj extends sV{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=sz.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(void 0!==sG[e]){sG[e].push({onLoad:t,onProgress:i,onError:n});return}sG[e]=[],sG[e].push({onLoad:t,onProgress:i,onError:n});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,o=this.responseType;fetch(a).then(t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;let i=sG[e],n=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=r?parseInt(r):0,s=0!==a,o=0;return new Response(new ReadableStream({start(e){(function t(){n.read().then(({done:n,value:r})=>{if(n)e.close();else{let n=new ProgressEvent("progress",{lengthComputable:s,loaded:o+=r.byteLength,total:a});for(let e=0,t=i.length;e<t;e++){let t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(r),t()}})})()}}))}throw new sW(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>new DOMParser().parseFromString(e,s));case"json":return e.json();default:if(void 0===s)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(s),i=new TextDecoder(t&&t[1]?t[1].toLowerCase():void 0);return e.arrayBuffer().then(e=>i.decode(e))}}}).then(t=>{sz.add(e,t);let i=sG[e];delete sG[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onLoad&&n.onLoad(t)}}).catch(t=>{let i=sG[e];if(void 0===i)throw this.manager.itemError(e),t;delete sG[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class sq extends sV{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,a=sz.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;let s=eh("img");function o(){c(),sz.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}}class sX extends sV{constructor(e){super(e)}load(e,t,i,n){let r=new eM,a=new sq(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},i,n),r}}class sY extends tb{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new tk(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}let sK=new e8,sQ=new eI,sJ=new eI;class sZ{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new es(512,512),this.map=null,this.mapPass=null,this.matrix=new e8,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new iB,this._frameExtents=new es(1,1),this._viewportCount=1,this._viewports=[new eE(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;sQ.setFromMatrixPosition(e.matrixWorld),t.position.copy(sQ),sJ.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(sJ),t.updateMatrixWorld(),sK.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sK),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(sK)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class s$ extends sZ{constructor(){super(new iw(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=2*Q*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class s0 extends sY{constructor(e,t,i=0,n=Math.PI/3,r=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(tb.DEFAULT_UP),this.updateMatrix(),this.target=new tb,this.distance=i,this.angle=n,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new s$}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}let s1=new e8,s2=new eI,s3=new eI;class s4 extends sZ{constructor(){super(new iw(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new es(4,2),this._viewportCount=6,this._viewports=[new eE(2,1,1,1),new eE(0,1,1,1),new eE(3,1,1,1),new eE(1,1,1,1),new eE(3,0,1,1),new eE(1,0,1,1)],this._cubeDirections=[new eI(1,0,0),new eI(-1,0,0),new eI(0,0,1),new eI(0,0,-1),new eI(0,1,0),new eI(0,-1,0)],this._cubeUps=[new eI(0,1,0),new eI(0,1,0),new eI(0,1,0),new eI(0,1,0),new eI(0,0,1),new eI(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),s2.setFromMatrixPosition(e.matrixWorld),i.position.copy(s2),s3.copy(i.position),s3.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(s3),i.updateMatrixWorld(),n.makeTranslation(-s2.x,-s2.y,-s2.z),s1.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s1)}}class s5 extends sY{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new s4}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class s6 extends sZ{constructor(){super(new iY(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class s8 extends sY{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(tb.DEFAULT_UP),this.updateMatrix(),this.target=new tb,this.shadow=new s6}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class s9{static decodeText(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return -1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e))?e:t+e}}class s7 extends t5{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class oe extends sV{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,a=sz.get(e);if(void 0!==a){if(r.manager.itemStart(e),a.then){a.then(i=>{t&&t(i),r.manager.itemEnd(e)}).catch(e=>{n&&n(e)});return}return setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a}let s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;let o=fetch(e,s).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(i){return sz.add(e,i),t&&t(i),r.manager.itemEnd(e),i}).catch(function(t){n&&n(t),sz.remove(e),r.manager.itemError(e),r.manager.itemEnd(e)});sz.add(e,o),r.manager.itemStart(e)}}class ot{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=oi(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=oi();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function oi(){return("undefined"==typeof performance?Date:performance).now()}let on="\\[\\]\\.:\\/",or=RegExp("["+on+"]","g"),oa="[^"+on+"]",os="[^"+on.replace("\\.","")+"]",oo=/((?:WC+[\/:])*)/.source.replace("WC",oa),ol=/(WCOD+)?/.source.replace("WCOD",os),oc=RegExp("^"+oo+ol+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",oa)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",oa)+"$"),oh=["material","materials","bones","map"];class ou{constructor(e,t,i){this.path=t,this.parsedPath=i||ou.parseTrackName(t),this.node=ou.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new ou.Composite(e,t,i):new ou(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(or,"")}static parseTrackName(e){let t=oc.exec(e);if(null===t)throw Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let e=i.nodeName.substring(n+1);-1!==oh.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){let i=function(e){for(let n=0;n<e.length;n++){let r=e[n];if(r.name===t||r.uuid===t)return r;let a=i(r.children);if(a)return a}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=ou.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(void 0===e[i]){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(void 0!==n){if(void 0===e[n]){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[n]}}let a=e[n];if(void 0===a){console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ou.Composite=class{constructor(e,t,i){let n=i||ou.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},ou.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ou.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ou.prototype.GetterByBindingType=[ou.prototype._getValue_direct,ou.prototype._getValue_array,ou.prototype._getValue_arrayElement,ou.prototype._getValue_toArray],ou.prototype.SetterByBindingTypeAndVersioning=[[ou.prototype._setValue_direct,ou.prototype._setValue_direct_setNeedsUpdate,ou.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ou.prototype._setValue_array,ou.prototype._setValue_array_setNeedsUpdate,ou.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ou.prototype._setValue_arrayElement,ou.prototype._setValue_arrayElement_setNeedsUpdate,ou.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ou.prototype._setValue_fromArray,ou.prototype._setValue_fromArray_setNeedsUpdate,ou.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class od{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Z(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"160"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="160")},1570:function(e,t,i){"use strict";i.r(t),i.d(t,{CSM:()=>g});var n=i(1795);let r=new n.yGw;class a{constructor(e){e=e||{},this.vertices={near:[new n.Pa4,new n.Pa4,new n.Pa4,new n.Pa4],far:[new n.Pa4,new n.Pa4,new n.Pa4,new n.Pa4]},void 0!==e.projectionMatrix&&this.setFromProjectionMatrix(e.projectionMatrix,e.maxFar||1e4)}setFromProjectionMatrix(e,t){let i=0===e.elements[11];return r.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach(function(e){e.applyMatrix4(r)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(e){e.applyMatrix4(r);let n=Math.abs(e.z);i?e.z*=Math.min(t/n,1):e.multiplyScalar(Math.min(t/n,1))}),this.vertices}split(e,t){for(;e.length>t.length;)t.push(new a);t.length=e.length;for(let i=0;i<e.length;i++){let n=t[i];if(0===i)for(let e=0;e<4;e++)n.vertices.near[e].copy(this.vertices.near[e]);else for(let t=0;t<4;t++)n.vertices.near[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[i-1]);if(i===e.length-1)for(let e=0;e<4;e++)n.vertices.far[e].copy(this.vertices.far[e]);else for(let t=0;t<4;t++)n.vertices.far[t].lerpVectors(this.vertices.near[t],this.vertices.far[t],e[i])}}toSpace(e,t){for(let i=0;i<4;i++)t.vertices.near[i].copy(this.vertices.near[i]).applyMatrix4(e),t.vertices.far[i].copy(this.vertices.far[i]).applyMatrix4(e)}}let s={lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

vec3 geometryClearcoatNormal = vec3( 0.0 );

#ifdef USE_CLEARCOAT

	geometryClearcoatNormal = clearcoatNormal;

#endif

#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		// Iridescence F0 approximation
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometryPosition, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
 	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;

	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometryPosition, directLight );

  		// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;

		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	float linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )
		vec2 cascade;
		float cascadeCenter;
		float closestEdge;
		float margin;
		float csmx;
		float csmy;

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
				// NOTE: Depth gets larger away from the camera.
				// cascade.x is closer, cascade.y is further
				cascade = CSM_cascades[ i ];
				cascadeCenter = ( cascade.x + cascade.y ) / 2.0;
				closestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;
				margin = 0.25 * pow( closestEdge, 2.0 );
				csmx = cascade.x - margin / 2.0;
				csmy = cascade.y + margin / 2.0;
				if( linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {

					float dist = min( linearDepth - csmx, csmy - linearDepth );
					float ratio = clamp( dist / margin, 0.0, 1.0 );

					vec3 prevColor = directLight.color;
					directionalLightShadow = directionalLightShadows[ i ];
					directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

					bool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;
					directLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );

					ReflectedLight prevLight = reflectedLight;
					RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

					bool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;
					float blendRatio = shouldBlend ? ratio : 1.0;

					reflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );
					reflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );
					reflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );
					reflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );

				}
			#endif

		}
		#pragma unroll_loop_end
	#elif defined (USE_SHADOWMAP)

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )

				directionalLightShadow = directionalLightShadows[ i ];
				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

			#endif

		}
		#pragma unroll_loop_end

	#elif ( NUM_DIR_LIGHT_SHADOWS > 0 )
		// note: no loop here - all CSM lights are in fact one light only
		getDirectionalLightInfo( directionalLights[0], directLight );
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	#endif

	#if ( NUM_DIR_LIGHTS > NUM_DIR_LIGHT_SHADOWS)
		// compute the lights not casting shadows (if any)

		#pragma unroll_loop_start
		for ( int i = NUM_DIR_LIGHT_SHADOWS; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];

			getDirectionalLightInfo( directionalLight, directLight );

			RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

		}
		#pragma unroll_loop_end

	#endif

#endif


#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	#if defined( USE_LIGHT_PROBES )

		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );

	#endif

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,lights_pars_begin:`
#if defined( USE_CSM ) && defined( CSM_CASCADES )
uniform vec2 CSM_cascades[CSM_CASCADES];
uniform float cameraNear;
uniform float shadowFar;
#endif
	`+n.WdD.lights_pars_begin},o=new n.yGw,l=new a,c=new n.Pa4,h=new n.ZzF,u=[],d=[],p=new n.yGw,f=new n.yGw,m=new n.Pa4(0,1,0);class g{constructor(e){this.camera=e.camera,this.parent=e.parent,this.cascades=e.cascades||3,this.maxFar=e.maxFar||1e5,this.mode=e.mode||"practical",this.shadowMapSize=e.shadowMapSize||2048,this.shadowBias=e.shadowBias||1e-6,this.lightDirection=e.lightDirection||new n.Pa4(1,-1,1).normalize(),this.lightIntensity=e.lightIntensity||3,this.lightNear=e.lightNear||1,this.lightFar=e.lightFar||2e3,this.lightMargin=e.lightMargin||200,this.customSplitsCallback=e.customSplitsCallback,this.fade=!1,this.mainFrustum=new a,this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this.createLights(),this.updateFrustums(),this.injectInclude()}createLights(){for(let e=0;e<this.cascades;e++){let e=new n.Ox3(0xffffff,this.lightIntensity);e.castShadow=!0,e.shadow.mapSize.width=this.shadowMapSize,e.shadow.mapSize.height=this.shadowMapSize,e.shadow.camera.near=this.lightNear,e.shadow.camera.far=this.lightFar,e.shadow.bias=this.shadowBias,this.parent.add(e),this.parent.add(e.target),this.lights.push(e)}}initCascades(){let e=this.camera;e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}updateShadowBounds(){let e=this.frustums;for(let t=0;t<e.length;t++){let e;let i=this.lights[t].shadow.camera,n=this.frustums[t],r=n.vertices.near,a=n.vertices.far,s=a[0];e=s.distanceTo(a[2])>s.distanceTo(r[2])?a[2]:r[2];let o=s.distanceTo(e);if(this.fade){let e=this.camera,t=Math.max(e.far,this.maxFar);o+=.25*Math.pow(n.vertices.far[0].z/(t-e.near),2)*(t-e.near)}i.left=-o/2,i.right=o/2,i.top=o/2,i.bottom=-o/2,i.updateProjectionMatrix()}}getBreaks(){let e=this.camera,t=Math.min(e.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":i(this.cascades,e.near,t,this.breaks);break;case"logarithmic":r(this.cascades,e.near,t,this.breaks);break;case"practical":!function(e,t,a,s,o){u.length=0,d.length=0,r(e,t,a,d),i(e,t,a,u);for(let t=1;t<e;t++)o.push(n.M8C.lerp(u[t-1],d[t-1],.5));o.push(1)}(this.cascades,e.near,t,.5,this.breaks);break;case"custom":void 0===this.customSplitsCallback&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,e.near,t,this.breaks)}function i(e,t,i,n){for(let r=1;r<e;r++)n.push((t+(i-t)*r/e)/i);n.push(1)}function r(e,t,i,n){for(let r=1;r<e;r++)n.push(t*(i/t)**(r/e)/i);n.push(1)}}update(){let e=this.camera,t=this.frustums;p.lookAt(new n.Pa4,this.lightDirection,m),f.copy(p).invert();for(let i=0;i<t.length;i++){let n=this.lights[i],r=n.shadow.camera,a=(r.right-r.left)/this.shadowMapSize,s=(r.top-r.bottom)/this.shadowMapSize;o.multiplyMatrices(f,e.matrixWorld),t[i].toSpace(o,l);let u=l.vertices.near,d=l.vertices.far;h.makeEmpty();for(let e=0;e<4;e++)h.expandByPoint(u[e]),h.expandByPoint(d[e]);h.getCenter(c),c.z=h.max.z+this.lightMargin,c.x=Math.floor(c.x/a)*a,c.y=Math.floor(c.y/s)*s,c.applyMatrix4(p),n.position.copy(c),n.target.position.copy(c),n.target.position.x+=this.lightDirection.x,n.target.position.y+=this.lightDirection.y,n.target.position.z+=this.lightDirection.z}}injectInclude(){n.WdD.lights_fragment_begin=s.lights_fragment_begin,n.WdD.lights_pars_begin=s.lights_pars_begin}setupMaterial(e){e.defines=e.defines||{},e.defines.USE_CSM=1,e.defines.CSM_CASCADES=this.cascades,this.fade&&(e.defines.CSM_FADE="");let t=[],i=this,n=this.shaders;e.onBeforeCompile=function(r){let a=Math.min(i.camera.far,i.maxFar);i.getExtendedBreaks(t),r.uniforms.CSM_cascades={value:t},r.uniforms.cameraNear={value:i.camera.near},r.uniforms.shadowFar={value:a},n.set(e,r)},n.set(e,null)}updateUniforms(){let e=Math.min(this.camera.far,this.maxFar);this.shaders.forEach(function(t,i){if(null!==t){let i=t.uniforms;this.getExtendedBreaks(i.CSM_cascades.value),i.cameraNear.value=this.camera.near,i.shadowFar.value=e}!this.fade&&"CSM_FADE"in i.defines?(delete i.defines.CSM_FADE,i.needsUpdate=!0):!this.fade||"CSM_FADE"in i.defines||(i.defines.CSM_FADE="",i.needsUpdate=!0)},this)}getExtendedBreaks(e){for(;e.length<this.breaks.length;)e.push(new n.FM8);e.length=this.breaks.length;for(let t=0;t<this.cascades;t++){let i=this.breaks[t],n=this.breaks[t-1]||0;e[t].x=n,e[t].y=i}}updateFrustums(){this.getBreaks(),this.initCascades(),this.updateShadowBounds(),this.updateUniforms()}remove(){for(let e=0;e<this.lights.length;e++)this.parent.remove(this.lights[e].target),this.parent.remove(this.lights[e])}dispose(){let e=this.shaders;e.forEach(function(e,t){delete t.onBeforeCompile,delete t.defines.USE_CSM,delete t.defines.CSM_CASCADES,delete t.defines.CSM_FADE,null!==e&&(delete e.uniforms.CSM_cascades,delete e.uniforms.cameraNear,delete e.uniforms.shadowFar),t.needsUpdate=!0}),e.clear()}}},450:function(e,t,i){"use strict";i.r(t),i.d(t,{GLTFLoader:()=>a});var n=i(1795),r=i(4646);class a extends n.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new u(e)}),this.register(function(e){return new _(e)}),this.register(function(e){return new A(e)}),this.register(function(e){return new b(e)}),this.register(function(e){return new p(e)}),this.register(function(e){return new f(e)}),this.register(function(e){return new m(e)}),this.register(function(e){return new g(e)}),this.register(function(e){return new h(e)}),this.register(function(e){return new v(e)}),this.register(function(e){return new d(e)}),this.register(function(e){return new x(e)}),this.register(function(e){return new y(e)}),this.register(function(e){return new l(e)}),this.register(function(e){return new S(e)}),this.register(function(e){return new w(e)})}load(e,t,i,r){let a;let s=this;if(""!==this.resourcePath)a=this.resourcePath;else if(""!==this.path){let t=n.Zp0.extractUrlBase(e);a=n.Zp0.resolveURL(t,this.path)}else a=n.Zp0.extractUrlBase(e);this.manager.itemStart(e);let o=function(t){r?r(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},l=new n.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(i){try{s.parse(i,a,function(i){t(i),s.manager.itemEnd(e)},o)}catch(e){o(e)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let r;let a={},s={},l=new TextDecoder;if("string"==typeof e)r=JSON.parse(e);else if(e instanceof ArrayBuffer){if(l.decode(new Uint8Array(e,0,4))===M){try{a[o.KHR_BINARY_GLTF]=new C(e)}catch(e){n&&n(e);return}r=JSON.parse(a[o.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(e))}else r=e;if(void 0===r.asset||r.asset.version[0]<2){n&&n(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let h=new Y(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](h);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[t.name]=t,a[t.name]=!0}if(r.extensionsUsed)for(let e=0;e<r.extensionsUsed.length;++e){let t=r.extensionsUsed[e],i=r.extensionsRequired||[];switch(t){case o.KHR_MATERIALS_UNLIT:a[t]=new c;break;case o.KHR_DRACO_MESH_COMPRESSION:a[t]=new T(r,this.dracoLoader);break;case o.KHR_TEXTURE_TRANSFORM:a[t]=new R;break;case o.KHR_MESH_QUANTIZATION:a[t]=new P;break;default:i.indexOf(t)>=0&&void 0===s[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}h.setExtensions(a),h.setPlugins(s),h.parse(i,n)}parseAsync(e,t){let i=this;return new Promise(function(n,r){i.parse(e,t,n,r)})}}function s(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let o={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class l{constructor(e){this.parser=e,this.name=o.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){let n=t[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){let t;let i=this.parser,r="light:"+e,a=i.cache.get(r);if(a)return a;let s=i.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e],l=new n.Ilk(0xffffff);void 0!==o.color&&l.setRGB(o.color[0],o.color[1],o.color[2],n.GUF);let c=void 0!==o.range?o.range:0;switch(o.type){case"directional":(t=new n.Ox3(l)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new n.cek(l)).distance=c;break;case"spot":(t=new n.PMe(l)).distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,t.angle=o.spot.outerConeAngle,t.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return t.position.set(0,0,0),t.decay=2,W(t,o),void 0!==o.intensity&&(t.intensity=o.intensity),t.name=i.createUniqueName(o.name||"light_"+e),a=Promise.resolve(t),i.cache.add(r,a),a}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,i=this.parser,n=i.json.nodes[e],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return i._getNodeRef(t.cache,r,e)})}}class c{constructor(){this.name=o.KHR_MATERIALS_UNLIT}getMaterialType(){return n.vBJ}extendParams(e,t,i){let r=[];e.color=new n.Ilk(1,1,1),e.opacity=1;let a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){let t=a.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],n.GUF),e.opacity=t[3]}void 0!==a.baseColorTexture&&r.push(i.assignTexture(e,"map",a.baseColorTexture,n.KI_))}return Promise.all(r)}}class h{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class u{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[],s=r.extensions[this.name];if(void 0!==s.clearcoatFactor&&(t.clearcoat=s.clearcoatFactor),void 0!==s.clearcoatTexture&&a.push(i.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),void 0!==s.clearcoatRoughnessFactor&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),void 0!==s.clearcoatRoughnessTexture&&a.push(i.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),void 0!==s.clearcoatNormalTexture&&(a.push(i.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),void 0!==s.clearcoatNormalTexture.scale)){let e=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.FM8(e,e)}return Promise.all(a)}}class d{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[],a=n.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&r.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&r.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(r)}}class p{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[];t.sheenColor=new n.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;let s=r.extensions[this.name];if(void 0!==s.sheenColorFactor){let e=s.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],n.GUF)}return void 0!==s.sheenRoughnessFactor&&(t.sheenRoughness=s.sheenRoughnessFactor),void 0!==s.sheenColorTexture&&a.push(i.assignTexture(t,"sheenColorMap",s.sheenColorTexture,n.KI_)),void 0!==s.sheenRoughnessTexture&&a.push(i.assignTexture(t,"sheenRoughnessMap",s.sheenRoughnessTexture)),Promise.all(a)}}class f{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[],a=n.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}class m{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[],s=r.extensions[this.name];t.thickness=void 0!==s.thicknessFactor?s.thicknessFactor:0,void 0!==s.thicknessTexture&&a.push(i.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||1/0;let o=s.attenuationColor||[1,1,1];return t.attenuationColor=new n.Ilk().setRGB(o[0],o[1],o[2],n.GUF),Promise.all(a)}}class g{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=i.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let a=[],s=r.extensions[this.name];t.specularIntensity=void 0!==s.specularFactor?s.specularFactor:1,void 0!==s.specularTexture&&a.push(i.assignTexture(t,"specularIntensityMap",s.specularTexture));let o=s.specularColorFactor||[1,1,1];return t.specularColor=new n.Ilk().setRGB(o[0],o[1],o[2],n.GUF),void 0!==s.specularColorTexture&&a.push(i.assignTexture(t,"specularColorMap",s.specularColorTexture,n.KI_)),Promise.all(a)}}class y{constructor(e){this.parser=e,this.name=o.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[],a=n.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&r.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(r)}}class x{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[],a=n.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&r.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(r)}}class _{constructor(e){this.parser=e,this.name=o.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;let r=n.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(!(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,r.source,a)}}class A{constructor(e){this.parser=e,this.name=o.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;let a=r.extensions[t],s=n.images[a.source],o=i.textureLoader;if(s.uri){let e=i.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then(function(r){if(r)return i.loadTextureImage(e,a.source,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class b{constructor(e){this.parser=e,this.name=o.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,n=i.json,r=n.textures[e];if(!r.extensions||!r.extensions[t])return null;let a=r.extensions[t],s=n.images[a.source],o=i.textureLoader;if(s.uri){let e=i.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then(function(r){if(r)return i.loadTextureImage(e,a.source,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class S{constructor(e){this.name=o.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(!i.extensions||!i.extensions[this.name])return null;{let e=i.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return n.then(function(t){let i=e.byteOffset||0,n=e.byteLength||0,a=e.count,s=e.byteStride,o=new Uint8Array(t,i,n);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(a,s,o,e.mode,e.filter).then(function(e){return e.buffer}):r.ready.then(function(){let t=new ArrayBuffer(a*s);return r.decodeGltfBuffer(new Uint8Array(t),a,s,o,e.mode,e.filter),t})})}}}class w{constructor(e){this.name=o.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;for(let e of t.meshes[i.mesh].primitives)if(e.mode!==B.TRIANGLES&&e.mode!==B.TRIANGLE_STRIP&&e.mode!==B.TRIANGLE_FAN&&void 0!==e.mode)return null;let r=i.extensions[this.name].attributes,a=[],s={};for(let e in r)a.push(this.parser.getDependency("accessor",r[e]).then(t=>(s[e]=t,s[e])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(e=>{let t=e.pop(),i=t.isGroup?t.children:[t],r=e[0].count,a=[];for(let e of i){let t=new n.yGw,i=new n.Pa4,o=new n._fP,l=new n.Pa4(1,1,1),c=new n.SPe(e.geometry,e.material,r);for(let e=0;e<r;e++)s.TRANSLATION&&i.fromBufferAttribute(s.TRANSLATION,e),s.ROTATION&&o.fromBufferAttribute(s.ROTATION,e),s.SCALE&&l.fromBufferAttribute(s.SCALE,e),c.setMatrixAt(e,t.compose(i,o,l));for(let t in s)if("_COLOR_0"===t){let e=s[t];c.instanceColor=new n.lb7(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,s[t]);n.Tme.prototype.copy.call(c,e),this.parser.assignFinalMaterial(c),a.push(c)}return t.isGroup?(t.clear(),t.add(...a),t):a[0]}))}}let M="glTF",E={JSON:0x4e4f534a,BIN:5130562};class C{constructor(e){this.name=o.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==M)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-12,r=new DataView(e,12),a=0;for(;a<n;){let t=r.getUint32(a,!0);a+=4;let n=r.getUint32(a,!0);if(a+=4,n===E.JSON){let n=new Uint8Array(e,12+a,t);this.content=i.decode(n)}else if(n===E.BIN){let i=12+a;this.body=e.slice(i,i+t)}a+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class T{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=o.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let i=this.json,r=this.dracoLoader,a=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,o={},l={},c={};for(let e in s)o[k[e]||e.toLowerCase()]=s[e];for(let t in e.attributes){let n=k[t]||t.toLowerCase();if(void 0!==s[t]){let r=i.accessors[e.attributes[t]],a=O[r.componentType];c[n]=a.name,l[n]=!0===r.normalized}}return t.getDependency("bufferView",a).then(function(e){return new Promise(function(t,i){r.decodeDracoFile(e,function(e){for(let t in e.attributes){let i=e.attributes[t],n=l[t];void 0!==n&&(i.normalized=n)}t(e)},o,c,n.GUF,i)})})}}class R{constructor(){this.name=o.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class P{constructor(){this.name=o.KHR_MESH_QUANTIZATION}}class I extends n._C8{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n*3+n;for(let e=0;e!==n;e++)t[e]=i[r+e];return t}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,c=n-t,h=(i-t)/c,u=h*h,d=u*h,p=e*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+h;for(let e=0;e!==s;e++){let t=a[f+e+s],i=a[f+e+o]*c,n=a[p+e+s],l=a[p+e]*c;r[e]=v*t+y*i+m*n+g*l}return r}}let L=new n._fP;class D extends I{interpolate_(e,t,i,n){let r=super.interpolate_(e,t,i,n);return L.fromArray(r).normalize().toArray(r),r}}let B={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},O={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},N={9728:n.TyD,9729:n.wem,9984:n.YLQ,9985:n.qyh,9986:n.aH4,9987:n.D1R},U={33071:n.uWy,33648:n.OoA,10497:n.rpg},F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},z={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},H={CUBICSPLINE:void 0,LINEAR:n.NMF,STEP:n.Syv},V={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function G(e,t,i){for(let n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function W(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function j(e){let t="",i=Object.keys(e).sort();for(let n=0,r=i.length;n<r;n++)t+=i[n]+":"+e[i[n]]+";";return t}function q(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let X=new n.yGw;class Y{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new s,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,a=-1;"undefined"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),a=(r=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||i||r&&a<98?this.textureLoader=new n.dpR(this.options.manager):this.textureLoader=new n.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(t){let a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};return G(r,a,n),W(a,n),Promise.all(i._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){let n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){let n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let n=i.clone(),r=(e,t)=>{let i=this.associations.get(e);for(let[n,a]of(null!=i&&this.associations.set(t,i),e.children.entries()))r(a,t.children[n])};return r(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let n=e(t[i]);if(n)return n}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let n=0;n<t.length;n++){let r=e(t[n]);r&&i.push(r)}return i}getDependency(e,t){let i=e+":"+t,n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":n=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(!(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,n){return i.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[o.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(e,a){i.load(n.Zp0.resolveURL(t.uri,r.path),e,void 0,function(){a(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)})}loadAccessor(e){let t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){let e=F[r.type],t=O[r.componentType],i=!0===r.normalized,a=new t(r.count*e);return Promise.resolve(new n.TlE(a,e,i))}let a=[];return void 0!==r.bufferView?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),void 0!==r.sparse&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then(function(e){let a,s;let o=e[0],l=F[r.type],c=O[r.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=r.byteOffset||0,p=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,f=!0===r.normalized;if(p&&p!==u){let e=Math.floor(d/p),i="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count,u=t.cache.get(i);u||(a=new c(o,e*p,r.count*p/h),u=new n.vpT(a,p/h),t.cache.add(i,u)),s=new n.kB5(u,l,d%p/h,f)}else a=null===o?new c(r.count*l):new c(o,d,r.count*l),s=new n.TlE(a,l,f);if(void 0!==r.sparse){let t=F.SCALAR,i=O[r.sparse.indices.componentType],a=r.sparse.indices.byteOffset||0,h=r.sparse.values.byteOffset||0,u=new i(e[1],a,r.sparse.count*t),d=new c(e[2],h,r.sparse.count*l);null!==o&&(s=new n.TlE(s.array.slice(),s.itemSize,s.normalized));for(let e=0,t=u.length;e<t;e++){let t=u[e];if(s.setX(t,d[e*l]),l>=2&&s.setY(t,d[e*l+1]),l>=3&&s.setZ(t,d[e*l+2]),l>=4&&s.setW(t,d[e*l+3]),l>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s})}loadTexture(e){let t=this.json,i=this.options,n=t.textures[e].source,r=t.images[n],a=this.textureLoader;if(r.uri){let e=i.manager.getHandler(r.uri);null!==e&&(a=e)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,i){let r=this,a=this.json,s=a.textures[e],o=a.images[t],l=(o.uri||o.bufferView)+":"+s.sampler;if(this.textureCache[l])return this.textureCache[l];let c=this.loadImageSource(t,i).then(function(t){t.flipY=!1,t.name=s.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);let i=(a.samplers||{})[s.sampler]||{};return t.magFilter=N[i.magFilter]||n.wem,t.minFilter=N[i.minFilter]||n.D1R,t.wrapS=U[i.wrapS]||n.rpg,t.wrapT=U[i.wrapT]||n.rpg,r.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){let i=this.json,r=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let a=i.images[e],s=self.URL||self.webkitURL,o=a.uri||"",l=!1;if(void 0!==a.bufferView)o=this.getDependency("bufferView",a.bufferView).then(function(e){l=!0;let t=new Blob([e],{type:a.mimeType});return o=s.createObjectURL(t)});else if(void 0===a.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let c=Promise.resolve(o).then(function(e){return new Promise(function(i,a){let s=i;!0===t.isImageBitmapLoader&&(s=function(e){let t=new n.xEZ(e);t.needsUpdate=!0,i(t)}),t.load(n.Zp0.resolveURL(e,r.path),s,void 0,a)})}).then(function(e){var t;return!0===l&&s.revokeObjectURL(o),e.userData.mimeType=a.mimeType||((t=a.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=c,c}assignTexture(e,t,i,n){let r=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((a=a.clone()).channel=i.texCoord),r.extensions[o.KHR_TEXTURE_TRANSFORM]){let e=void 0!==i.extensions?i.extensions[o.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=r.associations.get(a);a=r.extensions[o.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),r.associations.set(a,t)}}return void 0!==n&&(a.colorSpace=n),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,i=e.material,r=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+i.uuid,t=this.cache.get(e);t||(t=new n.UY4,n.F5T.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){let e="LineBasicMaterial:"+i.uuid,t=this.cache.get(e);t||(t=new n.nls,n.F5T.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}if(r||a||s){let e="ClonedMaterial:"+i.uuid+":";r&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),a&&(t.vertexColors=!0),s&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return n.Wid}loadMaterial(e){let t;let i=this,r=this.json,a=this.extensions,s=r.materials[e],l={},c=s.extensions||{},h=[];if(c[o.KHR_MATERIALS_UNLIT]){let e=a[o.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),h.push(e.extendParams(l,s,i))}else{let r=s.pbrMetallicRoughness||{};if(l.color=new n.Ilk(1,1,1),l.opacity=1,Array.isArray(r.baseColorFactor)){let e=r.baseColorFactor;l.color.setRGB(e[0],e[1],e[2],n.GUF),l.opacity=e[3]}void 0!==r.baseColorTexture&&h.push(i.assignTexture(l,"map",r.baseColorTexture,n.KI_)),l.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,l.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(h.push(i.assignTexture(l,"metalnessMap",r.metallicRoughnessTexture)),h.push(i.assignTexture(l,"roughnessMap",r.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)})))}!0===s.doubleSided&&(l.side=n.ehD);let u=s.alphaMode||V.OPAQUE;if(u===V.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,u===V.MASK&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==n.vBJ&&(h.push(i.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new n.FM8(1,1),void 0!==s.normalTexture.scale)){let e=s.normalTexture.scale;l.normalScale.set(e,e)}if(void 0!==s.occlusionTexture&&t!==n.vBJ&&(h.push(i.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==n.vBJ){let e=s.emissiveFactor;l.emissive=new n.Ilk().setRGB(e[0],e[1],e[2],n.GUF)}return void 0!==s.emissiveTexture&&t!==n.vBJ&&h.push(i.assignTexture(l,"emissiveMap",s.emissiveTexture,n.KI_)),Promise.all(h).then(function(){let n=new t(l);return s.name&&(n.name=s.name),W(n,s),i.associations.set(n,{materials:e}),s.extensions&&G(a,n,s),n})}createUniqueName(e){let t=n.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,i=this.extensions,r=this.primitiveCache,a=[];for(let s=0,l=e.length;s<l;s++){let l=e[s],c=function(e){let t;let i=e.extensions&&e.extensions[o.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+j(i.attributes):e.indices+":"+j(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,n=e.targets.length;i<n;i++)t+=":"+j(e.targets[i]);return t}(l),h=r[c];if(h)a.push(h.promise);else{let e;e=l.extensions&&l.extensions[o.KHR_DRACO_MESH_COMPRESSION]?function(e){return i[o.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(i){return K(i,e,t)})}(l):K(new n.u9r,l,t),r[c]={primitive:l,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){let t=this,i=this.json,a=this.extensions,s=i.meshes[e],o=s.primitives,l=[];for(let e=0,t=o.length;e<t;e++){var c;let t=void 0===o[e].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new n.Wid({color:0xffffff,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.Wl3})),c.DefaultMaterial):this.getDependency("material",o[e].material);l.push(t)}return l.push(t.loadGeometries(o)),Promise.all(l).then(function(i){let l=i.slice(0,i.length-1),c=i[i.length-1],h=[];for(let i=0,u=c.length;i<u;i++){let u;let d=c[i],p=o[i],f=l[i];if(p.mode===B.TRIANGLES||p.mode===B.TRIANGLE_STRIP||p.mode===B.TRIANGLE_FAN||void 0===p.mode)!0===(u=!0===s.isSkinnedMesh?new n.TUv(d,f):new n.Kj0(d,f)).isSkinnedMesh&&u.normalizeSkinWeights(),p.mode===B.TRIANGLE_STRIP?u.geometry=(0,r.Vs)(u.geometry,n.UlW):p.mode===B.TRIANGLE_FAN&&(u.geometry=(0,r.Vs)(u.geometry,n.z$h));else if(p.mode===B.LINES)u=new n.ejS(d,f);else if(p.mode===B.LINE_STRIP)u=new n.x12(d,f);else if(p.mode===B.LINE_LOOP)u=new n.blk(d,f);else if(p.mode===B.POINTS)u=new n.woe(d,f);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(u.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){let i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,n=i.length;t<n;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(u,s),u.name=t.createUniqueName(s.name||"mesh_"+e),W(u,s),p.extensions&&G(a,u,p),t.assignFinalMaterial(u),h.push(u)}for(let i=0,n=h.length;i<n;i++)t.associations.set(h[i],{meshes:e,primitives:i});if(1===h.length)return s.extensions&&G(a,h[0],s),h[0];let u=new n.ZAu;s.extensions&&G(a,u,s),t.associations.set(u,{meshes:e});for(let e=0,t=h.length;e<t;e++)u.add(h[e]);return u})}loadCamera(e){let t;let i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===i.type?t=new n.cPb(n.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new n.iKG(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),W(t,i),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],i=[];for(let e=0,n=t.joints.length;e<n;e++)i.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(e){let i=e.pop(),r=[],a=[];for(let s=0,o=e.length;s<o;s++){let o=e[s];if(o){r.push(o);let e=new n.yGw;null!==i&&e.fromArray(i.array,16*s),a.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[s])}return new n.OdW(r,a)})}loadAnimation(e){let t=this.json,i=this,r=t.animations[e],a=r.name?r.name:"animation_"+e,s=[],o=[],l=[],c=[],h=[];for(let e=0,t=r.channels.length;e<t;e++){let t=r.channels[e],i=r.samplers[t.sampler],n=t.target,a=n.node,u=void 0!==r.parameters?r.parameters[i.input]:i.input,d=void 0!==r.parameters?r.parameters[i.output]:i.output;void 0!==n.node&&(s.push(this.getDependency("node",a)),o.push(this.getDependency("accessor",u)),l.push(this.getDependency("accessor",d)),c.push(i),h.push(n))}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(e){let t=e[0],r=e[1],s=e[2],o=e[3],l=e[4],c=[];for(let e=0,n=t.length;e<n;e++){let n=t[e],a=r[e],h=s[e],u=o[e],d=l[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();let p=i._createAnimationTracks(n,a,h,u,d);if(p)for(let e=0;e<p.length;e++)c.push(p[e])}return new n.m7l(a,void 0,c)})}createNodeMesh(e){let t=this.json,i=this,n=t.nodes[e];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then(function(e){let t=i._getNodeRef(i.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,i=n.weights.length;t<i;t++)e.morphTargetInfluences[t]=n.weights[t]}),t})}loadNode(e){let t=this.json.nodes[e],i=this._loadNodeShallow(e),n=[],r=t.children||[];for(let e=0,t=r.length;e<t;e++)n.push(this.getDependency("node",r[e]));let a=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([i,Promise.all(n),a]).then(function(e){let t=e[0],i=e[1],n=e[2];null!==n&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(n,X)});for(let e=0,n=i.length;e<n;e++)t.add(i[e]);return t})}_loadNodeShallow(e){let t=this.json,i=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let a=t.nodes[e],s=a.name?r.createUniqueName(a.name):"",o=[],l=r._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return l&&o.push(l),void 0!==a.camera&&o.push(r.getDependency("camera",a.camera).then(function(e){return r._getNodeRef(r.cameraCache,a.camera,e)})),r._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){o.push(e)}),this.nodeCache[e]=Promise.all(o).then(function(t){let o;if((o=!0===a.isBone?new n.N$j:t.length>1?new n.ZAu:1===t.length?t[0]:new n.Tme)!==t[0])for(let e=0,i=t.length;e<i;e++)o.add(t[e]);if(a.name&&(o.userData.name=a.name,o.name=s),W(o,a),a.extensions&&G(i,o,a),void 0!==a.matrix){let e=new n.yGw;e.fromArray(a.matrix),o.applyMatrix4(e)}else void 0!==a.translation&&o.position.fromArray(a.translation),void 0!==a.rotation&&o.quaternion.fromArray(a.rotation),void 0!==a.scale&&o.scale.fromArray(a.scale);return r.associations.has(o)||r.associations.set(o,{}),r.associations.get(o).nodes=e,o}),this.nodeCache[e]}loadScene(e){let t=this.extensions,i=this.json.scenes[e],r=this,a=new n.ZAu;i.name&&(a.name=r.createUniqueName(i.name)),W(a,i),i.extensions&&G(t,a,i);let s=i.nodes||[],o=[];for(let e=0,t=s.length;e<t;e++)o.push(r.getDependency("node",s[e]));return Promise.all(o).then(function(e){for(let t=0,i=e.length;t<i;t++)a.add(e[t]);return r.associations=(e=>{let t=new Map;for(let[e,i]of r.associations)(e instanceof n.F5T||e instanceof n.xEZ)&&t.set(e,i);return e.traverse(e=>{let i=r.associations.get(e);null!=i&&t.set(e,i)}),t})(a),a})}_createAnimationTracks(e,t,i,r,a){let s;let o=[],l=e.name?e.name:e.uuid,c=[];switch(z[a.path]===z.weights?e.traverse(function(e){e.morphTargetInfluences&&c.push(e.name?e.name:e.uuid)}):c.push(l),z[a.path]){case z.weights:s=n.dUE;break;case z.rotation:s=n.iLg;break;case z.position:case z.scale:s=n.yC1;break;default:s=1===i.itemSize?n.dUE:n.yC1}let h=void 0!==r.interpolation?H[r.interpolation]:n.NMF,u=this._getArrayFromAccessor(i);for(let e=0,i=c.length;e<i;e++){let i=new s(c[e]+"."+z[a.path],t.array,u,h);"CUBICSPLINE"===r.interpolation&&this._createCubicSplineTrackInterpolant(i),o.push(i)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=q(t.constructor),i=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n++)i[n]=t[n]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof n.iLg?D:I)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function K(e,t,i){let r=t.attributes,a=[];for(let t in r){let n=k[t]||t.toLowerCase();n in e.attributes||a.push(function(t,n){return i.getDependency("accessor",t).then(function(t){e.setAttribute(n,t)})}(r[t],n))}if(void 0!==t.indices&&!e.index){let n=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});a.push(n)}return n.epp.workingColorSpace!==n.GUF&&"COLOR_0"in r&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${n.epp.workingColorSpace}" not supported.`),W(e,t),!function(e,t,i){let r=t.attributes,a=new n.ZzF;if(void 0===r.POSITION)return;{let e=i.json.accessors[r.POSITION],t=e.min,s=e.max;if(void 0!==t&&void 0!==s){if(a.set(new n.Pa4(t[0],t[1],t[2]),new n.Pa4(s[0],s[1],s[2])),e.normalized){let t=q(O[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let s=t.targets;if(void 0!==s){let e=new n.Pa4,t=new n.Pa4;for(let n=0,r=s.length;n<r;n++){let r=s[n];if(void 0!==r.POSITION){let n=i.json.accessors[r.POSITION],a=n.min,s=n.max;if(void 0!==a&&void 0!==s){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(s[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(s[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(s[2]))),n.normalized){let e=q(O[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;let o=new n.aLr;a.getCenter(o.center),o.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=o}(e,t,i),Promise.all(a).then(function(){return void 0!==t.targets?function(e,t,i){let n=!1,r=!1,a=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(r=!0),void 0!==i.COLOR_0&&(a=!0),n&&r&&a)break}if(!n&&!r&&!a)return Promise.resolve(e);let s=[],o=[],l=[];for(let c=0,h=t.length;c<h;c++){let h=t[c];if(n){let t=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):e.attributes.position;s.push(t)}if(r){let t=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):e.attributes.normal;o.push(t)}if(a){let t=void 0!==h.COLOR_0?i.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(l)]).then(function(t){let i=t[0],s=t[1],o=t[2];return n&&(e.morphAttributes.position=i),r&&(e.morphAttributes.normal=s),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,i):e})}},4105:function(e,t,i){"use strict";i.r(t),i.d(t,{EffectComposer:()=>c});var n=i(1795);let r={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};var a=i(8448),s=i(2662);class o extends s.w{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){let n,r;let a=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(n=0,r=1):(n=1,r=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),s.buffers.stencil.setFunc(a.ALWAYS,n,0xffffffff),s.buffers.stencil.setClear(r),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(a.EQUAL,1,0xffffffff),s.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),s.buffers.stencil.setLocked(!0)}}class l extends s.w{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class c{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){let i=e.getSize(new n.FM8);this._width=i.width,this._height=i.height,(t=new n.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:n.cLu})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new a.ShaderPass(r),this.copyPass.material.blending=n.jFi,this.clock=new n.SUY}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),i=!1;for(let t=0,n=this.passes.length;t<n;t++){let n=this.passes[t];if(!1!==n.enabled){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),n.needsSwap){if(i){let t=this.renderer.getContext(),i=this.renderer.state.buffers.stencil;i.setFunc(t.NOTEQUAL,1,0xffffffff),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),i.setFunc(t.EQUAL,1,0xffffffff)}this.swapBuffers()}void 0!==o&&(n instanceof o?i=!0:n instanceof l&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){let t=this.renderer.getSize(new n.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}},2662:function(e,t,i){"use strict";i.d(t,{T:()=>l,w:()=>r});var n=i(1795);class r{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}let a=new n.iKG(-1,1,1,-1,0,1);class s extends n.u9r{constructor(){super(),this.setAttribute("position",new n.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new n.a$l([0,2,0,0,2,0],2))}}let o=new s;class l{constructor(e){this._mesh=new n.Kj0(o,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,a)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}},3162:function(e,t,i){"use strict";i.r(t),i.d(t,{RenderPass:()=>a});var n=i(1795),r=i(2662);class a extends r.w{constructor(e,t,i=null,r=null,a=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=r,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new n.Ilk}render(e,t,i){let n,r;let a=e.autoClear;e.autoClear=!1,null!==this.overrideMaterial&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),null!==this.clearAlpha&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),!0==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(n),null!==this.overrideMaterial&&(this.scene.overrideMaterial=r),e.autoClear=a}}},8448:function(e,t,i){"use strict";i.r(t),i.d(t,{ShaderPass:()=>a});var n=i(1795),r=i(2662);class a extends r.w{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof n.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=n.rDY.clone(e.uniforms),this.material=new n.jyz({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new r.T(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.material.dispose(),this.fsQuad.dispose()}}},7606:function(e,t,i){"use strict";i.r(t),i.d(t,{FXAAShader:()=>n});let n={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new(i(1795)).FM8(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		precision highp float;

		uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)

		//----------------------------------------------------------------------------------
		// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag
		// SDK Version: v3.00
		// Email:       gameworks@nvidia.com
		// Site:        http://developer.nvidia.com/
		//
		// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
		//
		// Redistribution and use in source and binary forms, with or without
		// modification, are permitted provided that the following conditions
		// are met:
		//  * Redistributions of source code must retain the above copyright
		//    notice, this list of conditions and the following disclaimer.
		//  * Redistributions in binary form must reproduce the above copyright
		//    notice, this list of conditions and the following disclaimer in the
		//    documentation and/or other materials provided with the distribution.
		//  * Neither the name of NVIDIA CORPORATION nor the names of its
		//    contributors may be used to endorse or promote products derived
		//    from this software without specific prior written permission.
		//
		// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
		// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
		// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
		// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
		// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
		// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
		// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
		// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
		// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
		// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
		// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
		//
		//----------------------------------------------------------------------------------

		#ifndef FXAA_DISCARD
			//
			// Only valid for PC OpenGL currently.
			// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
			//
			// 1 = Use discard on pixels which don't need AA.
			//     For APIs which enable concurrent TEX+ROP from same surface.
			// 0 = Return unchanged color on pixels which don't need AA.
			//
			#define FXAA_DISCARD 0
		#endif

		/*--------------------------------------------------------------------------*/
		#define FxaaTexTop(t, p) texture2D(t, p, -100.0)
		#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)
		/*--------------------------------------------------------------------------*/

		#define NUM_SAMPLES 5

		// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha
		float contrast( vec4 a, vec4 b ) {
			vec4 diff = abs( a - b );
			return max( max( max( diff.r, diff.g ), diff.b ), diff.a );
		}

		/*============================================================================

									FXAA3 QUALITY - PC

		============================================================================*/

		/*--------------------------------------------------------------------------*/
		vec4 FxaaPixelShader(
			vec2 posM,
			sampler2D tex,
			vec2 fxaaQualityRcpFrame,
			float fxaaQualityEdgeThreshold,
			float fxaaQualityinvEdgeThreshold
		) {
			vec4 rgbaM = FxaaTexTop(tex, posM);
			vec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);
			// . S .
			// W M E
			// . N .

			bool earlyExit = max( max( max(
					contrast( rgbaM, rgbaN ),
					contrast( rgbaM, rgbaS ) ),
					contrast( rgbaM, rgbaE ) ),
					contrast( rgbaM, rgbaW ) )
					< fxaaQualityEdgeThreshold;
			// . 0 .
			// 0 0 0
			// . 0 .

			#if (FXAA_DISCARD == 1)
				if(earlyExit) FxaaDiscard;
			#else
				if(earlyExit) return rgbaM;
			#endif

			float contrastN = contrast( rgbaM, rgbaN );
			float contrastS = contrast( rgbaM, rgbaS );
			float contrastE = contrast( rgbaM, rgbaE );
			float contrastW = contrast( rgbaM, rgbaW );

			float relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );
			relativeVContrast *= fxaaQualityinvEdgeThreshold;

			bool horzSpan = relativeVContrast > 0.;
			// . 1 .
			// 0 0 0
			// . 1 .

			// 45 deg edge detection and corners of objects, aka V/H contrast is too similar
			if( abs( relativeVContrast ) < .3 ) {
				// locate the edge
				vec2 dirToEdge;
				dirToEdge.x = contrastE > contrastW ? 1. : -1.;
				dirToEdge.y = contrastS > contrastN ? 1. : -1.;
				// . 2 .      . 1 .
				// 1 0 2  ~=  0 0 1
				// . 1 .      . 0 .

				// tap 2 pixels and see which ones are "outside" the edge, to
				// determine if the edge is vertical or horizontal

				vec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongH = contrast( rgbaM, rgbaAlongH );
				// . 1 .
				// 0 0 1
				// . 0 H

				vec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongV = contrast( rgbaM, rgbaAlongV );
				// V 1 .
				// 0 0 1
				// . 0 .

				relativeVContrast = matchAlongV - matchAlongH;
				relativeVContrast *= fxaaQualityinvEdgeThreshold;

				if( abs( relativeVContrast ) < .3 ) { // 45 deg edge
					// 1 1 .
					// 0 0 1
					// . 0 1

					// do a simple blur
					return mix(
						rgbaM,
						(rgbaN + rgbaS + rgbaE + rgbaW) * .25,
						.4
					);
				}

				horzSpan = relativeVContrast > 0.;
			}

			if(!horzSpan) rgbaN = rgbaW;
			if(!horzSpan) rgbaS = rgbaE;
			// . 0 .      1
			// 1 0 1  ->  0
			// . 0 .      1

			bool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );
			if(!pairN) rgbaN = rgbaS;

			vec2 offNP;
			offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
			offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;

			bool doneN = false;
			bool doneP = false;

			float nDist = 0.;
			float pDist = 0.;

			vec2 posN = posM;
			vec2 posP = posM;

			int iterationsUsed = 0;
			int iterationsUsedN = 0;
			int iterationsUsedP = 0;
			for( int i = 0; i < NUM_SAMPLES; i++ ) {
				iterationsUsed = i;

				float increment = float(i + 1);

				if(!doneN) {
					nDist += increment;
					posN = posM + offNP * nDist;
					vec4 rgbaEndN = FxaaTexTop(tex, posN.xy);
					doneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );
					iterationsUsedN = i;
				}

				if(!doneP) {
					pDist += increment;
					posP = posM - offNP * pDist;
					vec4 rgbaEndP = FxaaTexTop(tex, posP.xy);
					doneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );
					iterationsUsedP = i;
				}

				if(doneN || doneP) break;
			}


			if ( !doneP && !doneN ) return rgbaM; // failed to find end of edge

			float dist = min(
				doneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,
				doneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.
			);

			// hacky way of reduces blurriness of mostly diagonal edges
			// but reduces AA quality
			dist = pow(dist, .5);

			dist = 1. - dist;

			return mix(
				rgbaM,
				rgbaN,
				dist * .5
			);
		}

		void main() {
			const float edgeDetectionQuality = .2;
			const float invEdgeDetectionQuality = 1. / edgeDetectionQuality;

			gl_FragColor = FxaaPixelShader(
				vUv,
				tDiffuse,
				resolution,
				edgeDetectionQuality, // [0,1] contrast needed, otherwise early discard
				invEdgeDetectionQuality
			);

		}
	`}},4646:function(e,t,i){"use strict";i.d(t,{Vs:()=>a,qf:()=>s});var n=i(1795);function r(e){let t,i,r;let a=-1,s=0;for(let n=0;n<e.length;++n){let o=e[n];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=o.itemSize),i!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===a&&(a=o.gpuType),a!==o.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=o.array.length}let o=new t(s),l=0;for(let t=0;t<e.length;++t)o.set(e[t].array,l),l+=e[t].array.length;let c=new n.TlE(o,i,r);return void 0!==a&&(c.gpuType=a),c}function a(e,t){if(t===n.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==n.z$h&&t!==n.UlW)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let i=e.getIndex();if(null===i){let t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}let r=i.count-2,a=[];if(t===n.z$h)for(let e=1;e<=r;e++)a.push(i.getX(0)),a.push(i.getX(e)),a.push(i.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(a.push(i.getX(e)),a.push(i.getX(e+1)),a.push(i.getX(e+2))):(a.push(i.getX(e+2)),a.push(i.getX(e+1)),a.push(i.getX(e)));a.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let s=e.clone();return s.setIndex(a),s.clearGroups(),s}}function s(e,t=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),function(e,t=!1){let i=null!==e[0].index,a=new Set(Object.keys(e[0].attributes)),s=new Set(Object.keys(e[0].morphAttributes)),o={},l={},c=e[0].morphTargetsRelative,h=new n.u9r,u=0;for(let n=0;n<e.length;++n){let r=e[n],d=0;if(i!==(null!==r.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in r.attributes){if(!a.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===o[e]&&(o[e]=[]),o[e].push(r.attributes[e]),d++}if(d!==a.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". Make sure all geometries have the same number of attributes."),null;if(c!==r.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in r.morphAttributes){if(!s.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===l[e]&&(l[e]=[]),l[e].push(r.morphAttributes[e])}if(t){let e;if(i)e=r.index.count;else{if(void 0===r.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". The geometry must have either an index or a position attribute"),null;e=r.attributes.position.count}h.addGroup(u,e,n),u+=e}}if(i){let t=0,i=[];for(let n=0;n<e.length;++n){let r=e[n].index;for(let e=0;e<r.count;++e)i.push(r.getX(e)+t);t+=e[n].attributes.position.count}h.setIndex(i)}for(let e in o){let t=r(o[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;h.setAttribute(e,t)}for(let e in l){let t=l[e][0].length;if(0===t)break;h.morphAttributes=h.morphAttributes||{},h.morphAttributes[e]=[];for(let i=0;i<t;++i){let t=[];for(let n=0;n<l[e].length;++n)t.push(l[e][n][i]);let n=r(t);if(!n)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" morphAttribute."),null;h.morphAttributes[e].push(n)}}return h}(e,t)}}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=e,i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},i.nc=void 0,i.b=document.baseURI||self.location.href;var n={};return(()=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.World=void 0,i(7911);var e=i(3985);Object.defineProperty(n,"World",{enumerable:!0,get:function(){return e.World}})})(),n})());
//# sourceMappingURL=sketchbook.min.js.map